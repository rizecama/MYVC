<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright © 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');
error_reporting(0);
jimport('joomla.application.component.controller');

class rfpcenterController extends JController
{

	function __construct()
	{
		parent::__construct();
	}

	function display()
	{
		parent::display();
	}

	function submitedrfp()
	{
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}

	function unsubmittedrfp()
	{

	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}

// by ananad babu
// function is for updating the  cam_rfpinfo  rft_type from drafts to Submitted
	function updateunsubmited()
	{

			$rfpid = JRequest::getVar('id','');
		$db =& JFactory::getDBO();
		$query = "UPDATE #__cam_rfpinfo SET rfp_type='rfp' WHERE id=".$rfpid;
		$db->setQuery( $query );
		$res=$db->query();
		if($res){
		echo "Sucessfully Submitted the RFP";
		}
		//$itemid= $_REQUEST['Itemid'];
		$msg= "Sucessfully Submitted the RFP";
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=unsubmittedrfp&Itemid='.$_REQUEST['Itemid'];
		$this->setRedirect($url,$msg);
	}

	function closedrfp()
	{
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}
	function awardrfp()
	{
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}
	function unawardrfp()
	{
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}
	function dashboard()
	{
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}
	function awardjob()
	{
	   $model = $this->getModel('rfpcenter');
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}
	function outsidevendor()
	{

	 // echo "<pre>"; print_r($_REQUEST);
	   $model = $this->getModel('rfpcenter');
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}

	function requote()
	{
	JRequest::getVar('view','rfpcenter');
     parent::display();
	}

	function requotesuccess()
	{
	  // print_r($_REQUEST); exit;
	   	$rid = JRequest::getVar('rid','');
		//*** Rfp Info **//
   		$db =& JFactory::getDBO();
		$query2="INSERT INTO #__cam_rfpinfo( `cust_id` , `property_id` , `rfp_indus_data` , `industry_id` , `projectName` , `startDate` , `endDate` , `frequency` , `proposalDueDate` , `proposalDueTime` , `maxProposals` , `createdDate` , `rfp_type` , `defsow_who` , `choose_tasks` , `work_perform` , `site_visit` , `bidders_info` , `publish` )
		SELECT `cust_id` , `property_id` , `rfp_indus_data` , `industry_id` , `projectName` , `startDate` , `endDate` , `frequency` , `proposalDueDate` , `proposalDueTime` , `maxProposals` , `createdDate` , `rfp_type` , `defsow_who` , `choose_tasks` , `work_perform` , `site_visit` , `bidders_info` , `publish`
		FROM #__cam_rfpinfo
		WHERE id =".$rid;

		$db->setQuery( $query2 );
		$res1=$db->query();

///*** Line task  ****//

	$insert_id = $db->insertid();
	$query3 ="INSERT INTO #__cam_rfpreq_info (`rfp_id`, `req_parentid`, `req_subparentid`, `req_id`, `price`) SELECT  '$insert_id', `req_parentid`, `req_subparentid`, `req_id`, `price` FROM #__cam_rfpreq_info WHERE rfp_id =".$rid;
	$db->setQuery( $query3 );
	$res2=$db->query();


		$query4 ="INSERT INTO #__cam_rfpsow_linetask (`rfp_id`, `linetaskname`, `rfpreference`, `taskuploads`, `task_desc`, `is_req_taskvendors`, `task_price`) SELECT  '$insert_id', `linetaskname`, `rfpreference`, `taskuploads`, `task_desc`, `is_req_taskvendors`, `task_price` FROM #__cam_rfpsow_linetask WHERE rfp_id =".$rid;
	$db->setQuery( $query4 );
	$res4=$db->query();


	 $query5 ="INSERT INTO #__cam_rfpsow_docs (`rfp_id`, `doc_path`, `is_req_docvendors`) SELECT  '$insert_id', `doc_path`, `is_req_docvendors` FROM #__cam_rfpsow_docs WHERE rfp_id =".$rid;
	$db->setQuery( $query5 );
	$res5=$db->query();
	//echo "<pre>"; print_r($res5); exit;
		$query7 = "UPDATE #__cam_vendor_proposals SET proposaltype='Unawarded' WHERE proposaltype!='draft' and proposaltype!='Draft' and proposaltype!='ITB' and rfpno=".$rid;
		$db->setQuery( $query7 );
		$res12=$db->query();

		$query16 = "UPDATE #__cam_rfpinfo SET rfp_type='draft' WHERE id=".$insert_id;
		$db->setQuery( $query16);
		$res16=$db->query();

		$today = date('m-d-Y');
		$query9 = "UPDATE #__cam_rfpinfo SET rfp_type='Unawarded',unawardeddate='$today' WHERE id=".$rid;
		$db->setQuery( $query9 );
		$res9=$db->query();
	$query6 = "SELECT U.email FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE C.rfpno=".$insert_id;
	//	$query = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded' WHERE id=".$id;
		$db->setQuery( $query6 );
		$data6 = $db->loadObjectlist();
		for ($i=0, $n=count( $data6); $i < $n; $i++)
	{
	if ($data6[$i]->email== ''){
	//echo "anand";
	} else {
	$mails = $data6[$i]->email;
	//echo "<pre>"; print_r($data1[$i]);
				$mailfrom = 'support@myvendorcenter.com';
				$fromname = 'MyVendorCenter.com';
				$assignuseremail = $mails;

				$mailsubject = 'MyVendorCenter Team';
				$body = "The proposals have all been rejected and the Property Manager will be re-bidding the job
	<br/><br/>At Your Service,<br/><br/>
	MyV.com";
				JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $useractivation,$mode = 1);

	}
	}
	if($res5){
	$msg="Your RFP Requoted Successfully";
	 }
	$link='index.php?option=com_camassistant&controller=rfpcenter&view=rfpcenter&task=requote&rfpid='.$insert_id.'&Itemid=56';
	$this->setRedirect( $link,$msg );
	}
	function proposalawarding()
	{
	   $model = $this->getModel('rfpcenter');
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}

	function verfiryaward()
	{

		$db =& JFactory::getDBO();
		$type=$_POST[queryString];
		//print_r($type); exit;
		if ( $type != "")
		{
		$query_email="SELECT * FROM #__cam_vendor_proposals WHERE proposaltype='$type'";
		$db->setQuery( $query_email );
		$result_email = $db->loadObjectlist();
	//	print_r($result_email);
		if ( $result_email){ $data="invalid"; }}
		echo $data;
		exit;
		return  $data;
   }
   function price()
	{

		$db =& JFactory::getDBO();
		$type=$_POST[queryString];
	//	print_r($type); exit;
		if ( $type != "")
		{
		$query_email="SELECT proposal_total_price FROM #__cam_vendor_proposals WHERE id='$type'";
		$db->setQuery( $query_email );
		$data = $db->loadResult();
		}
	//	print_r($result_email);
		//if ( $result_email){ $data="invalid"; }}
		echo number_format($data,2);
		
		exit;
		return  $data;
   }



	function awardedsuccess()
	{

		$rfpno = JRequest::getVar('rfpno','');
		$radioid = JRequest::getVar('radioid',array());

		$comission = JRequest::getVar('comission','');
		$shareinfo = JRequest::getVar('shareinfo','');
		
		//$comission = str_replace(',', '', $comission1);
		//$comission1 = doubleval(str_replace(",","",$comission2));
	 	//$comission = number_format($comission1,2,'.','');

		$email = JRequest::getVar('email','');
		
		//$radioid = JRequest::getVar('radioid','');
		$radioid[0] = JRequest::getVar('proposalid','');
		$name = JRequest::getVar('name','');
		$price1 = JRequest::getVar('v_price','');
		//echo $price2 = CAST( $price1 AS UNSIGNED );
		$price2 = doubleval(str_replace(",","",$price1));
	 	$price = number_format($price2,2,'.','');
		 //echo '<pre>'; print_r($_REQUEST); exit;
		 //$email1 = $email[$radioid];
		 $db =& JFactory::getDBO();
		 $award = "SELECT U.id,U.email,U.ccemail,U.name,U.lastname,C.rfpno FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE C.id=".$radioid[0]." and C.rfpno=".$rfpno;
		//$query = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded' WHERE id=".$id;
		$db->setQuery( $award );
		$award_data = $db->loadObjectlist();
		
		$lname = $award_data[0]->lastname;
		$username = $award_data[0]->name;
        $fullname= $username.' '.$lname;
		$email1=$award_data[0]->email;
		
		$award_ccemails=$award_data[0]->ccemail;
		//To get the winning amount to the awarded vendor
		/*$win_amt = "SELECT proposal_total_price FROM  #__cam_vendor_proposals  WHERE id=".$radioid[0]." and rfpno=".$rfpno;
		$db->setQuery( $win_amt );
		$winningamt = $db->loadResult();*/

		//Completed
		$query = "SELECT DISTINCT U.id,U.email,U.name,U.lastname,C.rfpno FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE C.id!=".$radioid[0]." and C.proposedvendorid!=".$award_data[0]->id." and C.rfpno=".$rfpno." and (C.proposaltype='Submit' or C.proposaltype='resubmit' or C.proposaltype='submit' or C.proposaltype='resubmit') ";
		//$query = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded' WHERE id=".$id;
		$db->setQuery( $query );
		$data1 = $db->loadObjectlist();
		
		$query2 = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded',proposal_total_price='$price',commission = '$comission'  WHERE id=".$radioid[0];
		$db->setQuery( $query2 );
		$res=$db->query();
		//To get the winning amount to the awarded vendor
		$win_amt = "SELECT proposal_total_price FROM  #__cam_vendor_proposals  WHERE id=".$radioid[0]." and rfpno=".$rfpno;
		$db->setQuery( $win_amt );
		$winningamt = $db->loadResult();
		$price2 = doubleval(str_replace(",","",$winningamt));
	 	$price = number_format($price2,2,'.','');
		$winamts = "$".number_format($price,2);

	
		$today = date('m-d-Y');
		$query6 = "UPDATE #__cam_rfpinfo SET rfp_type='Awarded',awardeddate='$today' WHERE id=".$rfpno;
		$db->setQuery( $query6 );
		$res4=$db->query();
		
		$query3 = "UPDATE #__cam_vendor_proposals SET proposaltype='Unawarded' WHERE id!=".$radioid[0]." and proposaltype!='draft' and proposaltype!='Draft' and proposaltype!='ITB' and rfpno=".$rfpno;
		$db->setQuery( $query3 );
		$res1=$db->query();

		
		$query4 ="SELECT proposedvendorid FROM #__cam_vendor_proposals WHERE rfpno=".$rfpno." and proposaltype='Awarded'";
		$db->setQuery( $query4 );
		$data4 = $db->loadResult();
		$query5 = "INSERT INTO #__cam_awardlist ( id , rfpid , proposal_id, user_id ) VALUES (  '' , '".$rfpno."','".$radioid[0]."', '".$data4."' );";
		$db->setQuery( $query5 );
		$res5=$db->query();

		
		
		$property_id = "SELECT P.id FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_id );
		$property_id = $db->loadResult();
		
		 $awardingper = "SELECT awarding_p FROM #__cam_propertyowner_link WHERE property_id=".$property_id;
		$db->setQuery( $awardingper );
		$awardingper = $db->loadResult();
		
		if($awardingper == 1)
		{
		$updateper = "UPDATE #__cam_rfpinfo SET awardjobaproval='1' WHERE id=".$rfpno;
		$db->setQuery( $updateper );
		$db->query();
		}
		
		for ($i=0, $n=count( $data1); $i < $n; $i++)
		{
		if ($data1[$i]->email== ''){
		//echo "anand";
		} else {
		//echo "<pre>"; print_r($data1[$i]);

		$mails = $data1[$i]->email;
		
		$name = $data1[$i]->name;
		$lname = $data1[$i]->lastname;
		$rfpno = $data1[$i]->rfpno;
		//echo "<pre>"; print_r($data1[$i]);
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$assignuseremail = $mails;
		$username=$name.' '.$lname;
		$mailsubject = 'Job update from MyVendorCenter';
		//For getting the rejected emil
		if( $shareinfo == 'yes' )
		$articleid = '157';
		else
		$articleid = '307';
		$query_rejectedemail ="SELECT introtext  FROM #__content where id='".$articleid."' ";
		$db->setQuery( $query_rejectedemail );
		$body = $db->loadResult();
		
		//$body = $rej_email;
			//echo "<pre>"; echo "regect"; print_r($assignuseremail);
		$user=JFactory::getUser();
		$db = & JFactory::getDBO();
		$property_name = "SELECT P.property_name FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_name );
		$propertyname1 = $db->loadResult();
		$propertyname = str_replace('_',' ',$propertyname1);
		$company_name = "SELECT comp_name FROM #__cam_customer_companyinfo  WHERE cust_id=".$user->id;
		$db->setQuery( $company_name );
		$companyname = $db->loadResult();


		$Bid_sql = "SELECT  (select count(*)  from jos_cam_vendor_proposals where rfpno=".$rfpno." AND proposaltype = 'Submit') as Submitted, (select count(*)  from jos_cam_vendor_proposals where rfpno=".$rfpno." AND proposaltype = 'Reject') as Rejected, MAX(CAST( proposal_total_price AS UNSIGNED )) as Max_Bid, MIN(CAST( proposal_total_price AS UNSIGNED )) as Min_Bid FROM #__cam_vendor_proposals  WHERE publish!=2 and proposal_total_price != '0.00' and proposal_total_price != '' and rfpno = ".$rfpno;
		$db->setQuery($Bid_sql);
		$Bid_info = $db->loadObjectList();
		//echo "<pre>"; print_r($Bid_info[0]); exit;
		$Min_Bid1 = doubleval(str_replace(",","",$Bid_info[0]->Min_Bid));
	 	$Min_Bid = number_format($Min_Bid1,2,'.','');
		$Max_Bid1 = doubleval(str_replace(",","",$Bid_info[0]->Max_Bid));
	 	$Max_Bid = number_format($Max_Bid1,2,'.','');
                if($price > $Max_Bid){
                   $Max_Bid=  $price;
                }
                if ($price < $Min_Bid) {
                    $Min_Bid =$price;
                }
		$Min_Bid = doubleval(str_replace(",","",$Min_Bid));
	 	$Min_Bid = number_format($Min_Bid,2,'.','');
		$Min_Bid = "$".number_format($Min_Bid,2);

		$Max_Bid = doubleval(str_replace(",","",$Max_Bid));
	 	$Max_Bid = number_format($Max_Bid,2,'.','');
		$Max_Bid = "$".number_format($Max_Bid,2);

		//completd
		$body = str_replace('{Vendor Name}',$username,$body) ;
		$body = str_replace('{RFP NUMBER}',$rfpno,$body) ;
		$body = str_replace('{Property Name}',$propertyname,$body);
		$body = str_replace('{CAM Firm}',$companyname,$body);
		$body = str_replace('{winning Bid}',$winamts,$body);
		$body = str_replace('{Low Bid}',$Min_Bid,$body);
		$body = str_replace('{High Bid}',$Max_Bid,$body);
		//echo "<pre>"; print_r($body); exit;
		//echo "<pre>";  echo "reject"; print_r($body);
		//CAMassistant.com";
		// Get property copy vendors option
		$property_copy = "SELECT P.copyvendor FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_copy );
		$copyvendor = $db->loadResult();
		
				
			JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
			$vendoremail = 'vendoremails@myvendorcenter.com';
			$rize_email = 'rize.cama@gmail.com';
			JUtility::sendMail($mailfrom, $fromname, $rize_email, $mailsubject, $body, $mode = 1);
			JUtility::sendMail($mailfrom, $fromname, $vendoremail, $mailsubject, $body, $mode = 1);
			//To send the email to cc emails of the vendors
			$query_cc ="select ccemail from #__users Where id =".$data1[$i]->id;
			$db->setQuery($query_cc);
			$cc = $db->loadResult();
			$cclist = explode(';',$cc);
			for($c=0; $c<count($cclist); $c++){
			$listcc = $cclist[$c];
			if($listcc != ''){
			$res = JUtility::sendMail($mailfrom, $fromname, $listcc, $mailsubject, $body, $mode=1);
			}
			}
		

		// parent::display();
		}
		}
 	//To send the unawarded email only once
		$rejectedmails = '';
		for ($ua=0, $cv=count( $data1); $ua < $cv; $ua++) {
		$rejectedmails .= $data1[$ua]->name.' '.$data1[$ua]->lastname.',';
		}
		$ericemail = 'vendoremails@myvendorcenter.com';
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$mailsubject = 'Job update from MyVendorCenter';
		$body = $body;
		JUtility::sendMail($mailfrom, $fromname, $ericemail, $mailsubject, $body, $mode = 1);
		$rejectedmails = '';
		//Completed

		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$assignuseremail = $email1;
		
		// To get the vendor company
		$v_c_name = "SELECT company_name FROM  #__cam_vendor_company where user_id=".$data4;
		$db->setQuery( $v_c_name );
		$v_cname = $db->loadResult();
		//Completed
		$model = $this->getModel('rfpcenter');
		$revised_mail_ps = $model->getrevisedmessage($rfpno);
		$revised_mail = html_entity_decode($revised_mail_ps);
		$revised_mail = str_replace('{devider}','',$revised_mail);
		if( !$revised_mail ) {
		$query_acceceptemail ="SELECT introtext  FROM #__content where id='156' ";
		$db->setQuery( $query_acceceptemail );
		$body = $db->loadResult();
		$body = str_replace('{devider}','',$body);
		}
		else{
		$body = $revised_mail;
		}
		$property_name = "SELECT P.property_name FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_name );
		$propertyname1 = $db->loadResult();
		$propertyname = str_replace('_',' ',$propertyname1);
		
		
		
		$user=JFactory::getUser();
		//print_r($user->user_type);
		 $customer_name = $user->name.' '.$user->lastname;
	 $camfirm_id = "SELECT P.cust_id FROM #__cam_customer_companyinfo as C LEFT JOIN #__cam_camfirminfo as P ON P.id=C.comp_id WHERE C.cust_id=".$user->id;
		$db->setQuery( $camfirm_id );
		$camfirmid = $db->loadResult();
		 $camfirm_name = "SELECT name,lastname FROM #__users WHERE id=".$camfirmid;
		$db->setQuery( $camfirm_name );
		$camfirmname = $db->loadObjectlist();
		$camfirm_admin= $camfirmname[0]->name.'&nbsp;'.$camfirmname[0]->lastname;
		//print_r($camfirm_admin);
		$company_name = "SELECT comp_name FROM #__cam_customer_companyinfo  WHERE cust_id=".$user->id;
		$db->setQuery( $company_name );
		$cname = $db->loadResult();

		if($user->user_type=='13'){
		$camadmin = $customer_name;
		} else {
		$camadmin = $camfirm_admin;
		}
		//echo "accept"; print_r($assignuseremail);
		
		$body = str_replace('{Vendor Name}',$v_cname,$body) ;
		$body = str_replace('{RFP NUMBER}',$rfpno,$body);
		$body = str_replace('{Property Name}',$propertyname,$body);
		
		//$body = str_replace('{Customer}',$customer_name,$body);
		if($user->user_type=='13'){
		$body = str_replace('{Customer}',$customer_name,$body);
		$body = str_replace('{CAM Firm}',$cname,$body);
		} else {
		$body = str_replace('{Customer}',$customer_name,$body);
		$body = str_replace('{CAM Firm}',$cname,$body);
		}
		$body = str_replace('{winning Bid}',$winamts,$body);
		
		$mailsubject = 'Project awarded to you through MyVendorCenter';
		//$bcc='awardedjob@myvendorcenter.com';
		$assignuseremail_vsupport = 'vendoremails@myvendorcenter.com';
		$rize_email = 'rize.cama@gmail.com';
		
		if( $awardingper != 1 )
		{
		
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail,$mailsubject, $body, $mode = 1);
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail_vsupport,$mailsubject, $body, $mode = 1);
		JUtility::sendMail($mailfrom, $fromname, $rize_email,$mailsubject, $body, $mode = 1);
		//Mail to the awarded vendor cc emails
		$cclist_v = explode(';',$award_ccemails);
		for($c=0; $c<count($cclist_v); $c++){
		$listcc_v = $cclist_v[$c];
		if($listcc_v != ''){
		$res = JUtility::sendMail($mailfrom, $fromname, $listcc_v, $mailsubject, $body, $mode=1);
		}
		}
		}
		//Completed
		//Mail to the manager
		$pr_name = "SELECT projectName FROM #__cam_rfpinfo WHERE id=".$rfpno;
		$db->setQuery( $pr_name );
		$projectName = $db->loadResult();
		
		$vendor_cname = "SELECT U.company_name FROM  #__cam_vendor_proposals as C LEFT JOIN #__cam_vendor_company as U ON U.user_id=C.proposedvendorid WHERE C.id=".$radioid[0];
		$db->setQuery( $vendor_cname );
		$vendor_company_name = $db->loadResult();
		$manageremail_body ="SELECT introtext  FROM #__content where id='247' ";
		$db->setQuery( $manageremail_body );
		$managerbody = $db->loadResult();
		$managerbody = str_replace('{Reference Name}',$projectName,$managerbody) ;
		$managerbody = str_replace('{Vendor Name}',$fullname,$managerbody) ;
		$managerbody = str_replace('{Vendor Company Name}',$vendor_company_name,$managerbody) ;
		$managerbody = str_replace('{RFP NUMBER}',$rfpno,$managerbody);
		$managerbody = str_replace('{Property Name}',$propertyname,$managerbody);
		if($user->user_type=='13'){
		$managerbody = str_replace('{Customer}',$customer_name,$managerbody);
		$managerbody = str_replace('{CAM Firm}',$cname,$managerbody);
		} else {
		$managerbody = str_replace('{Customer}',$customer_name,$managerbody);
		$managerbody = str_replace('{CAM Firm}',$cname,$managerbody);
		}
		$managerbody = str_replace('{winning Bid}',$winamts,$managerbody);
		$manageremail = $user->email ;
		//JUtility::sendMail($mailfrom, $fromname, $manageremail,$mailsubject, $managerbody, $mode = 1);
		//$manageremail_support = 'vipin@rizecorp.net';
		$manageremail_support = 'manageremails@myvendorcenter.com';
		//JUtility::sendMail($mailfrom, $fromname, $manageremail_support,$mailsubject, $managerbody, $mode = 1);
		//Completed
         	$rize_email = 'rize.cama@gmail.com';
			JUtility::sendMail($mailfrom, $fromname, $rize_email,$mailsubject, $managerbody, $mode = 1);
		//JUtility::sendMail($mailfrom, $fromname, $bcc, $mailsubject, $body, $mode = 1);

		//To send the email to cc emails of the vendors
		$query_cc ="select ccemail from #__users Where id =".$award_data[0]->id;
		$db->setQuery($query_cc);
		$cc = $db->loadResult();
		$cclist = explode(';',$cc);
		for($c=0; $c<count($cclist); $c++){
		$listcc = $cclist[$c];
		if( $listcc != ''  ){
		$res = JUtility::sendMail($mailfrom, $fromname, $listcc, $mailsubject, $body, $mode=1);
		}
		}
		//Completed


		// parent::display();

		// Sending mails to outside vendors
		$other_vendors ="SELECT companyname, emailid, id FROM #__cam_external_vendors where rfpid='".$rfpno."' ";
		$db->setQuery( $other_vendors );
		$outsides = $db->loadObjectList();
		if($outsides){
			for($o=0; $o<count($outsides); $o++) {
					if($outsides[$o]->emailid) {
						$mailfrom = $user->email;
						$fromname = 'MyVendorCenter.com';
						$outervendor = $outsides[$o]->emailid ;
						$reject_outer ="SELECT introtext  FROM #__content where id='282' ";
						$db->setQuery( $reject_outer );
						$rejectouter1 = $db->loadResult();
						$managerfullname = $user->name.'&nbsp;'.$user->lastname ;
						$aetmanbodya = str_replace('[Vendor Company Name]',$outsides[$o]->companyname,$rejectouter1) ;
						$aetmanbodya = str_replace('[Project Name]',$projectName,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager Full Name]',$customer_name,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager Company Name]',$cname,$aetmanbodya) ;
						$aetmanbodya = str_replace('[manager email]',$user->email,$aetmanbodya) ;
						
						$mailsubject = "You're proposal has been rejected through MyVendorCenter";
						if ( $awardingper != 1 )
						{
						JUtility::sendMail($mailfrom, $fromname, $outervendor,$mailsubject, $aetmanbodya, $mode = 1);
						$outervendor_support = 'vendoremails@myvendorcenter.com';
						JUtility::sendMail($mailfrom, $fromname, $outervendor_support,$mailsubject, $aetmanbodya, $mode = 1);
				}
			}	
		}
		}
		//Completed
		
		$user = JFactory::getUser();
		if($user->user_type == '12' || $user->user_type == '16'){
		$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=awardrfp&Itemid=130';
		}
		if($user->user_type == '13'){
		$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=awardrfp&Itemid=123';
		}

		$msg="Job Awarded Successfully";
		$this->setRedirect( $link,$msg );
		//modifying end by anand kumar on 21-7-11

	}
	function unawardingjob()
	{
	   $model = $this->getModel('rfpcenter');
	   $unawardingjob = $model->getunawardingjob();
	   //print_r($unawardingjob);
	   JRequest::getVar('view','rfpcenter');
	   parent::display();
	}
	function copydraft()
	{
	  $user = JFactory::getUser();
	 	$rid = JRequest::getVar('rfpid','');
		//*** Rfp Info **//
   		$db =& JFactory::getDBO();
		$query2="INSERT INTO #__cam_rfpinfo( `cust_id` , `rfp_indus_data` , `industry_id` , `projectName` , `startDate` , `endDate` , `frequency` , `proposalDueDate` , `proposalDueTime` , `maxProposals` , `createdDate` , `rfp_type` , `defsow_who` , `choose_tasks` , `work_perform` , `site_visit` , `bidders_info` , `publish`, `jobtype`, `jobnotes` )
		SELECT `cust_id` , `rfp_indus_data` , `industry_id` , `projectName` , `startDate` , `endDate` , `frequency` , `proposalDueDate` , `proposalDueTime` , `maxProposals` , `createdDate` , `rfp_type` , `defsow_who` , `choose_tasks` , `work_perform` , `site_visit` , `bidders_info` , `publish`, `jobtype`, `jobnotes`
		FROM #__cam_rfpinfo
		WHERE id =".$rid;

		$db->setQuery( $query2 );
		$res1=$db->query();

///*** Line task  ****//

	 $insert_id = $db->insertid();
	 $query3 ="INSERT INTO #__cam_rfpreq_info (`rfp_id`, `req_parentid`, `req_subparentid`, `req_id`, `price`) SELECT  '$insert_id', `req_parentid`, `req_subparentid`, `req_id`, `price` FROM #__cam_rfpreq_info WHERE rfp_id =".$rid;
	$db->setQuery( $query3 );
	$res2=$db->query();
	 $query4 ="INSERT INTO #__cam_rfpsow_linetask (`rfp_id`, `linetaskname`, `rfpreference`, `taskuploads`, `task_desc`, `is_req_taskvendors`, `task_price`) SELECT  '$insert_id', `linetaskname`, `rfpreference`, `taskuploads`, `task_desc`, `is_req_taskvendors`, `task_price` FROM #__cam_rfpsow_linetask WHERE rfp_id =".$rid;
	$db->setQuery( $query4 );
	$res4=$db->query();

// To copy the special requirements
$industryid ="SELECT industry_id  FROM #__cam_rfpinfo where id=".$rid." ";
$db->setQuery( $industryid );
$industry_id = $db->loadResult();
$masteraccount = $this->getmasterfirmaccount();
$query_general ="INSERT INTO #__cam_master_generalinsurance_standards_rfps (`masterid`, `rfpid`, `occur`, `each_occurrence`, `damage_retend`, `med_expenses`, `personal_inj`,`general_aggr`, `applies_to`, `products_aggr`, `waiver_sub`, `primary_noncontr`, `additional_insured`, `cert_holder`, `created_date`) SELECT  `masterid`, '$insert_id', `occur`, `each_occurrence`, `damage_retend`, `med_expenses`, `personal_inj`,`general_aggr`, `applies_to`, `products_aggr`, `waiver_sub`, `primary_noncontr`, `additional_insured`, `cert_holder`, `created_date` FROM #__cam_master_generalinsurance_standards WHERE masterid =".$masteraccount." and industry_id=".$industry_id." ";
	$db->setQuery( $query_general );
	$general = $db->query();
	
$query_auto ="INSERT INTO #__cam_master_autoinsurance_standards_rfps (`masterid`, `rfpid`, `applies_to_any`, `applies_to_owned`, `applies_to_nonowned`, `applies_to_hired`, `applies_to_scheduled`,`combined_single`, `bodily_injusy_person`, `bodily_injusy_accident`, `property_damage`, `waiver`, `primary`, `additional_ins`, `cert_holder`) SELECT  `masterid`, `rfpid`, `applies_to_any`, `applies_to_owned`, `applies_to_nonowned`, `applies_to_hired`, `applies_to_scheduled`,`combined_single`, `bodily_injusy_person`, `bodily_injusy_accident`, `property_damage`, `waiver`, `primary`, `additional_ins`, `cert_holder` FROM #__cam_master_autoinsurance_standards WHERE masterid =".$masteraccount." and industryid=".$industry_id." ";
	$db->setQuery( $query_auto );
	$auto = $db->query();
		
$query_workers ="INSERT INTO #__cam_master_workers_standards_rfps (`masterid`, `rfpid`, `workers_not`, `each_accident`, `disease_policy`, `disease_eachemp`, `waiver_work`,`certholder_work`, `workers_accepted`, `createddate`) SELECT  `masterid`, `rfpid`, `workers_not`, `each_accident`, `disease_policy`, `disease_eachemp`, `waiver_work`,`certholder_work`, `workers_accepted`, `createddate` FROM #__cam_master_workers_standards WHERE masterid =".$masteraccount." and industryid=".$industry_id." ";
	$db->setQuery( $query_workers );
	$workers = $db->query();
	
$query_umbrella ="INSERT INTO #__cam_master_umbrellainsurance_standards_rfps (`masterid`, `rfpid`, `each_occur`, `aggregate`, `certholder_umbrella`, `created_date`) SELECT  `masterid`, `rfpid`, `each_occur`, `aggregate`, `certholder_umbrella`, `created_date` FROM #__cam_master_umbrellainsurance_standards WHERE masterid =".$masteraccount." and industryid=".$industry_id." ";
	$db->setQuery( $query_umbrella );
	$umbrella = $db->query();
	
$query_lic ="INSERT INTO #__cam_master_licinsurance_standards_rfps (`masterid`, `rfpid`, `professional`, `occupational`, `created_date`) SELECT  `masterid`, `rfpid`, `professional`, `occupational`, `created_date` FROM #__cam_master_licinsurance_standards WHERE masterid =".$masteraccount." and industryid=".$industry_id." ";
	$db->setQuery( $query_lic );
	$lic = $db->query();
//Completed


	 $query5 ="INSERT INTO #__cam_rfpsow_docs (`rfp_id`, `doc_path`, `is_req_docvendors`) SELECT  '$insert_id', `doc_path`, `is_req_docvendors` FROM #__cam_rfpsow_docs WHERE rfp_id =".$rid;
	$db->setQuery( $query5 );
	$res5=$db->query();
	
	$property ="SELECT property_id  FROM #__cam_rfpinfo where id=".$rid." ";
		$db->setQuery( $property );
		$propertyid = $db->loadResult();


    $copy ="INSERT INTO #__cam_copyrfp ( `new_rfpid`, `old_rfpid`, `old_propertyid`) VALUES ( '".$insert_id."','".$rid."', '".$propertyid."' );";
	$db->setQuery( $copy );
	$copy_rfp =$db->query();

	//echo "<pre>"; print_r($res5); exit;
		$query7 = "UPDATE #__cam_rfpinfo SET rfp_type='draft' WHERE id=".$insert_id;
		$db->setQuery( $query7 );
		$res12=$db->query();
		$query8 = "UPDATE #__cam_rfpinfo SET cust_id=".$user->id." WHERE id=".$insert_id;
		$db->setQuery( $query8 );
		$res13=$db->query();

		//$query9 = "UPDATE #__cam_rfpinfo SET rfp_type='Unawarded' WHERE id=".$rid;
		//$db->setQuery( $query9 );
		//$res9=$db->query();
		//Insertign rfp industries

		$industries ="SELECT rfpid,industry_id  FROM #__cam_rfpindustries where rfpid=".$rid." ";
		$db->setQuery( $industries );
		$industrieslist = $db->loadObjectList();
//		echo "<pre>"; print_r($industrieslist); exit;
		for($ind=0; $ind<count($industrieslist); $ind++){
			$insert_indus = "insert into #__cam_rfpindustries values ('','".$insert_id."','".$industrieslist[$ind]->industry_id."')";
			$db->SetQuery($insert_indus);
			$db->query();
		}

		//Completed
		$jobtype ="SELECT jobtype  FROM #__cam_rfpinfo where id=".$rid." ";
		$db->setQuery( $jobtype );
		$job_type = $db->loadResult();
	
		if($res5){
		$msg='Copy as "A New (Draft) RFP" successful';
	 	}
		if($job_type == 'yes'){
		$link='index.php?option=com_camassistant&controller=rfp&task=editrfp&var=copy&rfpid='.$insert_id.'&job=basic&Itemid='.$_REQUEST['Itemid'];
		}
	
		else{
		$link='index.php?option=com_camassistant&controller=rfp&task=editrfp&var=copy&rfpid='.$insert_id.'&Itemid='.$_REQUEST['Itemid'];
		}
	$this->setRedirect( $link,$msg );

	}
	function unawardingsuccess_popup()
	{
	//print_r($_REQUEST); exit;
		$model = $this->getModel('rfpcenter');
		$rejection_letter = JRequest::getVar('box','');
		$other = JRequest::getVar('other','');
		$rfpno = JRequest::getVar('rfpno','');


		$unawarding['id']= $id;
		$unawarding['rfpno']= $rfpno;
    	$unawarding['rejection_letter']= $rejection_letter;
		$unawarding['other']= $other;

		$model = $this->getModel('rfpcenter');
		//print_r($model); exit;
	 	 if($model->store_unaward($unawarding)) {
		$db =& JFactory::getDBO();
		$query2 = "SELECT U.email,U.name,U.lastname,C.id,C.proposedvendorid FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE C.rfpno=".$rfpno." and C.proposaltype!='uninvited' and ( C.proposaltype='submit' or C.proposaltype='Submit' ) ";
	//	$query = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded' WHERE id=".$id;
		$db->setQuery( $query2 );
		$data2 = $db->loadObjectlist();
	

		$today = date('m-d-Y');
		$query9 = "UPDATE #__cam_rfpinfo SET rfp_type='Unawarded',unawardeddate='$today' WHERE id=".$rfpno;
		$db->setQuery( $query9 );
		$res9=$db->query();

		$query3 = "UPDATE #__cam_vendor_proposals SET proposaltype='Unawarded' WHERE proposaltype!='draft' and proposaltype!='uninvited' and proposaltype!='Draft' and proposaltype!='ITB' and rfpno=".$rfpno;
		$db->setQuery( $query3 );
		$res=$db->query();
    
	if($res){
		//echo "All proposals are rejected Successfully";
		}
	for ($i=0, $n=count( $data2); $i < $n; $i++)
	{
	if ($data2[$i]->email== ''){
	//echo "anand";
	} else {
	$mails = $data2[$i]->email;
	$name=$data2[$i]->name;
	$proposalid=$data2[$i]->id;
	$lastname=$data2[$i]->lastname;
	$vendorid=$data2[$i]->proposedvendorid;
	$fullname=$name.' '.$lastname;
	// To check the vendor declined or not
	$declined_sql ="SELECT not_interested FROM #__cam_vendor_availablejobs where rfp_id='".$rfpno."' and user_id=".$vendorid." ";
	$db->setQuery( $declined_sql );
	$declined = $db->loadResult();
	//Completed
	//To get the property name
	$pr_manager ="SELECT u.property_name, v.projectName FROM #__cam_property as u, #__cam_rfpinfo as v where u.id = v.property_id and v.id='".$rfpno."' ";
	$db->setQuery( $pr_manager );
	$rfp_details = $db->loadObject();
	$pm = $rfp_details->property_name ;
	$projectName = $rfp_details->projectName ;

	$vendor_cname ="SELECT company_name FROM #__cam_vendor_company where user_id='".$vendorid."' ";
	$db->setQuery( $vendor_cname );
	$vendorcname = $db->loadResult();
	
	$user = JFactory::getUser();
	$managerid=$user->id;
	$manager_cname ="SELECT comp_name FROM #__cam_customer_companyinfo where cust_id='".$managerid."' ";
	$db->setQuery( $manager_cname );
	$managercname = $db->loadResult();
	//Completed
	//echo "<pre>"; print_r($data1[$i]);
	$mailfrom = 'support@myvendorcenter.com';
	$fromname = 'MyVendorCenter.com';
	$assignuseremail = $mails;
	//$assignuseremail = 'rize.cama@gmail.com';
	$mailsubject = 'Job update from MyVendorCenter';
	$rejectedemail ="SELECT introtext  FROM #__content where id='277' ";
	$db->setQuery( $rejectedemail );
	$body = $db->loadResult();
	
	$user = JFactory::getUser();
	$managername = $user->name.' '.$user->lastname ;
	if($rejection_letter == 'other')
	{
		$rejection_letter = 'Other:' ;
	}
		$body = str_replace('[Vendor Company Name]',$vendorcname,$body) ;
		$body = str_replace('[RFPID]',$rfpno,$body);
		$body = str_replace('[Property Name]',str_replace('_',' ',$pm),$body);
		$body = str_replace('[Project Name]',$projectName,$body);
		$body = str_replace('[Manager Name]',$managername,$body);
		$body = str_replace('[Manager Company Name]',$managercname,$body);
		$body = str_replace('[reason]',$rejection_letter.'&nbsp;'.$other,$body);
		
		if($declined != '2') {
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
		$to_support = 'vendoremails@myvendorcenter.com';
		
		JUtility::sendMail($mailfrom, $fromname, $to_support, $mailsubject, $body, $mode = 1);
		$to_support_sk = 'sk4576@gmail.com';
		JUtility::sendMail($mailfrom, $fromname, $to_support_sk, $mailsubject, $body, $mode = 1);
		//To send the email to cc emails of the vendors
		$query_cc ="select ccemail from #__users Where id =".$vendorid;
		$db->setQuery($query_cc);
		$cc = $db->loadResult();
		$cclist = explode(';',$cc);

			for($c=0; $c<count($cclist); $c++){
			$listcc = $cclist[$c];
				if($listcc != ''){
				$res = JUtility::sendMail($mailfrom, $fromname, $listcc, $mailsubject, $body, $mode=1);
				}
			}
		}	
		//Completed
		}//Else condition completed
		
		} //For loop is completed
		$assignuseremail1 = 'rfp@myvendorcenter.com';
		$body = "<font color='red'>This is for Support team</font><br><br>".$body;
		//JUtility::sendMail($mailfrom, $fromname, $assignuseremail1, $mailsubject, $body, $mode = 1);
		}
		 $user = JFactory::getUser();
		 if($user->user_type == '12'){
			$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=128';
			}
			if($user->user_type == '13' || $user->user_type == '16'){
			$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
			}
			$doc =& JFactory::getDocument();
			echo '<script>parent.location="'.$link.'";</script>';
			exit;
		// $msg="Thank";
	//	$this->setRedirect( $link,$msg );
	}

	function unawardingsuccess()
	{
	//print_r($_REQUEST); exit;
		$model = $this->getModel('rfpcenter');
	 //  $unawardingjob = $model->getunawardingjob();
		$rejection_letter = JRequest::getVar('box','');
		$other = JRequest::getVar('other','');
		$rfpno = JRequest::getVar('rid','');


		$unawarding['id']= $id;
		$unawarding['rfpno']= $rfpno;
    	$unawarding['rejection_letter']= $rejection_letter;
		$unawarding['other']= $other;

		$model = $this->getModel('rfpcenter');
		//print_r($model); exit;
	 	 if($model->store_unaward($unawarding)) {
		$db =& JFactory::getDBO();
		$query2 = "SELECT U.email,U.name,U.lastname,C.id,C.proposedvendorid FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE ( proposaltype='Submit' || proposaltype='submit') and  C.rfpno=".$rfpno;
		
	//	$query = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded' WHERE id=".$id;
		$db->setQuery( $query2 );
		$data2 = $db->loadObjectlist();
     
		$today = date('m-d-Y');
		$query9 = "UPDATE #__cam_rfpinfo SET rfp_type='Unawarded',unawardeddate='$today' WHERE id=".$rfpno;
		$db->setQuery( $query9 );
		$res9=$db->query();

		$query3 = "UPDATE #__cam_vendor_proposals SET proposaltype='Unawarded' WHERE proposaltype!='draft' and proposaltype!='Draft' and proposaltype!='ITB' and rfpno=".$rfpno;
		$db->setQuery( $query3 );
		$res=$db->query();

	if($res){
		echo "all proposals are rejected Successfully";
		}
	for ($i=0, $n=count( $data2); $i < $n; $i++)
	{
	if ($data2[$i]->email== ''){
	//echo "anand";
	} else {
	$mails = $data2[$i]->email;
	$name=$data2[$i]->name;
	$proposalid=$data2[$i]->id;
	$lastname=$data2[$i]->lastname;
	$vendorid=$data2[$i]->proposedvendorid;
	$fullname=$name.' '.$lastname;
	//To get the property name
	$pr_manager ="SELECT u.property_name, v.projectName FROM #__cam_property as u, #__cam_rfpinfo as v where u.id = v.property_id and v.id='".$rfpno."' ";
	$db->setQuery( $pr_manager );
	$rfp_details = $db->loadObject();
	$pm = $rfp_details->property_name ;
	$projectName = $rfp_details->projectName ;

	$vendor_cname ="SELECT company_name FROM #__cam_vendor_company where user_id='".$vendorid."' ";
	$db->setQuery( $vendor_cname );
	$vendorcname = $db->loadResult();
	$user = JFactory::getUser();
	$manager_cname ="SELECT comp_name FROM #__cam_customer_companyinfo where cust_id='".$user->id."' ";
	$db->setQuery( $manager_cname );
	$managercname = $db->loadResult();
	//Completed
	//echo "<pre>"; print_r($managercname);exit;
	$mailfrom = 'support@myvendorcenter.com';
	$fromname = 'MyVendorCenter.com';
	$assignuseremail = $mails;
	$mailsubject = 'Job update from MyVendorCenter';
	$rejectedemail ="SELECT introtext  FROM #__content where id='277' ";
	$db->setQuery( $rejectedemail );
	$body = $db->loadResult();
	
	$user = JFactory::getUser();
	$managername = $user->name.' '.$user->lastname ;
	if($rejection_letter == 'other')
	{
	 $rejection_letter = 'Other:' ;

	}
	
		$body = str_replace('[Vendor Company Name]',$vendorcname,$body) ;
		
		$body = str_replace('[RFPID]',$rfpno,$body);
		$body = str_replace('[Property Name]',str_replace('_',' ',$pm),$body);
		$body = str_replace('[Project Name]',$projectName,$body);
		$body = str_replace('[Manager Name]',$managername,$body);
		$body = str_replace('[Manager Company Name]',$managercname,$body);
		$body = str_replace('[reason]',$rejection_letter.'&nbsp;'.$other,$body);
       
		$assignuseremail_support = 'vendoremails@myvendorcenter.com';
		
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail_support, $mailsubject, $body, $mode = 1);
		//To send the email to cc emails of the vendors
		$query_cc ="select ccemail from #__users Where id =".$vendorid;
		$db->setQuery($query_cc);
		$cc = $db->loadResult();
		$cclist = explode(';',$cc);

			for($c=0; $c<count($cclist); $c++){
			$listcc = $cclist[$c];
				if($listcc != ''){
				$res = JUtility::sendMail($mailfrom, $fromname, $listcc, $mailsubject, $body, $mode=1);
				}
			}
		//Completed
		}//Else condition completed
		} //For loop is completed
		$assignuseremail1 = 'rfp@myvendorcenter.com';
		$body = "<font color='red'>This is for Support team</font><br><br>".$body;
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail1, $mailsubject, $body, $mode = 1);
		}
		 $user = JFactory::getUser();
		 if($user->user_type == '12'){
			$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=128';
			}
			if($user->user_type == '13'){
			$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
			}
			$doc =& JFactory::getDocument();
			echo '<script>parent.location="'.$link.'";</script>';
			exit;
		// $msg="Thank";
	//	$this->setRedirect( $link,$msg );
	}

function outsidevendorsuccess()
	{
		//echo "<pre>"; print_r($_REQUEST); 
		$db =& JFactory::getDBO();
		//$other_vendor = JRequest::getVar('other','');
		$other_vendor[0] = JRequest::getVar('proposalid','');
		$awarded_outside = $other_vendor[0] ;
		$shareinfo = JRequest::getVar('shareinfo','');
	    $rfpno = JRequest::getVar('rfpno','');
		$awardedvendor = JRequest::getVar('companyname_other','');
		$awardedvendor = JRequest::getVar('awardedvendor','');
		$amount2 = JRequest::getVar('amount','');
		$amount2 = JRequest::getVar('v_price','');
		$amount1 = doubleval(str_replace(",","",$amount2));
	    $amount = number_format($amount1,2,'.','');
		$today = date('m-d-Y');
		$user=JFactory::getUser();
		//print_r($_REQUEST); exit;
		$outsidevendor['id']= '';
		$outsidevendor['rfpid']= JRequest::getVar('rfpno','');
    	$outsidevendor['awarded_vendor']= JRequest::getVar('awardedvendor','');
		$outsidevendor['criteria']= JRequest::getVar('criteria','');
	    $outsidevendor['addendum']= JRequest::getVar('addendum','');
		$outsidevendor['amount']=  $amount;
		$outsidevendor['award_date']= $today;
		$outsidevendor['cust_id']= $user->id;
		
		$othinfo ="SELECT * FROM #__cam_external_vendors where id='".$awarded_outside."' and rfpid='".$outsidevendor['rfpid']."' ";
		$db->setQuery( $othinfo );
		$outsides = $db->loadObject();
		
		$outsidevendor['company_name']= $outsides->companyname;
		$outsidevendor['contact_name']= $outsides->contactname;
		$outsidevendor['phone']= $outsides->phonenumber;
		$outsidevendor['email']= $outsides->emailid;
		$outsidevendor['awardedid']= $outsides->id;
		
		$model = $this->getModel('rfpcenter');

		//echo "<pre>"; print_r($outsidevendor); exit;
	 	if($model->store_outsidevendor($outsidevendor)) {
		//echo '<div style="padding-top:50px; padding-left:10px; font-size:15px; font-weight:bold;">Successfully Awarded To The Outside Vendor</div>';
		$db =& JFactory::getDBO();
		$query5 = "UPDATE #__cam_vendor_proposals SET proposaltype='Unawarded' WHERE proposaltype!='draft' and proposaltype!='Draft' and proposaltype!='ITB' and rfpno=".$rfpno;
		$db->setQuery( $query5 );
		$res5=$db->query();
		if($res5){
		//echo "all proposals are Unawarded Successfully";
		//echo "Job Awarded Successfully";
		}
	}
		 $query = "SELECT DISTINCT U.email,U.name,U.lastname,U.id,C.rfpno FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE  C.rfpno=".$rfpno." and C.proposaltype='Unawarded'  ";
		//$query = "UPDATE #__cam_vendor_proposals SET proposaltype='Awarded' WHERE id=".$id;
		$db->setQuery( $query );
		$data1 = $db->loadObjectlist();
		$query9 = "UPDATE #__cam_rfpinfo SET rfp_type='Awarded',awardeddate ='$today',apple='10' WHERE id=".$rfpno;
		$db->setQuery( $query9 );
		$res9=$db->query();
		for ($i=0, $n=count( $data1); $i < $n; $i++)
		{
		if ($data1[$i]->email== ''){
		//echo "anand";
		} else {
		//echo "<pre>"; print_r($data1[$i]);

		$mails = $data1[$i]->email;
		$name = $data1[$i]->name;
		$lname = $data1[$i]->lastname;
		$rfpno = $data1[$i]->rfpno;
		$vendorid = $data1[$i]->id;
		//echo "<pre>"; print_r($data1[$i]);
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$assignuseremail = $mails;
		$username=$name.' '.$lname;
		$mailsubject = 'Job update from MyVendorCenter';
		if( $shareinfo == 'yes' )
			$articleid = '157';
		else
			$articleid = '307';
		$query_rejectedemail ="SELECT introtext  FROM #__content where id='".$articleid."' ";
		$db->setQuery( $query_rejectedemail );
		$body = $db->loadResult();
		//
		//$body = $rej_email;
			//echo "<pre>"; echo "regect"; print_r($assignuseremail);
		$user=JFactory::getUser();
		$db = & JFactory::getDBO();
		$property_name = "SELECT P.property_name FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_name );
		$propertyname1 = $db->loadResult();
		$propertyname = str_replace('_',' ',$propertyname1);
		$company_name = "SELECT comp_name FROM #__cam_customer_companyinfo  WHERE cust_id=".$user->id;
		$db->setQuery( $company_name );
		$companyname = $db->loadResult();


		$Bid_sql = "SELECT  (select count(*)  from jos_cam_vendor_proposals where rfpno=".$rfpno." AND proposaltype = 'Submit') as Submitted, (select count(*)  from jos_cam_vendor_proposals where rfpno=".$rfpno." AND proposaltype = 'Reject') as Rejected, MAX(CAST( proposal_total_price AS UNSIGNED )) as Max_Bid, MIN(CAST( proposal_total_price AS UNSIGNED )) as Min_Bid FROM #__cam_vendor_proposals  WHERE  proposal_total_price != '0.00' and proposal_total_price != '' and publish!=2  and rfpno = ".$rfpno;
		$db->setQuery($Bid_sql);
		$Bid_info = $db->loadObjectList();
		//echo "<pre>"; print_r($Bid_info[0]); exit;
                $Min_Bid1 = doubleval(str_replace(",","",$Bid_info[0]->Min_Bid));
	 	$Min_Bid = number_format($Min_Bid1,2,'.','');
		$Max_Bid1 = doubleval(str_replace(",","",$Bid_info[0]->Max_Bid));
	 	$Max_Bid = number_format($Max_Bid1,2,'.','');
		 if($amount > $Max_Bid){
                   $Max_Bid=  $amount;
                }
                if ($amount < $Min_Bid) {
                    $Min_Bid =$amount;
                }
				$amount_win = "$".number_format($amount,2);
				$Min_Bid = "$".number_format($Min_Bid,2);
				$Max_Bid = "$".number_format($Max_Bid,2);
		//completd
		$body = str_replace('{Vendor Name}',$username,$body) ;
		$body = str_replace('{RFP NUMBER}',$rfpno,$body) ;
		$body = str_replace('{Property Name}',$propertyname,$body);
		$body = str_replace('{CAM Firm}',$companyname,$body);
		$body = str_replace('{winning Bid}',$amount_win,$body);
		$body = str_replace('{Low Bid}',$Min_Bid,$body);
		$body = str_replace('{High Bid}',$Max_Bid,$body);
		//echo "<pre>"; print_r($body);
		//echo "<pre>";  echo "reject"; print_r($body);
		//CAMassistant.com";
		$property_copy = "SELECT P.copyvendor FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_copy );
		$copyvendor = $db->loadResult();
		//if( $shareinfo == '1' ){
			JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
			$vendoremail = "vipin3485@gmail.com";
			JUtility::sendMail($mailfrom, $fromname, $vendoremail, $mailsubject, $body, $mode = 1);
			//To send the email to cc emails of the vendors
			$query_cc ="select ccemail from #__users Where id =".$vendorid;
			$db->setQuery($query_cc);
			$cc = $db->loadResult();
			$cclist = explode(';',$cc);
	
			for($c=0; $c<count($cclist); $c++){
			$listcc = $cclist[$c];
			if($listcc != ''){
			$res = JUtility::sendMail($mailfrom, $fromname, $listcc, $mailsubject, $body, $mode=1);
			}
			}
		//}
		//Completed
/*		$assignuseremail = 'support@myvendorcenter.com';
//		$assignuseremail = 'rize.cama@gmail.com';
		$body = $body . "<br><br><font color='red'>This email went out to vendor ".$username."</font>";
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
*/
		}
		}//exit

		//To send the unawarded email only once
		$outerrejectedmails = '';
		for ($oa=0, $cv1=count( $data1); $oa < $cv1; $oa++) {
		$outerrejectedmails .= $data1[$oa]->name.' '.$data1[$oa]->lastname.',';
		}
		$ericemail = 'vendoremails@myvendorcenter.com';
		
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$mailsubject = 'Job update from MyVendorCenter';
		$body = $body;
		JUtility::sendMail($mailfrom, $fromname, $ericemail, $mailsubject, $body, $mode = 1);
		$outerrejectedmails = '';
		//Completed


		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$mailsubject = 'Project awarded to you through MyVendorCenter';
		//$assignuseremail = $email1;
		$query_acceceptemail ="SELECT introtext  FROM #__content where id='156' ";
		$db->setQuery( $query_acceceptemail );
		$body = $db->loadResult();

		$property_name = "SELECT P.property_name FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_name );
		$propertyname1 = $db->loadResult();
		$propertyname = str_replace('_',' ',$propertyname1);
		$fullname= $awardedvendor;

		//print_r($user->user_type);
		 $customer_name = $user->name.' '.$user->lastname;
		 $camfirm_id = "SELECT P.cust_id FROM #__cam_customer_companyinfo as C LEFT JOIN #__cam_camfirminfo as P ON P.id=C.comp_id WHERE C.cust_id=".$user->id;
		$db->setQuery( $camfirm_id );
		$camfirmid = $db->loadResult();
		 $camfirm_name = "SELECT name,lastname FROM #__users WHERE id=".$camfirmid;
		$db->setQuery( $camfirm_name );
		$camfirmname = $db->loadObjectlist();
		$camfirm_admin= $camfirmname[0]->name.'&nbsp;'.$camfirmname[0]->lastname;
		//print_r($camfirm_admin);
		if($user->user_type=='13'){
		$camadmin = $customer_name;
		} else {
		$camadmin = $camfirm_admin;
		}
		//echo "accept"; print_r($assignuseremail);
		$company_name = "SELECT comp_name FROM #__cam_customer_companyinfo  WHERE cust_id=".$user->id;
		$db->setQuery( $company_name );
		$cname = $db->loadResult();

		$body = str_replace('{Vendor Name}',$fullname,$body) ;
		$body = str_replace('{RFP NUMBER}',$rfpno,$body) ;
		$body = str_replace('{Property Name}',$propertyname,$body);
//		$amount2 = "$".number_format($amount2,2);
		$amount_win1 = "$".number_format($amount,2);
		$body = str_replace('{winning Bid}',$amount_win1,$body);
		//$body = str_replace('{Customer}',$customer_name,$body);
		if($user->user_type=='13'){
		//$body = str_replace('to {CAM Firm}',' ',$body);
		//$body = str_replace('of {CAM Firm}',' ',$body);
		//$body = str_replace('{CAM Firm}',$customer_name,$body);
		$body = str_replace('{Customer}',$customer_name,$body);
		$body = str_replace('{CAM Firm}',$cname,$body);
		} else {
		//$body = str_replace('{CAM Firm}',$camadmin,$body);
		$body = str_replace('{Customer}',$customer_name,$body);
		$body = str_replace('{CAM Firm}',$cname,$body);
		}

		$assignuseremail='rize.cama@gmail.com';
		/*$body = "Hi ".$username."!<br/>congratulations on being awarded the job #".$rfpno." to you
		<br/><br/>At Your Service,<br/><br/>
		CAMassistant.com";*/
			//exit;
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail,$mailsubject, $body, $mode = 1);

		//Sending email to manager
		$aetman ="SELECT introtext  FROM #__content where id='241' ";
		$db->setQuery( $aetman );
		$aetmanbody = $db->loadResult();
		$rfpname ="SELECT projectName  FROM #__cam_rfpinfo where id=".$rfpno." ";
		$db->setQuery( $rfpname );
		$rfp_name_manager = $db->loadResult();
		$aetmanbody = str_replace('{Vendor Name}',$fullname,$aetmanbody) ;
		$aetmanbody = str_replace('{Reference Name}',$rfp_name_manager,$aetmanbody) ;
		$aetmanbody = str_replace('{Vendor Company Name}','Out side vendor',$aetmanbody) ;
		$aetmanbody = str_replace('{RFP NUMBER}',$rfpno,$aetmanbody) ;
		$aetmanbody = str_replace('{Property Name}',$propertyname,$aetmanbody);
                $amount_win1 = "$".number_format($amount,2);
		$aetmanbody = str_replace('{winning Bid}',$amount_win1,$aetmanbody);
		if($user->user_type=='13'){
		$aetmanbody = str_replace('{Customer}',$customer_name,$aetmanbody);
		$aetmanbody = str_replace('{CAM Firm}',$cname,$aetmanbody);
		} else {
		$aetmanbody = str_replace('{Customer}',$customer_name,$aetmanbody);
		$aetmanbody = str_replace('{CAM Firm}',$cname,$aetmanbody);
		}
		$manageremail = $user->email;
		JUtility::sendMail($mailfrom, $fromname, $manageremail,$mailsubject, $aetmanbody, $mode = 1);
		$manageremail_support = 'manageremails@myvendorcenter.com';
		JUtility::sendMail($mailfrom, $fromname, $manageremail_support,$mailsubject, $aetmanbody, $mode = 1);
		$manageremail_support = 'rize.cama@gmail.com';
		JUtility::sendMail($mailfrom, $fromname, $manageremail_support,$mailsubject, $aetmanbody, $mode = 1);
		//Completed

		// Sending mails to outside vendors
		$amount = "$".number_format($amount,2);
		$other_vendors ="SELECT companyname, emailid, id FROM #__cam_external_vendors where rfpid='".$rfpno."' ";
		$db->setQuery( $other_vendors );
		$outsides = $db->loadObjectList();
		if($outsides){
			for($o=0; $o<count($outsides); $o++) {
			
				if($awarded_outside == $outsides[$o]->id ) {
					if($outsides[$o]->emailid) {
						$mailfrom = 'support@myvendorcenter.com';
						$fromname = 'MyVendorCenter.com';
						$outervendor = $outsides[$o]->emailid ;
						//Check is there any editable message for award
						$model = $this->getModel('rfpcenter');
						$revised_msg_ps = $model->getrevisedmessage($rfpno);
						$revised_msg = html_entity_decode($revised_msg_ps);
						$revised_msg = str_replace('{devider}','',$revised_msg);
						if( !$revised_msg ){ 
						$reject_outer ="SELECT introtext  FROM #__content where id='281' ";
						$db->setQuery( $reject_outer );
						$rejectouter = $db->loadResult();
						$rejectouter = str_replace('{devider}','',$rejectouter);
						}
						else {
						$rejectouter = $revised_msg;
						}
						$user=JFactory::getUser();
						$managerfullname = $user->name.'&nbsp;'.$user->lastname ;
						$aetmanbody = str_replace('[Vendor Company Name]',$outsidevendor['company_name'],$rejectouter) ;
						$aetmanbody = str_replace('[Project Name]',$rfp_name_manager,$aetmanbody) ;
						$aetmanbody = str_replace('[Manager Full Name]',$managerfullname,$aetmanbody) ;
						$aetmanbody = str_replace('[Manager full name]',$managerfullname,$aetmanbody) ;
						$aetmanbody = str_replace('[Manager Company Name]',$cname,$aetmanbody) ;
						$aetmanbody = str_replace('[Proposal Amount entered by Manager]',$amount,$aetmanbody) ;
						$aetmanbody = str_replace('{Customer}',$user->name.' '.$user->lastname,$aetmanbody) ;
						$mailsubject = "You've been awarded a job through MyVendorCenter";
						JUtility::sendMail($mailfrom, $fromname, $outervendor,$mailsubject, $aetmanbody, $mode = 1);
						$outervendor_support = 'vendoremails@myvendorcenter.com';
						JUtility::sendMail($mailfrom, $fromname, $outervendor_support,$mailsubject, $aetmanbody, $mode = 1);
					}
				}
				else{
					if($outsides[$o]->emailid) {
						$mailfrom = $user->email;
						$fromname = 'MyVendorCenter.com';
						$outervendor = $outsides[$o]->emailid ;
						$reject_outer ="SELECT introtext  FROM #__content where id='282' ";
						$db->setQuery( $reject_outer );
						$rejectouter1 = $db->loadResult();
						$user=JFactory::getUser();
						$managerfullname = $user->name.'&nbsp;'.$user->lastname ;
						$aetmanbodya = str_replace('[Vendor Company Name]',$outsides[$o]->companyname,$rejectouter1) ;
						$aetmanbodya = str_replace('[Project Name]',$rfp_name_manager,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager Full Name]',$managerfullname,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager full name]',$managerfullname,$aetmanbodya) ;
						$aetmanbodya = str_replace('[manager email]',$user->email,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager Company Name]',$cname,$aetmanbodya) ;
						$mailsubject = "You're proposal has been rejected through MyVendorCenter";
						JUtility::sendMail($mailfrom, $fromname, $outervendor,$mailsubject, $aetmanbodya, $mode = 1);
						$outervendor_support = 'vendoremails@myvendorcenter.com';
						JUtility::sendMail($mailfrom, $fromname, $outervendor_support,$mailsubject, $aetmanbodya, $mode = 1);
					}
				}
			}	
		}
		
		//Completed
			
		if($user->user_type == '12'){
		$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=awardrfp&rated=yes&Itemid=123';
		}
		if($user->user_type == '13'){
		$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=awardrfp&rated=yes&Itemid=123';
		}
	$doc =& JFactory::getDocument();
	echo '<script>parent.location="'.$link.'";</script>';
	exit;
	}
	function overview()
	{
		$user	= JFactory::getUser();
		if($user->user_type == 12)
		{
			JRequest::getVar('view','rfpcenter');
	    	parent::display();
		}
		else
		{
			JRequest::setVar('task', 'not_authorized');
			JRequest::setVar('view', 'rfpcenter');
			parent::display();
		}

	}

	  function getcommission(){
	  $c1		=0;
	  $c2		=$_REQUEST['c2'];
	  $c2 = doubleval(str_replace(",","",$c2));
if($c1 == 0 && $c2 !=0) //code to combined calculation
{
	if($c2 < 4400000)
	{
		$formula = (-0.00869*log($c2))+0.15;
		$percent = round($formula,5);
	}
	else if($c2 >= 4400000 && $c2 < 6500000)
	{
		$formula	=  (-0.00000000000000000000004033*pow($c2,3))+((0.0000000000000010088)*pow($c2,2))-(0.0000000083137)*$c2 + 0.037557;
		$percent = round($formula,5);
	}
	else if($c2 >= 6500000)
	{
		$percent = 0.015;
	}
	$comm_amnt = $percent*$c2;
	$comm_amnt = round($comm_amnt,2);
	//$comm_amnt = round($comm_amnt);
}

$comm_amnt = doubleval(str_replace(",","",$comm_amnt));
//$comm_amnt = number_format($comm_amnt,2);

echo $comm_amnt;
exit;
	  }

	function deleterfp(){

	$db = & JFactory::getDBO();
		$id = $_REQUEST['rfpid'];
		if($id){
		$query = "Delete FROM `#__cam_rfpinfo`  WHERE id in (".$id.")";
		$db->setQuery($query);
		$db->Query();
		$query = "Delete FROM `#__cam_rfpsow_linetask`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_rfpsow_uploadfiles`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
		$db->Query();
		$query = "Delete FROM `#__cam_rfpreq_info`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_vendor_proposals`  WHERE rfpno in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_rfpsow_addnotes`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_rfpsow_addexception`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_rfpsow_uploadfiles`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_vendor_availablejobs`  WHERE rfp_id in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		$query = "Delete FROM `#__cam_closedzip`  WHERE rfpid in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
        $query = "Delete FROM `#__cam_awardlist`  WHERE rfpid in (".$id.")";
		$db->setQuery($query);
	    $db->Query();
		}
	  echo "success"; exit;

	}
	
	function getcancelproposals(){
	
	$rfpid = $_REQUEST['rfpid'];
	$rfpname = $_REQUEST['rfpname'];
	$db = & JFactory::getDBO();
	$getprops = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,P.contact_name, V.company_name, V.phone_ext, P.proposaltype, P.proposal_total_price,P.Alt_bid, P.publish, P.bidfrom, P.id as proposalid, U.subscribe_type, P.proposeddate  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops);
	$listprps = $db->loadObjectList();
	?>
	<table width="100%" border="0" style="margin:0px 0px; border:1px solid #A3A3A3; background:#F7F7F7">
    <tbody>
    
<tr><td align="center">
<?php
$model = $this->getModel('rfpcenter');
$draftprops = $model->alldraftproposals_count($rfpid);

$exp_count = explode('---',$draftprops);
if( $exp_count[0] == $exp_count[1] )
	$count_drafts = 'no';
else
	$count_drafts = 'yes';

?>
<ul class="addednum" style="padding-top:0px;">
<?php
$getpublish = "SELECT publish, proposalDueDate, rfp_adminstatus, bidding, rfp_type, maxProposals, cust_id, jobtype, property_id FROM #__cam_rfpinfo WHERE id=".$rfpid." ";
	$db->setQuery( $getpublish);
	$publish = $db->loadObject();
	?>

 </ul>
    </td>
  </tr>

  <tr>
    <td>
    <table width="100%" cellspacing="0" cellpadding="0" border="0" style="padding:0px 0px; border:">
  <tbody> <tr>
    <td width="42%" height="10" bgcolor="#707070" style="color:#fff; padding-left:15px;"><strong>VENDOR</strong>
    </td>
	<td width="25%" height="20" bgcolor="#707070" style="padding-left:25px; color:#FFF;">
   <strong>COMPLIANCE STATUS</strong></td>
	<td width="21%" height="10" bgcolor="#707070" style="color:#FFF;">
    <strong>INVITATION STATUS</strong></td>
     <td width="15%" height="10" bgcolor="#707070" align="center" style="padding-left:0px; color:#FFF;">
  <strong>PRICE</strong></td>
  </tr>

  </tr>
  <?php if(count($listprps) > 0){ ?>
  <?php for($i=0; $i<count($listprps); $i++){ ?>
  
 <?php if($listprps[$i]->contact_name){ 
  $listprps[$i]->contact_name = $listprps[$i]->contact_name;
	} else { 
  $listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
	} 
	
	//To get the contact name of alternative proposals
	if($listprps[$i]->Alt_bid == 'yes') {
		$getconame = "SELECT contact_name  FROM #__cam_vendor_proposals WHERE rfpno=".$rfpid." and proposedvendorid=".$listprps[$i]->id." and Alt_bid='' ";
		$db->setQuery( $getconame);
		$getcname = $db->loadResult();
		if($getcname){ 
		$listprps[$i]->contact_name = $getcname ;
		}
		else{
		$listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
		}
	}
	//Completed
	
	//To avoid declined vendors
	$dec_users = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfpid." and user_id=".$listprps[$i]->id." "; 
	$db->setQuery( $dec_users);
	$declinedrfp = $db->loadResult();
	if($declinedrfp == '2')
	$style='none';
	else
	$style='';
	
	if( $listprps[$i]->Alt_bid == 'yes' && ( $listprps[$i]->proposaltype =='ITB' || $listprps[$i]->proposaltype =='Draft' || $listprps[$i]->proposaltype =='review'  || $listprps[$i]->proposaltype =='uninvited' ) )
		$display_alt_draft = 'none';
	else
		$display_alt_draft = '';	
		
	if( $style == 'none' || $display_alt_draft == 'none' )	
	$final_display = 'none' ;
	else
	$final_display = '' ;
	
		//Completed
	?>
	
	<tr class="table_blue_rowdotsextend" style="display:<?php echo $final_display;?>">
    <td width="40%" style="text-align:left"><strong><a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $listprps[$i]->id; ?>" target="_blank"><?php echo $listprps[$i]->company_name ; ?></a></strong>
<p style="padding:0px 0px;"><?php echo $listprps[$i]->contact_name.': ' .$listprps[$i]->company_phone;  if($listprps[$i]->phone_ext) { echo "&nbsp;-&nbsp;(" . $listprps[$i]->phone_ext . '&nbsp;)' ; }?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $listprps[$i]->email. '?cc=' .$listprps[$i]->ccemail; ?>" style="color:gray;" >Email</a>

<?php 
	$reminder_sql = "SELECT reminder_type, managerid, send_reminder_date, proposal_type from #__cam_rfp_reminders where rfpid=".$rfpid." and vendorid=".$listprps[$i]->id." and proposalid=".$listprps[$i]->proposalid." order by id DESC "; 
	$db->setQuery( $reminder_sql);
	$last_reminder = $db->loadObject();
	if( $last_reminder ){
		if( $last_reminder->reminder_type != 'm' ){
		$type_reminder = 'MyVendorCenter'; 
		}
		else{
		$reminder_name = "select name, lastname from #__users where id=".$last_reminder->managerid." "; 
		$db->setQuery( $reminder_name );
		$reminder_sent_name = $db->loadObject();
		$type_reminder = $reminder_sent_name->name.'&nbsp;'.$reminder_sent_name->lastname; 
		}
		$datesenmt = explode(' ',$last_reminder->send_reminder_date);
		
		$property_sql = "select timezone from #__cam_property where id=".$publish->property_id." "; 
		$db->setQuery( $property_sql );
		$timezone_prop = $db->loadResult();
		
			if( $timezone_prop == '' || $timezone_prop == 'est' ) $timezone = 'EST';
			else if( $timezone_prop == 'cen' ) $timezone = 'CEN';
			else if( $timezone_prop == 'mou' ) $timezone = 'MOU';
			else if( $timezone_prop == 'pac' ) $timezone = 'PAC';
			else if( $timezone_prop == 'ala' ) $timezone = 'ALA';
			else if( $timezone_prop == 'haw' ) $timezone = 'HAW';
			else if( $row->timezone == 'eni' ) $timezone = 'ENI';
			else if( $row->timezone == 'midw' ) $timezone = 'MIDW';
			else if( $row->timezone == 'car' ) $timezone = 'CAR';
			else if( $row->timezone == 'atl' ) $timezone = 'ATL';
			else if( $row->timezone == 'new' ) $timezone = 'NEW';
			else if( $row->timezone == 'bra' ) $timezone = 'BRA';
			else if( $row->timezone == 'mid' ) $timezone = 'MID';
			else if( $row->timezone == 'azo' ) $timezone = 'AZO';
			else if( $row->timezone == 'wes' ) $timezone = 'WES';
			else if( $row->timezone == 'bru' ) $timezone = 'BRU';
			else if( $row->timezone == 'kal' ) $timezone = 'KAL';
			else if( $row->timezone == 'bag' ) $timezone = 'BAG';
			else if( $row->timezone == 'teh' ) $timezone = 'TEH';
			else if( $row->timezone == 'abu' ) $timezone = 'ABU';
			else if( $row->timezone == 'kab' ) $timezone = 'KAB';
			else if( $row->timezone == 'eka' ) $timezone = 'EKA';
			else if( $row->timezone == 'mum' ) $timezone = 'MUM';
			else if( $row->timezone == 'kath' ) $timezone = 'KATH';
			else if( $row->timezone == 'alm' ) $timezone = 'ALM';
			else if( $row->timezone == 'yan' ) $timezone = 'YAN';
			else if( $row->timezone == 'ban' ) $timezone = 'BAN';
			else if( $row->timezone == 'bei' ) $timezone = 'BEI';
			else if( $row->timezone == 'tok' ) $timezone = 'TOK';
			else if( $row->timezone == 'ade' ) $timezone = 'ADE';
			else if( $row->timezone == 'eas' ) $timezone = 'EAS';
			else if( $row->timezone == 'mag' ) $timezone = 'MAG';
			else if( $row->timezone == 'auk' ) $timezone = 'AUK';
		
		if( $last_reminder->proposal_type == '1' )	
		$reminder_for = 'Invitation';
		else
		$reminder_for = 'Proposal';
      echo "<br /><p class='invitation_reminder'>".$reminder_for." reminder sent by ".$type_reminder." </p>
	  <span>on ".$datesenmt[0]." at ".date("h:i A", strtotime($datesenmt[1]))." ".$timezone."</span>";
	 }
?>
<p style="height:5px"></p></td>

	<?php /*?><td valign="middle" width="17%" align="center"><?php if($listprps[$i]->proposaltype)  { ?><img alt="" src="templates/camassistant_left/images/right-icon_new.png"> <?php } ?></td><?php */?>
	<td valign="middle" width="22%" style="padding-left:30px;" align="center">
	 <?php
	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($listprps[$i]->id,$rfpid);  
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($listprps[$i]->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($listprps[$i]->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($listprps[$i]->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($listprps[$i]->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($listprps[$i]->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($listprps[$i]->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($listprps[$i]->id,$rfpid);
	
	// Check even rfp have some standards or not
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
	//Completed
	
	if( $totalprefers_new_w9 == 'success' && $totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success'  && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){
			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$listprps[$i]->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			$result_final = 'success' ;
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else{
		$result_final = 'notset' ;
	}
	// Compliance status in case of basic request
	if( $publish->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($listprps[$i]->id);
	$result_final = $c_status ;
	
	}
	// Completed
		
	 ?>
	 <?php 
		if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
			
	 if( $publish->jobtype == 'yes' ){
	 	if($result_final == 'nostandards'){ ?>
		<a href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $listprps[$i]->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
		<?php } else { 
	 	?>
	 	<a href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $listprps[$i]->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 	<?php
	 	}
	 }
	 else {
	 	if($result_final == 'notset'){ ?>
		<a id="nostandards" title="No Standards" href="javascript:void(0);" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $publish->cust_id; ?>);">N/A</a>&nbsp;&nbsp;
		<?php } 
		else if($result_final == 'success' ){ ?>
	<a class="checkmarkbox" title="Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');">	</a>
			<?php }  else if($result_final == 'fail'){ ?>
	<a class="redmarkbox" title="Non-Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');">	</a>	
			<?php } ?>
		<?php } ?>
<?php
if( $listprps[$i]->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>				
	 </td>
	 
	<td valign="middle" width="17%" align="center">
	<?php if($listprps[$i]->proposaltype)  { 
	//To check this rfp in invitations? or not ?
	$getidinv = "SELECT id  FROM #__rfp_invitations  WHERE rfpid=".$rfpid." and vendorid=".$listprps[$i]->id." ";
	$db->setQuery( $getidinv);
	$invitevendorid = $db->loadResult();
	
	if($invitevendorid && ($listprps[$i]->bidfrom == 'admin')) { ?>
	<a href="javascript:blankpopup();" title="Awaiting Vendor's response"><img alt="" src="templates/camassistant_left/images/empty-icon.png"></a>
	
	<?php } else {
	$companyname_acc = str_replace(',','_',$listprps[$i]->company_name);
	?>
	<a href="javascript:void(0);" onclick="getcheckmarkpopup('<?php echo $companyname_acc ; ?>','<?php echo $listprps[$i]->proposeddate;?>');"><img alt="" src="templates/camassistant_left/images/Checkmark.png"> </a>
	<?php } } ?></td>
	
	
     
	 
	 
<?php 
if($listprps[$i]->Alt_bid == 'yes')
$alt = 'yes';
else
$alt = '';	
	 ?>
	 <?php if($publish->bidding != 'seal'){ ?>
	 <?php //&& $listprps[$i]->publish ==1  echo '<pre>'; print_r($listprps[$i]); ?>
    <td valign="middle" width="20%" align="center"><strong><?php if($listprps[$i]->proposaltype == 'submit' || $listprps[$i]->proposaltype == 'Submit' || $listprps[$i]->proposaltype == 'resubmit')   { 
	 ?>
	<a href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank"><?php echo "$". number_format($listprps[$i]->proposal_total_price,2); ?></a>
	<?php
	} 
	else if( $listprps[$i]->proposaltype == 'uninvited' ){
		echo "<a class='uninitetext_vendor' onclick='getshowmessage(".$rfpid.",".$listprps[$i]->id.");' href='javascript:void(0);'>UN-INVITED</font>";
	}
	else { echo "PENDING"; }?></strong><?php if($listprps[$i]->Alt_bid == 'yes'){
	echo " (alt)";
	} ?></td> <?php } else { ?>

	<td valign="middle" width="20%" align="center"><strong><?php 
	if( $listprps[$i]->proposaltype == 'uninvited' ){
	echo "<a class='uninitetext_vendor' onclick='getshowmessage(".$rfpid.",".$listprps[$i]->id.");' href='javascript:void(0);'>UN-INVITED</font>";	
	}
	else if($listprps[$i]->proposaltype == 'submit' || $listprps[$i]->proposaltype == 'Submit' || $listprps[$i]->proposaltype == 'resubmit' || $listprps[$i]->proposaltype == 'review'  )  { echo "<font color='gray'>SEALED</font><br><a class='breakseal' href='javascript:reopenrfp(".$rfpid.");'><span class='hasTip2' title='Info: Breaking the seal converts a RFP from Sealed Bidding to open bidding, and allows you to see pricing BEFORE you end the bidding.'>BREAK SEAL?</span></a>"; } else { echo "PENDING"; }?></strong></td> <?php } ?>


  </tr>
 
  <?php }  } else {?>
  <tr class="table_blue_rowdotsextend"><td colspan="4"><p style="font-size: 13px; margin-bottom: 10px; text-align: center;">You have NOT invited any Vendors to participate in this project, please click on "INVITE A VENDOR" above</p></td></tr>
  <?php } 
  
  // To get the rfp invitation for this JOB
	$getinvitevendors = "SELECT vendorid from #__rfp_invitations where rfpid=".$rfpid."";
	$db->setQuery( $getinvitevendors);
	$invitevendors = $db->loadObjectList();
	for($n=0; $n<count($invitevendors); $n++){
	$not = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfpid." and user_id=".$invitevendors[$n]->vendorid." "; 
	$db->setQuery( $not);
	$dec = $db->loadResult();
	
		if($dec == '2'){ 
	$getpropsinv = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,V.company_name, V.phone_ext FROM jos_users as U
	LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
	where U.id=".$invitevendors[$n]->vendorid." ";
	$db->setQuery( $getpropsinv);
	$decdata = $db->loadObject();	
		?>
		<tr class="table_blue_rowdotsextend">
		<td width="40%" style="text-align:left"><strong><?php echo $decdata->company_name; ?></strong>
<p style="padding:0px 0px;"><?php echo $decdata->name.' '.$decdata->lastname; ?> <?php if($decdata->company_phone){ echo ":".$decdata->company_phone ; } ?> <?php if($decdata->phone_ext){ echo "- (".$decdata->phone_ext.')'  ; } ?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $decdata->email. '?cc=' .$decdata->ccemail; ?>">Email</a><p style="height:5px"></p></td>

<?php
	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($decdata->id,$rfpid);
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($decdata->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($decdata->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($decdata->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($decdata->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($decdata->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($decdata->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($decdata->id,$rfpid);
	
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
	if($totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success' && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){

			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$decdata->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else{
		$result_final = 'notset' ;
	}	
		
		// Compliance status in case of basic request
	if( $publish->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($decdata->id);
	$result_final = $c_status ;
	}
	// Completed
	
	 ?>
<td valign="middle" width="22%" style="padding-left:30px;" align="center">
<?php 
	if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
		
if( $publish->jobtype == 'yes' ){
	if($result_final == 'nostandards'){
	 ?>
	 <a href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $decdata->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
	 <?php
	 } else { ?>
	 <a href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $decdata->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 <?php }
}
	 
else {	
	if($result_final == 'notset'){ ?>
		 <a id="nostandards" href="javascript:void(0);" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>,<?php echo $publish->cust_id; ?>);" title="No Standards">N/A</a>&nbsp;&nbsp;
		<?php } 
	else if($result_final == 'success' ){ ?>
		 <a class="checkmarkbox" title="Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');"></a>
	 	<?php }  
	else if($result_final == 'fail'){ ?>
	     <a class="redmarkbox" title="Non-Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');"></a>	
		<?php } ?>
<?php } ?>	

<?php
if( $decdata->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $decdata->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $decdata->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>
	
</td>

<td valign="middle" width="17%" align="center"><a id="declinedbuttons" href="javascript:void(0);" onclick="getdeclinedreason(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>);"></a> </td>


 <td valign="middle" width="20%" align="center"><strong><span style="color:red;">DECLINED</font></strong></td>
		</tr>
		<?php }
	}
	//Completed
  ?>
  
  
</tbody></table>

    </td>
  </tr>
  <tr valign="middle" height="20">
    <td><p style="padding-top:3px; padding-left:5px; padding-right:5px; color:#333335; display:none"><strong>CURRENT PROJECT STATUS: </strong><span style="color:#487be7;">
	<?php
	if($publish->rfp_adminstatus == ''){
	echo "Currently being reviewed by qualified, pre-screened Vendors";
	} else{
	echo $publish->rfp_adminstatus;
	}
	 ?>
	</span></p></td>
  </tr>

 <?php
  //code for permission need for rfp submission 
  $user=JFactory::getUser();
  $rfpper = $model->getrequstper($rfpid);
  $managername = "SELECT name,lastname FROM #__users  WHERE id=".$rfpper->cust_id.""; 
  $db->setQuery( $managername );
  $managername = $db->loadObject();
  if($publish->jobtype == 'yes')
  $type = 1;
  else
  $type = 0;
  
  if( $user->user_type == 16 && $rfpper->rfpapproval == '1'){ ?>
 <tr valign="middle" height="55">
  <td align="center"><strong><?php echo $managername->name.'&nbsp;'.$managername->lastname ; ?></strong> needs you to approve this project before it is submitted</td>
  </tr>
 <tr valign="middle" height="55">
  <td align="center">
   <a class='rfpdecline_button' onclick='getrfdecline(<?php echo $rfpid ?>,<?php echo $type; ?>);' href='javascript:void(0);'></a>
  <a class='rfpapproval_button' onclick='getrfpapproval(<?php echo $rfpid ?>,<?php echo $type ?>);' href='javascript:void(0);'></a>
 </td>
    </tr>
 <?php } ?>
 
</tbody></table>
	<?php  exit;
	 } 
	
	function getproposals(){
	$rfpid = $_REQUEST['rfpid'];
	$rfpname = $_REQUEST['rfpname'];
	$db = & JFactory::getDBO();
	$getprops = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,P.contact_name, V.company_name, V.phone_ext, P.proposaltype, P.proposal_total_price,P.Alt_bid, P.publish, P.bidfrom, P.id as proposalid, U.subscribe_type, P.proposeddate  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops);
	$listprps = $db->loadObjectList();
	?>
	<table width="100%" border="0" style="margin:0px 0px; border:1px solid #A3A3A3; background:#F7F7F7">
    <tbody>
    <tr>
    <td align="center">
    <ul class="addednum" style="padding-bottom:5px;">
	<?php
	$getpublish = "SELECT publish, proposalDueDate, rfp_adminstatus, bidding, rfp_type, maxProposals, cust_id, jobtype, property_id FROM #__cam_rfpinfo WHERE id=".$rfpid." ";
	$db->setQuery( $getpublish);
	$publish = $db->loadObject();
	
	$date1 = $publish->proposalDueDate;
	$date = explode("-", $date1);
	$pdate = $date[2].'-'.$date[0].'-'.$date[1];
	$date2 = date("Y-m-d");
	$diff = abs(strtotime($pdate) - strtotime($date2));
	$days = floor($diff/(60*60*24));
	?>
	
	<?php 
	if($publish->jobtype == 'yes'){
		$extra_info = '_basic' ;
		$job_type = 'basic';
		} 
	else{
		$extra_info = '' ;			
		$job_type = '';
		}
		
	 ?>
<li><a href="index.php?option=com_camassistant&controller=rfp&task=reviewrfp&rfpid=<?php echo $rfpid;  ?>&var=view&job=<?php echo $job_type; ?>&Itemid=87">VIEW</a></li>
<?php 
$user = & JFactory::getUser();
$model = $this->getModel('rfpcenter');
$invitationper = $model->getinvitevendorper($publish->property_id);
if( $user->user_type == '16' )
{
if( $publish->cust_id == $user->id )
{
?>
<li> <a href="#" onclick="javascript:addendum<?php echo $extra_info; ?>(<?php echo $rfpid;  ?>,'basic');">MODIFY</a></li>
<?php }
if( $publish->jobtype != 'yes' && ( $invitationper == 1 || $publish->cust_id == $user->id )) { ?>
<li class="inviteavendor"><a href="javascript:void(0);" onclick="inviteavendor('<?php echo $publish->rfp_type; ?>','<?php echo $rfpid; ?>','<?php echo $publish->maxProposals; ?>');">INVITE A VENDOR</a></li>
<?php }  } else { ?>

<li> <a href="#" onclick="javascript:addendum<?php echo $extra_info; ?>(<?php echo $rfpid;  ?>,'basic');">MODIFY</a></li>
<?php if($publish->jobtype != 'yes') {?>
<li class="inviteavendor"><a href="javascript:void(0);" onclick="inviteavendor('<?php echo $publish->rfp_type; ?>','<?php echo $rfpid; ?>','<?php echo $publish->maxProposals; ?>');">INVITE A VENDOR</a></li>
<?php } } ?>
<li><a href="javascript:void(0);" onclick="send_reminder(<?php echo $rfpid; ?>);">SEND REMINDER</a></li>
</ul>
</td></tr>
<tr><td align="center">
<?php
$model = $this->getModel('rfpcenter');
$draftprops = $model->alldraftproposals_count($rfpid);

$exp_count = explode('---',$draftprops);
if( $exp_count[0] == $exp_count[1] )
	$count_drafts = 'no';
else
	$count_drafts = 'yes';

?>
<ul class="addednum" style="padding-top:0px;">
<?php if( $user->user_type == '16' )
{
if( $publish->cust_id == $user->id )
{
?>
<li><a style="color:red;" href="javascript:void(0);" onclick="uninvitevendor(<?php echo $rfpid; ?>,'<?php echo $count_drafts; ?>');" title="Un-Invite Vendor">UN-INVITE VENDOR</a></li>
<li><a style="color:red;" class="" href="javascript:cancelrequest('<?php echo $rfpid; ?>');">CANCEL REQUEST</a></li>
<?php } }  else { ?>
<li><a style="color:red;" href="javascript:void(0);" onclick="uninvitevendor(<?php echo $rfpid; ?>,'<?php echo $count_drafts; ?>');" title="Un-Invite Vendor">UN-INVITE VENDOR</a></li>
<li><a style="color:red;" class="" href="javascript:cancelrequest('<?php echo $rfpid; ?>');">CANCEL REQUEST</a></li>
<?php } ?>
 </ul>
    </td>
  </tr>

  <tr>
    <td>
    <table width="100%" cellspacing="0" cellpadding="0" border="0" style="padding:0px 0px; border:">
  <tbody> <tr>
    <td width="42%" height="10" bgcolor="#707070" style="color:#fff; padding-left:15px;"><strong>VENDOR</strong>
    </td>
	<td width="25%" height="20" bgcolor="#707070" style="padding-left:25px; color:#FFF;">
   <strong>COMPLIANCE STATUS</strong></td>
	<td width="21%" height="10" bgcolor="#707070" style="color:#FFF;" align="center">
    <strong>INVITATION STATUS</strong></td>
     <td width="15%" height="10" bgcolor="#707070" align="center" style="padding-left:0px; color:#FFF;">
  <strong>PRICE</strong></td>
  </tr>

  </tr>
  <?php if(count($listprps) > 0){ ?>
  <?php for($i=0; $i<count($listprps); $i++){ ?>
  
 <?php if($listprps[$i]->contact_name){ 
  $listprps[$i]->contact_name = $listprps[$i]->contact_name;
	} else { 
  $listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
	} 
	
	//To get the contact name of alternative proposals
	if($listprps[$i]->Alt_bid == 'yes') {
		$getconame = "SELECT contact_name  FROM #__cam_vendor_proposals WHERE rfpno=".$rfpid." and proposedvendorid=".$listprps[$i]->id." and Alt_bid='' ";
		$db->setQuery( $getconame);
		$getcname = $db->loadResult();
		if($getcname){ 
		$listprps[$i]->contact_name = $getcname ;
		}
		else{
		$listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
		}
	}
	//Completed
	
	//To avoid declined vendors
	$dec_users = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfpid." and user_id=".$listprps[$i]->id." "; 
	$db->setQuery( $dec_users);
	$declinedrfp = $db->loadResult();
	if($declinedrfp == '2')
	$style='none';
	else
	$style='';
	
	if( $listprps[$i]->Alt_bid == 'yes' && ( $listprps[$i]->proposaltype =='ITB' || $listprps[$i]->proposaltype =='Draft' || $listprps[$i]->proposaltype =='review'  || $listprps[$i]->proposaltype =='uninvited' ) )
		$display_alt_draft = 'none';
	else
		$display_alt_draft = '';	
		
	if( $style == 'none' || $display_alt_draft == 'none' )	
	$final_display = 'none' ;
	else
	$final_display = '' ;
	
		//Completed
	?>
	
	<tr class="table_blue_rowdotsextend" style="display:<?php echo $final_display;?>">
    <td width="40%" style="text-align:left"><strong><a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $listprps[$i]->id; ?>" target="_blank"><?php echo $listprps[$i]->company_name ; ?></a></strong>
<p style="padding:0px 0px;"><?php echo $listprps[$i]->contact_name.': ' .$listprps[$i]->company_phone;  if($listprps[$i]->phone_ext) { echo "&nbsp;-&nbsp;(" . $listprps[$i]->phone_ext . '&nbsp;)' ; }?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $listprps[$i]->email. '?cc=' .$listprps[$i]->ccemail; ?>" style="color:gray;" >Email</a>

<?php 
	$reminder_sql = "SELECT reminder_type, managerid, send_reminder_date, proposal_type from #__cam_rfp_reminders where rfpid=".$rfpid." and vendorid=".$listprps[$i]->id." and proposalid=".$listprps[$i]->proposalid." order by id DESC "; 
	$db->setQuery( $reminder_sql);
	$last_reminder = $db->loadObject();
	if( $last_reminder ){
		if( $last_reminder->reminder_type != 'm' ){
		$type_reminder = 'MyVendorCenter'; 
		}
		else{
		$reminder_name = "select name, lastname from #__users where id=".$last_reminder->managerid." "; 
		$db->setQuery( $reminder_name );
		$reminder_sent_name = $db->loadObject();
		$type_reminder = $reminder_sent_name->name.'&nbsp;'.$reminder_sent_name->lastname; 
		}
		$datesenmt = explode(' ',$last_reminder->send_reminder_date);
		
		$property_sql = "select timezone from #__cam_property where id=".$publish->property_id." "; 
		$db->setQuery( $property_sql );
		$timezone_prop = $db->loadResult();
		
			if( $timezone_prop == '' || $timezone_prop == 'est' ) $timezone = 'EST';
			else if( $timezone_prop == 'cen' ) $timezone = 'CEN';
			else if( $timezone_prop == 'mou' ) $timezone = 'MOU';
			else if( $timezone_prop == 'pac' ) $timezone = 'PAC';
			else if( $timezone_prop == 'ala' ) $timezone = 'ALA';
			else if( $timezone_prop == 'haw' ) $timezone = 'HAW';
			else if( $row->timezone == 'eni' ) $timezone = 'ENI';
			else if( $row->timezone == 'midw' ) $timezone = 'MIDW';
			else if( $row->timezone == 'car' ) $timezone = 'CAR';
			else if( $row->timezone == 'atl' ) $timezone = 'ATL';
			else if( $row->timezone == 'new' ) $timezone = 'NEW';
			else if( $row->timezone == 'bra' ) $timezone = 'BRA';
			else if( $row->timezone == 'mid' ) $timezone = 'MID';
			else if( $row->timezone == 'azo' ) $timezone = 'AZO';
			else if( $row->timezone == 'wes' ) $timezone = 'WES';
			else if( $row->timezone == 'bru' ) $timezone = 'BRU';
			else if( $row->timezone == 'kal' ) $timezone = 'KAL';
			else if( $row->timezone == 'bag' ) $timezone = 'BAG';
			else if( $row->timezone == 'teh' ) $timezone = 'TEH';
			else if( $row->timezone == 'abu' ) $timezone = 'ABU';
			else if( $row->timezone == 'kab' ) $timezone = 'KAB';
			else if( $row->timezone == 'eka' ) $timezone = 'EKA';
			else if( $row->timezone == 'mum' ) $timezone = 'MUM';
			else if( $row->timezone == 'kath' ) $timezone = 'KATH';
			else if( $row->timezone == 'alm' ) $timezone = 'ALM';
			else if( $row->timezone == 'yan' ) $timezone = 'YAN';
			else if( $row->timezone == 'ban' ) $timezone = 'BAN';
			else if( $row->timezone == 'bei' ) $timezone = 'BEI';
			else if( $row->timezone == 'tok' ) $timezone = 'TOK';
			else if( $row->timezone == 'ade' ) $timezone = 'ADE';
			else if( $row->timezone == 'eas' ) $timezone = 'EAS';
			else if( $row->timezone == 'mag' ) $timezone = 'MAG';
			else if( $row->timezone == 'auk' ) $timezone = 'AUK';
		
		if( $last_reminder->proposal_type == '1' )	
		$reminder_for = 'Invitation';
		else
		$reminder_for = 'Proposal';
      echo "<br /><p class='invitation_reminder'>".$reminder_for." reminder sent by ".$type_reminder." </p>
	  <span>on ".$datesenmt[0]." at ".date("h:i A", strtotime($datesenmt[1]))." ".$timezone."</span>";
	 }
?>
<p style="height:5px"></p></td>

	<?php /*?><td valign="middle" width="17%" align="center"><?php if($listprps[$i]->proposaltype)  { ?><img alt="" src="templates/camassistant_left/images/right-icon_new.png"> <?php } ?></td><?php */?>
	<td valign="middle" width="22%" style="padding-left:30px;" align="center">
	 <?php
	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($listprps[$i]->id,$rfpid);  
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($listprps[$i]->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($listprps[$i]->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($listprps[$i]->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($listprps[$i]->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($listprps[$i]->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($listprps[$i]->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($listprps[$i]->id,$rfpid);
	
	// Check even rfp have some standards or not
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
	//Completed
	
	if( $totalprefers_new_w9 == 'success' && $totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success'  && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){
			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$listprps[$i]->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			$result_final = 'success' ;
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else{
		$result_final = 'notset' ;
	}
	// Compliance status in case of basic request
	if( $publish->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($listprps[$i]->id);
	$result_final = $c_status ;
	
	}
	// Completed
		
	 ?>
	 <?php 
		if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
			
	 if( $publish->jobtype == 'yes' ){
	 	if($result_final == 'nostandards'){ ?>
		<a href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $listprps[$i]->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
		<?php } else { 
	 	?>
	 	<a href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $listprps[$i]->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 	<?php
	 	}
	 }
	 else {
	 	if($result_final == 'notset'){ ?>
		<a id="nostandards" title="No Standards" href="javascript:void(0);" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $publish->cust_id; ?>);">N/A</a>&nbsp;&nbsp;
		<?php } 
		else if($result_final == 'success' ){ ?>
	<a class="checkmarkbox" title="Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');">	</a>
			<?php }  else if($result_final == 'fail'){ ?>
	<a class="redmarkbox" title="Non-Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');">	</a>	
			<?php } ?>
		<?php } ?>
<?php
if( $listprps[$i]->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>				
	 </td>
	 
	<td valign="middle" width="17%" align="center">
	<?php if($listprps[$i]->proposaltype)  { 
	//To check this rfp in invitations? or not ?
	$getidinv = "SELECT id  FROM #__rfp_invitations  WHERE rfpid=".$rfpid." and vendorid=".$listprps[$i]->id." ";
	$db->setQuery( $getidinv);
	$invitevendorid = $db->loadResult();
	
	if($invitevendorid && ($listprps[$i]->bidfrom == 'admin')) { ?>
	<a href="javascript:blankpopup();" title="Awaiting Vendor's response"><img alt="" src="templates/camassistant_left/images/empty-icon.png"></a>
	
	<?php } else {
	$companyname_acc = str_replace(',','_',$listprps[$i]->company_name);
	?>
	<a href="javascript:void(0);" onclick="getcheckmarkpopup('<?php echo $companyname_acc ; ?>','<?php echo $listprps[$i]->proposeddate;?>');"><img alt="" src="templates/camassistant_left/images/Checkmark.png"> </a>
	<?php } } ?></td>
	
	
     
	 
	 
<?php 
if($listprps[$i]->Alt_bid == 'yes')
$alt = 'yes';
else
$alt = '';	
	 ?>
	 <?php if($publish->bidding != 'seal'){ ?>
	 <?php //&& $listprps[$i]->publish ==1  echo '<pre>'; print_r($listprps[$i]); ?>
    <td valign="middle" width="20%" align="center"><strong><?php if($listprps[$i]->proposaltype == 'submit' || $listprps[$i]->proposaltype == 'Submit' || $listprps[$i]->proposaltype == 'resubmit')   { 
	 ?>
	<a href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank"><?php echo "$". number_format($listprps[$i]->proposal_total_price,2); ?></a>
	<?php
	} 
	else if( $listprps[$i]->proposaltype == 'uninvited' ){
		echo "<a class='uninitetext_vendor' onclick='getshowmessage(".$rfpid.",".$listprps[$i]->id.");' href='javascript:void(0);'>UN-INVITED</font>";
	}
	else { echo "PENDING"; }?></strong><?php if($listprps[$i]->Alt_bid == 'yes'){
	echo " (alt)";
	} ?></td> <?php } else { ?>

	<td valign="middle" width="20%" align="center"><strong><?php 
	if( $listprps[$i]->proposaltype == 'uninvited' ){
	echo "<a class='uninitetext_vendor' onclick='getshowmessage(".$rfpid.",".$listprps[$i]->id.");' href='javascript:void(0);'>UN-INVITED</font>";	
	}
	else if($listprps[$i]->proposaltype == 'submit' || $listprps[$i]->proposaltype == 'Submit' || $listprps[$i]->proposaltype == 'resubmit' || $listprps[$i]->proposaltype == 'review'  )  { echo "<font color='gray'>SEALED</font><br><a class='breakseal' href='javascript:reopenrfp(".$rfpid.");'><span class='hasTip2' title='Info: Breaking the seal converts a RFP from Sealed Bidding to open bidding, and allows you to see pricing BEFORE you end the bidding.'>BREAK SEAL?</span></a>"; } else { echo "PENDING"; }?></strong></td> <?php } ?>


  </tr>
 
  <?php }  } else {?>
  <tr class="table_blue_rowdotsextend"><td colspan="4"><p style="font-size: 13px; margin-bottom: 10px; text-align: center;">You have NOT invited any Vendors to participate in this project, please click on "INVITE A VENDOR" above</p></td></tr>
  <?php } 
  
  // To get the rfp invitation for this JOB
	$getinvitevendors = "SELECT vendorid from #__rfp_invitations where rfpid=".$rfpid."";
	$db->setQuery( $getinvitevendors);
	$invitevendors = $db->loadObjectList();
	for($n=0; $n<count($invitevendors); $n++){
	$not = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfpid." and user_id=".$invitevendors[$n]->vendorid." "; 
	$db->setQuery( $not);
	$dec = $db->loadResult();
	
		if($dec == '2'){ 
	$getpropsinv = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,V.company_name, V.phone_ext FROM jos_users as U
	LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
	where U.id=".$invitevendors[$n]->vendorid." ";
	$db->setQuery( $getpropsinv);
	$decdata = $db->loadObject();	
		?>
		<tr class="table_blue_rowdotsextend">
		<td width="40%" style="text-align:left"><strong><?php echo $decdata->company_name; ?></strong>
<p style="padding:0px 0px;"><?php echo $decdata->name.' '.$decdata->lastname; ?> <?php if($decdata->company_phone){ echo ":".$decdata->company_phone ; } ?> <?php if($decdata->phone_ext){ echo "- (".$decdata->phone_ext.')'  ; } ?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $decdata->email. '?cc=' .$decdata->ccemail; ?>">Email</a><p style="height:5px"></p></td>

<?php
	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($decdata->id,$rfpid);
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($decdata->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($decdata->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($decdata->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($decdata->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($decdata->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($decdata->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($decdata->id,$rfpid);
	
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
	if($totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success' && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){
			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$decdata->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else{
		$result_final = 'notset' ;
	}	
		
		// Compliance status in case of basic request
	if( $publish->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($decdata->id);
	$result_final = $c_status ;
	}
	// Completed
	
	 ?>
<td valign="middle" width="22%" style="padding-left:30px;" align="center">
<?php 
	if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
		
if( $publish->jobtype == 'yes' ){
	if($result_final == 'nostandards'){
	 ?>
	 <a href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $decdata->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
	 <?php
	 } else { ?>
	 <a href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $decdata->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 <?php }
}
	 
else {	
	if($result_final == 'notset'){ ?>
		 <a id="nostandards" href="javascript:void(0);" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>,<?php echo $publish->cust_id; ?>);" title="No Standards">N/A</a>&nbsp;&nbsp;
		<?php } 
	else if($result_final == 'success' ){ ?>
		 <a class="checkmarkbox" title="Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');"></a>
	 	<?php }  
	else if($result_final == 'fail'){ ?>
	     <a class="redmarkbox" title="Non-Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>,<?php echo $publish->cust_id; ?>,'<?php echo $title; ?>');"></a>	
		<?php } ?>
<?php } ?>	

<?php
if( $decdata->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $decdata->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $decdata->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>
	
</td>

<td valign="middle" width="17%" align="center"><a id="declinedbuttons" href="javascript:void(0);" onclick="getdeclinedreason(<?php echo $rfpid; ?>,<?php echo $decdata->id; ?>);"></a> </td>


 <td valign="middle" width="20%" align="center"><strong><span style="color:red;">DECLINED</font></strong></td>
		</tr>
		<?php }
	}
	//Completed
  ?>
  
  
</tbody></table>

    </td>
  </tr>
  <tr valign="middle" height="20">
    <td><p style="padding-top:3px; padding-left:5px; padding-right:5px; color:#333335; display:none"><strong>CURRENT PROJECT STATUS: </strong><span style="color:#487be7;">
	<?php
	if($publish->rfp_adminstatus == ''){
	echo "Currently being reviewed by qualified, pre-screened Vendors";
	} else{
	echo $publish->rfp_adminstatus;
	}
	 ?>
	</span></p></td>
  </tr>
<?php 
if( $user->user_type == '16' )
{
	if( $publish->cust_id == $user->id )
	{
?>	
<tr valign="middle" height="55">
    <td>

<?php 	$getpropstype = "SELECT proposaltype  FROM #__cam_vendor_proposals  WHERE rfpno=".$rfpid." and (proposaltype ='Submit' || proposaltype ='resubmit' || proposaltype ='ITB') ";
	$db->setQuery( $getpropstype);
	$proposaltype = $db->loadObjectList();
	if(count($proposaltype) > 0) {
		if($publish->rfp_type != 'end') { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding" href="javascript:endbidding(<?php echo $rfpid; ?>);">
	<span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids."><img class="review_submit_new" alt="" src="templates/camassistant_left/images/EndBidding.gif" /></span></a></p>
 	<?php }
	else { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding">
	<span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids.">ENDED</span></a></p>
	<?php }
		 }

	else {
		if($publish->rfp_type != 'cancel') { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding" href="javascript:cancelbidding(<?php echo $rfpid; ?>);" ><span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids."><img class="review_submit_new" alt="" src="templates/camassistant_left/images/EndBidding.gif" /></span></a></p>
	<?php }
	else { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding"><span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids.">CANCELED</span></a></p>
	<?php }
	 }
	?>
	  </td>
  </tr>
  <?php } 
    } else { ?>
	<tr valign="middle" height="55">
    <td>
	<?php 	$getpropstype = "SELECT proposaltype  FROM #__cam_vendor_proposals  WHERE rfpno=".$rfpid." and (proposaltype ='Submit' || proposaltype ='resubmit' || proposaltype ='ITB') ";
	$db->setQuery( $getpropstype);
	$proposaltype = $db->loadObjectList();
	if(count($proposaltype) > 0) {
		if($publish->rfp_type != 'end') { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding" href="javascript:endbidding(<?php echo $rfpid; ?>);">
	<span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids."><img class="review_submit_new" alt="" src="templates/camassistant_left/images/EndBidding.gif" /></span></a></p>
 	<?php }
	else { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding">
	<span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids.">ENDED</span></a></p>
	<?php }
		 }

	else {
		if($publish->rfp_type != 'cancel') { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding" href="javascript:cancelbidding(<?php echo $rfpid; ?>);" ><span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids."><img class="review_submit_new" alt="" src="templates/camassistant_left/images/EndBidding.gif" /></span></a></p>
	<?php }
	else { ?>
	<p align="center" style="padding-bottom:5px;"><a class="cancebidding"><span class="hasTip2" title="Info ::END BIDDING does 2 things:
	1. Closes the RFP to vendors AND
	2. Allows you to view the proposal report that contains all submitted bids.">CANCELED</span></a></p>
	<?php }
	 }
	?>
	<?php } ?>  
    </td>
  </tr>
 <?php
  //code for permission need for rfp submission 
  $user=JFactory::getUser();
  $rfpper = $model->getrequstper($rfpid);
  $managername = "SELECT name,lastname FROM #__users  WHERE id=".$rfpper->cust_id.""; 
  $db->setQuery( $managername );
  $managername = $db->loadObject();
  if($publish->jobtype == 'yes')
  $type = 1;
  else
  $type = 0;
  
  if( $user->user_type == 16 && $rfpper->rfpapproval == '1'){ ?>
 <tr valign="middle" height="55">
  <td align="center"><strong><?php echo $managername->name.'&nbsp;'.$managername->lastname ; ?></strong> needs you to approve this project before it is submitted</td>
  </tr>
 <tr valign="middle" height="55">
  <td align="center">
   <a class='rfpdecline_button' onclick='getrfdecline(<?php echo $rfpid ?>,<?php echo $type; ?>);' href='javascript:void(0);'></a>
  <a class='rfpapproval_button' onclick='getrfpapproval(<?php echo $rfpid ?>,<?php echo $type ?>);' href='javascript:void(0);'></a>
 </td>
    </tr>
 <?php } ?>
 
</tbody></table>
	<?php  exit;
	 }
	 
	
	 

	function sendrequest(){
	$body = JRequest::getVar('supportbody','');
	$subject = JRequest::getVar('subject','');
	$user=JFactory::getUser();
	$fromname = $user->name. ' ' . $user->lastname;
	$mailsubject = 'Need Support for '.$subject;
	$assignuseremail = 'support@myvendorcenter.com' ;
	$mailfrom = $user->email ;
	//$assignuseremail = 'rize.cama@gmail.com' ;
	$res = JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
		if($res){
		$msg="Your email has successfully been sent to the support team.";
		$link='index.php?option=com_camassistant&controller=rfpcenter&task=submitedrfp&Itemid=87';
		$this->setRedirect( $link,$msg );
		}
	}

	function cancelrfp(){
           //echo 'anand'; exit;
	$db = & JFactory::getDBO();
	$user=JFactory::getUser();
	$rfpid = JRequest::getVar('rfpid','');
	
	$var = JRequest::getVar('var','');
    $date_now = date("Y-m-d H:i");
	$datetime = explode(' ',$date_now) ;
	$strdate = strtotime(date("Y-m-d", strtotime($datetime[0])) );
	$time_only = explode(':',$datetime[1]) ;
	$onlyhours = $time_only[0] * 3600; 
	$duetime = $time_only[1] + $onlyhours; 
	$sql_time = "SELECT u.timezone FROM #__cam_property as u, #__cam_rfpinfo as v WHERE v.id=".$rfpid." and u.id=v.property_id "; 
	$db->setQuery($sql_time);
	$timezone = $db->loadResult();
			if( $timezone == '' || $timezone == 'est' ) 
			$duetime = $duetime ;
			else if( $timezone == 'cen' )
			$duetime = $duetime - 3600 ;
			else if( $timezone == 'mou' ) 
			$duetime = $duetime - 7200 ;
			else if( $timezone == 'pac' ) 
			$duetime = $duetime - 10800 ;
			else if( $timezone == 'ala' )  
			$duetime = $duetime - 14400 ;
			else if( $timezone == 'haw' ) 
			$duetime = $duetime - 21600 ;
			else if( $timezone == 'car' ) 
			$duetime = $duetime + 1800;
			else if( $timezone == 'atl' ) 
			$duetime = $duetime + 3600;
			else if( $timezone == 'bra' ) 
			$duetime = $duetime + 7200;
			else if( $timezone == 'new' ) 
			$duetime = $duetime + 5400;
			else if( $timezone == 'mid' ) 
			$duetime = $duetime + 10800;
			else if( $timezone == 'azo' ) 
			$duetime = $duetime + 14400;
			else
			$duetime = $duetime ;
	$finaldate = $strdate; 
	$date_year = date("m-d-Y", $finaldate);	
	$minutes = 	$duetime % 3600 ;			
	$minutes_result = 	round($duetime / 3600) ;
	$date = $date_year.' '.$minutes_result.':'.$minutes ;
					
	if($var == 'end'){
	$rfptype = 'closed';
	$retype = 'end' ;
	$msg="YOU HAVE SUCCESFULLY ENDED YOUR REQUEST";
	}
	else{
	$rfptype = 'Unawarded';
	$retype = 'cancel' ;
	$msg="YOU HAVE SUCCESFULLY CANCELLED YOUR REQUEST";
	}
	 
	 // Send the mail to client
	 $getprops = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,P.contact_name, V.company_name, V.phone_ext, P.proposaltype, P.Alt_bid, P.proposal_total_price, P.id as proposalid  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where (P.proposaltype='Submit' or  P.proposaltype='resubmit' or P.proposaltype='submit') and P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops);
	$listprps = $db->loadObjectList();
	$count_pps = count($listprps);
	
	if($var == 'end' && $count_pps > 0){
	  $proposalper = "SELECT L.proposals_p FROM #__cam_propertyowner_link as L,#__cam_rfpinfo as V WHERE V.id=".$rfpid." and V.property_id=L.property_id";
	    $db->setQuery( $proposalper );
	    $proposalper = $db->loadResult(); 
	
	if( $proposalper == 1 )
		{
	
	$getclients = "SELECT U.*,V.projectName, V.property_id FROM #__cam_board_mem as U, #__cam_rfpinfo as V WHERE V.id=".$rfpid." and V.property_id=U.property_name and U.enablemail='yes'";
	$db->setQuery( $getclients);
	$totalclient = $db->loadObjectList();
	}

	// To get the property name
	$getpname = "SELECT property_name FROM #__cam_property WHERE id=".$totalclient[0]->property_id."";
	$db->setQuery( $getpname );
	$propertyname = $db->loadResult();
	$propertyname = str_replace('_',' ',$propertyname);
	
	
	//COmpleted
	if($totalclient) {
	for( $c=0; $c<count($totalclient); $c++ ){
		$clientemail ="SELECT introtext  FROM #__content where id='283' ";
		$db->setQuery( $clientemail );
		$client_body = $db->loadResult();
		$mailfrom = $user->email;
		$fromname = $user->name.' '. $user->lastname;
		$clientemail = $totalclient[$c]->email;
		
	     $getname = "SELECT name,lastname FROM #__users WHERE username ='".$totalclient[$c]->email."'";
	     $db->setQuery( $getname );
	     $getname = $db->loadObject();
	
	     $clientname = $getname->name. '&nbsp;' .$getname->lastname;
		
		$mailsubject = 'Your Proposal Report is now available';
		$urllink = JURI::root().'ziptest.php?directtozip=&rfpid='.$rfpid.'' ;
		$downalod = "<a href=".$urllink.">Proposal Report</a>";
		$clientbody = str_replace('[Client_Full_Name]',$clientname,$client_body) ;
		$clientbody = str_replace('[Project_Name]',$totalclient[0]->projectName,$clientbody) ;
		$clientbody = str_replace('[Property_Name]',$propertyname,$clientbody) ;
		$clientbody = str_replace('[Proposal_Report_Link]',$downalod,$clientbody) ;
		$clientbody = str_replace('[Manager-user_Email_Address]',$mailfrom,$clientbody) ;
		$clientbody = str_replace('[Manager-user_Full_Name]',$fromname,$clientbody) ;
		JUtility::sendMail($mailfrom, $fromname, $clientemail, $mailsubject, $clientbody, $mode = 1);
		$rizeemail = 'rize.cama@gmail.com';
		JUtility::sendMail($mailfrom, $fromname, $rizeemail, $mailsubject, $clientbody, $mode = 1);
		$supportemail = 'support@myvendorcenter.com';
		JUtility::sendMail($mailfrom, $fromname, $supportemail, $mailsubject, $clientbody, $mode = 1);
			}
		}
	}
	//COmpleted
	
	$query_updatedc = "UPDATE #__cam_rfpinfo SET rfp_type ='".$rfptype."', closedfrom ='".$retype."',publish ='1',biddingcloseddate='".$date."' WHERE id=".$rfpid;
	$db->setQuery( $query_updatedc);
	$update=$db->query();
	if($update){
		$link='index.php?option=com_camassistant&controller=rfpcenter&task=closedrfp&Itemid=89';
		$this->setRedirect( $link,$msg );
		}
	}

	function reopenrfp(){
	$db = & JFactory::getDBO();
	$rfpid = JRequest::getVar('rfpid','');
	$query_updatedc = "UPDATE #__cam_rfpinfo SET bidding ='open' WHERE id=".$rfpid;
	$db->setQuery( $query_updatedc);
	$update=$db->query();
	if($update){
		$msg = "RFP reopend successfully.";
		$link='index.php?option=com_camassistant&controller=rfpcenter&task=submitedrfp&Itemid=87';
		$this->setRedirect( $link,$msg );
		}
	}

	function getdetails(){
		$db= JFactory::getDBO();
		$details = $db->setQuery("SELECT u.company_phone, v.name, v.lastname, v.email  FROM #__cam_vendor_company as u, #__users as v where u.user_id=".$_REQUEST['id']." and u.user_id=v.id ");
		$details = $db->loadObject();
		$final = $details->name.' '.$details->lastname.'|'.$details->email.'|'.$details->company_phone;
		echo $final; exit;
		}

		function sendinvitation(){
		$db= JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$data['rfpid'] = JRequest::getVar('rfpid','');
		$data['companyname'] = JRequest::getVar('companyname','');
		$data['contactname'] = JRequest::getVar('contactname','');
		$data['phone'] = JRequest::getVar('phone','');
		$data['email'] = JRequest::getVar('email','');
		$data['notes'] = JRequest::getVar('notes','');
		$data['date'] = date('Y-m-d H:i');

		$query_rejectedemail ="SELECT introtext  FROM #__content where id='242' ";
		$db->setQuery( $query_rejectedemail );
		$body = $db->loadResult();
		$user=JFactory::getUser();
		$body = str_replace('{companyname}',$data['companyname'],$body) ;
		$body = str_replace('{contactname}',$data['contactname'],$body) ;
		$body = str_replace('{phone}',$data['phone'],$body);
		$body = str_replace('{email}',$data['email'],$body);
		$body = str_replace('{notes}',$data['notes'],$body);
		$body = str_replace('{managername}',$user->name.' '. $user->lastname,$body);

		$mailfrom = $user->email;
		$fromname = $user->name.' '. $user->lastname;
		//$assignuseremail = 'rize.cama@gmail.com';
		$assignuseremail = 'support@myvendorcenter.com';
		$mailsubject = 'Vendor Invitation';
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);

	 	if($model->store_invitation($data)) {
		$msg = "Invitation sent successfully.";
		$link='index.php?option=com_camassistant&controller=rfpcenter&task=submitedrfp&Itemid=87';
		$this->setRedirect( $link,$msg );
		}


		}


		function getclosedproposals(){
	
	$rfpid = $_REQUEST['rfpid'];
	$rfpname = $_REQUEST['rfpname'];
	$db = & JFactory::getDBO();
	$user = & JFactory::getUser();
	$model = $this->getModel('rfpcenter');
	$getprops = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,P.contact_name, V.company_name, V.phone_ext, P.proposaltype, P.Alt_bid, P.proposal_total_price, P.id as proposalid, U.subscribe_type  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where (P.proposaltype='Submit' or  P.proposaltype='resubmit') and P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops);
	$listprps = $db->loadObjectList();

	//To get the unsubmitted proposals
	$getprops_alt = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname,P.contact_name, V.company_phone, V.company_name, V.phone_ext, P.proposaltype, P.Alt_bid, P.proposal_total_price, P.id as proposalid, U.subscribe_type  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where (P.proposaltype='Submit' and P.proposaltype='resubmit') and P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops_alt);
	$listunprops = $db->loadObjectList();
	//Completed
    $getpublish = "SELECT rfp_adminstatus, cust_id, jobtype, bidding,property_id FROM #__cam_rfpinfo WHERE id=".$rfpid." ";
	$db->setQuery( $getpublish);
	$admindata = $db->loadObject();
	$adminstatus = $admindata->rfp_adminstatus;
	$bidding_type = $admindata->bidding;
	?>
	<?php 
		if($admindata->jobtype == 'yes')
		$job_type = 'basic' ;
		else
		$job_type = '';
	 ?>
	<table width="100%" border="0" style="margin:0px 0px; border:1px solid #A3A3A3; background:#F7F7F7">
    <tbody>
    <tr>
    <td align="center">
	 
    <ul class="addednumclosed" style="padding-bottom:5px;">
     <?php    $count=count($listprps); ?>
	<li><a href="index.php?option=com_camassistant&controller=rfp&task=reviewrfp&rfpid=<?php echo $rfpid;  ?>&job=<?php echo $job_type; ?>&var=view&Itemid=87">VIEW REQUEST</a></li>
	<li><a href="javascript:popup_proposal_summary1(<?php echo $rfpid; ?>);">VIEW PROPOSALS</a></li>
    <li><a href='javascript:popup_proposal_summary34("<?PHP echo $rfpid; ?>","<?PHP echo $count; ?>");' class="downloadproposals">DOWNLOAD PROPOSALS</a></li>
	
	</ul>
	<ul class="addednumclosed" style="padding-top:5px; padding-bottom:23px;">
	<?php 
	if( $user->user_type == '16' )
	 {
	   if( $admindata->cust_id == $user->id )
         { ?>
	<li><a href="#" onclick="draft(<?php echo $rfpid; ?>);">COPY AS NEW</a></li> 
	<li><a href="#" onclick="rebid(<?php echo $rfpid; ?>,'<?php echo $job_type; ?>');" >MODIFY & RESUBMIT</a></li>
		
	
	<li><a class="" href="javascript:reopenclosedrfp('<?php echo $rfpid; ?>');">RE-OPEN PROJECT</a></li>
	<li><a class="rejectallproposals" href="javascript:rejectallproposals('<?php echo $rfpid; ?>');">REJECT ALL PROPOSALS</a></li>
<?php   } 
     } else { ?>
	 <li><a href="#" onclick="draft(<?php echo $rfpid; ?>);">COPY AS NEW</a></li> 
	<li><a href="#" onclick="rebid(<?php echo $rfpid; ?>,'<?php echo $job_type; ?>');" >MODIFY & RESUBMIT</a></li>
		
	
	<li><a class="" href="javascript:reopenclosedrfp('<?php echo $rfpid; ?>');">RE-OPEN PROJECT</a></li>
	<li><a class="rejectallproposals" href="javascript:rejectallproposals('<?php echo $rfpid; ?>');">REJECT ALL PROPOSALS</a></li>
<?php } ?>	 
    </ul>
    </td>
  </tr>

  <tr>
    <td>
    <table width="100%" cellspacing="0" cellpadding="0" border="0" style="padding:0px 0px; border:">
  <tbody> <?php if($count > 0 || count($listunprops) > 0){ ?><tr>
    <td width="42%" height="10" bgcolor="#707070" style="color:#fff; padding-left:15px;"><strong>VENDOR INFORMATION</strong>
    </td>
<td width="15%" height="10" bgcolor="#707070" align="left" style="color:#FFF;">
  <strong>COMPLIANCE STATUS</strong></td>
     <td width="15%" height="10" bgcolor="#707070" align="left" style="padding-left:69px; color:#FFF;">
  <strong>PRICE</strong></td>
  </tr><?php } else { ?>
  <tr><td><p class="noproposals_closed_dotted"></p><p class="noproposals_closed">This job was closed before any proposals were submitted by Vendors</p>
  		  </td></tr>
  <?php } ?>
  </tr>  <?php for($i=0; $i< $count; $i++){ ?>
   <?php if($listprps[$i]->contact_name){ 
  $listprps[$i]->contact_name = $listprps[$i]->contact_name;
	} else { 
  $listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
	} 
	
	//To get the contact name of alternative proposals
	if($listprps[$i]->Alt_bid == 'yes') {
		$getconame = "SELECT contact_name  FROM #__cam_vendor_proposals WHERE rfpno=".$rfpid." and proposedvendorid=".$listprps[$i]->id." and Alt_bid='' ";
		$db->setQuery( $getconame);
		$getcname = $db->loadResult();
		if($getcname){ 
		$listprps[$i]->contact_name = $getcname ;
		}
		else{
		$listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
		}
	}
	//Completed
	
	?>
	
	<tr class="table_blue_rowdotsextend">
    <td width="40%" style="text-align:left"><strong><a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $listprps[$i]->id; ?>" target="_blank"><?php echo $listprps[$i]->company_name ; ?></a></strong>
<p style="padding:0px 0px;"><?php echo $listprps[$i]->contact_name.': ' .$listprps[$i]->company_phone;  if($listprps[$i]->phone_ext) { echo "&nbsp;-&nbsp;(" . $listprps[$i]->phone_ext . ')' ; }?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $listprps[$i]->email. '?cc=' .$listprps[$i]->ccemail; ?>">Email</a><p style="height:5px"></p></td>
<?php
	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($listprps[$i]->id,$rfpid);
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($listprps[$i]->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($listprps[$i]->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($listprps[$i]->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($listprps[$i]->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($listprps[$i]->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($listprps[$i]->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($listprps[$i]->id,$rfpid);
	
	// Check even rfp have some standards or not
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
		if($totalprefers_new_w9 == 'success' && $totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success' && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){
			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$listprps[$i]->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			$result_final = 'success' ;
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else{
		$result_final = 'notset' ;
	}	
		// Compliance status in case of basic request
	if( $admindata->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($listprps[$i]->id);
	$result_final = $c_status ;
	}
	// Completed
		if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
		
	 ?>
	 <td width="15%" align="center">
	<?php 
	 if( $admindata->jobtype == 'yes' ){
	 	if($result_final == 'nostandards'){ ?>
		<a href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $listprps[$i]->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
		<?php } else { 
	 	?>
	 	<a href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $listprps[$i]->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 	<?php
	 	}
	 }
	 
	 else {
	 if($result_final == 'success' ){ ?>
<a class="checkmarkbox" href="javascript:void(0);" title="Compliant" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $admindata->cust_id; ?>,'<?php echo $title; ?>');">	</a>
	 	<?php }  else if($result_final == 'fail'){ ?>
<a class="redmarkbox" href="javascript:void(0);" title="Non-Compliant" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $admindata->cust_id; ?>,'<?php echo $title; ?>');">	</a>	
		<?php } else if($result_final == 'notset'){ ?>
<a id="nostandards" href="javascript:void(0);" title="No Standards" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $admindata->cust_id; ?>);">N/A</a>&nbsp;&nbsp;			
		<?php } ?>	
		<?php } ?>	
<?php
if( $listprps[$i]->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>
			
</td>
<?php
if($listprps[$i]->Alt_bid == 'yes')
$alt = 'yes' ;
else
$alt = '' ;
?>
    <td valign="middle" width="20%" align="center"><strong>
	<a href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank"><?php  echo "$". number_format($listprps[$i]->proposal_total_price,2);
	if($listprps[$i]->Alt_bid == 'yes'){
	echo " (alt)";
	}
	 ?></a>
	 </strong></td>
 
  </tr>
  <?php } ?>
  <?php for($i=0; $i<count($listunprops); $i++){ ?>
   <?php if($listunprops[$i]->contact_name){ 
  $listunprops[$i]->contact_name=$listunprops[$i]->contact_name;
	} else { 
  $listunprops[$i]->contact_name=$listunprops[$i]->company_name;
	} 
	//To get the contact name of alternative proposals
	if($listunprops[$i]->Alt_bid == 'yes') {
		$getconame = "SELECT contact_name  FROM #__cam_vendor_proposals WHERE rfpno=".$rfpid." and proposedvendorid=".$listunprops[$i]->id." and Alt_bid='' ";
		$db->setQuery( $getconame);
		$getcname = $db->loadResult();
		if($getcname){ 
		$listunprops[$i]->contact_name = $getcname ;
		}
		else{
		$listunprops[$i]->contact_name = $listunprops[$i]->name. ' '. $listunprops[$i]->lastname ;
		}
	}
	//Completed
	?>
	<tr class="table_blue_rowdotsextend">
    <td width="40%" style="text-align:left"><strong><a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $listunprops[$i]->id; ?>" target="_blank"><?php echo $listunprops[$i]->company_name ; ?></a></strong>
<p style="padding:0px 0px;"><?php echo $listunprops[$i]->name. ' '. $listunprops[$i]->lastname.': ' .$listunprops[$i]->company_phone;  if($listunprops[$i]->phone_ext) { echo "&nbsp;-&nbsp;(" . $listunprops[$i]->phone_ext . ')' ; }?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $listunprops[$i]->email. '?cc=' .$listunprops[$i]->ccemail; ?>"><?php echo $listunprops[$i]->email; ?></a><p style="height:5px"></p></td>

<?php
	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($listunprops[$i]->id,$rfpid);
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($listunprops[$i]->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($listunprops[$i]->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($listunprops[$i]->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($listunprops[$i]->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($listunprops[$i]->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($listunprops[$i]->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($listunprops[$i]->id,$rfpid);
	// Check even rfp have some standards or not
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
	if($totalprefers_new_w9 == 'success' && $totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success' && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){
			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$listunprops[$i]->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			$result_final = 'success' ;
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else {
	$result_final = 'notset' ;
	}	
	
	// Compliance status in case of basic request
	if( $admindata->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($listunprops[$i]->id);
	$result_final = $c_status ;
	}
	// Completed
		if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
		
	 ?>
	 <td width="15%" align="center">
	 <?php 
if( $admindata->jobtype == 'yes' ){
	 	if($result_final == 'nostandards'){ ?>
		<a href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $listunprops[$i]->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
		<?php } else { 
	 	?>
	 	<a href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $listunprops[$i]->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 	<?php
	 	}
 }
else {	 
	 if($result_final == 'success' ){ ?>
<a class="checkmarkbox" href="javascript:void(0);" title="Compliant" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listunprops[$i]->id; ?>,<?php echo $admindata->cust_id; ?>,'<?php echo $title; ?>');">	</a>
	 	<?php }  else if($result_final == 'fail'){ ?>
<a class="redmarkbox" href="javascript:void(0);" title="Non-Compliant" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listunprops[$i]->id; ?>,<?php echo $admindata->cust_id; ?>,'<?php echo $title; ?>');">	</a>	
		<?php } else if($result_final == 'notset'){ ?>
<a id="nostandards" href="javascript:void(0);" title="No Standards" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $listunprops[$i]->id; ?>,<?php echo $admindata->cust_id; ?>);">N/A</a>&nbsp;&nbsp;			
		<?php } ?>	
<?php }	 ?>

<?php
if( $listunprops[$i]->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listunprops[$i]->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_closed"><a href="javascript:void(0);" onclick="unverified(<?php echo $listunprops[$i]->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>

</td>
<td valign="middle" width="20%" align="center"><strong><font color="red">NO BID</font></strong></td>
  </tr>
  <?php } ?>
  
  
</tbody></table>

    </td>
  </tr>

<?php
if ($user->user_type == '16') { 
if($admindata->cust_id == $user->id){ ?>

<tr valign="middle" height="55">
    <td>
	<p align="center" style="padding-bottom:5px;"><a href="#" style=" color: #7AB800;font-size: 12px;font-weight: bold; margin-left:1px;text-decoration: none;" onclick="openpopup(<?php echo $rfpid; ?>);" ><img class="review_submit_new" alt="" src="templates/camassistant_left/images/AwardJob.gif" /></a></p>
    </td>
  </tr>
  
<?php }  } else { ?>
<tr valign="middle" height="55">
    <td>
	<p align="center" style="padding-bottom:5px;"><a href="#" style=" color: #7AB800;font-size: 12px;font-weight: bold; margin-left:1px;text-decoration: none;" onclick="openpopup(<?php echo $rfpid; ?>);" ><img class="review_submit_new" alt="" src="templates/camassistant_left/images/AwardJob.gif" /></a></p>
    </td>
  </tr>
<?php } ?>
</tbody></table>
	<?php  exit;
	 
		}
	
		
		

		function getawardedproposals(){
		
	$rfpid = $_REQUEST['rfpid'];
	$rfpname = $_REQUEST['rfpname'];
	$type = $_REQUEST['type'];
	$from = $_REQUEST['from'];
	if($from != 'yes') {
	$condition = '(P.proposaltype="Awarded" || P.proposaltype="Unawarded" || P.proposaltype="Submit")';
	} else {
	//$condition = 'P.proposaltype="Awarded"';
	$condition = '(P.proposaltype="Awarded" || P.proposaltype="Unawarded" || P.proposaltype="Submit")';
	}
	$db = & JFactory::getDBO();
	$user = & JFactory::getUser();
	
	$getprops = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname, V.company_phone,P.contact_name, V.company_name, V.phone_ext,P.Alt_bid, P.proposaltype, P.proposal_total_price, P.id as proposalid  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where ".$condition." and P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops);
	$listprps = $db->loadObjectList();

    $getpublish = "SELECT publish, proposalDueDate, rfp_adminstatus, bidding, rfp_type, maxProposals, cust_id, jobtype, property_id FROM #__cam_rfpinfo WHERE id=".$rfpid." ";
	$db->setQuery( $getpublish);
	$admindata = $db->loadObject();
	
	$adminstatus = $admindata->rfp_adminstatus;
	
	?>
	<?php 
		if($admindata->jobtype == 'yes')
		$job_type = 'basic' ;
		else
		$job_type = '';
	 ?>
	<table width="100%" border="0" style="margin:0px 0px; border:1px solid #A3A3A3; background:#F7F7F7">
    <tbody>
    <tr>
    <td align="center">
    <ul class="addednumclosed">
	
       <?php $count2= count($listprps); ?>
	<?php if($from != 'yes') {?>
	<?php /*?><li><a href="javascript:getapplepopup(<?php echo $rfpid; ?>);">RATE VENDOR</a></li><?php */?>
	<?php } ?>
	<li><a href="index.php?option=com_camassistant&controller=rfp&task=reviewrfp&rfpid=<?php echo $rfpid;  ?>&job=<?php echo $job_type; ?>&var=view&Itemid=87">VIEW REQUEST</a></li>
	<li><a href="javascript:popup_proposal_summary2(<?php echo $rfpid; ?>);">VIEW PROPOSALS</a></li>
	<li><a href='javascript:popup_proposal_summary36("<?PHP echo $rfpid; ?>","<?PHP echo $count2; ?>")' class="downloadproposals">DOWNLOAD PROPOSALS</a></li>
	<?php if( $admindata->cust_id == $user->id ) { ?>
	<li><a href="#" onclick="draft(<?php echo $rfpid; ?>);">COPY AS NEW</a></li>
	<?php } ?>

    </ul>
    </td>
  </tr>

  <tr>
    <td>
    <table width="100%" cellspacing="0" cellpadding="0" border="0" style="padding:0px 0px; border:">
  <tbody> <?php //if($count2 > 0){ ?><tr>
    <td width="42%" height="10" bgcolor="#707070" style="color:#fff; padding-left:15px;"><strong>VENDOR INFORMATION</strong></td>
	<td width="28%" height="10" bgcolor="#707070" style="color:#fff; padding-left:20px;"><strong>COMPLIANCE STATUS</strong></td>	
	<td width="20%" height="10" bgcolor="#707070" style="color:#fff; padding-left:27px;"><strong>AWARD DATE</strong></td>
    <td width="15%" height="10" bgcolor="#707070" align="center" style="color:#FFF;"><strong>PRICE</strong></td>
  	</tr><?php //} ?>
	 <?php
	$getdate = "SELECT awardeddate,unawardeddate,apple,apple_publish, cust_id  from #__cam_rfpinfo where id=".$rfpid." ";
	$db->setQuery( $getdate);
	$deta = $db->loadObject();
        $outsidevendor = "SELECT awarded_vendor,amount,award_date, contact_name, phone, email, awardedid from #__cam_outsidevendor where rfpid=".$rfpid." ";
	$db->setQuery( $outsidevendor);
	$outside_vendor = $db->loadObject();
	if($type == 'unaward'){
	$awardeddate = $deta->unawardeddate;
	}
	else{
	$awardeddate = $deta->awardeddate;
	}
	?>
  </tr>  <?php for($i=0; $i<count($listprps); $i++){ ?>
  <?php if($listprps[$i]->contact_name){ 
  $listprps[$i]->contact_name = $listprps[$i]->contact_name;
	} else { 
  $listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname;
	} 
	
	//To get the contact name of alternative proposals
	if($listprps[$i]->Alt_bid == 'yes') {
		$getconame = "SELECT contact_name  FROM #__cam_vendor_proposals WHERE rfpno=".$rfpid." and proposedvendorid=".$listprps[$i]->id." and Alt_bid='' ";
		$db->setQuery( $getconame);
		$getcname = $db->loadResult();
		if($getcname){ 
		$listprps[$i]->contact_name = $getcname ;
		}
		else{
		$listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
		}
	}
	//Completed
		$commetns = "SELECT comment, rate_date, id, managerid  FROM #__cam_rfp_ratings WHERE rfpid=".$rfpid."  ";
		$db->setQuery( $commetns);
		$man_comment = $db->loadObject();
		
		if($man_comment->managerid)
		$managerid = $man_comment->managerid ;
		else
		$managerid = $deta->cust_id ;
					
	$user_details = "SELECT u.name, u.lastname, v.comp_city, v.comp_state FROM #__users as u, #__cam_customer_companyinfo as v WHERE u.id=".$managerid." and v.cust_id=".$managerid." ";
	$db->setQuery( $user_details);
	$user_details = $db->loadObject();

		$userstate = "SELECT state_id FROM #__state WHERE id=".$user_details->comp_state."  ";
		$db->setQuery( $userstate);
		$state_rating = $db->loadResult();
	
	//To get the manager commenct
	
	//Completed
	?>
	<tr class="table_blue_rowdotsextend">
    <td width="40%" style="text-align:left"><strong><a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $listprps[$i]->id; ?>" target="_blank"><?php echo $listprps[$i]->company_name ; ?></a></strong>
<p style="padding:0px 0px;"><?php echo $listprps[$i]->contact_name.': ' .$listprps[$i]->company_phone;  if($listprps[$i]->phone_ext) { echo "&nbsp;-&nbsp;(" . $listprps[$i]->phone_ext . ')' ; }?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $listprps[$i]->email. '?cc=' .$listprps[$i]->ccemail; ?>">Email</a><p style="height:5px"></p></td>

    

   <td valign="middle" width="20%" align="center">
   <?php 
   	$totalprefers_new_w9	=	$this->checknewspecialrequirements_w9($listprps[$i]->id,$rfpid);  
	$totalprefers_new_gli	=	$this->checknewspecialrequirements_gli($listprps[$i]->id,$rfpid);
	$totalprefers_new_aip	=	$this->checknewspecialrequirements_aip($listprps[$i]->id,$rfpid);
	$totalprefers_new_wci	=	$this->checknewspecialrequirements_wci($listprps[$i]->id,$rfpid);
	$totalprefers_new_umb	=	$this->checknewspecialrequirements_umb($listprps[$i]->id,$rfpid);
	$totalprefers_new_pln	=	$this->checknewspecialrequirements_pln($listprps[$i]->id,$rfpid);
	$totalprefers_new_occ	=	$this->checknewspecialrequirements_occ($listprps[$i]->id,$rfpid);
	$totalprefers_new_omi	=	$this->checknewspecialrequirements_omi($listprps[$i]->id,$rfpid);
	// Check even rfp have some standards or not
	$existed_standards	=	$this->getallstandardsrfp($rfpid);
	if($existed_standards == 'yes') {
	//Completed
	
	if( $totalprefers_new_w9 == 'success' && $totalprefers_new_gli == 'success' && $totalprefers_new_aip == 'success' && $totalprefers_new_wci == 'success' && $totalprefers_new_umb == 'success' && $totalprefers_new_pln == 'success' && $totalprefers_new_occ == 'success' && $totalprefers_new_omi == 'success'){
			$result_final = 'success' ;
			$masteraccount = $this->getmasterfirmaccount();
			$sql_terms = "SELECT termsconditions FROM #__cam_vendor_aboutus WHERE vendorid=".$masteraccount." "; 
			$db->setQuery($sql_terms);
			$terms_exist = $db->loadResult();
			if($terms_exist == '1'){
			$sql = "SELECT accepted FROM #__cam_vendor_terms WHERE vendorid=".$listprps[$i]->id." and masterid=".$masteraccount." "; 
			$db->setQuery($sql);
			$terms = $db->loadResult();
				if($terms == '1'){
				$result_final = 'success' ;
				}
				else{
				$result_final = 'fail' ;
				}
			}
			else{
			$result_final = 'success' ;
			}
			
		}
		else{
			$result_final = 'fail' ;
		}
	}
	else{
		$result_final = 'notset' ;
	}
	// Compliance status in case of basic request
	if( $admindata->jobtype == 'yes' ){
	$model = $this->getModel('rfpcenter');
	$c_status =	$model->checkcompliancestatus($listprps[$i]->id);
	$result_final = $c_status ;
	
	}
	// Completed
	?>
	 <?php 
		if($result_final == 'success' ){ 
			$id_cccbasic = 'checkmarkbox_small';
			$title = 'Compliant';
		}
		else if($result_final == 'fail'){
			$id_cccbasic = 'redmarkbox_small';
			$title = 'Non-Compliant';
		}
		else{
			$id_cccbasic = 'bothicons_small';
			$title = 'Compliant & Non-Compliant';
		}
	if( $admindata->jobtype == 'yes' ){
	 	if($result_final == 'nostandards'){ ?>
		<a style="width:34px;" href="javascript:void(0);" title="No Standards" onclick="getbasiccompliance_null('<?php echo $listprps[$i]->id; ?>');" id="nostandards">N/A</a>&nbsp;&nbsp;
		<?php } else { 
	 	?>
	 	<a style="width:34px;" href="javascript:void(0);" title="<?php echo $title; ?>" onclick="getbasiccompliance('<?php echo $listprps[$i]->id; ?>','<?php echo $title; ?>');" class="<?php echo $id_cccbasic; ?>"></a>
	 	<?php
	 	}
	 }
	 else {
	 	if($result_final == 'notset'){ ?>
		<a id="nostandards" title="No Standards" href="javascript:void(0);" onclick="getcompliancestate_null(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $admindata->cust_id; ?>);">N/A</a>&nbsp;&nbsp;
		<?php } 
		else if($result_final == 'success' ){ ?>
	<a style="width:34px;" class="checkmarkbox" title="Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $admindata->cust_id; ?>,'<?php echo $title; ?>');">	</a>
			<?php }  else if($result_final == 'fail'){ ?>
	<a style="width:34px;" class="redmarkbox" title="Non-Compliant" href="javascript:void(0);" onclick="getcompliancestate(<?php echo $rfpid; ?>,<?php echo $listprps[$i]->id; ?>,<?php echo $admindata->cust_id; ?>,'<?php echo $title; ?>');">	</a>	
			<?php } ?>
		<?php } ?>
<?php
if( $listprps[$i]->subscribe_type == 'free' ) { ?>
<div class="verifiedvendor_awarded"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor_awarded"><a href="javascript:void(0);" onclick="unverified(<?php echo $listprps[$i]->id; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>		
	
   </td>
   
   <td valign="middle" width="20%" align="center"><strong>	<?php if($listprps[$i]->proposaltype == 'Awarded') echo $awardeddate ; ?></strong></td>
    <td valign="middle" width="20%" align="center"><strong>
	
	<?php
	if($listprps[$i]->Alt_bid == 'yes')
	$alt = 'yes';
	else
	$alt = '';
	if($listprps[$i]->proposaltype == 'Awarded') {
	$awarded_vendorid = $listprps[$i]->id ;
	 // Get awarded company name
    $award_sqls = "SELECT u.company_name from #__cam_vendor_company as u, #__cam_vendor_proposals as v where v.rfpno=".$rfpid." and v.proposaltype='Awarded' and v.proposedvendorid=u.user_id ";
	$db->setQuery( $award_sqls );
	$award_company = $db->loadResult();
	 ?>
	<a href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank">
	<?php echo "<font color='#7AB929'>$". number_format($listprps[$i]->proposal_total_price,2).'</font>'; ?>
	  </a>
	<?php }
	else if($listprps[$i]->proposaltype == 'Unawarded') {  ?>
	
	<a id="redproposals" href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank">
	<?php echo "<font color='red'>$". number_format($listprps[$i]->proposal_total_price,2).'</font>'; ?>
	  </a>
	<?php  }
	else{ echo "<font color='red'>NO BID</font>"; }
	?>
	</strong>
	<?php if($listprps[$i]->Alt_bid == 'yes'){
	echo " <br />(alt)";
	} ?>
	</td>


  </tr>
  <?php } ?>
  <?php
  // To get all outside vendors added manager when awarding the JOB
    $total_outers = "SELECT * from #__cam_external_vendors where rfpid=".$rfpid." ";
	$db->setQuery( $total_outers );
	$totalouters = $db->loadObjectList();
  //Completed
  ?>
  <?php if($totalouters){
  	for( $o=0; $o<count($totalouters);$o++ ) {
   ?>
  <tr class="table_blue_rowdotsextend">
    <td width="40%" style="text-align:left">
<p style="padding:0px 0px;"><strong><?php echo $totalouters[$o]->companyname; ?></strong><br/><?php echo $totalouters[$o]->awarded_vendor; ?></p>
<?php if($totalouters[$o]->contactname) echo $totalouters[$o]->contactname.'&nbsp;'; ?>
<?php if($totalouters[$o]->phonenumber) echo $totalouters[$o]->phonenumber.'<br />'; ?>
<a  class="miniemails" href="mailto:<?php echo $totalouters[$o]->emailid; ?>" style="color:gray;">Email</a>
</p></td>

    <td valign="middle" width="20%" align="center"><strong>
	
	</strong></td>

   <td valign="middle" width="20%" align="center"><strong>
   <?php
   $explodedate = explode(' ',$totalouters[$o]->sumitdate);
   if( $totalouters[$o]->id == $outside_vendor->awardedid ){
   echo $explodedate[0];
   $font = "<font color='green'>";
   }
   else{
   $font = "<font color='red'>";
   }
   ?>
   </strong></td>
    <td valign="middle" width="20%" align="center"><strong><?php echo $font.'$'.number_format($totalouters[$o]->amount,2); ?></strong></td>

  </tr>
  <?php } } ?>
<?php   if($from == 'yes') { ?>
  <tr class="table_blue_rowdotsextendlast"><td valign="middle" colspan="5" align="center"><br /><strong>
  <?php 

  if($outside_vendor){
  echo "Outside Vendor - Rating Unavailable";
  }
  else{
  echo "Rating for:";  
  }?>
  </strong> <?php echo $award_company; ?><p style="height:10px;"></p>
	<?php 
	if($deta->apple_publish == 0 && !$outside_vendor){ ?><span id="apple<?php echo $deta->apple ; ?>">&nbsp;</span>
		<span id="click_result" style="padding-top:6px;">
		<?php 
		if($deta->apple == '1')		
		echo "VERY UNSATISFIED";
		if($deta->apple == '2')		
		echo "UNSATISFIED";
		if($deta->apple == '3')		
		echo "NEUTRAL";
		if($deta->apple == '4')		
		echo "SATISFIED";
		if($deta->apple == '5')		
		echo "VERY SATISFIED";
		?>
		</span>
		<?php
		if(!$man_comment->rate_date){
		$dat_rate_date = $deta->awardeddate ;
		$dat_rate_date = str_replace('-','/',$dat_rate_date);
		}
		else{
		$dat_rate_date = $man_comment->rate_date ;
		}
		
		$dat_rate_date = explode(' ',$dat_rate_date);
		$dat_rate_date = $dat_rate_date[0];
		echo "<br /><span class='managercoments'>".nl2br($man_comment->comment)."</span>";
		echo "<div class='clear'></div><span><strong>Submitted by</strong>: ".$user_details->name." ".substr($user_details->lastname,0,1).". - ".$user_details->comp_city.", ".strtoupper($state_rating)." on ".$dat_rate_date."</span>";
		
		if($man_comment->id)
		$man_comment->id = $man_comment->id;
		else
		$man_comment->id = "'no'";
		?>
		<br /><br /><span><a href="javascript:getapplepopup_edit(<?php echo $rfpid; ?>,<?php echo $man_comment->id; ?>,<?php echo $awarded_vendorid; ?>);" id="editrating" rel="<?php echo $man_comment->id; ?>"><img src="templates/camassistant_left/images/yello_editbtn.png" /></a></span>
	<?php } 
	else if($outside_vendor){ echo "<strong><font color='red'></font></strong>";  } 
	else { echo "<strong><font color='red'>This review has been removed by MyVC</font></strong>"; } ?>
	
	</td></tr>
	<tr height="20"></tr>
	<?php } ?>
</tbody></table>

    </td>
  </tr>
     
	<?php if($from != 'yes' && !$outside_vendor ) {
   
	if( $user->user_type == '16' ) {
	  if( $admindata->cust_id == $user->id ) {
	
	 ?>
	<tr valign="middle" height="55">
    <td>
    
	<p align="center" style="padding-bottom:5px;"><a class="review_submit_new" href="javascript:getapplepopup('<?php echo $rfpid; ?>','<?php echo $awarded_vendorid; ?>');"><img class="review_submit_new" alt="" src="templates/camassistant_left/images/rate-vendor.png" /></a></p>
	 </td>
  </tr>
	<?php  } } else { ?> 
	<tr valign="middle" height="55">
    <td>
    
	<p align="center" style="padding-bottom:5px;"><a class="review_submit_new" href="javascript:getapplepopup('<?php echo $rfpid; ?>','<?php echo $awarded_vendorid; ?>');"><img class="review_submit_new" alt="" src="templates/camassistant_left/images/rate-vendor.png" /></a></p>
	 </td>
  </tr>
	<?php } } 
  
 // approval need for rfp submission
  $model = $this->getModel('rfpcenter');
  $rfpper = $model ->getawardper($rfpid);
  $managername = "SELECT name,lastname FROM #__users  WHERE id=".$rfpper->cust_id.""; 
  $db->setQuery( $managername );
  $managername = $db->loadObject();
 
if( $user->user_type == '16' &&  $rfpper->awardjobaproval == '1') { ?>
  <tr valign="middle" height="55">
  <td align="center"><strong><?php echo $managername->name.'&nbsp;'.$managername->lastname ; ?></strong> needs you to approve this project before it is submitted</td>
  </tr>
 <tr valign="middle" height="55">
  <td align="center">
   <a class='awarddecline_button' onclick='getdeclineapproval(<?php echo $rfpid ?>);' href='javascript:void(0);'></a>
  <a class='awardapproval_button' onclick='getawardapproval(<?php echo $rfpid ?>);' href='javascript:void(0);'></a>
 </td>
    </tr>
 <?php } ?>
</tbody></table>
	<?php  exit;
	 }
         function getunawardedproposals(){
	$rfpid = $_REQUEST['rfpid'];
	$rfpname = $_REQUEST['rfpname'];
	$type = $_REQUEST['type'];
	$from = $_REQUEST['from'];
	if($from != 'yes') {
	$condition = '(P.proposaltype="Unawarded" || P.proposaltype="Unawarded")';
	} else {
	$condition = 'P.proposaltype="Unawarded"';
	}
	$db = & JFactory::getDBO();
	$getprops = "SELECT U.id, U.name, U.email, U.ccemail, U.lastname,P.contact_name, V.company_phone,P.Alt_bid, V.company_name, V.phone_ext, P.proposaltype, P.proposal_total_price,P.id as proposalid  FROM jos_users as U
LEFT JOIN jos_cam_vendor_company  as V on U.id=V.user_id
LEFT JOIN jos_cam_vendor_proposals as P on U.id=P.proposedvendorid where ".$condition." and P.rfpno=".$rfpid." ";
	$db->setQuery( $getprops);
	$listprps = $db->loadObjectList();

             $getpublish = "SELECT rfp_adminstatus, jobtype FROM #__cam_rfpinfo WHERE id=".$rfpid." ";
	$db->setQuery( $getpublish);
	$admindata = $db->loadObject();
	$adminstatus = $admindata->rfp_adminstatus;
	?>
	<?php 
		if($admindata->jobtype == 'yes')
		$job_type = 'basic' ;
		else
		$job_type = '';
	 ?>
	<table width="100%" border="0" style="margin:0px 0px; border:1px solid #A3A3A3; background:#F7F7F7">
    <tbody>
    <tr>
    <td align="center">
    <ul class="addednumclosed" style="padding-bottom:0px;">
        <?php $count3= count($listprps); ?>
	<?php if($from != 'yes') {?>
	<?php /*?><li><a href="javascript:getapplepopup(<?php echo $rfpid; ?>);">RATE VENDOR</a></li><?php */?>
	<?php } ?>
	<li><a href="index.php?option=com_camassistant&controller=rfp&task=reviewrfp&rfpid=<?php echo $rfpid;  ?>&var=view&job=<?php echo $job_type; ?>&Itemid=87">VIEW REQUEST</a></li>
	<li><a href="javascript:popup_proposal_summary1(<?php echo $rfpid; ?>);">VIEW PROPOSALS</a></li>
	<li><a href='javascript:popup_proposal_summary34("<?PHP echo $rfpid; ?>","<?PHP echo $count3; ?>")' class="downloadproposals">DOWNLOAD PROPOSALS</a></li>
	<li></li>
	</ul>
	<ul class="addednumclosed" style="padding-top:0px;">
	<li><a href="#" onclick="draft(<?php echo $rfpid; ?>);">COPY AS NEW</a></li>
	<li><a href="#" onclick="rebid(<?php echo $rfpid; ?>,'<?php echo $job_type; ?>');" >MODIFY & RESUBMIT</a></li>
    </ul>
    </td>
  </tr>

  <tr>
    <td>
    <table width="100%" cellspacing="0" cellpadding="0" border="0" style="padding:0px 0px; border:">
  <tbody> <?php //if(count($listprps) > 0){ ?><tr>
    <td width="42%" height="10" bgcolor="#707070" style="color:#fff; padding-left:15px;"><strong>VENDOR INFORMATION</strong></td>
	<?php if($from != 'yes') {?>
	<!--<td width="20%" height="10" bgcolor="#707070" style="color:#fff; padding-left:27px;"><strong>AWARD DATE</strong></td>-->
	<td width="20%" height="10" bgcolor="#707070" style="color:#fff; padding-left:32px;"><strong>AWARD STATUS</strong></td>
    <td width="15%" height="10" bgcolor="#707070" align="center" style="color:#FFF;"><strong>PRICE</strong></td>
	<?php } else { ?>
	<td width="20%" height="10" bgcolor="#707070" align="center" style="color:#FFF;"><strong>YOUR RATING</strong></td>
	<?php } ?>
  	</tr><?php //} 
	if(count($listprps) <= 0) { ?>
	<tr class="table_blue_rowdotsextend">
	<td colspan="3">
	<p style="margin-bottom:10px; font-weight:bold;" align="center">This Request was ended before any proposals were submitted.</p>
	</td></tr>
	<?php }
	?>
	 <?php
	$getdate = "SELECT awardeddate,unawardeddate,apple,apple_publish from #__cam_rfpinfo where id=".$rfpid." ";
	$db->setQuery( $getdate);
	$deta = $db->loadObject();
        $outsidevendor = "SELECT awarded_vendor,amount,award_date from #__cam_outsidevendor where rfpid=".$rfpid." ";
	$db->setQuery( $outsidevendor);
	$outside_vendor = $db->loadObject();
	if($type == 'unaward'){
	$awardeddate = $deta->unawardeddate;
	}
	else{
	$awardeddate = $deta->awardeddate;
	}
	?>
   <?php for($i=0; $i<count($listprps); $i++){ ?>
    <?php if($listprps[$i]->contact_name){ 
  $listprps[$i]->contact_name = $listprps[$i]->contact_name;
	} else { 
  $listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
	} 
	//To get the contact name of alternative proposals
	if($listprps[$i]->Alt_bid == 'yes') {
		$getconame = "SELECT contact_name  FROM #__cam_vendor_proposals WHERE rfpno=".$rfpid." and proposedvendorid=".$listprps[$i]->id." and Alt_bid='' ";
		$db->setQuery( $getconame);
		$getcname = $db->loadResult();
		if($getcname){ 
		$listprps[$i]->contact_name = $getcname ;
		}
		else{
		$listprps[$i]->contact_name = $listprps[$i]->name. ' '. $listprps[$i]->lastname ;
		}
	}
	//Completed
	
	?>
	

	<tr class="table_blue_rowdotsextend">
    <td width="40%" style="text-align:left"><strong><a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $listprps[$i]->id; ?>" target="_blank"><?php echo $listprps[$i]->company_name ; ?></a></strong>
<p style="padding:0px 0px;"><?php echo $listprps[$i]->contact_name.': ' .$listprps[$i]->company_phone;  if($listprps[$i]->phone_ext) { echo "&nbsp;-&nbsp;(" . $listprps[$i]->phone_ext . ')' ; }?></p>
<a style="color:gray;" class="miniemails" href="mailto:<?php echo $listprps[$i]->email. '?cc=' .$listprps[$i]->ccemail; ?>">Email</a><p style="height:5px"></p></td>
	<?php if($from != 'yes') {?>
   <!-- <td valign="middle" width="20%" align="center"><strong>	<?php echo $awardeddate ; ?></strong></td> -->

   <td valign="middle" width="20%" align="center"><strong><?php if($listprps[$i]->proposaltype == 'Awarded') { echo "<font color='green'>AWARDED</font>"; } else { echo "<font color='red'>UNAWARDED</font>"; } ?> </strong></td>
   <?php 
	if($listprps[$i]->Alt_bid == 'yes')
	$alt = 'yes' ;
	else
	$alt = '' ;
	?>
    <td valign="middle" width="20%" align="center"><strong><?php  
	if($listprps[$i]->proposaltype == 'Awarded') { ?>
	<a id="redproposals" href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank">
	<?php echo "<font color='green'>$". number_format($listprps[$i]->proposal_total_price,2).'</font>';  ?></a>
	<?php } else {  ?>
	<a id="redproposals" href="index.php?option=com_camassistant&controller=rfpcenter&task=vendor_proposal_preview_tomanager&Alt_Prp=<?php echo $alt; ?>&Proposal_id=<?php echo $listprps[$i]->proposalid; ?>&vendor_id=<?php echo $listprps[$i]->id; ?>&rfp_id=<?php echo $rfpid; ?>&job=<?php echo $job_type; ?>" target="_blank">
	<?php 	echo "<font color='red'>$". number_format($listprps[$i]->proposal_total_price,2).'</font>';   ?> </a>
	<?php }?></strong><?php if($listprps[$i]->Alt_bid == 'yes'){
	echo " (alt)";
	} ?></td>
	<?php } else { ?>
	<td valign="middle" width="24%" align="center">
	<?php if($deta->apple_publish == 0){ ?><strong><span id="apple<?php echo $deta->apple ; ?>">&nbsp;</span><?php } ?></strong></td>
	<?php } ?>
  </tr>
  <?php } ?><?php if($outside_vendor){ ?>
  <tr class="table_blue_rowdotsextend">
    <td width="40%" style="text-align:left">
<p style="padding:0px 0px;"><strong>Outside Vendor</strong><br/><?php echo $outside_vendor->awarded_vendor; ?></p>
</p></td>

   <td valign="middle" width="20%" align="center"><strong><font color='green'>AWARDED</font></strong></td>
    <td valign="middle" width="20%" align="center"><strong><font color='red'>$<?php echo number_format($outside_vendor->amount,2); ?></font></strong></td>

  </tr>
  <?php } ?>
</tbody></table>

    </td>
  </tr>

	<?php if($from != 'yes') {?>
    <?php /*?><p style="float:right; padding-bottom:5px;"><a class="review_submit_new" href="javascript:contactsupport('<?php echo $rfpname; ?>');"><img class="review_submit_new" alt="" src="templates/camassistant_left/images/contact-support.png" /></a></p>
	<?php } else { ?>
	<tr valign="middle" height="55">
    <td>
	<p style="float:left; padding-bottom:5px;"><a class="review_submit_new" href="javascript:getapplepopup('<?php echo $rfpid; ?>');"><img class="review_submit_new" alt="" src="templates/camassistant_left/images/rate-vendor.png" /></a></p>
	 </td>
  </tr><?php */?>
	<?php } ?>


</tbody></table>
	<?php  exit;
	 }
	 //save apple rating
	 function saveapples(){
	 $user =& JFactory::getUser();
	 $model = $this->getModel('rfpcenter');
	 $db = & JFactory::getDBO();
	 $rfpid = JRequest::getVar('rfpid','');
	 $apple = JRequest::getVar('applerating','');
	 $type = JRequest::getVar('type','');
	 $id = JRequest::getVar('id','');
	 $rating_comment = JRequest::getVar('rating_comment','');
	 $query_updatedc = "UPDATE #__cam_rfpinfo SET apple ='".$apple."' WHERE id=".$rfpid;
	 $db->setQuery( $query_updatedc);
	 $update=$db->query();
	 // Save the Comments
	 if($type == 'edit')
	 $apples['id'] = $id;
	 
	 $apples['rfpid'] = $rfpid;
	 $apples['comment'] = $rating_comment;
	 $apples['managerid'] = $user->id;
	 $apples['apples'] = $apple;
	 $apples['rate_date'] = date('m/d/Y G:i:s');
	 $save_rating = $model->saveapplerating($apples);
	 $link='index.php?option=com_camassistant&controller=rfpcenter&task=awardrfp&rated=yes&Itemid=123';
	 echo '<script>parent.location="'.$link.'";</script>';
	 //Completed
	/* if($update){
		$msg = "Vendor rating updated successfully.";
		$link='index.php?option=com_camassistant&controller=rfpcenter&task=awardrfp&Itemid=123';
		$this->setRedirect( $link,$msg );
		}*/
	  }

	 function checkapples(){
	 	$db = & JFactory::getDBO();
		$rfpid = JRequest::getVar('rfpid','');
		$getdate = "SELECT apple from #__cam_rfpinfo where id=".$rfpid." ";
		$db->setQuery( $getdate);
		$apples = $db->loadResult();
		if($apples){
		echo "given";
		}
		else{
		echo "Not given";
		}
		exit;
	 }
	 function reopenedclosedrfp(){
	 $db = & JFactory::getDBO();
	 $rfpid = JRequest::getVar('rfpid','');
	 $query_updatedc = "UPDATE #__cam_rfpinfo SET rfp_type ='rfp', closedfrom ='',publish ='1',biddingcloseddate='', bidding='open' WHERE id=".$rfpid;
	 $db->setQuery( $query_updatedc);
	 $update=$db->query();
	 if($update){
		$msg = "RFP re-opend successfully.";
		$link='index.php?option=com_camassistant&controller=rfpcenter&task=submitedrfp&Itemid=87';
		$this->setRedirect( $link,$msg );
		}
		
	 }
	 
	 
 //Function to get the SOW form
	 function getsowform(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');
		$user =& JFactory::getUser();
		if(($user->user_type == '13' && $user->accounttype == 'master') || $user->user_type == '16'){
			$display_edit = '';
		}
		else{
			$display_edit = 'none';
		}
			
		if($user->user_type == '13' && $user->accounttype != 'master'){
		$sql_master = "SELECT masterid FROM #__cam_masteraccounts where firmid='".$user->id."'";
		$db->Setquery($sql_master);
		$exmaster = $db->loadResult();
		}
		else if($user->user_type == '13' && $user->accounttype == 'master'){
		$exmaster = $user->id;
		}
		else{
		$sql_c = "SELECT comp_id FROM #__cam_customer_companyinfo where cust_id='".$user->id."'";
		$db->Setquery($sql_c);
		$cname = $db->loadResult();
		$sql_ma = "SELECT cust_id FROM #__cam_camfirminfo where id='".$cname."'";
		$db->Setquery($sql_ma);
		$firmad = $db->loadResult();
		$sql_master = "SELECT masterid FROM #__cam_masteraccounts where firmid='".$firmad."'";
		$db->Setquery($sql_master);
		$exmaster = $db->loadResult();
		}
		
		
		
		if( !$exmaster && $user->user_type !=16 ){ ?>
		<p class="insurancedotlinet" style="border-bottom:none; padding:10px;background-color:#eeeeee;">To set company-wide compliance standards, please contact MyVendorCenter to set up a FREE Master Account.  You may do this by sending an email to <a class="editstandards_limit" href="mailto:support@myvendorcenter.com">support@myvendorcenter.com</a> or by calling 1-800-985-9243.  <br /><br /></p>
		<?php }
		?>
<div class="lineitem_pan_row" style="background-color:#eeeeee;">
<p style="height:2px;"></p>

<div class="editoption" align="right" style="display:<?php echo $display_edit; ?>">
<a href="javascript:void(0);" class="editstandards">EDIT</a><p style="height:4px;"></p>
</div>
<div class="insuranceoptions" style="display:none;" align="right">
<a href="#" class="editstandardsind">SAVE</a>&nbsp;&nbsp;&nbsp; <a class="editstandardall">|</a>&nbsp;&nbsp;&nbsp;
<a href="#" rel="all" class="editstandardall">SAVE AND APPLY TO ALL INDUSTRIES</a>&nbsp;&nbsp;&nbsp; <a class="editstandardall">|</a>&nbsp;&nbsp;&nbsp;
<a href="javascript:void(0);" class="cancelbutton">CANCEL</a>
<p style="height:10px;"></p>
</div>
<div class="insurancedotline" style="display:<?php echo $display_edit; ?>"></div>
<p class="insurancedotline_text" style="border-bottom:none; padding-top:5px; display:none;">Please select the minimum requirements for Vendors that service this industry and then "SAVE". We recommend understanding the typical compliance standards within each industry before applying your own settings below. You may also upload a sample certificate for Vendors to review by clicking on the "UPLOAD SAMPLE CERT" button below.  <br /><br />
<?php /*?><span id='upload_file10' style="float:left;width:auto;padding-right:5px; margin-top:15px;"><a href="javascript:addEventa2('10');" style="margin-top:11px;"><img src="templates/camassistant_left/images/UploadSampleCert.png" /></a></span><?php */?>
<div class="clear"></div>
<?php 
$certificates = $model->getcertificates($industryid);
?>
</p>
<div class="clear"></div>
<div class="lineitem_pan" style="border:none;">
<form action="" name="specialreqs" id="specialreqs" method="post">
	<input name="hidden" type="hidden" id="theValue" value="0">
	<div class="insurancedotline" style="border-bottom:none; margin-left:17px; margin-top:12px;">
	<?php
	
	$w9data = $model->getw9insdata($industryid);
	$generaldata = $model->getgeneralinsdata($industryid);
	$autodata = $model->getautoinsdata($industryid);
	$workdata = $model->getworkinsdata($industryid);
	$umbrelladata = $model->getumbrellainsdata($industryid);
	$licdata = $model->getlicinsdata($industryid);
	$omidata = $model->getomiinsdata($industryid);
	
	if(( !$w9data && !$generaldata && !$autodata && !$workdata && !$umbrelladata && !$licdata && !$omidata)&& $user->user_type == 16 )
	{ ?>
	<div class="editnewinfotext" align="center"><span>You have not set any standards for this industry, please click EDIT to get started</span></div>
	<?php }
	?>
	<table cellpadding="0" cellspacing="0" border="0" width="97%">
	
	
	
	<?php
	$w9data = $model->getw9insdata($industryid);
	if($w9data) { $w9_main = 'checked="checked"'; $w9_class = 'styled active'; 
	?>
	<tr>
	<td width="10"><input type="checkbox" value="yes" id="w9standards" class="<?php echo $w9_class; ?>" name="w9standards" <?php echo $w9_main; ?> /></td><td><strong>W9</strong></td></tr>
		<?php } else { ?>
	<tr id="w9_lost" style="display:none;">
	<td width="10"><input type="checkbox" value="yes" id="w9standards" class="<?php echo $w9_class; ?>" name="w9standards" <?php echo $w9_main; ?> /></td><td><strong>W9</strong></td></tr>	
		<?php } ?>
	<tr height="15"></tr>
	<?php
	$generaldata = $model->getgeneralinsdata($industryid);
	if($generaldata) { $general_main = 'checked="checked"'; $gen_class = 'styled active'; 
	?>
	
	<tr>
	<td width="10"><input type="checkbox" value="yes" id="generalliability" class="<?php echo $gen_class; ?>" name="generalliability" <?php echo $general_main; ?> /></td><td><strong>General Liability</strong></td></tr>
		<?php } else { ?>
	<tr id="generalliability_lost" style="display:none;">
	<td width="10"><input type="checkbox" value="yes" id="generalliability" class="<?php echo $gen_class; ?>" name="generalliability" <?php echo $general_main; ?> /></td><td><strong>General Liability</strong></td></tr>	
		<?php } ?>
	<?php 
	if($generaldata) {
	?>
	<tr><td></td><td>
	<ul class="pre_general" style="pointer-events:none; list-style-type:none;">
		<?php if($generaldata->occur){ $selected_occur = 'checked'; $class = 'styled active'; ?>
		<li><input type="checkbox" value="yes" name="occur" class="<?php echo $class; ?>" checked="<?php echo $selected_occur; ?>" /> <label>Occur</label></li>
		<?php } ?>
		<?php if($generaldata->each_occurrence && $generaldata->each_occurrence != '0.00'){ ?>
		<li>Each Occurrence:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($generaldata->each_occurrence,2); ?></span></li>
		<?php } ?>
		<?php if($generaldata->damage_retend && $generaldata->damage_retend != '0.00'){ ?>
		<li>Damage to Rented Premises:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($generaldata->damage_retend,2); ?></span></li>
		<?php } ?>
		<?php if($generaldata->med_expenses && $generaldata->med_expenses != '0.00'){ ?>
		<li>Med Expenses:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($generaldata->med_expenses,2); ?></span></li>
		<?php } ?>
		<?php if($generaldata->personal_inj && $generaldata->personal_inj != '0.00'){ ?>
		<li>Personal & Adv injury:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($generaldata->personal_inj,2); ?></span></li>
		<?php } ?>
		<?php if($generaldata->general_aggr && $generaldata->general_aggr != '0.00'){ ?>
		<li>General Aggregate:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($generaldata->general_aggr,2); ?></span>
		<?php } ?>
		<?php if($generaldata->applies_to){ ?>
		<?php if($generaldata->applies_to == 'pol') 
			  $pols = 'checked="checked"';
		      else if($generaldata->applies_to == 'proj')
			  $proj = 'checked="checked"';
			  else if($generaldata->applies_to == 'loc')
			  $loc = 'checked="checked"';
		 ?>
		| Applies To: 
		<input type="radio" name="applies_to" value="pol" <?php echo $pols; ?>  style="vertical-align:top" /> Pol&nbsp;&nbsp; 
		<input type="radio" name="applies_to" value="proj" <?php echo $proj; ?>  style="vertical-align:top" /> Proj&nbsp;&nbsp;
		<input type="radio" name="applies_to" value="loc" <?php echo $loc; ?>  style="vertical-align:top" /> Loc</li>
		<?php } ?>
		<?php if($generaldata->products_aggr && $generaldata->products_aggr != '0.00'){ ?>
		<li>Products - COMP/OP Aggregate:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($generaldata->products_aggr,2); ?></span></li>
		<?php } ?>
		<?php if($generaldata->waiver_sub == 'yes'){ $waiv = 'checked'; $class_waiver_sub = 'styled'; ?>
		<li><input type="checkbox" value="yes" name="waiver_sub" checked="<?php echo $waiv; ?>" class="<?php echo $class_waiver_sub; ?>" /> <label>Waiver of Subrogation</label></li>
		<?php } ?>
		<?php if($generaldata->primary_noncontr == 'yes'){ $prim = 'checked'; $class_primary_noncontr = 'styled';?>
		<li><input type="checkbox" value="yes" name="primary_noncontr" checked="<?php echo $prim; ?>" class="<?php echo $class_primary_noncontr; ?>" /> <label>Primary Non-Contributory</label></li>
		<?php } ?>
		<?php if($generaldata->additional_insured == 'yes'){ $add = 'checked'; $class_additional_insured = 'styled';?>
		<li><input type="checkbox" value="yes" name="additional_insured" checked="<?php echo $add; ?>" class="<?php echo $class_additional_insured; ?>" /><label> List my Company as as "Additional Insured"</label></li>
		<?php } ?>
		<?php if($generaldata->cert_holder == 'yes'){ $cert = 'checked'; $class_cert_holder = 'styled'; ?>
		<li><input type="checkbox" value="yes" name="cert_holder" checked="<?php echo $cert; ?>" class="<?php echo $class_cert_holder; ?>"  /><label> MyVendorCenter listed as Cert. Holder</label></li>
		<?php } ?>
		</ul>		
		</td>
		</td></tr>
	<?php } ?>	
	<tr id="generalliability_sub"></tr>
	<tr height="15"></tr>
	<?php
	$autodata = $model->getautoinsdata($industryid);
		if($autodata){ $auto_main = 'checked="checked"'; $class_auto="styled active";  
	?>
	<tr>
	<td width="10"><input type="checkbox" value="yes" id="autoliability" class="<?php echo $class_auto; ?>" name="autoliability" <?php echo $auto_main; ?> /></td><td><strong>Auto Liability</strong></td></tr>
	<?php } else { ?>
	<tr id="autoliability_lost" style="display:none;"><td width="10"><input type="checkbox" value="yes" id="autoliability" class="<?php echo $class_auto; ?>" name="autoliability" <?php echo $auto_main; ?> /></td><td><strong>Auto Liability</strong></td></tr>
	<?php } ?>
	<tr><td></td><td>
	<ul class="pre_auto" style="pointer-events:none; list-style-type:none;">
		<?php 
		
			  if($autodata->applies_to_any == 'any') {
			  $any = 'checked="checked"';
			  $class_cert_1 = 'styled';
			  }
		      if($autodata->applies_to_owned == 'owned') {
			  $owned = 'checked="checked"';
			  $class_cert_2 = 'styled';
			  }
			  if ($autodata->applies_to_nonowned == 'nonowned') {
			  $nonowned = 'checked="checked"';
			  $class_cert_3 = 'styled';
			  }
			  if ($autodata->applies_to_hired == 'hired') {
			  $hired = 'checked="checked"';
			  $class_cert_4 = 'styled';
			  }
			  if ($autodata->applies_to_scheduled == 'scheduled') {
			  $scheduled = 'checked="checked"';
			  $class_cert_5 = 'styled';
			  }
		?>
	
<?php if($autodata->applies_to_any || $autodata->applies_to_owned || $autodata->applies_to_nonowned || $autodata->applies_to_hired || $autodata->applies_to_scheduled){ ?>		
<li>
		<table cellpadding="0" cellspacing="0"><tr><td>Applies To:&nbsp;&nbsp;</td>
		<?php } ?>
		<?php if($autodata->applies_to_any == 'any') { ?>
		<td><input type="checkbox" name="applies_to_any" class="<?php echo $class_cert_1; ?>" value="any" <?php echo $any; ?>   /></td><td> Any&nbsp;&nbsp; </td>
		<?php } ?>
		<?php if($autodata->applies_to_owned) {?>
		<td><input type="checkbox" name="applies_to_owned" class="<?php echo $class_cert_2; ?>" value="owned" <?php echo $owned; ?> /></td><td> Owned&nbsp;&nbsp;</td>
		<?php } ?>
		<?php if($autodata->applies_to_nonowned) { ?>		
		<td><input type="checkbox" name="applies_to_nonowned" class="<?php echo $class_cert_3; ?>" value="nonowned" <?php echo $nonowned; ?> /></td><td>Non-Owned&nbsp;&nbsp;</td>
		<?php } ?>
		<?php if($autodata->applies_to_hired) { ?>		
		<td><input type="checkbox" name="applies_to_hired" class="<?php echo $class_cert_4; ?>" value="hired" <?php echo $hired; ?> /></td><td>Hired&nbsp;&nbsp;</td>
		<?php } ?>
		<?php if($autodata->applies_to_scheduled) { ?>		
		<td><input type="checkbox" name="applies_to_scheduled" class="<?php echo $class_cert_5; ?>" value="scheduled" <?php echo $scheduled; ?> /></td><td>Scheduled</td>
		<?php } ?>
		<?php if($autodata->applies_to_any || $autodata->applies_to_owned || $autodata->applies_to_nonowned || $autodata->applies_to_hired || $autodata->applies_to_scheduled){ ?>		
</tr></table></li>
		<?php } ?>
		
		
		<?php if($autodata->combined_single  && $autodata->combined_single != '0.00'){ ?>
		<li>Combined Single Limit:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($autodata->combined_single,2); ?></span></li>
		<?php } ?>		
		<?php if($autodata->bodily_injusy_person && $autodata->bodily_injusy_person != '0.00'){ ?>
		<li>Bodily Injury - Per Person:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($autodata->bodily_injusy_person,2); ?></span></li>
		<?php } ?>		
		<?php if($autodata->bodily_injusy_accident && $autodata->bodily_injusy_accident != '0.00'){ ?>
		<li>Bodily Injury - Per Accident:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($autodata->bodily_injusy_accident,2); ?></span></li>
		<?php } ?>		
		<?php if($autodata->property_damage && $autodata->property_damage != '0.00'){ ?>
		<li>Property Damage - Per Accident:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($autodata->property_damage,2); ?></span></li>
		<?php } ?>
		<?php if($autodata->waiver){ ?>
		<?php if($autodata->waiver == 'yes'){ $waiv = 'checked="checked"'; $class_waiver = 'styled'; }?>
		<li><input type="checkbox" value="yes" name="waiver" <?php echo $waiv; ?> class="<?php echo $class_waiver; ?>" /> <label>Waiver of Subrogation</label></li>
		<?php } ?>
		<?php if($autodata->primary){ ?>
		<?php if($autodata->primary == 'yes'){ $prim = 'checked="checked"'; $class_primary = 'styled';} ?>
		<li><input type="checkbox" value="yes" name="primary" <?php echo $prim; ?>  class="<?php echo $class_primary; ?>" /><label> Primary Non-Contributory</label></li>
		<?php } ?>
		<?php if($autodata->additional_ins){ ?>
		<?php if($autodata->additional_ins == 'yes'){ $add = 'checked="checked"'; $class_additional_ins = 'styled';} ?>
		<li><input type="checkbox" value="yes" name="additional_ins" <?php echo $add; ?> class="<?php echo $class_additional_ins; ?>" /> <label>List my Company as as "Additional Insured"</label></li>
		<?php } ?>
		<?php if($autodata->cert_holder){ ?>
		<?php if($autodata->cert_holder == 'yes'){ $cert = 'checked="checked"'; $class_cert_holder2 = 'styled';} ?>
		<li><input type="checkbox" value="yes" name="cert_holder" <?php echo $cert; ?> class="<?php echo $class_cert_holder2; ?>"  /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		<?php } ?>
		</ul>
	
	</td></tr>
	<tr id="autoliability_sub"></tr>
	<tr height="15"></tr>
	<?php
	$workdata = $model->getworkinsdata($industryid);
		if($workdata){ $work_main = 'checked="checked"'; $class_work="styled active";
	?>
	<tr><td width="10"><input type="checkbox" value="yes" id="workersliability" class="<?php echo $class_work; ?>" name="workersliability" <?php echo $work_main; ?> /></td><td><strong>Worker's Comp Policy/Employers Liability</strong></td></tr>
	<?php } else { ?>
	<tr id="workersliability_lost" style="display:none;"><td width="10"><input type="checkbox" value="yes" id="workersliability" class="<?php echo $class_work; ?>" name="workersliability" <?php echo $work_main; ?> /></td><td><strong>Worker's Comp Policy/Employer's Liability</strong></td></tr>
	<?php } ?>
	<tr><td></td><td>
	<ul class="pre_workers" style="pointer-events:none; list-style-type:none;">
		<?php 
		if($workdata->workers_not == 'not') {
		$not = 'checked="checked"';
		if($workdata->workers_not){ ?>
		<li><input type="radio" id="workers_not" name="workers_not" value="not" <?php echo $not; ?> style="vertical-align:top;"  /> Worker's Comp Exemptions NOT accepted</li>
		<?php } ?>	
		<li><ul class="notaccepted" style="list-style-type:none;"><li>	
		<?php if($workdata->each_accident && $workdata->each_accident !='0.00' ){ ?>
		<li>Each Accident:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($workdata->each_accident,2); ?></span></li>
		<?php } ?>		
		<?php if($workdata->disease_policy && $workdata->disease_policy !='0.00' ){ ?>
		<li>Disease - Policy Limit:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($workdata->disease_policy,2); ?></span></li>
		<?php } ?>		
		<?php if($workdata->disease_eachemp && $workdata->disease_eachemp !='0.00' ){ ?>
		<li>Disease - Each Employee:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($workdata->disease_eachemp,2); ?></span></li>
		<?php } ?>
		<?php if($workdata->waiver_work){ ?>
		<?php if($workdata->waiver_work == 'yes'){ $waiver_work = 'checked="checked"'; $class_waiver_work = 'styled';}?>
		<li><input type="checkbox" value="yes" name="waiver_work" <?php echo $waiver_work; ?> class="<?php echo $class_waiver_work; ?>" /> <label>Waiver of Subrogation</label></li>
		<?php } ?>
		<?php if($workdata->certholder_work){ ?>
		<?php if($workdata->certholder_work == 'yes'){ $certholder_work = 'checked="checked"'; $class_certholder_work = 'styled';} ?>
		<li><input type="checkbox" value="yes" name="certholder_work" <?php echo $certholder_work; ?> class="<?php echo $class_certholder_work; ?>" /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		</li></ul></li>
		<?php } ?>
		<?php 
		}
		else if($workdata->workers_not == 'yes'){ 
		$workers_accepted = 'checked="checked"';
		?>
		<li><input type="radio" id="workers_yes" name="workers_not" value="yes" <?php echo $workers_accepted; ?> style="vertical-align:top;" /> Worker's Comp Exemptions accepted
		<br />WARNING: Worker's Comp. Exemption Certificates are commonly mistaken for a Worker's Comp policy. Please be aware that this "exemption" does NOT offer the property manager/association/building owner any form of protection against liability for an injured worker's loss of wages and/or medical expenses if an on-the-job injury occurs. Consult your legal advisor for your unique situation, as laws vary by jurisdiction.
		</li>
		<?php } ?>
		</ul>
	
	</td></tr>
	<tr id="workersliability_sub"></tr>
	<tr height="15"></tr>
	<?php
	$umbrelladata = $model->getumbrellainsdata($industryid);
		if($umbrelladata){ $umb_main = 'checked="checked"'; $class_umb = 'styled active';  
	?>
	<tr><td width="10"><input type="checkbox" value="yes" id="umbrellaliability" class="<?php echo $class_umb; ?>" name="umbrellaliability" <?php echo $umb_main; ?> /></td><td><strong>Umbrella Liability</strong></td></tr>
	<?php } else { ?>
	
	<tr id="umbrellaliability_lost" style="display:none;"><td width="10"><input type="checkbox" value="yes" id="umbrellaliability" class="<?php echo $class_umb; ?>" name="umbrellaliability" <?php echo $umb_main; ?> /></td><td><strong>Umbrella Liability</strong></td></tr>
	
	<?php } ?>
	<tr><td></td><td>
	<ul class="pre_umbrella" style="pointer-events:none; list-style-type:none;">
		
		<?php if($umbrelladata->each_occur && $umbrelladata->each_occur !='0.00' ){ ?>
		<li>Each Occurrence:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($umbrelladata->each_occur,2); ?></span></li>
		<?php } ?>		
		<?php if($umbrelladata->aggregate && $umbrelladata->aggregate !='0.00' ){ ?>
		<li>Aggregate:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($umbrelladata->aggregate,2); ?></span></li>
		<?php } ?>	
		<?php if($umbrelladata->certholder_umbrella){ ?>
		<?php if($umbrelladata->certholder_umbrella == 'yes'){ $waiver_umbrella = 'checked="checked"'; $class_certholder_umbrella = 'styled'; }?>
		<li><input type="checkbox" value="yes" name="certholder_umbrella" <?php echo $waiver_umbrella; ?> class="<?php echo $class_certholder_umbrella; ?>" /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		<?php } ?>	
		</ul>
	</td></tr>
	<tr id="umbrellaliability_sub"></tr>
	<tr height="15"></tr>
	<?php
	$licdata = $model->getlicinsdata($industryid);
		if($licdata){ $lic_main = 'checked="checked"'; $class_lic = 'styled active'; 
	?>
	<tr><td width="10"><input type="checkbox" value="yes" id="licensingliability" class="<?php echo $class_lic; ?>" name="licensingliability" <?php echo $lic_main; ?> /></td><td><strong>Licensing</strong></td></tr>
	<?php } else { ?>
	<tr id="licensingliability_lost" style="display:none;"><td width="10"><input type="checkbox" value="yes" id="licensingliability" class="<?php echo $class_lic; ?>" name="licensingliability" <?php echo $lic_main; ?> /></td><td><strong>Licensing</strong></td></tr>
	<?php } ?>
	<tr><td></td><td>
	<ul class="pre_lic" style="pointer-events:none; list-style-type:none;">
		
		<?php if($licdata->professional){ ?>
		<?php if($licdata->professional == 'yes'){ $professional = 'checked="checked"'; $class_professional = 'styled';}?>
		<li><input type="checkbox" value="yes" name="professional" <?php echo $professional; ?> class="<?php echo $class_professional; ?>" /> <label>Professional License</label></li>
		<?php } ?>		
		<?php if($licdata->occupational){ ?>
		<?php if($licdata->occupational == 'yes'){ $occupational = 'checked="checked"'; $class_occupational = 'styled';}?>
		<li><input type="checkbox" value="yes" name="occupational" <?php echo $occupational; ?> class="<?php echo $class_occupational; ?>" /> <label>Occupational License</label></li>
		<?php } ?>	
		</ul>
	</td></tr>
	
	<tr id="licensingliability_sub"></tr>	
	<tr height="15"></tr>
	<?php
	$omidata = $model->getomiinsdata($industryid);
	if($omidata){ $omi_main = 'checked="checked"'; $class_omi="styled active";  
	?>
	<tr><td width="10"><input type="checkbox" value="yes" id="errorsomissions" class="<?php echo $class_omi; ?>" name="errorsomissions" <?php echo $omi_main; ?> /></td><td><strong>Errors & Omissions</strong></td></tr>
	<?php } else { ?>
	<tr id="errorsomissions_lost" style="display:none;"><td width="10"><input type="checkbox" value="yes" id="errorsomissions" class="<?php echo $omi_main; ?>" name="errorsomissions" <?php echo $omi_main; ?> /></td><td><strong>Errors & Omissions</strong></td></tr>
	<?php } ?>
	<tr><td></td><td>
	<ul class="pre_omi" style="pointer-events:none; list-style-type:none;">
		
		<?php if($omidata->each_claim && $omidata->each_claim !='0.00' ){ ?>
		<li>Each Claim:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($omidata->each_claim,2); ?></span></li>
		<?php } ?>		
		<?php if($omidata->aggregate_omi && $omidata->aggregate_omi !='0.00' ){ ?>
		<li>Aggregate:&nbsp;<span id="greenbolddolor"><?php echo "$".number_format($omidata->aggregate_omi,2); ?></span></li>
		<?php } ?>	
		<?php if($omidata->certholder_omi){ ?>
		<?php if($omidata->certholder_omi == 'yes'){ $waiver_omi = 'checked="checked"'; $class_certholder_omi = 'styled'; }?>
		<li><input type="checkbox" value="yes" name="certholder_omi" <?php echo $waiver_omi; ?> class="<?php echo $class_certholder_omi; ?>" /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		<?php } ?>	
		</ul>
	</td></tr>
	<tr id="errorsomissions_sub"></tr>	
	<tr height="15"></tr>
	
	</table>
	
	<?php if($exmaster || $user->user_type == '16'){ ?>
	<div id="dashedlinecertificate" class="insurancedotline_text">
<span class="dashspan">SAMPLE CERTIFICATE</span></div>
	<?php } ?>
	<?php if( count($certificates) >= 1 ) { ?>
	<table cellpadding="0" cellspacing="0" style="padding-top:15px;" width="100%">
<?php for( $ce=0; $ce<count($certificates); $ce++ ){ 
	if($certificates[$ce]->type == 'shared')
	$addition = '&type=shared';
	else
	$addition = '';
	
	
?>
<tr id="certificate<?php echo $certificates[$ce]->id; ?>" align="center">



<td style="text-align:center;">
<a class="removecertificate" id="removecertificate" rel="<?php echo $certificates[$ce]->id; ?>" href="javascript:void(0);" style="display:none;"><img src="templates/camassistant_left/images/red.png" alt="delete" style="cursor:pointer;" /></a> &nbsp;&nbsp;
<a class="viewcertificates" href="index.php?option=com_camassistant&controller=rfpcenter&task=viewcertificatedoc&filename=<?php echo $certificates[$ce]->filename; ?>&filepath=<?php echo $certificates[$ce]->filepath; ?>&propertyid=<?php echo $certificates[$ce]->propertyid; ?><?php echo $addition; ?>"><?php echo str_replace('_',' ',$certificates[$ce]->filename); ?></a></td>
</tr>
<tr height="5"></tr>
<?php } ?>
</table>
<?php } else { 


if( $user->user_type == '16' )
	$newdisp = '';
	else
	$newdisp = 'none';
?>
<table cellpadding="0" cellspacing="0" style="padding-top:15px;" width="100%">

<tr id="certificate" align="center">
<td class="editpropicnew" style="text-align:center; display:<?php echo $newdisp; ?>">
You have not uploaded a sample certificate for your Vendors
</td>
</tr>
<tr height="5"></tr>

</table>
<?php } ?>
	<p class="insurancedotline_text" style="border-bottom:none; padding-top:15px; display:none; margin-left:0px; margin-right:0px; padding-left:0px; text-align:center;">
	<span style="width:auto; margin-top:15px; margin-bottom:15px;" id="upload_file10"><a style="margin-top:11px;" href="javascript:addEventa2('10');"><img src="templates/camassistant_left/images/UploadSampleCert.png"></a></span></p>
	<div class="clear"></div>
	
		 </div>
<input type="hidden" value="com_camassistant" name="option">
<input type="hidden" value="saveinsurance" name="task">
<input type="hidden" value="rfpcenter" name="controller">
<input type="hidden" id="industryall" value="<?php echo $industryid; ?>" name="industry" />
<span id="delimg10" style="display:none" title="Remove From list"><img src="templates/camassistant_left/images/red.png" alt="delete" style="cursor:pointer;" onclick="javascript:deletelineupload_line(10);"  /></span>
	<div id="newdiva210" style="margin-top:20px; margin-left:0px;" align="center"></div>
	<br />
</form>
</div>

<div class="clear"></div>
</div>
		<?php
		exit;
	  } 
	 //Completed
	 //Function to get the all sub items of general liability insurance
	 function getgeneralliability(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');		
		$generaldata = $model->getgeneralinsdata($industryid);
			if($generaldata){
			$exist = 'exist';
			}
			else{
			$exist = 'noexist' ;
			}
	 	?>
		<?php echo $exist; ?><td></td>
		<td><ul class="generaloptions">
		<?php if($generaldata->occur){ $selected_occur = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="occur" <?php echo $selected_occur; ?> />&nbsp;<label>Occur</label></li>
		<li>Each Occurrence: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="each_occurrence" value="<?php echo number_format($generaldata->each_occurrence,2); ?>" name="each_occurrence" /></li>
		<li>Damage to Rented Premises: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="damage_retend" value="<?php echo number_format($generaldata->damage_retend,2); ?>" name="damage_retend" /></li>
		<li>Med Expenses: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="med_expenses" value="<?php echo number_format($generaldata->med_expenses,2); ?>" name="med_expenses" /></li>
		<li>Personal & Adv injury: <input type="text" onClick="if(this.value == '0.00') this.value='';"  onChange="javascript: add_commas(this,this.value);" id="personal_inj" value="<?php echo number_format($generaldata->personal_inj,2); ?>" name="personal_inj" /></li>
		
		<li>
		<table cellpadding="0" cellspacing="0"><tr><td>General Aggregate: </td><td><input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="general_aggr" value="<?php echo number_format($generaldata->general_aggr,2); ?>" name="general_aggr" /></td> 
		<?php if($generaldata->applies_to == 'pol') 
			  $pols = 'checked="checked"';
		      else if($generaldata->applies_to == 'proj')
			  $proj = 'checked="checked"';
			  elseif ($generaldata->applies_to == 'loc')
			  $loc = 'checked="checked"';
		 ?>
		<td>&nbsp;&nbsp;| Applies To:&nbsp;</td><td> &nbsp;
		<input type="radio" name="applies_to" <?php echo $pols; ?> value="pol" style="vertical-align:top; margin-top:3px;" /></td><td> <label>Pol&nbsp;&nbsp;</label></td><td>
		<input type="radio" name="applies_to" value="proj" <?php echo $proj; ?>  style="vertical-align:top; margin-top:1px;" /></td><td> <label>Proj&nbsp;&nbsp;</label></td><td>
		<input type="radio" name="applies_to" value="loc" <?php echo $loc; ?>   style="vertical-align:top;  margin-top:1px;" /></td><td> <label>Loc</label></td></tr></table>
		</li>
		
		<li>Products - COMP/OP Aggregate: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="products_aggr" value="<?php echo number_format($generaldata->products_aggr,2); ?>" name="products_aggr" /></li>
		<?php if($generaldata->waiver_sub == 'yes'){ $waiv = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="waiver_sub" <?php echo $waiv; ?> /> <label>Waiver of Subrogation</label></li>
		<?php if($generaldata->primary_noncontr == 'yes'){ $prim = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="primary_noncontr" <?php echo $prim; ?> /> <label>Primary Non-Contributory</label></li>
		<?php if($generaldata->additional_insured == 'yes'){ $add = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="additional_insured" <?php echo $add; ?> /> <label>List my Company as as "Additional Insured"</label></li>
		<?php if($generaldata->cert_holder == 'yes'){ $cert = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="cert_holder_gli" <?php echo $cert; ?>  /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		</ul></td>
		
		
		<?php
		exit;
	 }
	 //Completed
	 
	 //Function to get the all sub items of general liability insurance
	 function getautoliability(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');		
		$autodata = $model->getautoinsdata($industryid);
			if($autodata){
			$exist = 'exist';
			}
			else{
			$exist = 'noexist' ;
			}
	 	?>
		<?php echo $exist; ?><td></td>
		<td><ul class="generaloptions">
		<?php if($autodata->applies_to_any == 'any') 
			  $any = 'checked="checked"';
		      if($autodata->applies_to_owned == 'owned')
			  $owned = 'checked="checked"';
			  if ($autodata->applies_to_nonowned == 'nonowned')
			  $nonowned = 'checked="checked"';
			  if ($autodata->applies_to_hired == 'hired')
			  $hired = 'checked="checked"';
			  if ($autodata->applies_to_scheduled == 'scheduled')
			  $scheduled = 'checked="checked"';
		?>
		<li>
		<span style="vertical-align:top">Applies To:&nbsp;</span>
		<input type="checkbox" name="applies_to_any" value="any" <?php echo $any; ?>  /> <label>Any</label>&nbsp;&nbsp; 
		<input type="checkbox" name="applies_to_owned" value="owned" <?php echo $owned; ?> /> <label>Owned</label>&nbsp;&nbsp;
		<input type="checkbox" name="applies_to_nonowned" value="nonowned" <?php echo $nonowned; ?> /> <label>Non-Owned</label>&nbsp;&nbsp;
		<input type="checkbox" name="applies_to_hired" value="hired" <?php echo $hired; ?> /> <label>Hired</label>&nbsp;&nbsp;
		<input type="checkbox" name="applies_to_scheduled" value="scheduled" <?php echo $scheduled; ?> /> <label>Scheduled</label>
		</li>
		<li>Combined Single Limit: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="combined_single" value="<?php echo number_format($autodata->combined_single,2); ?>" name="combined_single" /></li>
		<li>Bodily Injury - Per Person: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="bodily_injusy_person" value="<?php echo number_format($autodata->bodily_injusy_person,2); ?>" name="bodily_injusy_person" /></li>
		<li>Bodily Injury - Per Accident: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="bodily_injusy_accident" value="<?php echo number_format($autodata->bodily_injusy_accident,2); ?>" name="bodily_injusy_accident" /></li>
		<li>Property Damage - Per Accident: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="property_damage"  value="<?php echo number_format($autodata->property_damage,2); ?>" name="property_damage" /></li>
		<?php if($autodata->waiver == 'yes'){ $waiv = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="waiver" <?php echo $waiv; ?> /> <label>Waiver of Subrogation</label></li>
		<?php if($autodata->primary == 'yes'){ $prim = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="primary" <?php echo $prim; ?> /> <label>Primary Non-Contributory</label></li>
		<?php if($autodata->additional_ins == 'yes'){ $add = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="additional_ins" <?php echo $add; ?> /> <label>List my Company as as "Additional Insured"</label></li>
		<?php if($autodata->cert_holder == 'yes'){ $cert = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="cert_holder" <?php echo $cert; ?>  /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		</ul></td>
		
		
		<?php
		exit;
	 }
	 //Completed
	 
	  //Function to get the all sub items of workers liability insurance
	 function getworkliability(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');		
		$workdata = $model->getworkinsdata($industryid);
			if($workdata){
			$exist = 'exist';
			}
			else{
			$exist = 'noexist' ;
			}
	 	?>
		<?php echo $exist; ?><td></td>
		<td><ul class="generaloptions">
		<?php 
		if($workdata->workers_not == 'not') {
		$not = 'checked="checked"';
		$display = 'block';
		}
		else{
		$display='none';
		}
		?>
		<li><input type="radio" id="workers_not" name="workers_not" value="not" <?php echo $not; ?> style="vertical-align:top;" /> Worker's Comp Exemptions NOT accepted</li>
		<li><ul class="workers_sub" style="display:<?php echo $display; ?>; list-style-type:none;">
		<li>Each Accident: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="each_accident" value="<?php echo number_format($workdata->each_accident,2); ?>" name="each_accident" /></li>
		<li>Disease - Policy Limit: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="disease_policy" value="<?php echo number_format($workdata->disease_policy,2); ?>" name="disease_policy" /></li>
		<li>Disease - Each Employee: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="disease_eachemp" value="<?php echo number_format($workdata->disease_eachemp,2); ?>" name="disease_eachemp" /></li>
		<?php if($workdata->waiver_work == 'yes'){ $waiver_work = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="waiver_work" <?php echo $waiver_work; ?> /> <label>Waiver of Subrogation</label></li>
		<?php if($workdata->certholder_work == 'yes'){ $certholder_work = 'checked="checked"'; } ?>
		<li><input type="checkbox" value="yes" name="certholder_work" <?php echo $certholder_work; ?>  /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		</ul></li>
		<?php 
		if($workdata->workers_not == 'yes') 
		$workers_accepted = 'checked="checked"';
		?>
		<li><input type="radio" id="workers_yes" name="workers_not" value="yes" <?php echo $workers_accepted; ?> style="vertical-align:top;" /> Worker's Comp Exemptions accepted</li>
		WARNING: Worker's Comp. Exemption Certificates are commonly mistaken for a Worker's Comp policy. Please be aware that this "exemption" does NOT offer the property manager/association/building owner any form of protection against liability for an injured worker's loss of wages and/or medical expenses if an on-the-job injury occurs. Consult your legal advisor for your unique situation, as laws vary by jurisdiction.		
		</ul></td>
		
		
		<?php
		exit;
	 }
	 //Completed
	 
	 //Function to get the all sub items of umbrella insurance
	 function getumbrellaliability(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');		
		$umbrelladata = $model->getumbrellainsdata($industryid);
			if($umbrelladata){
			$exist = 'exist';
			}
			else{
			$exist = 'noexist' ;
			}
	 	?>
		<?php echo $exist; ?><td></td>
		<td><ul class="generaloptions">
		<?php 
		
		?>
		<li>Each Occurrence: <input type="text"  onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="each_occur" value="<?php echo number_format($umbrelladata->each_occur,2); ?>" name="each_occur" /></li>
		
		<li>Aggregate: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="aggregate" value="<?php echo number_format($umbrelladata->aggregate,2); ?>" name="aggregate" /></li>
		<?php if($umbrelladata->certholder_umbrella == 'yes'){ $waiver_umbrella = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="certholder_umbrella" <?php echo $waiver_umbrella; ?> /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		</ul></td>
		<?php
		exit;
	 }
	 //Completed
	 //Function to get the all sub items of lic insurance
	 function getlicliability(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');	
		$licdata = $model->getlicinsdata($industryid);	
			if($licdata){
			$exist = 'exist';
			}
			else{
			$exist = 'noexist' ;
			}
	 	?>
		<?php echo $exist; ?><td></td>
		<td><ul class="generaloptions">
		<?php 
		
		?>
		<?php if($licdata->professional == 'yes'){ $professional = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="professional" <?php echo $professional; ?> /> <label>Professional License</label></li>
		<?php if($licdata->occupational == 'yes'){ $occupational = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="occupational" <?php echo $occupational; ?> /> <label>Occupational License</label></li>
		</ul></td>
		<?php
		exit;
	 }
	 //Completed
	 
	 function getomissions(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industryid','');	
		$omidata = $model->getomiinsdata($industryid);	
			if($omidata){
			$exist = 'exist';
			}
			else{
			$exist = 'noexist' ;
			}
	 	?>
		<?php echo $exist; ?><td></td>
		<td><ul class="generaloptions">
		
		<li>Each Claim: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="each_claim" value="<?php echo number_format($omidata->each_claim,2); ?>" name="each_claim" /></li>

		<li>Aggregate: <input type="text" onClick="if(this.value == '0.00') this.value='';" onChange="javascript: add_commas(this,this.value);" id="aggregate_omi" value="<?php echo number_format($omidata->aggregate_omi,2); ?>" name="aggregate_omi" /></li>
		<?php if($omidata->certholder_omi == 'yes'){ $waiver_omi = 'checked="checked"'; }?>
		<li><input type="checkbox" value="yes" name="certholder_omi" <?php echo $waiver_omi; ?> /> <label>MyVendorCenter listed as Cert. Holder</label></li>
		
		</ul></td>
		<?php
		exit;
	 }
	 //Completed
	 
	 //Function to save the insurance standards
	 function saveinsurance(){
		$db=&JFactory::getDBO();	
	 	$user=JFactory::getUser();
		$model = $this->getModel('rfpcenter');
		$industryid = JRequest::getVar('industry','');
		$w9standards = JRequest::getVar('w9standards','');
		$generalliability = JRequest::getVar('generalliability','');
		$autoliability = JRequest::getVar('autoliability','');
		$workersliability = JRequest::getVar('workersliability','');
		$umbrellaliability = JRequest::getVar('umbrellaliability','');
		$licensingliability = JRequest::getVar('licensingliability','');
		$errorsability = JRequest::getVar('errorsomissions','');
		//echo $generalliability.'<br />';
		// To save the certificates
		$allcertifates = JRequest::getVar('linetask_uploads_210','');
			for( $uc=0; $uc<count($allcertifates); $uc++ ){
				$idname = $allcertifates[$uc] ;
				$idname = explode('-',$idname);
					
					if($idname[0] != 'shared')
					$certficates['propertyid'] = $idname[0] ;
					else
					$certficates['type'] = $idname[0] ;
					
				$certficates['masterid'] = $user->id ;
				$certficates['industryid'] = $industryid ;	
				$certficates['filepath'] = str_replace($idname[0],'',$allcertifates[$uc]) ;
				$certficates['filename'] = str_replace($idname[0],'',$allcertifates[$uc]) ;
				$certficates['filepath'] = ltrim ($certficates['filepath'],'-');
				$certficates['filename'] = ltrim ($certficates['filename'],'-');
				$file_name = explode('/',$certficates['filename']);
				$count = count($file_name);
				$certficates['filename'] = $file_name[$count - 1] ;
				$certficates['upload_date'] = date('Y-m-d');
				
					if($certficates['type'] == 'shared') {
					//Get company name and tax id to replace first path
					$vendor_data = "SELECT camfirm_license_no, comp_name FROM `jos_cam_customer_companyinfo` where cust_id=".$user->id." ";
					$db->setQuery( $vendor_data );
					$companyname = $db->loadObject();
					$data = "components/com_camassistant/doc/".str_replace(' ','_',$companyname->comp_name).'_'.str_replace(' ','_',$companyname->camfirm_license_no).'/';
					$certficates['filepath'] = str_replace($data,'',$certficates['filepath']) ;
					}
					else{
					$certficates['filepath'] = $certficates['filepath'] ;
					}
					
					if($industryid != 'all'){
						if($certficates['filename']){
							$savingdata = $model->savecertifcates($certficates);
						}
					}
					else{
					$industryList = $model->getallindustriesdef();	
						for( $ins=0; $ins<count($industryList); $ins++ )
						{
							$certficates['industryid'] = $industryList[$ins]->value ;
							if($certficates['filename']){	
							$savingdata = $model->savecertifcates($certficates);
							}
						}
					}
					$certficates = '';
			}
			
		//Completed
		
		$w9['masterid'] = $user->id ;
		$w9['industry_id'] = $industryid;
		$w9['created_date'] = date('m-d-Y');
		$model = $this->getModel('rfpcenter');
		
		if($w9standards == 'yes'){
				$w9 = $w9 ;
		}
		else{
				$db=&JFactory::getDBO();	
				if($w9['industry_id'] == 'all'){
				$query_d = "Delete FROM `#__cam_master_w9_standards` WHERE masterid =".$user->id." ";
				}
				else{
				$query_d = "Delete FROM `#__cam_master_w9_standards` WHERE masterid =".$user->id." and industry_id=".$w9['industry_id']." ";
				}
				$db->setQuery($query_d);
				$db->Query();
			}
		if($w9standards == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$w9['industry_id'] = $industryList[$in]->value ;
						$check = $model->getcheckw9industryinc($w9['industry_id']);		
							if($check) { 
								$w9['id'] = $check ;
								$savingdata = $model->savew9insurance($w9);
							}
							else{
							
								$savingdata = $model->savew9insurance($w9);
							}
							$check = '';
							$w9['id'] = '';
						}
			}
			else{
				$check = $model->getcheckw9industryinc($w9['industry_id']);		
				
					if($check) { 
						$w9['id'] = $check ;
						$savingdata = $model->savew9insurance($w9);
					}
					else{
						$savingdata = $model->savew9insurance($w9);
					}
					
			}
		}
		
		$gen['masterid'] = $user->id ;
		$gen['industry_id'] = $industryid;
		$gen['occur'] = JRequest::getVar('occur','');
		
		$gen['each_occurrence'] = JRequest::getVar('each_occurrence','');
		$gen['each_occurrence']	= str_replace(",","",$gen['each_occurrence']);
		$gen['damage_retend'] = JRequest::getVar('damage_retend','');
		$gen['damage_retend']	= str_replace(",","",$gen['damage_retend']);
		$gen['med_expenses'] = JRequest::getVar('med_expenses','');
		$gen['med_expenses']	= str_replace(",","",$gen['med_expenses']);
		$gen['personal_inj'] = JRequest::getVar('personal_inj','');
		$gen['personal_inj']	= str_replace(",","",$gen['personal_inj']);
		$gen['general_aggr'] = JRequest::getVar('general_aggr','');
		$gen['general_aggr']	= str_replace(",","",$gen['general_aggr']);
		$gen['applies_to'] = JRequest::getVar('applies_to','');
		$gen['products_aggr'] = JRequest::getVar('products_aggr','');
		$gen['products_aggr']	= str_replace(",","",$gen['products_aggr']);
		
		
		$gen['waiver_sub'] = JRequest::getVar('waiver_sub','');
		$gen['primary_noncontr'] = JRequest::getVar('primary_noncontr','');
		$gen['additional_insured'] = JRequest::getVar('additional_insured','');
		$gen['cert_holder_gli'] = JRequest::getVar('cert_holder_gli','');
		if($gen['cert_holder_gli'] == 'yes'){
		$gen['cert_holder'] = JRequest::getVar('cert_holder_gli','');
		}
		else{
		$gen['cert_holder'] = '';
		}
		
		$gen['created_date'] = date('m-d-Y');
		
		//To insert the data 
		$model = $this->getModel('rfpcenter');
			if($generalliability == 'yes'){
				$gen = $gen ;
			}
			else{
				$db=&JFactory::getDBO();	
				if($gen['industry_id'] == 'all'){
				$query_d = "Delete FROM `#__cam_master_generalinsurance_standards`  WHERE masterid =".$user->id." ";
				}
				else{
				$query_d = "Delete FROM `#__cam_master_generalinsurance_standards`  WHERE masterid =".$user->id." and industry_id=".$gen['industry_id']." ";
				}
				$db->setQuery($query_d);
				$db->Query();
			}
		
		if($generalliability == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$gen['industry_id'] = $industryList[$in]->value ;
						$check = $model->getcheckindustryinc($gen['industry_id']);		
							if($check) { 
								$gen['id'] = $check ;
								$savingdata = $model->saveinsurance($gen);
							}
							else{
							
								$savingdata = $model->saveinsurance($gen);
							}
							$check = '';
							$gen['id'] = '';
						}
			}
			else{
				$check = $model->getcheckindustryinc($gen['industry_id']);		
				
					if($check) { 
						$gen['id'] = $check ;
						$savingdata = $model->saveinsurance($gen);
					}
					else{
						$savingdata = $model->saveinsurance($gen);
					}
					
			}
		}
		//To insert the auto data
		$auto['masterid'] = $user->id ;
		$auto['industryid'] = $industryid;
		
		$auto['applies_to_any'] = JRequest::getVar('applies_to_any','');
		$auto['applies_to_owned'] = JRequest::getVar('applies_to_owned','');
		$auto['applies_to_nonowned'] = JRequest::getVar('applies_to_nonowned','');
		$auto['applies_to_hired'] = JRequest::getVar('applies_to_hired','');
		$auto['applies_to_scheduled'] = JRequest::getVar('applies_to_scheduled','');
		
		$auto['combined_single'] = JRequest::getVar('combined_single','');
		$auto['combined_single']	= str_replace(",","",$auto['combined_single']);
		$auto['bodily_injusy_person'] = JRequest::getVar('bodily_injusy_person','');
		$auto['bodily_injusy_person']	= str_replace(",","",$auto['bodily_injusy_person']);
		$auto['bodily_injusy_accident'] = JRequest::getVar('bodily_injusy_accident','');
		$auto['bodily_injusy_accident']	= str_replace(",","",$auto['bodily_injusy_accident']);
		$auto['property_damage'] = JRequest::getVar('property_damage','');
		$auto['property_damage']	= str_replace(",","",$auto['property_damage']);
		
		$auto['waiver'] = JRequest::getVar('waiver','');
		$auto['primary'] = JRequest::getVar('primary','');
		$auto['additional_ins'] = JRequest::getVar('additional_ins','');
		$auto['cert_holder'] = JRequest::getVar('cert_holder','');
		$model = $this->getModel('rfpcenter');
			if($autoliability == 'yes'){
				$auto = $auto ;
			}
			else{
				$db=&JFactory::getDBO();
				if($auto['industryid'] == 'all'){	
				$query_d = "Delete FROM `#__cam_master_autoinsurance_standards`  WHERE masterid =".$user->id."  ";
				}
				else{
				$query_d = "Delete FROM `#__cam_master_autoinsurance_standards`  WHERE masterid =".$user->id." and industryid=".$auto['industryid']." ";
				}
				$db->setQuery($query_d);
				$db->Query();
			}
		
		if($autoliability == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$auto['industryid'] = $industryList[$in]->value ;
						$check_auto = $model->getcheckautoinc($auto['industryid']);		
							if($check_auto) { 
								$auto['id'] = $check_auto ;
								$savingdata = $model->saveautoinsurance($auto);
							}
							else{
								$savingdata = $model->saveautoinsurance($auto);
							}
							$check_auto = '';
							$auto['id'] = '';
						}
			}
			else{
				$check = $model->getcheckautoinc($auto['industryid']);		
				
					if($check) { 
						$auto['id'] = $check ;
						$savingdata = $model->saveautoinsurance($auto);
					}
					else{
						$savingdata = $model->saveautoinsurance($auto);
					}
					
			}
		}	
		//Completed
		
		//To insert the workers data
		$work['masterid'] = $user->id ;
		$work['industryid'] = $industryid;
		$work['workers_not'] = JRequest::getVar('workers_not','');
		$work['each_accident'] = JRequest::getVar('each_accident','');
		$work['each_accident']	= str_replace(",","",$work['each_accident']);
		$work['disease_policy'] = JRequest::getVar('disease_policy','');
		$work['disease_policy']	= str_replace(",","",$work['disease_policy']);
		$work['disease_eachemp'] = JRequest::getVar('disease_eachemp','');
		$work['disease_eachemp']	= str_replace(",","",$work['disease_eachemp']);
		
		$work['property_damage'] = JRequest::getVar('property_damage','');
		$work['waiver_work'] = JRequest::getVar('waiver_work','');
		$work['certholder_work'] = JRequest::getVar('certholder_work','');
		$work['workers_accepted'] = JRequest::getVar('workers_accepted','');
		$model = $this->getModel('rfpcenter');
			if($workersliability == 'yes'){
				$work = $work ;
			}
			else{
				$db=&JFactory::getDBO();
				if($work['industryid'] == 'all'){	
				$query_d = "Delete FROM `#__cam_master_workers_standards`  WHERE masterid =".$user->id." ";
				}
				else{
				$query_d = "Delete FROM `#__cam_master_workers_standards`  WHERE masterid =".$user->id." and industryid=".$work['industryid']." ";
				}
				$db->setQuery($query_d);
				$db->Query();
			}
		
		if($workersliability == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$work['industryid'] = $industryList[$in]->value ;
						$check_work = $model->getcheckworkinc($work['industryid']);		
							if($check_work) { 
								$work['id'] = $check_work ;
								$savingdata = $model->saveworkinsurance($work);
							}
							else{
								$savingdata = $model->saveworkinsurance($work);
							}
							$check_work = '';
							$work['id'] = '';
						}
			}
			else{
				$check = $model->getcheckworkinc($work['industryid']);		
					if($check) { 
						$work['id'] = $check ;
						$savingdata = $model->saveworkinsurance($work);
					}
					else{
						$savingdata = $model->saveworkinsurance($work);
					}
					
			}
		}	
		//Completed
		
		//To insert the umbrella data
		$umb['masterid'] = $user->id ;
		$umb['industryid'] = $industryid;
		$umb['each_occur'] = JRequest::getVar('each_occur','');
		$umb['each_occur']	= str_replace(",","",$umb['each_occur']);
		$umb['aggregate'] = JRequest::getVar('aggregate','');
		$umb['aggregate']	= str_replace(",","",$umb['aggregate']);
		$umb['certholder_umbrella'] = JRequest::getVar('certholder_umbrella','');
		$model = $this->getModel('rfpcenter');
			if($umbrellaliability == 'yes'){
				$umb = $umb ;
			}
			else{
				$db=&JFactory::getDBO();	
				if($umb['industryid'] == 'all'){	
				$query_d = "Delete FROM `#__cam_master_umbrellainsurance_standards`  WHERE masterid =".$user->id." ";
				}
				else{
				$query_d = "Delete FROM `#__cam_master_umbrellainsurance_standards`  WHERE masterid =".$user->id." and industryid=".$umb['industryid']." ";
				}
				$db->setQuery($query_d);
				$db->Query();
			}
		
		if($umbrellaliability == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$umb['industryid'] = $industryList[$in]->value ;
						$check_umb = $model->getcheckumbinc($umb['industryid']);		
							if($check_umb) { 
								$umb['id'] = $check_umb ;
								$savingdata = $model->saveumbinsurance($umb);
							}
							else{
								$savingdata = $model->saveumbinsurance($umb);
							}
							$check_umb = '';
							$umb['id'] = '';
						}
			}
			else{
				$check = $model->getcheckumbinc($umb['industryid']);		
					if($check) { 
						$umb['id'] = $check ;
						$savingdata = $model->saveumbinsurance($umb);
					}
					else{
						$savingdata = $model->saveumbinsurance($umb);
					}
					
			}
		}	
		//Completed
		
		//To insert the LIC data
		$lic['masterid'] = $user->id ;
		$lic['industryid'] = $industryid;
		$lic['professional'] = JRequest::getVar('professional','');
		$lic['occupational'] = JRequest::getVar('occupational','');
		$model = $this->getModel('rfpcenter');
		if($licensingliability == 'yes'){
		$lic = $lic ;
		}
		else{
		$db=&JFactory::getDBO();	
		if($lic['industryid'] == 'all'){
		$query_d = "Delete FROM `#__cam_master_licinsurance_standards`  WHERE masterid =".$user->id."  ";
		}
		else{
		$query_d = "Delete FROM `#__cam_master_licinsurance_standards`  WHERE masterid =".$user->id." and industryid=".$lic['industryid']." ";
		}
		$db->setQuery($query_d);
		$db->Query();
		}
		if($licensingliability == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$lic['industryid'] = $industryList[$in]->value ;
						$check_lic = $model->getchecklicinc($lic['industryid']);		
							if($check_lic) { 
								$lic['id'] = $check_lic ;
								$savingdata = $model->savelicinsurance($lic);
							}
							else{
								$savingdata = $model->savelicinsurance($lic);
							}
							$check_lic = '';
							$lic['id'] = '';
						}
			}
			else{
				$check = $model->getchecklicinc($lic['industryid']);		
					if($check) { 
						$lic['id'] = $check ;
						$savingdata = $model->savelicinsurance($lic);
					}
					else{
						$savingdata = $model->savelicinsurance($lic);
					}
					
			}
		}	
		//Completed
		
		//To insert the LIC data
		$omi['masterid'] = $user->id ;
		$omi['industryid'] = $industryid;
		$omi['each_claim'] = JRequest::getVar('each_claim','');
		$omi['each_claim']	= str_replace(",","",$omi['each_claim']);
		$omi['aggregate_omi'] = JRequest::getVar('aggregate_omi','');
		$omi['aggregate_omi']	= str_replace(",","",$omi['aggregate_omi']);
		$omi['certholder_omi']	= JRequest::getVar('certholder_omi','');
		
		$model = $this->getModel('rfpcenter');
		if($errorsability == 'yes'){
			$omi = $omi ;
		}
		else{
			$db=&JFactory::getDBO();	
			if($omi['industryid'] == 'all'){
			$query_d = "Delete FROM `#__cam_master_errors_omissions`  WHERE masterid =".$user->id."  ";
			}
			else{
			$query_d = "Delete FROM `#__cam_master_errors_omissions`  WHERE masterid =".$user->id." and industryid=".$omi['industryid']." ";
			}
			$db->setQuery($query_d);
			$db->Query();
		}
		if($errorsability == 'yes'){
			if($industryid == 'all'){
					$industryList = $model->getallindustriesdef();	
					for( $in=0; $in<count($industryList); $in++ )
						{
						$omi['industryid'] = $industryList[$in]->value ;
						$check_omi = $model->getcheckomiinc($omi['industryid']);		
							if($check_omi) { 
								$omi['id'] = $check_omi ;
								$savingdata = $model->saveomiinsurance($omi);
							}
							else{
								$savingdata = $model->saveomiinsurance($omi);
							}
							$check_omi = '';
							$omi['id'] = '';
						}
			}
			else{
				$check = $model->getcheckomiinc($omi['industryid']);		
					if($check) { 
						$omi['id'] = $check ;
						$savingdata = $model->saveomiinsurance($omi);
					}
					else{
						$savingdata = $model->saveomiinsurance($omi);
					}
					
			}
		}	
		
		//if($savingdata){
		//$msg = "VENDOR INSURANCE STANDARDS saved successfully.";
		$newURL = 'index.php?option=com_camassistant&controller=rfpcenter&task=mastercompliance&Itemid=249';
		header('Location: '.$newURL);
		//}
		//echo "<pre>"; print_r($ins); exit;
		
		 }
	 //Completed
	 function vendorinsstand_calc()
	{
	   $fieldvalue= JRequest::getVar('fieldvalue','');
	   $fieldvalue = doubleval(str_replace(",","",$fieldvalue));
	   $fieldvalue = number_format($fieldvalue,2);
	   echo $fieldvalue;
	   exit;
	}
	
	function updatecompliance(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
		$weeks = JRequest::getVar('week','');
		$today = date('Y-m-d H:i:s');
			$query = "SELECT id FROM  #__cam_master_email_compliance_status WHERE masterid=".$user->id;
			$db->setQuery( $query );
			$cid = $db->loadResult();
				if($cid){
						$query = "UPDATE #__cam_master_email_compliance_status SET weeks=".$weeks." WHERE masterid=".$user->id;
						$db->setQuery( $query );
						$res=$db->query();
						echo "updatesuccess";
					}
				else{
					$sql = "insert into #__cam_master_email_compliance_status values ('','".$user->id."','".$weeks."','".$today."','')";
					$db->SetQuery($sql);
					$db->query();
					echo "success";
				}
			
			// Update permission level
			$query_c = "SELECT id FROM #__cam_master_compliancereport WHERE masterid=".$user->id." ";
			$db->setQuery($query_c);
			$mid = $db->loadResult();	
			if(!$mid) {
			$query5 = "INSERT INTO #__cam_master_compliancereport ( id , masterid , master, admin, dm, m, unverified, verified, nonc, compliant, report_switch, include_docs, how_docs, gli, api, wc, umb, omi, pln, oln, phone_number ) VALUES (  '' , '".$user->id."', '1', '1', '1', '1', '0', '0', '0', '0','0','0','','0','0','0','0','0','0','0','0' );";
			$db->setQuery( $query5 );
			$res5=$db->query();
			}		
			//Completed		
				
		exit;		
	}
	
	function updatepermission(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
		$today = date('Y-m-d H:i:s');
			
			$query = "SELECT id FROM  #__cam_master_email_compliance_status WHERE masterid=".$user->id;
			$db->setQuery( $query );
			$cid = $db->loadResult();
				if($cid){
						$query = "UPDATE #__cam_master_email_compliance_status SET permission='yes' WHERE masterid=".$user->id;
						$db->setQuery( $query );
						$res=$db->query();
						echo "updatesuccess";
					}
				else{
					$sql = "insert into #__cam_master_email_compliance_status values ('','".$user->id."','".$weeks."','".$today."','yes')";
					$db->SetQuery($sql);
					$db->query();
					echo "success";
				}	
		exit;		
	}
	
	function deletepermission(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
			$query = "UPDATE #__cam_master_email_compliance_status SET permission='' WHERE masterid=".$user->id;
			$db->setQuery( $query );
			$res=$db->query();
			echo "deletesuccess";
			exit;		
	}
	
	
	function deleteupdatecompliance(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
			$query = "Delete FROM `#__cam_master_email_compliance_status`  WHERE masterid in (".$user->id.")";
			$db->setQuery($query);
			$db->Query();
			
			$query = "Delete FROM `#__cam_master_compliancereport`  WHERE masterid in (".$user->id.")";
			$db->setQuery($query);
			$db->Query();
			
			echo "deletesuccess";
			exit;		
	}
	
	function saveaboutus(){ 
            $db=&JFactory::getDBO();
   $model = $this->getModel('rfpcenter');
   $user	= JFactory::getUser();
   $aboutus = JRequest::getVar('aboutus','');
   	 	 $aboutus = htmlentities($_REQUEST['aboutus'], ENT_QUOTES);
		 $aboutus = str_replace('\&quot','&quot',$aboutus);
		 $aboutus = str_replace('\\','',$aboutus);
		 
   $termsconditions = JRequest::getVar('termsconditions','');
   if($termsconditions) {
   $termsconditions = $termsconditions ;
   }
   else{
   $termsconditions = '';
   }
   $post['termsconditions'] = $termsconditions ;
   $post['aboutus'] = $aboutus ;
   $post['vendorid'] = $user->id ;
   $post['update']	= date('Y-m-d');
   $post['id'] = JRequest::getVar('id','');
   //Sending mail to vendors about terms and conditions
   $mailto_vendor = $model->sendmailtovendor();
   $query = "Delete FROM `#__cam_vendor_terms`  WHERE masterid=".$user->id;
   $db->setQuery($query);
   $db->Query();
   $save = $model->store_addabout($post);
	   if($save){
		$newURL = 'index.php?option=com_camassistant&controller=rfpcenter&task=mastercompliance&Itemid=249';
		header('Location: '.$newURL);
		
	   }
   }
   
    function save_uploadfile()
	{

		$files		= JRequest::getVar( 'uploadfile', '', 'files', 'array' );
		$post	= JRequest::get('post');
		$rebid	= JRequest::getVar('rebid','');
        $pid	= JRequest::getVar('pid','');
		$db = &JFactory::getDbo();
		$model = $this->getModel('rfpcenter');
		$masteruser = $model->getmasterfirmaccount();
		$master_data = "SELECT camfirm_license_no, comp_name FROM `jos_cam_customer_companyinfo` where cust_id=".$masteruser." ";
		$db->setQuery( $master_data );
		$pro_res = $db->loadObjectList();
		$pro_res[0]->comp_name = ereg_replace(" ", "_", $pro_res[0]->comp_name);
		$pro_res[0]->comp_name = str_replace(" ", "_", $pro_res[0]->comp_name);
		$pro_res[0]->comp_name = str_replace("&", "_", $pro_res[0]->comp_name);
		$pro_res[0]->comp_name = str_replace("#", "_", $pro_res[0]->comp_name);
		$pro_res[0]->comp_name = str_replace("%", "_", $pro_res[0]->comp_name);
		
        $p_path= $pro_res[0]->comp_name.'_'.$pro_res[0]->camfirm_license_no.'/';
        $base_Dir = JPATH_COMPONENT.DS.'doc'.DS;
		//$base_Dir = JPATH_COMPONENT.DS.'assets'.DS.'images'.DS.'rfp'.DS.'Tasks'.DS;
		$filename = $files['name'];
		$filename = preg_replace("/[&'`:;={}!@#$%^*(?)-+|]/"," ",$filename);	
		$filename = ereg_replace(" ", "_", $filename);
		$filename = str_replace(" ", "_", $filename);
		$filename = str_replace("&", "_", $filename);
		$filename = str_replace("#", "_", $filename);
		$filename = str_replace("%", "_", $filename);
		$filename = str_replace("'", "_", $filename);
		$filename = str_replace(",", "_", $filename);
		
                $dest=$base_Dir.$p_path;
                if(!is_dir($dest))
                mkdir($dest,0777);
		$filepath = $base_Dir.$p_path.$filename;
		move_uploaded_file($files['tmp_name'], $filepath);
		$user	= JFactory::getUser();
		$taskid = JRequest::getVar('task_id','');
        $user_id = JRequest::getVar('mid','');
		$filename = $filename;
	 	$task_id = $taskid;
		$user_id = $user_id;
		echo "<script language='javascript' type='text/javascript'>
		window.parent.document.getElementById( 'sbox-window' ).close();
		var taskid = '".$taskid."';
		var filename = '".$filename."';
		//alert(taskid);
		//alert(filename);
		window.parent.document.getElementById('lineuploads'+taskid).value ='shared-'+filename;
        window.parent.document.getElementById('delimg'+taskid).style.display ='';
        window.parent.document.getElementById('uploadfile'+taskid).innerHTML =filename;



		//window.parent.document.getElementById(taskid).innerHTML = path+del_path+old;
		 </script>";
		 exit;
		//parent::display();
	}
	
	function viewcertificatedoc(){
	
		$user	= JFactory::getUser();
		$db = JFactory::getDBO();
		$filename = JRequest::getVar('filename','');
		$propertyid = JRequest::getVar('propertyid','');
		$filepath = JRequest::getVar('filepath','');
		$type = JRequest::getVar('type','');
		$query = "SELECT property_name, tax_id FROM #__cam_property where id= ".$propertyid." ";
		$db->setQuery($query);
		$propert_data = $db->loadObject();
		$path = JURI::root().'components/com_camassistant/doc/'.str_replace(' ','_',$propert_data->property_name).'_'.$propert_data->tax_id;
		
		if($type == 'shared'){
			$model = $this->getModel('rfpcenter');
			$masteruser = $model->getmasterfirmaccount();
			$master_data = "SELECT camfirm_license_no, comp_name FROM `jos_cam_customer_companyinfo` where cust_id=".$masteruser." ";
			$db->setQuery( $master_data );
			$masterinfo = $db->loadObject();
			$path = JURI::root().'components/com_camassistant/doc/'.str_replace(' ','_',$masterinfo->comp_name).'_'.str_replace(' ','_',$masterinfo->camfirm_license_no);
		}
		
		$doc_name = $path.'/'.$filepath;
		header("content-type: application/octet-stream");
		header("Content-Disposition: attachment; filename=".$filename);
		readfile($doc_name);
		exit;	
	
	}
	
	function removecert(){
		$db = JFactory::getDBO();
		$certid = JRequest::getVar('certid','');
		$query = "Delete FROM `#__cam_master_certificates`  WHERE id = ".$certid."";
		$db->setQuery($query);
		if ($db->Query() ) 
		{
		$report = 'success';
		}
		else{
		$report = 'fail';
		}
		echo $report; exit;
	}
   
   	function getdraftproposals(){
	$rfpid = $_REQUEST['rfpid'];
	$Itemid = JRequest::getVar('Itemid','');
	?>
	<table width="100%" border="0" style="margin:0px 0px; border:1px solid #A3A3A3; background:#F7F7F7">
    <tbody>
    <tr>
    <td align="center">
    <ul class="addednumclosed" style="width:115px; float:none;">
	
	<li><a href="index.php?option=com_camassistant&controller=rfp&task=editrfp&var=draft&rfpid=<?php echo $rfpid; ?>&Itemid=88">EDIT&nbsp;</a></li>
	<li><a href='javascript:deletedraft("<?PHP echo $rfpid; ?>")'>DELETE</a></li>
    </ul>
    </td>
  </tr>
 <tr>
    <td>
    <table width="100%" cellspacing="0" cellpadding="0" border="0" style="padding:0px 0px; border:">
  <tbody> 
  	<tr><td><p style="padding-left:20px; padding-bottom:20px; text-align:center; padding-top:15px;">This Request has NOT been submitted. Please click EDIT to submit</p></td></tr>
  
</tbody></table>

    </td>
  </tr>
	<?php  exit;
	 }
	 
	 function checknewspecialrequirements_w9($vendorid,$rfpid){
	 	$db = & JFactory::getDBO();
		$w9_data ="SELECT * from #__cam_vendor_compliance_w9docs  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($w9_data);
		$vendor_w9_data = $db->loadObjectList();

		$rfp_w9_data ="SELECT * from #__cam_master_w9_standards_rfps  WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_w9_data);
		$rfp_w9_data = $db->loadObject();
		$occur_w9 = '';
		
		if($rfp_w9_data){
			if( !$vendor_w9_data[0]->w9_upld_cert || $vendor_w9_data[0]->w9_status == '-1') {
				$occur_w9[] = 'no' ;
			}
			else{
				$occur_w9[] = 'yes' ;
			}
		}
		
		if( in_array("no", $occur_w9) ){
			$cabins_w9[] = "no";
		}
			else{
			$cabins_w9[] = "yes";
		}
			$occur_w9 = '';
				
		if($cabins_w9){
			if( in_array("yes", $cabins_w9) ){
			$special_w9 = "success";
			}
			else{
			$special_w9 = "fail";
			}
		}
		else{
				if($rfp_w9_data)
				$special_w9 = "fail";
				else
				$special_w9 = "success";
		}
			
		$cabins_w9[] = '';
		return $special_w9 ;		
	 }
	 
	  function checknewspecialrequirements_gli($vendorid,$rfpid){
		$db = & JFactory::getDBO();
		//echo $vendorid;
		$gli_data ="SELECT * from #__cam_vendor_liability_insurence  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($gli_data);
		$vendor_gli_data = $db->loadObjectList();
		//Get RFP data
		$rfp_gli_data ="SELECT * from #__cam_master_generalinsurance_standards_rfps  WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_gli_data);
		$rfp_gli_data = $db->loadObject();
//		echo "<pre>"; print_r($rfp_gli_data);
		$occur = '';
		for( $gl=0; $gl<count($vendor_gli_data); $gl++ ){
			
			if($rfp_gli_data->occur ==  'yes'){
				if( $vendor_gli_data[$gl]->GLI_occur == 'occur' ){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			
			if($rfp_gli_data->each_occurrence >  '0'){
				if($rfp_gli_data->each_occurrence <= $vendor_gli_data[$gl]->GLI_policy_occurence){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->damage_retend > '0'){
				if($rfp_gli_data->damage_retend <= $vendor_gli_data[$gl]->GLI_damage){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->med_expenses > '0'){
				if($rfp_gli_data->med_expenses <= $vendor_gli_data[$gl]->GLI_med){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}	
			if($rfp_gli_data->personal_inj > '0'){
				if($rfp_gli_data->personal_inj <= $vendor_gli_data[$gl]->GLI_injury){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->general_aggr > '0'){	
				if($rfp_gli_data->general_aggr <= $vendor_gli_data[$gl]->GLI_policy_aggregate){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}

			if($rfp_gli_data->applies_to == 'pol'){
				if($vendor_gli_data[$gl]->GLI_applies == 'pol'){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->applies_to == 'proj'){
				if($vendor_gli_data[$gl]->GLI_applies == 'proj'){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->applies_to == 'loc'){
				if($vendor_gli_data[$gl]->GLI_applies == 'loc'){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			
			if($rfp_gli_data->products_aggr >  '0'){
				if($rfp_gli_data->products_aggr <= $vendor_gli_data[$gl]->GLI_products){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}	
			if($rfp_gli_data->waiver_sub == 'yes') {
				if($vendor_gli_data[$gl]->GLI_waiver == 'waiver'){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->primary_noncontr == 'yes') {
				if($vendor_gli_data[$gl]->GLI_primary == 'primary'){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->additional_insured == 'yes') {

				if($vendor_gli_data[$gl]->GLI_additional){

					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
			if($rfp_gli_data->cert_holder == 'yes') {
				if($vendor_gli_data[$gl]->GLI_certholder == 'yes'){
					$occur[] = 'yes' ;
				}
				else{
					$occur[] = 'no' ;
				}
			}
				if($rfp_gli_data){
					if($vendor_gli_data[$gl]->GLI_end_date < date('Y-m-d') || !$vendor_gli_data[$gl]->GLI_upld_cert || !$vendor_gli_data[$gl]->GLI_policy_occurence || !$vendor_gli_data[$gl]->GLI_policy_aggregate || $vendor_gli_data[$gl]->GLI_status == '-1') {
						$occur[] = 'no' ;
					}
					else{
						$occur[] = 'yes' ;
					}
				}
		
			//echo "<pre>"; print_r($occur); echo "</pre>"; 
			if( in_array("no", $occur) ){
			$cabins_gli[] = "no";
			}
			else{
			$cabins_gli[] = "yes";
			}
			$occur = '';
		}
		
		if($cabins_gli){
			if( in_array("yes", $cabins_gli) ){
			$special = "success";
			}
			else{
			$special = "fail";
			}
		}
		else{
				if($rfp_gli_data)
				$special = "fail";
				else
				$special = "success";
		}
			
		$cabins_gli[] = '';
		return $special ;
		
	}
//Completed
	function checknewspecialrequirements_aip($vendorid,$rfpid){
		$db = & JFactory::getDBO();
		$aip_data ="SELECT * from #__cam_vendor_auto_insurance  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($aip_data);
		$vendor_aip_data = $db->loadObjectList();
		//Get RFP data
		$rfp_aip_data ="SELECT * from #__cam_master_autoinsurance_standards_rfps  WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_aip_data);
		$rfp_aip_data = $db->loadObject();
		
			for( $ai=0; $ai<count($vendor_aip_data); $ai++ ){
				if($rfp_aip_data->applies_to_any == 'any'){
					if($rfp_aip_data->applies_to_any == $vendor_aip_data[$ai]->aip_applies_any){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}

				if($rfp_aip_data->applies_to_owned == 'owned'){
					if($rfp_aip_data->applies_to_owned == $vendor_aip_data[$ai]->aip_applies_owned){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}

				if($rfp_aip_data->applies_to_nonowned == 'nonowned'){
					if($rfp_aip_data->applies_to_nonowned == $vendor_aip_data[$ai]->aip_applies_nonowned){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}

				if($rfp_aip_data->applies_to_hired == 'hired'){
					if($rfp_aip_data->applies_to_hired == $vendor_aip_data[$ai]->aip_applies_hired){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}

				if($rfp_aip_data->applies_to_scheduled == 'scheduled'){
					if($vendor_aip_data[$ai]->aip_applies_scheduled == 'sch'){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->combined_single > '0'){	
					if($rfp_aip_data->combined_single <= $vendor_aip_data[$ai]->aip_combined){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->bodily_injusy_person > '0'){	
					if($rfp_aip_data->bodily_injusy_person <= $vendor_aip_data[$ai]->aip_bodily){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->bodily_injusy_accident > '0'){	
					if($rfp_aip_data->bodily_injusy_accident <= $vendor_aip_data[$ai]->aip_body_injury){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->property_damage > '0'){	
					if($rfp_aip_data->property_damage <= $vendor_aip_data[$ai]->aip_property){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->waiver == 'yes'){
					if($vendor_aip_data[$ai]->aip_waiver == 'waiver'){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->primary == 'yes'){
					if($vendor_aip_data[$ai]->aip_primary == 'primary'){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->additional_ins == 'yes'){
					if($vendor_aip_data[$ai]->aip_addition != ''){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data->cert_holder == 'yes'){
					if($vendor_aip_data[$ai]->aip_cert == 'yes'){
						$occur_aip[] = 'yes' ;
					}
					else{
						$occur_aip[] = 'no' ;
					}
				}
				
				if($rfp_aip_data){
					if($vendor_aip_data[$ai]->aip_end_date < date('Y-m-d') || $vendor_aip_data[$ai]->aip_upld_cert=='' || $vendor_aip_data[$ai]->aip_status == '-1' || !$vendor_aip_data[$ai]->aip_combined ) 		{
						$occur_aip[] = 'no' ;
						}
					else
						{
						$occur_aip[] = 'yes' ;
						}
				}
				
				if( in_array("no", $occur_aip) ){
					$cabins_aip[] = "no";
				}
				else{
					$cabins_aip[] = "yes";
				}
				$occur_aip = '';	
			}	
			if($cabins_aip){
				if( in_array("yes", $cabins_aip) ){
					$special_aip = "success";
				}
				else{
					$special_aip = "fail";
				}
			}
			else{
				if($rfp_aip_data)
				$special_aip = "fail";
				else
				$special_aip = "success";
			}
			
				$cabins_aip[] = '';
		
		return $special_aip ;
		
		
	}
	//Function to check WCI documents
	function checknewspecialrequirements_wci($vendorid,$rfpid){
		
		$db = & JFactory::getDBO();
		$wci_data ="SELECT * from #__cam_vendor_workers_companies_insurance  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($wci_data);
		$vendor_wci_data = $db->loadObjectList();
		//Get RFP data
		$rfp_wci_data ="SELECT * from #__cam_master_workers_standards_rfps WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_wci_data);
		$rfp_wci_data = $db->loadObject();

			for( $wci=0; $wci<count($vendor_wci_data); $wci++ ){
				
				if($rfp_wci_data->disease_policy > '0'){	
					if($rfp_wci_data->disease_policy <= $vendor_wci_data[$wci]->WCI_disease_policy){
						$occur_wci[] = 'yes' ;
					}
					else{
						$occur_wci[] = 'no' ;
					}
				}	
					
				if($rfp_wci_data->disease_eachemp > '0'){
					if($rfp_wci_data->disease_eachemp <= $vendor_wci_data[$wci]->WCI_disease){
						$occur_wci[] = 'yes' ;
					}
					else{
						$occur_wci[] = 'no' ;
					}
				}
				
				if($rfp_wci_data->waiver_work == 'yes'){
					if($vendor_wci_data[$wci]->WCI_waiver == 'waiver'){
						$occur_wci[] = 'yes' ;
					}
					else{
						$occur_wci[] = 'no' ;
					}
				}
				
				if($rfp_wci_data->each_accident > '0'){
					if($rfp_wci_data->each_accident <= $vendor_wci_data[$wci]->WCI_each_accident){
						$occur_wci[] = 'yes' ;
					}
					else{
						$occur_wci[] = 'no' ;
					}
				}
				
				if($rfp_wci_data->certholder_work == 'yes'){
					if($vendor_wci_data[$wci]->WCI_cert == 'yes'){
						$occur_wci[] = 'yes' ;
					}
					else{
						$occur_wci[] = 'no' ;
					}
				}
				if($rfp_wci_data){
					if($vendor_wci_data[$wci]->WCI_end_date < date('Y-m-d') || $vendor_wci_data[$wci]->WCI_upld_cert=='' || $vendor_wci_data[$wci]->WCI_status == '-1') {
							$occur_wci[] = 'no' ;
					}
					else{
							$occur_wci[] = 'yes' ;
					}
				}	
				if( in_array("no", $occur_wci) ){
					$cabins_wci[] = "no";
				}
				else{
					$cabins_wci[] = "yes";
				}
				$occur_wci = '';
			}
			
			if($cabins_wci){
				if( in_array("yes", $cabins_wci) ){
					$special_wci = "success";
				}
				else{
					$special_wci = "fail";
				}
			}
			else{
				if($rfp_wci_data)
				$special_wci = "fail";
				else
				$special_wci = "success";
			}
			
				$cabins_wci[] = '';
		
		return $special_wci ;
	}
	
	//COmpleted
	//function to check umbrella liability documents
	 function checknewspecialrequirements_umb($vendorid,$rfpid){
		$db = & JFactory::getDBO();
		//echo $vendorid.'<br />';
		$umb_data ="SELECT * from #__cam_vendor_umbrella_license  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($umb_data);
		$vendor_umb_data = $db->loadObjectList();
		//Get RFP data
		$rfp_umb_data ="SELECT * from #__cam_master_umbrellainsurance_standards_rfps WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_umb_data);
		$rfp_umb_data = $db->loadObject();
		
			for( $umb=0; $umb<count($vendor_umb_data); $umb++ ){
				
				if($rfp_umb_data->each_occur > '0'){	
					if($rfp_umb_data->each_occur <= $vendor_umb_data[$umb]->UMB_occur){
						$occur_umb[] = 'yes' ;
					}
					else{
						$occur_umb[] = 'no' ;
					}
				}	
				if($rfp_umb_data->aggregate > '0'){	
					if($rfp_umb_data->aggregate <= $vendor_umb_data[$umb]->UMB_aggregate){
						$occur_umb[] = 'yes' ;
					}
					else{
						$occur_umb[] = 'no' ;
					}
				}	
				if($rfp_umb_data->certholder_umbrella == 'yes'){
					if($vendor_umb_data[$umb]->UMB_certholder == 'yes'){
						$occur_umb[] = 'yes' ;
					}
					else{
						$occur_umb[] = 'no' ;
					}
				}
				if($rfp_umb_data){
				if($vendor_umb_data[$umb]->UMB_expdate < date('Y-m-d') || !$vendor_umb_data[$umb]->UMB_upld_cert || $vendor_umb_data[$umb]->UMB_status == '-1' || !$vendor_umb_data[$umb]->UMB_aggregate || !$vendor_umb_data[$umb]->UMB_occur) {
						$occur_umb[] = 'no' ;
				}
				else{
						$occur_umb[] = 'yes' ;
				}
				}
				//echo "<pre>"; print_r($occur_umb); echo "</pre>";
				if( in_array("no", $occur_umb) ){
					$cabins_umb[] = "no";
				}
				else{
					$cabins_umb[] = "yes";
				}
				$occur_umb = '';
			}	 
				
				if($cabins_umb){
					if( in_array("yes", $cabins_umb) ){
						$special_umb = "success";
					}
					else{
						$special_umb = "fail";
					}
				}
				else{
					if($rfp_umb_data)
					$special_umb = "fail";
					else
					$special_umb = "success";
				}
		
				$cabins_umb[] = '';
				return $special_umb ;
	 }
	//Completed
	//Funcion to check professional licensw
	function checknewspecialrequirements_pln($vendorid,$rfpid){

		$db = & JFactory::getDBO();
		$pln_data ="SELECT * from #__cam_vendor_professional_license  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($pln_data);
		$vendor_pln_data = $db->loadObjectList();
		//Get RFP data
		$rfp_pln_data ="SELECT * from #__cam_master_licinsurance_standards_rfps WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_pln_data);
		$rfp_pln_data = $db->loadObject();
		
			for( $pln=0; $pln<count($vendor_pln_data); $pln++ ){
			
				if($rfp_pln_data->professional == 'yes'){
					if($vendor_pln_data[$pln]->PLN_expdate < date('Y-m-d') || !$vendor_pln_data[$pln]->PLN_upld_cert || $vendor_pln_data[$pln]->PLN_status == '-1') {
						$occur_pln[] = 'no' ;
					}
					else{
						$occur_pln[] = 'yes' ;
					}
				}
				
				if( in_array("no", $occur_pln) ){
					$cabins_pln[] = "no";
				}
				else{
					$cabins_pln[] = "yes";
				}
				$occur_pln = '';
			}	
			
			if($cabins_pln){
				if( in_array("yes", $cabins_pln) ){
					$special_pln = "success";
				}
				else{
					$special_pln = "fail";
				}
			}
			else{
					if($rfp_pln_data->professional)
					$special_pln = "fail";
					else
					$special_pln = "success";
			}
			
				$cabins_pln[] = '';
				return $special_pln ;
	}
	//Completed
	function checknewspecialrequirements_occ($vendorid,$rfpid){

		$db = & JFactory::getDBO();
		$occ_data ="SELECT * from #__cam_vendor_occupational_license  WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($occ_data);
		$vendor_occ_data = $db->loadObjectList();
		//Get RFP data
		$rfp_occ_data ="SELECT * from #__cam_master_licinsurance_standards_rfps WHERE rfpid=".$rfpid; //validation to status of docs
		$db->Setquery($rfp_occ_data);
		$rfp_occ_data = $db->loadObject();
		
			for( $occ=0; $occ<count($vendor_occ_data); $occ++ ){
			
				if($rfp_occ_data->occupational == 'yes'){
					if($vendor_occ_data[$occ]->OLN_expdate < date('Y-m-d') || !$vendor_occ_data[$occ]->OLN_upld_cert || $vendor_occ_data[$pln]->OLN_status == '-1') {
						$occur_occ[] = 'no' ;
					}
					else{
						$occur_occ[] = 'yes' ;
					}
				}
				if( $occur_occ ){
					if( in_array("no", $occur_occ) ){
						$cabins_occ[] = "no";
					}
					else{
						$cabins_occ[] = "yes";
					}
				}	
			}	
			
			if($cabins_occ){
				if( in_array("yes", $cabins_occ) ){
					$special_occ = "success";
				}
				else{
					$special_occ = "fail";
				}
				$cabins_occ = '';
			}
			
			else{
					if($rfp_occ_data->occupational)
					$special_occ = "fail";
					else
					$special_occ = "success";
			}
			
				$cabins_occ = '';
				return $special_occ ;
	}
	//Completed
	
	function checknewspecialrequirements_omi($vendorid,$rfpid){
	
		$db = & JFactory::getDBO();
		$omi_data ="SELECT * from #__cam_vendor_errors_omissions_insurance WHERE vendor_id=".$vendorid; //validation to status of docs
		$db->Setquery($omi_data);
		$vendor_omi_data = $db->loadObjectList();
		//Get RFP data
		$rfp_omi_data ="SELECT * from #__cam_master_errors_omissions_rfps WHERE rfpid=".$rfpid." ";
		$db->Setquery($rfp_omi_data);
		$rfp_omi_data = $db->loadObject();
		
		
		
			for( $omi=0; $omi<count($vendor_omi_data); $omi++ ){
				
				if($rfp_omi_data->each_claim > '0'){	
					if($rfp_omi_data->each_claim <= $vendor_omi_data[$omi]->OMI_each_claim){
						$occur_omi[] = 'yes' ;
					}
					else{
						$occur_omi[] = 'no' ;
					}
				}	
				if($rfp_omi_data->aggregate_omi > '0'){	
					if($rfp_omi_data->aggregate_omi <= $vendor_omi_data[$omi]->OMI_aggregate){
						$occur_omi[] = 'yes' ;
					}
					else{
						$occur_omi[] = 'no' ;
					}
				}	
				if($rfp_omi_data->certholder_omi == 'yes'){
					if($vendor_omi_data[$omi]->OMI_cert == 'yes'){
						$occur_omi[] = 'yes' ;
					}
					else{
						$occur_omi[] = 'no' ;
					}
				}
				if($rfp_omi_data){
				if($vendor_omi_data[$omi]->OMI_end_date < date('Y-m-d') || !$vendor_omi_data[$omi]->OMI_upld_cert || $vendor_omi_data[$omi]->OMI_status == '-1' ) {
						$occur_omi[] = 'no' ;
				}
				else{
						$occur_omi[] = 'yes' ;
				}
				}
				
				/*if( $vendorid == '1767' ){
				echo "<pre>";	print_r($occur_omi); echo "</pre>";
				//echo "<pre>";	print_r($rfp_omi_data); echo "</pre>";
				}*/
		
				if($occur_omi){
					if( in_array("no", $occur_omi) ){
						$cabins_omi[] = "no";
					}
					else{
						$cabins_omi[] = "yes";
					}
				}
				$occur_omi = '';
			}	
			
				if($cabins_omi){
					if( in_array("yes", $cabins_omi) ){
						$special_omi = "success";
					}
					else{
						$special_omi = "fail";
					}
				}
				else{
					if($rfp_omi_data)
					$special_omi = "fail";
					else
					$special_omi = "success";
				}
		
				$cabins_omi = '';
				return $special_omi ;
	}
	
	function getmasterfirmaccount(){
	$user =& JFactory::getUser();
		$db=&JFactory::getDBO();
			if($user->user_type == '12'){
				$query_c = "SELECT comp_id FROM #__cam_customer_companyinfo WHERE cust_id=".$user->id." ";
				$db->setQuery($query_c);
				$cid = $db->loadResult();	
				$camfirmid = "SELECT cust_id FROM #__cam_camfirminfo WHERE id=".$cid." ";
				$db->setQuery($camfirmid);
				$camfirm = $db->loadResult();
				$masterid = "SELECT masterid FROM #__cam_masteraccounts WHERE firmid=".$camfirm." ";
				$db->setQuery($masterid);
				$master = $db->loadResult();
				}
			elseif($user->user_type == '13' && $user->accounttype!='master'){
				$masterid = "SELECT masterid FROM #__cam_masteraccounts WHERE firmid=".$user->id." "; 
				$db->setQuery($masterid);
				$master = $db->loadResult();
			}
			else{
			$master = $user->id;
			}	
			return $master ;
	}
	
	function updatemanager(){
		$user =& JFactory::getUser();
		$db=&JFactory::getDBO();
		$manager = JRequest::getVar('manager','');	
		$permission = JRequest::getVar('permission','');	
			$query_c = "SELECT id FROM #__cam_master_compliancereport WHERE masterid=".$user->id." ";
			$db->setQuery($query_c);
			$mid = $db->loadResult();	
				if($mid){	
					$query = "UPDATE #__cam_master_compliancereport SET ".$manager." = ".$permission." WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
				}
				
			
		exit;
	
	}
	
	
	function getallstandardsrfp($rfp_id){
		$db = & JFactory::getDBO();
		$user =& JFactory::getUser();
		
		$rfp_w9_data ="SELECT * from #__cam_master_w9_standards_rfps  WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_w9_data);
		$rfp_w9_data = $db->loadObject();
		
		$rfp_gli_data ="SELECT * from #__cam_master_generalinsurance_standards_rfps  WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_gli_data);
		$rfp_gli_data = $db->loadObject();
		
		$rfp_aip_data ="SELECT * from #__cam_master_autoinsurance_standards_rfps  WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_aip_data);
		$rfp_aip_data = $db->loadObject();
		
		$rfp_wci_data ="SELECT * from #__cam_master_workers_standards_rfps WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_wci_data);
		$rfp_wci_data = $db->loadObject();
		
		$rfp_umb_data ="SELECT * from #__cam_master_umbrellainsurance_standards_rfps WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_umb_data);
		$rfp_umb_data = $db->loadObject();
		
		$rfp_pln_data ="SELECT * from #__cam_master_licinsurance_standards_rfps WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_pln_data);
		$rfp_pln_data = $db->loadObject();
		
		$rfp_omi_data ="SELECT * from #__cam_master_errors_omissions_rfps WHERE rfpid=".$rfp_id; //validation to status of docs
		$db->Setquery($rfp_omi_data);
		$rfp_omi_data = $db->loadObject();
		
		if(!$rfp_w9_data && !$rfp_gli_data && !$rfp_aip_data && !$rfp_wci_data && !$rfp_umb_data && !$rfp_pln_data  && !$rfp_omi_data ){
			$set = 'no';
		}
		else{
			$set = 'yes';
		}
		return $set ;	
	}
	//Completed
	
	function saveoutsidevendors(){
		
		$db = & JFactory::getDBO();
		$user =& JFactory::getUser();
		$model = $this->getModel('rfpcenter');
		$out['cust_id'] = $user->id; 
		// Remove comma, dots from amount
		$amount_new = JRequest::getVar('amount','');
		$amount_new = str_replace(',','',$amount_new);
		$explode_amt = explode('.',$amount_new);
		$lastamt = $explode_amt[0] ;
		$out['rfpid'] = JRequest::getVar('rfpid','');
		$out['companyname'] = JRequest::getVar('awardedvendor','');
		$out['contactname'] = JRequest::getVar('contactname','');
		$out['phonenumber'] = JRequest::getVar('phone1','').JRequest::getVar('phone2','').JRequest::getVar('phone3','');
		$out['emailid'] = JRequest::getVar('emailid','');
		$out['amount'] = $lastamt;
		$out['sumitdate'] = date("m-d-Y H:i:s");
		
		$save_out = $model->saveoutsidevendor($out);
		echo "<script language='javascript' type='text/javascript'>window.parent.document.getElementById( 'sbox-window' ).close();window.parent.location.reload();</script>";
		
		exit;
		 
	}
	
	function price_other()
	{

		$db =& JFactory::getDBO();
		$type=$_POST[queryString];
		$rfpid=$_REQUEST[rfpid];
	//	print_r($type); exit;
		if ( $type != "")
		{
		$query_email="SELECT amount FROM #__cam_external_vendors WHERE id='$type' and rfpid='".$rfpid."' ";
		$db->setQuery( $query_email );
		$data = $db->loadResult();
		}
		
	//	print_r($result_email);
		//if ( $result_email){ $data="invalid"; }}
		echo number_format($data,2);
		exit;
		return  $data;
   }
   function removeouters(){
   		$db =& JFactory::getDBO();
		$outerid = $_REQUEST[vendorid];
		$rfpid = $_REQUEST[rfp];
		$query_delete = "Delete FROM `#__cam_external_vendors`  WHERE id = ".$outerid." and rfpid= ".$rfpid." ";
		$db->setQuery($query_delete);
		if($db->Query()){
			echo "Yes";
		}
		else{
			echo "No";
		}
		exit;
		
   }
   
   function sendactivationrequest(){
   		$db =& JFactory::getDBO();
		$vendorid = JRequest::getVar("vendorid",'');
		$from = JRequest::getVar("from",'');
		$user =& JFactory::getUser();
		$managername = $user->name.'&nbsp;'.$user->lastname ;
		
		$model = $this->getModel('rfpcenter');
		$manager_company = $model->getmanagercompany();
		$vendor = $model->getvendorinformation($vendorid);
		$vendor_cname = $model->getvendorcname($vendorid);
		$mailcontent = $model->getmailcontent();

		$body = str_replace('(Vendor Company Name)',$vendor_cname,$mailcontent);
		$body = str_replace('[Manager Full Name]',$managername,$body);
		$body = str_replace('[Management Company Name]',$manager_company,$body);
		
		$ccmails = $vendor->ccemail ;
		$assignuseremail = $vendor->email ;
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$mailsubject = 'Please change your account to become VERIFIED';
		$res = JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
		$sateesh = 'rize.cama@gmail.com';
		JUtility::sendMail($mailfrom, $fromname, $sateesh, $mailsubject, $body, $mode = 1);
		$support = 'vendoremails@myvendorcenter.com';
		JUtility::sendMail($mailfrom, $fromname, $support, $mailsubject, $body, $mode = 1);
		
		$cclist_v = explode(';',$ccmails);
		for($c=0; $c<count($cclist_v); $c++){
			$listcc_v = $cclist_v[$c];
			if($listcc_v != ''){
				JUtility::sendMail($mailfrom, $fromname, $listcc_v, $mailsubject, $body, $mode = 1);
			}
		}
		if(!$from)
		{
		echo "<script language='javascript' type='text/javascript'>
		window.parent.document.getElementById( 'sbox-window' ).close();
		window.parent.location.reload();
		 </script>";
		 }
		 else if( $from == 'newsearch' ){
		 echo "<script language='javascript' type='text/javascript'>
		window.parent.document.getElementById( 'sbox-window' ).close();
		alert('Your request has been sent to this Vendor successfully');
		 </script>";
		 }
		else{
		header('Location: index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id='.$vendorid.' ');	
		}
		
   }
   
   //Function to get all invites
   function getinvites(){
		$rfpid = Jrequest::getVar('rfpid','');
		$ptype = Jrequest::getVar('ptype','');
		$db = JFactory::getDBO();
		if( $ptype == 'itb' ){
		$query_itbs = "SELECT u.company_name, u.user_id, v.id FROM #__cam_vendor_company as u, #__cam_vendor_proposals as v WHERE v.rfpno=".$rfpid." and v.proposedvendorid=u.user_id and ( v.proposaltype='ITB' or v.proposaltype='review' ) and v.bidfrom='admin' ";
		}
		else{
		$query_itbs = "SELECT u.company_name, u.user_id, v.id FROM #__cam_vendor_company as u, #__cam_vendor_proposals as v WHERE v.rfpno=".$rfpid." and v.proposedvendorid=u.user_id and ( v.proposaltype='ITB' or v.proposaltype='review' or v.proposaltype='Draft' ) and v.bidfrom='' group by u.user_id ";
		}
		$db->setQuery( $query_itbs );
		$data = $db->loadObjectList();
		
		foreach( $data as $obj )
		{
			$dec_users = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfpid." and user_id=".$obj->user_id." "; 
			$db->setQuery( $dec_users);
			$declinedrfp = $db->loadResult();
			if( $declinedrfp != 2 ){
			$user_proposa_id = $obj->user_id.'-'.$obj->id ;
			$list_vendors_pre[] = JHTML::_('select.option',  $user_proposa_id, $obj->company_name);
			}
		}
		
		
		$list_vendors[] = JHTML::_('select.option', '0', 'Select Vendor');
		if($list_vendors_pre){
		$list_vendors[] = JHTML::_('select.option', 'all', 'All Vendors on this list');
		}
		foreach( $data as $obj )
		{
			$dec_users = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfpid." and user_id=".$obj->user_id." "; 
			$db->setQuery( $dec_users);
			$declinedrfp = $db->loadResult();
			if( $declinedrfp != 2 ){
			$user_proposa_id = $obj->user_id.'-'.$obj->id ;
			$list_vendors[] = JHTML::_('select.option',  $user_proposa_id, $obj->company_name);
			}
		}
		$result = JHTML::_('select.genericlist',$list_vendors, 'vendorid', 'class="vendor_drop" size="1" ' . $javascript , 'value', 'text','', 'vendorid');
		echo $result; exit;
   }
   //Completed
   //Function to send the reminder
   function send_reminder(){
  
		$db = JFactory::getDBO();
		$user = JFactory::getUser();
		$rfp_id = JRequest::getVar('rfpid','');
		$vendorid_proposalid = JRequest::getVar('vendorid','');
		$proposal_type = JRequest::getVar('firstdd','');
		$model = $this->getModel('rfpcenter');
		if( $vendorid_proposalid == 'all' ){
			if($proposal_type == '2'){
			$vendor_total = $model->totaldraftvendors($rfp_id);
			$vendor_total_save = $model->totaldraftvendorswithalt($rfp_id);
			}
			else	{
			$vendor_total = $model->totalinvitevendors($rfp_id);
			$vendor_total_save = $model->totalinvitevendors($rfp_id);
			}
		}
		else{
			$vendorid_proposalid = JRequest::getVar('vendorid','');
			$expids = explode('-',$vendorid_proposalid);
			$vendor_total[0]->user_id = $expids[0];
			$vendor_total[0]->id = $expids[1];
			$vendor_total_save[0]->user_id = $expids[0];
			$vendor_total_save[0]->id = $expids[1];
		}
		
		for( $p=0; $p<count($vendor_total); $p++ ){
		$vendorid_proposalid = $vendor_total[$p]->user_id.'-'.$vendor_total[$p]->id;
		$expids = explode('-',$vendorid_proposalid);
		$vendorid = $expids[0];
		$proposalid = $expids[1];
		// To send the reminder to vendor
			$dec_users = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfp_id." and user_id=".$vendorid." "; 
			$db->setQuery( $dec_users);
			$declinedrfp = $db->loadResult();
			
				if( $declinedrfp != 2 ){
					$send_reminder = $model->sendmail_reminder($rfp_id, $vendorid, $proposal_type);
				}
		}
		
	for( $p=0; $p<count($vendor_total_save); $p++ ){	
		// To save the details
	$vendorid_proposalid = $vendor_total_save[$p]->user_id.'-'.$vendor_total_save[$p]->id;
	$expids = explode('-',$vendorid_proposalid);
	$vendorid = $expids[0];
	$proposalid = $expids[1];	
	$date_now = date("Y-m-d H:i");
	$datetime = explode(' ',$date_now) ;
	$strdate = strtotime($datetime[0]);
    $time_only = explode(':',$datetime[1]) ;
	$onlyhours = $time_only[0] * 3600; 
	$duetime = $strdate + $time_only[1] + $onlyhours; 
  	$sql_time = "SELECT u.timezone FROM #__cam_property as u, #__cam_rfpinfo as v WHERE v.id=".$rfp_id." and u.id=v.property_id "; 
	$db->setQuery($sql_time);
	$timezone = $db->loadResult();
	
			if( $timezone == '' || $timezone == 'est' ) 
			$duetime = $duetime ;
			else if( $timezone == 'cen' )
			$duetime = $duetime - 3600 ;
			else if( $timezone == 'mou' ) 
			$duetime = $duetime - 7200 ;
			else if( $timezone == 'pac' ) 
			$duetime = $duetime - 10800 ;
			else if( $timezone == 'ala' )  
			$duetime = $duetime - 14400 ;
			else if( $timezone == 'haw' ) 
			$duetime = $duetime - 18000 ;
			else if( $timezone == 'car' ) 
			$duetime = $duetime + 1800;
			else if( $timezone == 'atl' ) 
			$duetime = $duetime + 3600;
			else if( $timezone == 'bra' ) 
			$duetime = $duetime + 7200;
			else if( $timezone == 'new' ) 
			$duetime = $duetime + 5400;
			else if( $timezone == 'mid' ) 
			$duetime = $duetime + 10800;
			else if( $timezone == 'azo' ) 
			$duetime = $duetime + 14400;
		    else
			$duetime = $duetime ;
			$duetime = $duetime + $time_only[1];
			$date_year = date("m-d-Y H:i", $duetime);	
			$final_date = explode(' ',$date_year);
			$hours = explode(':',$final_date[1]);
			$finalyear = $final_date[0].' '.$hours[0].':'.$time_only[1];
			
		$remind['rfpid']= $rfp_id;
		$remind['vendorid']= $vendorid;
		$remind['proposalid']= $proposalid;
		$remind['managerid']= $user->id;
		$remind['send_reminder_date'] = $finalyear ;
		//echo $remind['send_reminder_date'].'<br>';
		//exit;
		$remind['reminder_type']= 'm';
		$remind['proposal_type']= $proposal_type;
			$dec_users = "SELECT not_interested from #__cam_vendor_availablejobs where rfp_id=".$rfp_id." and user_id=".$vendorid." "; 
			$db->setQuery( $dec_users);
			$declinedrfp = $db->loadResult();
				if( $declinedrfp != 2 ){		
					$model->store_reminder($remind) ;
				}
		}
		echo "<script language='javascript' type='text/javascript'>window.parent.document.getElementById( 'sbox-window' ).close();window.parent.location.reload();</script>";
   	}
	//Function to un-invite vendors
	function send_uninvite(){
		$vendors = JRequest::getVar('vendors','');
		$rfpid = JRequest::getVar('rfpid','');
		$vendor = implode(',',$vendors);
		$msg = '';
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=messagebox&vendors='.$vendor.'&rfpid='.$rfpid.'';
		$this->setRedirect($url,$msg);
	}
	
	//Function to send the message and update query
   function send_message(){
   		
		$vendors_c = JRequest::getVar('vendors','');
		$rfpid = JRequest::getVar('rfpid','');
		$reason = JRequest::getVar('reason','');
		$vendors = explode(',',$vendors_c);
		$model = $this->getModel('rfpcenter');
		if( $reason )
		$reason = $reason ;
		else
		$reason = 'Manager did not submit a reason.' ;
		$message = $model->sendmessage($vendors,$rfpid,$reason);
		echo "<script language='javascript' type='text/javascript'>window.parent.document.getElementById( 'sbox-window' ).close();window.parent.location.reload();</script>";
   }
   //Function to send the message to vendors to update compliance status
   
   function sendacompliancerequest(){
   		$db =& JFactory::getDBO();
		$vendorid = JRequest::getVar("vendorid",'');
		$fails = JRequest::getVar("fails",'');
		$from = JRequest::getVar("from",'');
		$user =& JFactory::getUser();
		$managername = $user->name.'&nbsp;'.$user->lastname ;
		
		$model = $this->getModel('rfpcenter');
		$manager_company = $model->getmanagercompany();
		$vendor = $model->getvendorinformation($vendorid);
		$vendor_cname = $model->getvendorcname($vendorid);
		$mailcontent = $model->getmailbody($fails);

		$body = str_replace('[Vendor Company Name]',$vendor_cname,$mailcontent);
		$body = str_replace('[Manager Full Name]',$managername,$body);
		$body = str_replace('[Manager Company Name]',$manager_company,$body);
		
		$ccmails = $vendor->ccemail ;
		$assignuseremail = $vendor->email ;
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		if( $fails == 'both' )
			$mailsubject = 'Request to become Compliant and Verified';
		else
			$mailsubject = 'Request to become Compliant';
			
		$res = JUtility::sendMail($mailfrom, $fromname, $assignuseremail, $mailsubject, $body, $mode = 1);
		$sateesh = 'rize.cama@gmail.com';
		JUtility::sendMail($mailfrom, $fromname, $sateesh, $mailsubject, $body, $mode = 1);
		$support = 'vendoremails@myvendorcenter.com';
		JUtility::sendMail($mailfrom, $fromname, $support, $mailsubject, $body, $mode = 1);
		
		$cclist_v = explode(';',$ccmails);
		for($c=0; $c<count($cclist_v); $c++){
			$listcc_v = $cclist_v[$c];
			if($listcc_v != ''){
				JUtility::sendMail($mailfrom, $fromname, $listcc_v, $mailsubject, $body, $mode = 1);
			}
		}
		if(!$from)
		{
		echo "<script language='javascript' type='text/javascript'>
		window.parent.document.getElementById( 'sbox-window' ).close();
		window.parent.location.reload();
		 </script>";
		 }
		 else if( $from == 'newsearch' ){
		 echo "<script language='javascript' type='text/javascript'>
		window.parent.document.getElementById( 'sbox-window' ).close();
		alert('Your request has been sent to this Vendor successfully');
		 </script>";
		 }
		else{
		header('Location: index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id='.$vendorid.' ');	
		}
		
   }
   //Function to update vendor type
   function updatevendortype(){
   		$db =& JFactory::getDBO();
		$user = JFactory::getUser();
		$vendortype = JRequest::getVar("v_type",'');
		$permission = JRequest::getVar('permission','');	
			$query_c = "SELECT id FROM #__cam_master_compliancereport WHERE masterid=".$user->id." ";
			$db->setQuery($query_c);
			$mid = $db->loadResult();	
				if($mid){	
					if( $vendortype == 'unverified' ) {
					$query = "UPDATE #__cam_master_compliancereport SET ".$vendortype." = ".$permission." WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					$query = "UPDATE #__cam_master_compliancereport SET verified = '0' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					}
					else if( $vendortype == 'verified' ){
					$query = "UPDATE #__cam_master_compliancereport SET ".$vendortype." = ".$permission." WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					$query = "UPDATE #__cam_master_compliancereport SET unverified = '0' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();	
					}
					else if( $vendortype == 'both_verified' ){
					$query = "UPDATE #__cam_master_compliancereport SET unverified = '1', verified = '1' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();	
					}
					
					else if( $vendortype == 'nonc' ) {
					$query = "UPDATE #__cam_master_compliancereport SET ".$vendortype." = ".$permission." WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					$query = "UPDATE #__cam_master_compliancereport SET compliant = '0' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					}
					else if( $vendortype == 'compliant' ){
					$query = "UPDATE #__cam_master_compliancereport SET ".$vendortype." = ".$permission." WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					$query = "UPDATE #__cam_master_compliancereport SET nonc = '0' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();	
					}
					else if( $vendortype == 'both_comp' ){
					$query = "UPDATE #__cam_master_compliancereport SET nonc = '1', compliant = '1' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();	
					}
					
					
				}
		echo $vendortype; exit;
   }
   //Completed


      function updatefiletype(){
   		$db =& JFactory::getDBO();
		$user = JFactory::getUser();
		$filetype = JRequest::getVar("v_type",'');
		$permission = JRequest::getVar('permission','');	
			$query_c = "SELECT id FROM #__cam_master_compliancereport WHERE masterid=".$user->id." ";
			$db->setQuery($query_c);
			$mid = $db->loadResult();	
				if($mid){	
					if( $filetype == 'csvval' ) {
					$query = "UPDATE #__cam_master_compliancereport SET documenttype = ".$permission." WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
					}
					else if( $filetype == 'pdfval' ){
					$query = "UPDATE #__cam_master_compliancereport SET documenttype = '0' WHERE masterid=".$user->id;
					$db->setQuery( $query );
					$res=$db->query();
						
					}
					
				}
		echo $filetype; exit;
   }

	function updateswitchon(){
		$db =& JFactory::getDBO();
		$user = JFactory::getUser();
		$swoff = JRequest::getVar("off",'');
			if( $swoff == 'on' )
				$switch = '1';
			else
				$switch = '0';	
		$query = "UPDATE #__cam_master_compliancereport SET report_switch = ".$switch." WHERE masterid=".$user->id;
		$db->setQuery( $query );
		$res=$db->query();	
		exit;
	}
	//Function to add vendor documents to the compliance report page
	function updatedocuments(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
		$permission_first = JRequest::getVar('documents','');
		if( $permission_first == '1' )
		$query = "UPDATE #__cam_master_compliancereport SET include_docs = ".$permission_first." WHERE masterid=".$user->id;
		else
		$query = "UPDATE #__cam_master_compliancereport SET include_docs = ".$permission_first.", how_docs='0', gli='0', api='0', wc='0', umb='0', omi='0', pln='0', oln='0' WHERE masterid=".$user->id;
		$db->setQuery( $query );
		$res=$db->query();
		exit;
	}
	function updatedocuments_second(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
		$permission_second = JRequest::getVar('documents_second','');
		$query = "UPDATE #__cam_master_compliancereport SET how_docs = '".$permission_second."', gli='0', api='0', wc='0', umb='0', omi='0', pln='0', oln='0'  WHERE masterid=".$user->id;
		$db->setQuery( $query );
		$res=$db->query();
		exit;
	}
	
	function updatedocuments_third(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
		$permit_third = JRequest::getVar('permit','');
		$document_type = JRequest::getVar('document_type','');
		$query = "UPDATE #__cam_master_compliancereport SET ".$document_type." = '".$permit_third."' WHERE masterid=".$user->id;
		$db->setQuery( $query );
		$res=$db->query();
		echo $query;
		exit;
	}
	
	function update_phone(){
		$db=&JFactory::getDBO();
		$user=JFactory::getUser();
		$phonenumber = JRequest::getVar('phonenumber','');
		$query = "UPDATE #__cam_master_compliancereport SET phone_number = '".$phonenumber."' WHERE masterid=".$user->id;
		$db->setQuery( $query );
		$res=$db->query();
		exit;
	}
	function awardjob_second(){
		$award_task = JRequest::getVar('awardedto','');
		$rfpno = JRequest::getVar('rfpno','');
		$shareinfo = JRequest::getVar('shareinfo','');
		$price1 = JRequest::getVar('v_price','');
		
		if( $award_task == 'outsidevendorsuccess' ) {
			$other_vendor = JRequest::getVar('other','');
			$radioid = $other_vendor[0] ;
			$awardedto = 'out';
		}
		else{
			$radioid = JRequest::getVar('radioid',array());
			$radioid = $radioid[0];
			$awardedto = 'in';
		}
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=awardmail&rfpno='.$rfpno.'&proposalid='.$radioid.'&shareinfo='.$shareinfo.'&awardedto='.$awardedto.'&Itemid=125';
		$this->setRedirect($url);
		//echo "<pre>"; print_r($_REQUEST); exit;
	}
	//Function to save the email text
	function save_awardedemail(){
		$db=&JFactory::getDBO();
		
		$mailtext['rfpid'] = JRequest::getVar('rfpno','');
		$proposalid = JRequest::getVar('proposalid','');
		$shareinfo = JRequest::getVar('shareinfo','');
		$awardedto = JRequest::getVar('awardedto','');
		$emailtest = JRequest::getVar('mailtext','');
		$nonedit = $_REQUEST['non_edit'];
		$nonedit = htmlentities($_REQUEST['non_edit'], ENT_QUOTES);
		$emailtest = htmlentities($_REQUEST['mailtext'], ENT_QUOTES);
		$emailtest = str_replace('\&quot','&quot',$emailtest);
		$emailtest = str_replace('\\','',$emailtest);
		
		$mailbody = $nonedit.'{devider}'.$emailtest;
		$mailtext['email_text'] = $mailbody;
		$model = $this->getModel('rfpcenter');
		$preid = $model->getexistingid($mailtext['rfpid']);
		if($preid->id)
		$mailtext['id'] = $preid->id;
		else
		$mailtext['id'] = '';
		$model->store_mailtext($mailtext);
		
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=awardmail&rfpno='.$mailtext['rfpid'].'&proposalid='.$proposalid.'&shareinfo='.$shareinfo.'&awardedto='.$awardedto.'&Itemid=125';
		$this->setRedirect($url);
		
		//echo "<pre>"; print_r($_REQUEST); exit;
	}
	
	function save_emailsubmit(){
		$db=&JFactory::getDBO();
		$rfpid = JRequest::getVar('rfpno','');
		$proposalid = JRequest::getVar('proposalid','');
		$shareinfo = JRequest::getVar('shareinfo','');
		$awardedto = JRequest::getVar('awardedto','');
		
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=awardmail_submit&rfpno='.$rfpid.'&proposalid='.$proposalid.'&shareinfo='.$shareinfo.'&awardedto='.$awardedto.'&Itemid=125';
		$this->setRedirect($url);
		
		//echo "<pre>"; print_r($_REQUEST); exit;
	}
	//Function to deleetd edited text
	function deleteeditmailtext(){
		$db=&JFactory::getDBO();
		$rfpid = JRequest::getVar('rfpno','');
		$query_del = "Delete FROM #__cam_awarded_emailtext  WHERE rfpid = ".$rfpid." ";
		$db->setQuery($query_del);
		$db->Query();
		exit;
	}
	function acceptinvitation()
	{
        $db=&JFactory::getDBO();
		$user=&JFactory::getUser();
	    $proid = JRequest::getVar('property_id','');
		$manager_id = JRequest::getVar('manager_id','');
		$invitationid = JRequest::getVar('invitationid','');
		$boardmem_id = JRequest::getVar('boardmem_id','');
		$linkproperty = "Update #__cam_propertyowner_link SET link_value = '1' WHERE id = '".$invitationid."'";
		$db->setQuery($linkproperty);
		$db->Query();
		$updateinfo = "Update #__cam_board_mem SET link_invite ='' WHERE id = '".$boardmem_id."'";
		$db->setQuery($updateinfo);
		$db->Query();
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
		$this->setRedirect($url);
	
	}
	function declineinvitation()
	{
	    $db=&JFactory::getDBO();
		$user=&JFactory::getUser();
	    $proid = JRequest::getVar('property_id','');
		$manager_id = JRequest::getVar('manager_id','');
		$invitationid = JRequest::getVar('invitationid','');
	    $decline_pro = "UPDATE #__cam_propertyowner_link SET propertydecline='1' where id='".$invitationid."'";
		$db->setQuery($decline_pro);
		$db->Query();
	    $url ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
		$this->setRedirect($url);
	}
	
	
	function declinerfpaproval()
	{
	    $db=&JFactory::getDBO();
		$rfpid = JRequest::getVar('rid','');
		$query = "UPDATE #__cam_rfpinfo SET rfpapproval_decline='2' WHERE id='".$rfpid."'";
	    $db->setQuery( $query );
	    $db->query();
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
		$this->setRedirect($url);
	
	}
	
	function declineawardedvendors()
	{
	    $db=&JFactory::getDBO();
		$user=&JFactory::getUser();
		$model = $this->getModel('rfpcenter');
	    $rfpid = JRequest::getVar('rid','');
		$query = "UPDATE #__cam_rfpinfo SET awardjobdecline='2' WHERE id='".$rfpid."'";
	    $db->setQuery( $query );
	    $res=$db->query();
		$url ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
		$this->setRedirect($url);
		
	}
	
	function invitationcookieset()
	{
  	setcookie("invitation_cookie", "invitations");
	$url ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
	$this->setRedirect($url);	
	}
	
	function sendmailtoawardedvendors()
	{	
		$db =& JFactory::getDBO();
		$rfpno = JRequest::getVar('rid','');
		$model = $this->getModel('rfpcenter');
		$proposals = $model->getaltproposalsids();
	   for($i=0; $i<count($proposals);$i++)
	   {
	 $award = "SELECT U.id,U.email,U.ccemail,U.name,U.lastname,C.rfpno FROM  #__cam_vendor_proposals as C LEFT JOIN #__users as U ON U.id=C.proposedvendorid WHERE C.id=".$proposals[$i]->id." and C.rfpno=".$rfpno;
		$db->setQuery( $award );
		$award_data = $db->loadObjectlist();
		$lname = $award_data[0]->lastname;
		$username = $award_data[0]->name;
        $fullname= $username.' '.$lname;
		$email1=$award_data[0]->email;
		$award_ccemails=$award_data[0]->ccemail;
	    $win_amt = "SELECT proposal_total_price FROM  #__cam_vendor_proposals  WHERE id=".$proposals[$i]->id." and rfpno=".$rfpno;
		$db->setQuery( $win_amt );
		$winningamt = $db->loadResult();
		$price2 = doubleval(str_replace(",","",$winningamt));
	 	$price = number_format($price2,2,'.','');
		$winamts = "$".number_format($price,2);
		
      }
	
		$query = "UPDATE #__cam_rfpinfo SET awardjobaproval='2' WHERE id='".$rfpno."'";
		$db->setQuery( $query );
		$res=$db->query();
        $query4 ="SELECT proposedvendorid FROM #__cam_vendor_proposals WHERE rfpno=".$rfpno." and proposaltype='Awarded'";
		$db->setQuery( $query4 );
		$data4 = $db->loadResult();
		$property_id = "SELECT P.id FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_id );
		$property_id = $db->loadResult();
		$mailfrom = 'support@myvendorcenter.com';
		$fromname = 'MyVendorCenter.com';
		$assignuseremail = $email1;
		
		// To get the vendor company
		$v_c_name = "SELECT company_name FROM  #__cam_vendor_company where user_id=".$data4;
		$db->setQuery( $v_c_name );
		$v_cname = $db->loadResult();
		$model = $this->getModel('rfpcenter');
		$revised_mail_ps = $model->getrevisedmessage($rfpno);
		$revised_mail = html_entity_decode($revised_mail_ps);
		$revised_mail = str_replace('{devider}','',$revised_mail);
		if( !$revised_mail ) {
		$query_acceceptemail ="SELECT introtext  FROM #__content where id='156' ";
		$db->setQuery( $query_acceceptemail );
		$body = $db->loadResult();
		$body = str_replace('{devider}','',$body);
		}
		else{
		$body = $revised_mail;
		}
		
		$property_name = "SELECT P.property_name,C.cust_id FROM #__cam_rfpinfo as C LEFT JOIN #__cam_property as P ON P.id=C.property_id WHERE C.id=".$rfpno;
		$db->setQuery( $property_name );
		$propertyname1 = $db->loadObject();
		$propertyname = str_replace('_',' ',$propertyname1->property_name);
		$cust_info = "SELECT name,lastname,user_type FROM #__users  WHERE id=".$propertyname1->cust_id;
		$db->setQuery( $cust_info );
		$cust_info = $db->loadObject();
		$customer_name = $cust_info->name.' '.$cust_info->lastname;
		
	  $camfirm_id = "SELECT P.cust_id FROM #__cam_customer_companyinfo as C LEFT JOIN #__cam_camfirminfo as P ON P.id=C.comp_id WHERE C.cust_id=".$propertyname1->cust_id;
		$db->setQuery( $camfirm_id );
		$camfirmid = $db->loadResult();
		
		$camfirm_name = "SELECT name,lastname FROM #__users WHERE id=".$camfirmid;
		$db->setQuery( $camfirm_name );
		$camfirmname = $db->loadObjectlist();
		$camfirm_admin= $camfirmname[0]->name.'&nbsp;'.$camfirmname[0]->lastname;
		//print_r($camfirm_admin);
		$company_name = "SELECT comp_name FROM #__cam_customer_companyinfo  WHERE cust_id=".$propertyname1->cust_id;
		$db->setQuery( $company_name );
		$cname = $db->loadResult();

		if($cust_info->user_type=='13'){
		$camadmin = $customer_name;
		} else {
		$camadmin = $camfirm_admin;
		}
		
		//echo "accept"; print_r($assignuseremail);
		
		$body = str_replace('{Vendor Name}',$v_cname,$body) ;
		$body = str_replace('{RFP NUMBER}',$rfpno,$body);
		$body = str_replace('{Property Name}',$propertyname,$body);
		
		//$body = str_replace('{Customer}',$customer_name,$body);
		if($user->user_type=='13'){
		$body = str_replace('{Customer}',$customer_name,$body);
		$body = str_replace('{CAM Firm}',$cname,$body);
		} else {
		$body = str_replace('{Customer}',$customer_name,$body);
		$body = str_replace('{CAM Firm}',$cname,$body);
		}
		$body = str_replace('{winning Bid}',$winamts,$body);
		$mailsubject = 'Project awarded to you through MyVendorCenter';
		//$bcc='awardedjob@myvendorcenter.com';
		$assignuseremail_vsupport = 'vendoremails@myvendorcenter.com';
		$rize_email = 'rize.cama@gmail.com';
		
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail,$mailsubject, $body, $mode = 1);
		JUtility::sendMail($mailfrom, $fromname, $rize_email,$mailsubject, $body, $mode = 1);
		JUtility::sendMail($mailfrom, $fromname, $assignuseremail_vsupport,$mailsubject, $body, $mode = 1);
		//Mail to the awarded vendor cc emails
		$cclist_v = explode(';',$award_ccemails);
		for($c=0; $c<count($cclist_v); $c++){
		$listcc_v = $cclist_v[$c];
		if($listcc_v != ''){
		$res = JUtility::sendMail($mailfrom, $fromname, $listcc_v, $mailsubject, $body, $mode=1);
		}
		}
		

		// Sending mails to outside vendors
		$other_vendors ="SELECT companyname, emailid, id FROM #__cam_external_vendors where rfpid='".$rfpno."' ";
		$db->setQuery( $other_vendors );
		$outsides = $db->loadObjectList();
		if($outsides){
			for($o=0; $o<count($outsides); $o++) {
					if($outsides[$o]->emailid) {
						$mailfrom = $user->email;
						$fromname = 'MyVendorCenter.com';
						$outervendor = $outsides[$o]->emailid ;
						$reject_outer ="SELECT introtext  FROM #__content where id='282' ";
						$db->setQuery( $reject_outer );
						$rejectouter1 = $db->loadResult();
						$managerfullname = $user->name.'&nbsp;'.$user->lastname ;
						$aetmanbodya = str_replace('[Vendor Company Name]',$outsides[$o]->companyname,$rejectouter1) ;
						$aetmanbodya = str_replace('[Project Name]',$projectName,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager Full Name]',$customer_name,$aetmanbodya) ;
						$aetmanbodya = str_replace('[Manager Company Name]',$cname,$aetmanbodya) ;
						$aetmanbodya = str_replace('[manager email]',$user->email,$aetmanbodya) ;
						
						$mailsubject = "You're proposal has been rejected through MyVendorCenter";
					
						JUtility::sendMail($mailfrom, $fromname, $outervendor,$mailsubject, $aetmanbodya, $mode = 1);
						$outervendor_support = 'vendoremails@myvendorcenter.com';
						JUtility::sendMail($mailfrom, $fromname, $outervendor_support,$mailsubject, $aetmanbodya, $mode = 1);
				}
			}	
		}
	
		//Completed
		
		$link = 'index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
	
		$msg="";
		$this->setRedirect( $link,$msg );
		//modifying end by anand kumar on 21-7-11
	
	
	
	
	
	}
	
	function sendmailtoapprovalvendors()
	{
	
	    $db=&JFactory::getDBO();
		$user=&JFactory::getUser();
		$model = $this->getModel('rfpcenter');
	    $rfpid = JRequest::getVar('rid','');
		
		$vendors = "select DISTINCT(proposedvendorid) from #__cam_vendor_proposals  WHERE rfpno = '".$rfpid ."'";
		$db->setQuery($vendors);
	    $vendorids = $db->loadobjectList();
		
		if($vendorids)
		{
		for($i = 0 ; $i<count($vendorids); $i++ )
		{
		$vendorid = $vendorids[$i]->proposedvendorid;
		$v_company = "SELECT u.company_name, v.email, v.ccemail, v.subscribe, u.faxid, u.fax_acc  FROM #__cam_vendor_company as u, #__users as v where u.user_id=".        $vendorid." and u.user_id=v.id ";
	    $db->Setquery($v_company);
	    $vendor_companyname = $db->loadObject();
		$v_companyname = $vendor_companyname->company_name ;
        $vemail = $vendor_companyname->email ;
	    $ccemail = $vendor_companyname->ccemail ;
        $subscribe = $vendor_companyname->subscribe;
		$pdata = "SELECT u.property_name,  v.projectName, v.proposalDueDate, v.proposalDueTime, v.cust_id, v.jobtype, v.property_id FROM #__cam_property as u, #__cam_rfpinfo as v where u.id=v.property_id and v.id=".$rfpid." ";
	$db->Setquery($pdata);
	$rfpdetails = $db->loadObject();
	
	$query = "UPDATE #__cam_rfpinfo SET rfpapproval='2' WHERE id='".$rfpid."'";
	$db->setQuery( $query );
	$res=$db->query();
	
	$updateinv = "UPDATE #__rfp_invitations SET approval_request = 2 where rfpid = ".$rfpid."";
	$db->setQuery($updateinv);
	$db->query();
		
	$namemanager = "SELECT comp_name FROM #__cam_customer_companyinfo  where cust_id=".$rfpdetails->cust_id." ";
	$db->Setquery($namemanager);
	$managaercname = $db->loadResult();
    $rfptime = $rfpdetails->proposalDueDate.' '.$rfpdetails->proposalDueTime ;
        
    $customerdata = "SELECT u.comp_name FROM #__cam_customer_companyinfo as u, #__cam_rfpinfo as v where v.cust_id=u.cust_id and v.id=".$rfpid." ";
	$db->Setquery($customerdata);
	$cust_coname = $db->loadResult();
	
	// To get the manager name
	$manager_name = "SELECT name, lastname, email FROM #__users where id=".$rfpdetails->cust_id." ";
	$db->Setquery($manager_name);
	$manager_details = $db->loadObject();
	$man_fullname = $manager_details->name.' '. $manager_details->lastname ;
	
	//Completed
	$rfp_new = $this->getrfpinfo_new($rfpid);
	if($subscribe == 'yes'){
		if( $rfp_new->create_rfptype == 'open' || $rfp_new->create_rfptype == 'both' )
    	$email_data = "SELECT introtext  FROM #__content where id='310' ";
		else
		$email_data = "SELECT introtext  FROM #__content where id='248' ";
	}
	else{
		if( $rfp_new->create_rfptype == 'open' || $rfp_new->create_rfptype == 'both' )
		$email_data = "SELECT introtext  FROM #__content where id='311' ";
		else
		$email_data = "SELECT introtext  FROM #__content where id='258' ";
	}
	$db->Setquery($email_data);
	$data = $db->loadResult();
	$proposalid = $this->getproposal($rfpid,$vendorid);       
    $body = str_replace('{VENDOR}',$v_companyname,$data);
	$body = str_replace('[RFP #]',$rfpid,$body);
	$body = str_replace('{PNAME}',str_replace('_',' ',$rfpdetails->property_name),$body);
	$body = str_replace('[communityname]',str_replace('_',' ',$rfpdetails->property_name),$body);
	$body = str_replace('[managername]',$managaercname,$body);
	$body = str_replace('[Reference Name]',$rfpdetails->projectName,$body);
	$body = str_replace('{PROJECTNAME}',$rfptime,$body);
	$body = str_replace('{CAMFIRM}',$cust_coname,$body);
	$body = str_replace('{managerfullname}',$man_fullname,$body);
	$site_url = JURI::root() ;
	$link = $site_url."index.php?option=com_camassistant&controller=proposals&task=vendor_proposal_form&view=proposals&Prp_id=".$rfpdetails->property_id."&rfp_id=".$post['rfpid']."&mot_interested=0&type=invitation&id=".$proposalid."&jobtype=".$rfpdetails->jobtype."&Itemid=112";
	$link_invite = '<a href="'.$link.'">CLICK HERE</a>';
	$body = str_replace('{CLICK HERE}',$link_invite,$body);
	
	//$mailfrom = 'support@myvendorcenter.com';
	$mailfrom = $manager_details->email ;
	
	$fromname = $cust_coname;
	if( $rfp_new->create_rfptype == 'open' || $rfp_new->create_rfptype == 'both' )
		$mailsubject = "A new Project is available for your company";
	else
		$mailsubject = "You've received a Project Invitation";
	   $existingid = $model->checkproposalexist($postrfpid,$vendorid);
	    $duplicateid =$existingid;
		
		if( $duplicateid == 'no' ) {		
	if( $vemail ) {
	JUtility::sendMail($mailfrom, $fromname, $vemail, $mailsubject, $body,$mode = 1);
	$support='rize.cama@gmail.com';
    JUtility::sendMail($mailfrom, $fromname, $support, $mailsubject, $body,$mode = 1);
	//To send the mails to CC
	$cclist = explode(';',$ccemail);
		for($c=0; $c<=count($cclist); $c++){
		$listcc = $cclist[$c];
		if($listcc){
		$res = JUtility::sendMail($mailfrom, $fromname, $listcc, $mailsubject, $body,$mode = 1);
		  }
		}
		}
		}
		
		/*$email_fax = "SELECT introtext  FROM #__content where id='309'";
		$db->Setquery($email_fax);
		$faxbody = $db->loadResult();
		$fax_body = str_replace('{VENDOR}',$v_companyname,$faxbody);
		$fax_body = str_replace('[RFP #]',$rfpid,$fax_body);
		$fax_body = str_replace('{PNAME}',str_replace('_',' ',$rfpdetails->property_name),$fax_body);
		$fax_body = str_replace('[communityname]',str_replace('_',' ',$rfpdetails->property_name),$fax_body);
		$fax_body = str_replace('[managername]',$managaercname,$fax_body);
		$fax_body = str_replace('[Reference Name]',$rfpdetails->projectName,$fax_body);
		$fax_body = str_replace('{PROJECTNAME}',$rfptime,$fax_body);
		$fax_body = str_replace('{CAMFIRM}',$cust_coname,$fax_body);
		$fax_body = str_replace('{managerfullname}',$man_fullname,$fax_body);
        $pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);
		$pdf->SetCreator(PDF_CREATOR);
		$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);
		$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));
		$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));
		$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);
		$pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);
		$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
		$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);
		$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);
		$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);
		$pdf->setLanguageArray($l);
		$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);
		$pdf->setJPEGQuality(200);
		$pdf->AddPage();
		$pdfcontent = $fax_body;
		$pdf->writeHTML($pdfcontent, true, 0, true, 0);
		$pdf->lastPage();
		$title= $post['rfpid'].'_Invitation_'.$post['vendorid'].'.pdf'; //set title
		$pdf->SetTitle($title);
		$pdf->Output('/home/allen/public_html/mydev/components/com_camassistant/assets/invitations/' . $title, 'F');
		$attachment ="/home/allen/public_html/mydev/components/com_camassistant/assets/invitations/".$title;
		$to_fax = '8005309768@rcfax.com';
		$mailfrom = "support@myvendorcenter.com";
		$mailsubject = "You've received a Project Invitation";
		$body = $fax_body ;
		$to_rize = 'rize.cama@gmail.com';
		if( $vendor_companyname->faxid && ( $vendor_companyname->fax_acc == 'yes' || $vendor_companyname->fax_acc  == '' ) ) {
		$successMail =JUtility::sendMail($mailfrom, $fromname, $to_rize, $mailsubject, $body,$mode = 1, $cc=null, $bcc=null, $attachment, $replyto=null, $replytoname=null);
		$successMail =JUtility::sendMail($mailfrom, $fromname, $to_fax, $mailsubject, $body,$mode = 1, $cc=null, $bcc=null, $attachment, $replyto=null, $replytoname=null);
		}		
		$username = 'rize.cama'; // Enter your Interfax username here
		$password = 'rize@1251'; // Enter your Interfax password here
		$faxnumber = '+18005309768'; // Enter your designated fax number here in the format +[country code][area code][fax number], for example: +12125554874
		$texttofax = $body; // Enter your fax contents here
		$filetype = 'pdf';
		$client = new SoapClient("http://ws.interfax.net/dfs.asmx?wsdl");
		$params->Username  = $username;
		$params->Password  = $password;
		$params->FaxNumber = $faxnumber;
		$params->Data      = $texttofax;
		$params->FileType  = $filetype;
		if( $vendor_companyname->faxid && ( $vendor_companyname->fax_acc == 'yes' || $vendor_companyname->fax_acc  == '' ) ) {
		$faxResult = $client->SendCharFax($params);
		}
	*/	 
	}

		}
	    $url ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
		$this->setRedirect($url);	
	}
	
	function getrfpinfo_new($rfpid){
		$db=JFactory::getDBO();
		$sql_rfp_new = "SELECT property_id, cust_id, industry_id, create_rfptype FROM #__cam_rfpinfo where id=".$rfpid." ";
		$db->Setquery($sql_rfp_new);
		$rfp_new = $db->loadObject();	
		return $rfp_new;
	}
	function getproposal($rfpid,$vendorid){
		$db=&JFactory::getDBO();
		$query_mans = "SELECT id from #__cam_vendor_proposals where rfpno = ".$rfpid." and proposedvendorid=".$vendorid." ";
		$db->setQuery($query_mans);
        $proposalid = $db->loadResult();
		return $proposalid;
	}
	
}
?>
