<?php
error_reporting(0);
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here
JHTML::_('behavior.modal');
$folder_name = JRequest::getVar('folder_name','');
$taxid = JRequest::getVar( 'taxid','' );

$Itemid = JRequest::getVar('Itemid','');
//echo "this is default-4 file"; 
?>

<?php 
$fileplace = explode("-->", $_REQUEST['fileplace']);
$fpath='components/com_camassistant/doc/'.$fileplace[0].'/';
$fpath_back='components/com_camassistant/doc';
$cnt=count($fileplace);
$user = JFactory::getUser(); 
//Functio to  by sateesh on 03-08-11--> 
if ($user->user_type=='13' || $user->user_type=='12' ) {
if($cnt==1)
	$backlink='index.php?option=com_camassistant&controller=documents&task=pdocs&Itemid=76';
else if($cnt==2) 
	$backlink='index.php?option=com_camassistant&controller=documents&task=pfiles&Itemid='.$_REQUEST['Itemid'].'&pid='.$_REQUEST['pid'].'&mid='. $_REQUEST['mid'].'&propertyname='.$fileplace[0].'&taxid='.$taxid;
else {
	for($i=0;$i<count($fileplace)-2;$i++) {
		$pro_name = str_replace(' ','_',$fileplace[0]);
		$pro_name = $pro_name.'_'.$taxid;
	
		$fpath_back.='/'.$fileplace[$i+1];
		$fplace_back = explode("-->", $_REQUEST['fileplace']);
		for($j=0;$j<=$i+1;$j++)
		$fplace1_back[$j]=$fplace_back[$j];
		$fplace2_back=implode('-->',$fplace1_back);
	}
	$k=count($fileplace)-2;
	$fpath_back = str_replace('doc','doc/'.$pro_name,$fpath_back);
	$backlink='index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid='.$_REQUEST['Itemid'].'&pid='.$_REQUEST['pid'].'&mid='. $_REQUEST['mid'].'&path='.$fpath_back.'&folder_name='.$fileplace[$k].'&fileplace='.$fplace2_back.'&taxid='.$taxid;
}
} 
///for My company documents BACK BUTTON functionality
else{
if($cnt==1) {
$backlink = "index.php?option=com_camassistant&controller=documents&task=vendor_docs&Itemid=115";
}
else{
//echo "<pre>"; print_r($fileplace);
	for($i=0;$i<count($fileplace)-1;$i++) {
		$fpath_back.='/'.$fileplace[$i];
		$fplace_back = explode("-->", $_REQUEST['fileplace']);
		for($j=0;$j<=$i;$j++)
		$fplace1_back[$j]=$fplace_back[$j];
		$fplace2_back=implode('-->',$fplace1_back);
		$fpath_back = str_replace($_REQUEST['folder_name'],'',$fpath_back);
	}
$k=count($fileplace)-2;
$fpath_back = str_replace('doc','doc/'.$taxid,$fpath_back);
$backlink='index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid='.$_REQUEST['Itemid'].'&pid='.$_REQUEST['pid'].'&mid='. $_REQUEST['mid'].'&path='.$fpath_back.'&folder_name='.$fileplace[$k].'&fileplace='.$fplace2_back.'&taxid='.$taxid;
}
}
//$path = explode($_REQUEST['folder_name'], $_REQUEST['path']);
//$fileplace = explode("-->".$_REQUEST['folder_name'], $_REQUEST['fileplace']);
?>
<?php 
 $user = JFactory::getUser();  
if ($user->user_type=='13' || $user->user_type=='12') { ?>

<div style="float:left; display:none" id="bedcrumb">
<ul>
<li class="home"><a href="index.php?option=com_camassistant&controller=vendors&task=vendor_dashboard&Itemid=112">Home  </a></li>
<li><a href="index.php?option=com_camassistant&controller=documents&Itemid=76">My Company Documents</a></li>
<li><a href="index.php?option=com_camassistant&controller=documents&task=pdocs&Itemid=76">Property Documents</a></li>
<?php $m=count($fileplace)-1;

for($i=0;$i<count($fileplace);$i++) { 
if($i<$m) { ?>
<li>
<?php if($i==0) { ?>
<a href="index.php?option=com_camassistant&controller=documents&task=pfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=&propertyname=<?php print_r($fileplace[$i]); ?>&taxid=<?php echo $taxid;?>">
<?php echo str_replace('_',' ',$fileplace[$i]);?></a>
<?php } else { 
$propertytname = str_replace(' ','_',$fileplace[0]);
$propertytname = $propertytname.'_'.$taxid;

$fpath.='/'.$fileplace[$i];
$fplace = explode("-->", $_REQUEST['fileplace']);
for($j=0;$j<=$i;$j++)
$fplace1[$j]=$fplace[$j];
$fplace2=implode('-->',$fplace1);
$fpath = str_replace($fileplace[0],$propertytname,$fpath);
?>
<a href="index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $fpath; ?>&folder_name=<?php echo $fileplace[$i];?>&fileplace=<?php echo $fplace2;?>&taxid=<?php echo $taxid; ?>">
<?php echo str_replace('_',' ',$fileplace[$i]);?></a>
<?php } ?>
</li>
<?php  
} else { 
echo "<li>".str_replace('_',' ',$fileplace[$i])."</li>";
}
}
$docTitle = ereg_replace('--','',$_REQUEST['fileplace']);
?></li>
</ul>
</div>
<?php }  else{ ?>
<!--This is for company documents-->
<div style="float:left; display:none" id="bedcrumb">
<ul>
<li class="home"><a href="index.php?option=com_camassistant&controller=vendors&task=vendor_dashboard&Itemid=112">Home  </a></li>
<li><a href="index.php?option=com_camassistant&controller=documents&task=vendor_docs&Itemid=115">My Company Documents</a></li>
<?php 
$m=count($fileplace)-1;
for($i=0;$i<count($fileplace);$i++) { 
if($i<$m) { ?>
<li>
<?php if($i==0) {  
if(strpos($fpath,$taxid)){
$fpath = $fpath;}
else{
$fpath = str_replace('doc','doc/'.$taxid,$fpath);}
?>
<a href="index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&propertyname=<?php print_r($fileplace[$i]); ?>&path=<?php echo $fpath; ?>&fileplace=<?php echo $fileplace[$i]; ?>&taxid=<?php echo $taxid;?> ">
<?php echo str_replace('_',' ',$fileplace[$i]);?></a>
<?php } else { 

$fpath.='/'.$fileplace[$i];
$fplace = explode("-->", $_REQUEST['fileplace']);
for($j=0;$j<=$i;$j++)
$fplace1[$j]=$fplace[$j];
$fplace2=implode('-->',$fplace1);
if(strpos($fpath,$taxid)){
$fpath = $fpath;}
else{
$fpath = str_replace('doc','doc/'.$taxid,$fpath);}
?>
<a href="index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $fpath; ?>&folder_name=<?php echo $fileplace[$i];?>&fileplace=<?php echo $fplace2;?>&taxid=<?php echo $taxid;?> ">
<?php echo str_replace('_',' ',$fileplace[$i]);?></a>
<?php } ?>
</li>
<?php  
} else { 
echo "<li>".str_replace('_',' ',$fileplace[$i])."</li>";
}
}
	$docTitle = ereg_replace('--','',$_REQUEST['fileplace']);
?></li>
</ul></div>
<!--This is for company documents-->
<?php } 
//Functio to  by sateesh on 03-08-11 completed--> 
?>
<div style="float:right; margin-bottom:10px;" ><br/>
<?php 
/*$fileplace = explode("-->".$_REQUEST['folder_name'], $_REQUEST['fileplace']);
$path = explode($_REQUEST['folder_name'], $_REQUEST['path']);
$fileplace = explode("-->".$_REQUEST['folder_name'], $_REQUEST['fileplace']);*/
?>
<?php 
  $user = JFactory::getUser();  
if ($user->user_type=='13' || $user->user_type=='12') { ?>
<?php
$link = 'index.php?option=com_camassistant&controller=documents&task=pdocs&Itemid=76';
?>
<?php } else { 
$link = 'index.php?option=com_camassistant&controller=documents&task=vendor_docs&Itemid=115';
}
?>
<?php //print_r($backlink); ?>
<a href="<?php echo $backlink;?>"><img src="templates/camassistant_left/images/back.png" alt="info" /></a></div><div class="clear"></div>
<!--<div id="i_bar_gr">-->
<div id="i_bar_path">
<div id="i_bar_txt">
<span>Directory Path: <?PHP //if(isset($folder_name) && $folder_name != '') echo $folder_name; else { ?>
<?php 	for($i=0;$i<count($fileplace);$i++) { 
			echo ucfirst(trim(str_replace('_',' ',$fileplace[$i])));
			if($i<count($fileplace)-1)
			echo '/';
		} ?>
<?PHP //} ?> </span></div>
<div id="i_icon">
<?php
if($user->user_type=='11')
$article = '110';
else
$article = '80';
?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=<?php echo $article ;?>&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" /> </a>
</div>
</div>
<div class="clear"></div>
<!-- sof table pan -->
<div class="table_pannel">
<div class="table_panneldiv">
<form name="docform" action="index.php">
<input type="hidden" name="option" value="" />
<input type="hidden" name="controller" value="" />
<input type="hidden" name="task" value="" />
<input type="hidden" name="spid" value="" />
<input type="hidden" name="smid" value="" />
<input type="hidden" name="spath" value="" />
<input type="hidden" name="doc_title" value="" />
<input type="hidden" name="second" value="" />
<input type="hidden" name="urlredirect" value="" />

<table width="100%" cellpadding="0" cellspacing="4" class="vendortable">
  <!--<tr class="table_blue_row">-->
  <tr class="vendorfirsttr">
    <td width="102" align="center" valign="middle">SELECT</td>
    <td width="456" align="left" valign="middle">NAME</td>
    <td width="141" align="center" valign="middle">OPTIONS</td>
    </tr>
    
  <?php for ($i=0; $i<count($this->openfiles['folders']); $i++){ ?>
<tr class="table_blue_rowdots2">
    <td align="center" valign="bottom" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->openfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->openfiles['folders'][$i];?>&taxid=<?php echo $taxid; ?>"><img src="images/folder_icon.png"  alt="folder" /></a></td>
    <td align="left" valign="middle" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->openfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->openfiles['folders'][$i];?>&taxid=<?php echo $taxid; ?>"><?php echo str_replace('_',' ',$this->openfiles['folders'][$i]); ?></a>
</td>
<td align="center" valign="middle" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid=<?php echo $_REQUEST['Itemid']; ?>&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->openfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->openfiles['folders'][$i];?>&taxid=<?php echo $taxid; ?>">OPEN</a>
<?PHP $db =& JFactory::getDBO(); $user =& JFactory::getUser(); if($user->user_type == '11'){ ?> |  
<script type="text/javascript">
function folderdelete(){
var result = confirm('Are you sure you want to delete this folder <?php print_r($this->openfiles['folders'][$i]); ?> and the internal files?');

	if(result == true)
	{
		var frm = document.docform;
		frm.option.value='com_camassistant';
		frm.controller.value='documents';
		frm.task.value='vendor_delete';
		//frm.view.value='documents';
		frm.spid.value=<?php echo $_REQUEST['pid']; ?>;
		frm.smid.value=<?php echo $_REQUEST['mid']; ?>;
		frm.spath.value='<?php echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>';
		frm.doc_title.value='<?php print_r($this->openfiles['folders'][$i]); ?>';
		frm.submit();
	}
	if(result == false) 
	{
		//alert('No action taken');
		window.location.href;
		//window.location = "http://www.google.com/"
		//return false;
	}
}
</script>
<!--<a href="index.php?option=com_camassistant&controller=documents&Itemid=<?PHP //echo $Itemid; ?>&controller=documents&task=vendor_delete&spid=<?php //echo $_REQUEST['pid']; ?>&smid=<?php //echo $_REQUEST['mid']; ?>&spath=<?php //echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>&title=<?php //print_r($this->openfiles['folders'][$i]); ?>">DELETE</a> 
-->
<a href="javascript:folderdelete();">DELETE</a>

<?PHP } ?>

</td>
</tr>
<?php } ?>
<?php

for ($i=0; $i<count($this->openfiles['files']); $i++){
$img_icon = substr(strrchr($this->openfiles['files'][$i], "."), 1);

?>
<tr class="table_blue_rowdots2">
<td align="center" valign="bottom" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=open&Itemid=<?php echo $_REQUEST['Itemid']; ?>&doc_title=<?php print_r($this->openfiles['files'][$i]); ?>&path=<?php echo $_REQUEST['path']; ?>&folder_name=<?php print_r($this->openfiles['files'][$i]); ?> "><img src="templates/camassistant_inner/images/images_<?PHP echo $img_icon; ?>.png" /></a></td>
<td align="left" valign="middle" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=open&Itemid=<?php echo $_REQUEST['Itemid']; ?>&doc_title=<?php print_r($this->openfiles['files'][$i]); ?>&path=<?php echo $_REQUEST['path']; ?>&folder_name=<?php print_r($this->openfiles['files'][$i]); ?> "><?php echo str_replace('_',' ',$this->openfiles['files'][$i]); ?></a>
</td>
<td align="center" valign="middle" style="padding-top:12px; padding-bottom:12px;">
<a href="index.php?option=com_camassistant&controller=documents&task=open&Itemid=<?php echo $_REQUEST['Itemid']; ?>&doc_title=<?php print_r($this->openfiles['files'][$i]); ?>&path=<?php echo $_REQUEST['path']; ?>&folder_name=<?php print_r($this->openfiles['files'][$i]); ?> ">OPEN</a>
<?PHP $db =& JFactory::getDBO(); $user =& JFactory::getUser(); if($user->user_type == '11'){ ?> |  
<script type="text/javascript">
function filedelete(file){
var result = confirm('Are you sure you want to delete this file'+file+' ?');
urlredirect = document.URL;
	if(result == true)
	{
		var from = document.docform;
		from.option.value='com_camassistant';
		from.controller.value='documents';
		from.task.value='vendor_deletefile';
		from.urlredirect.value='urlredirect';
		from.spid.value=<?php echo $_REQUEST['pid']; ?>;
		from.smid.value=<?php echo $_REQUEST['mid']; ?>;
		from.spath.value='<?php echo $_REQUEST['path']; ?>';
		from.doc_title.value=file;
		from.second.value='second';
		from.submit();
	}
	else 
	{
		return false;
	}
}
</script>

 <a href="javascript:void(0);" onclick="javascript:filedelete('<?php echo $this->openfiles['files'][$i]; ?>');">DELETE</a>
<!--<a href="index.php?option=com_camassistant&controller=documents&Itemid=<?PHP //echo $Itemid; ?>&controller=documents&task=vendor_deletefile&spid=<?php //echo $_REQUEST['pid']; ?>&smid=<?php //echo $_REQUEST['mid']; ?>&spath=<?php //echo $_REQUEST['path']."/".$this->openfiles['files'][$i]; ?>">DELETE</a> 
-->
<?PHP } ?></td>

</tr>
<?php } ?>
 <tr class="table_blue_rowdo">
   <td align="center" valign="bottom">&nbsp;</td>
   <td align="left" valign="top">&nbsp;</td>
   <td align="left" valign="top">&nbsp;</td>
   </tr>
</table>
</form>
<p style="height:50px;"></p>
<div class="table_bottomlinks2">
<ul>
<li  style=" background:none;"><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfolder&parentid=1&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']; ?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" ><img src="images/new_folder.png" alt="add a new folder" width="45" height="39" align="absmiddle" /> </a><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfolder&parentid=1&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']; ?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" >+Add a new Folder  </a></li>

<li><a class="modal" id="links1"  title="Upload a file"  href="index.php?option=com_camassistant&controller=documents&task=addfile&parentid=1&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']; ?>" rel="{handler: 'iframe', size: {x: 500, y: 250}}" > <img src="images/upload_folder.png" alt="Upload a file to this folder" width="37" height="36" align="middle" />+Upload a file to this folder </a></li> 
</ul>
</div>
</div></div>
<div class="clear"></div>
