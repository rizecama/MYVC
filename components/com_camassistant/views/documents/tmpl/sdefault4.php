<?php

/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here
JHTML::_('behavior.modal');
//echo "this is Shared default-4 file";
$type = JRequest::getVar( 'type','' );
$taxid = JRequest::getVar( 'taxid','' );
$camuser = JRequest::getVar( 'user','' );
$smid = JRequest::getVar( 'smid','' );
if($type == 'shared'){
$type = 'shared';
} else{ $type = '';}
?>
<!--//Getting states list by sateesh on 02-08-11 -->
<?php 
$fileplace = explode("-->", $_REQUEST['fileplace']);
$fpath='components/com_camassistant/doc/'.$fileplace[0];
$fpath_back='components/com_camassistant/doc/';
//print_r($_REQUEST['spid']);

///For shared properties
if($type == 'shared'){
$cnt=count($fileplace);
if($cnt==1)
	$backlink='index.php?option=com_camassistant&controller=documents&task=sdocs&Itemid=76';
else {
$db =& JFactory::getDBO();
$user = JFactory::getUser();
if($user->user_type == 13){
if($_REQUEST['smid'] != $user->id){
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no.'/'.$_REQUEST['smid'];
$propertyname = str_replace(' ','_',$propertyname);
$fpath_back = $fpath_back.$propertyname;
$fpath_back = str_replace('//','/',$fpath_back);
}
else{
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no;
$propertyname = str_replace(' ','_',$propertyname);
$fpath_back = $fpath_back.$propertyname;
$fpath_back = str_replace('//','/',$fpath_back);
}
}
if($user->user_type == 12){
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no.'/'.$_REQUEST['smid'];
$propertyname = str_replace(' ','_',$propertyname);
$fpath_back = $fpath_back.$propertyname;
$fpath_back = str_replace('//','/',$fpath_back);
}
	for($i=0;$i<count($fileplace)-1;$i++) {
	
		$fpath_back.='/'.$fileplace[$i];
		$fplace_back = explode("-->", $_REQUEST['fileplace']);
		for($j=0;$j<=$i;$j++)
		$fplace1_back[$j]=$fplace_back[$j];
		$fplace2_back=implode('-->',$fplace1_back);

	}
	$k=count($fileplace)-1;



if($camuser == 'cam'){
$fpath_back = str_replace($smid,'',$fpath_back);
$fpath_back = str_replace('//','/',$fpath_back);
} else{
$fpath_back = str_replace($smid,'',$fpath_back);
$fpath_back = str_replace('//','/',$fpath_back);

}

$backlink='index.php?option=com_camassistant&controller=documents&task=sopenfiles&type=shared&Itemid='.$_REQUEST['Itemid'].'&spid='.$_REQUEST['spid'].'&smid='. $_REQUEST['smid'].'&spath='.$fpath_back.'&propertyname='.$fileplace[$k].'&fileplace='.$fplace2_back.'&user='.$camuser;
}}
///For shared properties completed
//$path = explode($_REQUEST['folder_name'], $_REQUEST['path']);
//$fileplace = explode("-->".$_REQUEST['folder_name'], $_REQUEST['fileplace']);
?>
<!--//Getting states list by sateesh on 02-08-11 completed -->
<?php
if($type =='shared'){
$db =& JFactory::getDBO();
$user = JFactory::getUser();
$fpath ='components/com_camassistant/doc/'.$user->id;
?>
<div style="float:left; display:none" id="bedcrumb">
<ul>
<li class="home"><a href="index.php?option=com_camassistant&controller=vendors&task=vendor_dashboard&Itemid=112">Home  </a></li>
<li><a href="index.php?option=com_camassistant&controller=documents&Itemid=76">My Company Documents</a></li>
<li><a href="index.php?option=com_camassistant&controller=documents&task=sdocs&Itemid=76">Shared Company Documents</a></li>
<!--//index.php?option=com_camassistant&controller=documents&Itemid=76&propertyname=Test1&task=sfiles&spid=13&smid=229-->
<?php $m=count($fileplace)-1;
for($i=0;$i<count($fileplace);$i++) { 
if($i<$m) { ?>
<li>
<?php if($i==0) { 
$db =& JFactory::getDBO();
$user = JFactory::getUser();
if($fpath == 'components/com_camassistant/doc'){
$fpath ='components/com_camassistant/doc/'.$user->id.'/';
}else{
$fpath = $fpath;
}
if($user->user_type == 13){
if($_REQUEST['smid'] != $user->id){
$fpath = str_replace($user->id,'',$fpath);
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no.'/'.$_REQUEST['smid'];
$propertyname = str_replace(' ','_',$propertyname);
$fpath = $fpath.$propertyname;
}
else {
$fpath = str_replace($user->id,'',$fpath);
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no;
$propertyname = str_replace(' ','_',$propertyname);
$fpath = $fpath.$propertyname;
}
}
else if($user->user_type == 12){
$fpath = str_replace($user->id,'',$fpath);
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no.'/'.$_REQUEST['smid'];
$propertyname = str_replace(' ','_',$propertyname);
$fpath = $fpath.$propertyname;
}
//echo "<br>".$fpath."<br>";
?>
<?php if($camuser == 'cam'){
$fpath = str_replace($smid,'',$fpath);
$fpath = str_replace('//','/',$fpath);
} else{
$fpath = $fpath;
} ?>
<a href="index.php?option=com_camassistant&controller=documents&Itemid=<?php echo $_REQUEST['Itemid']; ?>&propertyname=<?php print_r($fileplace[$i]); ?>&task=sopenfiles&fileplace=<?php print_r($fileplace[$i]); ?>&type=shared&spath=<?php echo $fpath."/".$fileplace[$i]; ?>&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>">
<?php echo str_replace('_',' ',$fileplace[$i]);?></a>
<?php } else { 

//$fpath.='/'.$fileplace[$i];

$fplace = explode("-->", $_REQUEST['fileplace']);

for($j=0;$j<=$i;$j++)
$fplace1[$j]=$fplace[$j];
$fplace2=implode('-->',$fplace1);
$spath = str_replace('-->','/',$fplace2);
//$fplace2=htmlentities($fplace2);
?>
<?php if($camuser == 'cam'){
$fpath = str_replace($smid,'',$fpath);
$fpath = str_replace('//','/',$fpath);
} else{
$fpath = $fpath;
} ?>

<a href="index.php?option=com_camassistant&controller=documents&task=sopenfiles&type=shared&fileplace=<?php echo $fplace2;?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $fpath."/".$spath; ?>&folder_name=<?php echo $fileplace[$i];?>">
<?php echo str_replace('_',' ',$fileplace[$i]);?></a>
<?php } ?>
</li>
<?php  
} else { 
echo "<li>".str_replace('_',' ',$fileplace[$i])."</li>";
}
}
//echo $v;
$docTitle = ereg_replace('--','',$_REQUEST['fileplace']);
//echo $docTitle; ?></li>
</ul>
</div>
<?php } ?>
<div id="bedcrumb" style="float:left; display:none;">
<ul>
<br/>

</ul>
</div>
<div style="float:right; margin-bottom:10px;" ><br/>
<?php if($_REQUEST['type'] != 'shared' ){ ?>
<a href="<?php echo $backlink;?>"><img src="templates/camassistant_left/images/back.png" alt="info" /></a>
<?php } else {?>
<a href="<?php echo $backlink;?>"><img src="templates/camassistant_left/images/back.png" alt="info" /></a>
<?php } ?>
</div>
<div class="clear"></div>
<!-- eof dotshead -->
<div id="i_bar">
<div id="i_bar_txt">
<span>Directory Path: <?PHP //if(isset($folder_name) && $folder_name != '') echo $folder_name; else { ?>
<?php 	for($i=0;$i<count($fileplace);$i++) { 
			echo ucfirst(trim(str_replace('_',' ',$fileplace[$i])));
			if($i<count($fileplace)-1)
			echo '/';
		} ?>
<?PHP //} ?> </span>
</div>
<div id="i_icon">
<?php 
 $user = JFactory::getUser();  
if ($user->user_type=='12') { ?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=89&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" /> </a>
<?php } else { ?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=80&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" /> </a>
<?php } ?></div>	
</div>

<div class="table_pannel">
<div class="table_panneldiv">
<form name="docform" action="index.php">
<input type="hidden" name="option" value="" />
<input type="hidden" name="controller" value="" />
<input type="hidden" name="task" value="" />
<input type="hidden" name="spid" value="" />
<input type="hidden" name="smid" value="" />
<input type="hidden" name="spath" value="" />
<input type="hidden" name="doc_title" value="" />
<input type="hidden" name="second" value="" />
<input type="hidden" name="backurl" value="" />
<table width="100%" cellpadding="0" cellspacing="4" class="vendortable">
   <tr class="vendorfirsttr">
    <td width="62" align="center" valign="top">SELECT</td>
    <td width="456" align="left" valign="top">NAME</td>
    <td width="141" align="center" valign="top" colspan="2">OPTIONS</td>
    </tr>

  <?php for ($i=0; $i<count($this->sopenfiles['folders']); $i++){ ?>
  <tr class="table_blue_rowdots2">
  <td align="center" valign="bottom" style="padding-top:12px; padding-bottom:12px;">
<a href="index.php?option=com_camassistant&controller=documents&Itemid=82&controller=documents&task=sopenfiles&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->sopenfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->sopenfiles['folders'][$i];?>&type=<?php echo $type; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&taxid=<?php echo $taxid; ?>&user=<?php echo $camuser;?>"><img src="images/folder_icon.png"  alt="folder" /></a></td>

<td align="left" valign="middle" style="padding-top:12px; padding-bottom:12px;">
<a href="index.php?option=com_camassistant&controller=documents&Itemid=82&controller=documents&task=sopenfiles&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->sopenfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->sopenfiles['folders'][$i];?>&type=<?php echo $type; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&taxid=<?php echo $taxid; ?>&user=<?php echo $camuser;?>"><?php echo str_replace('_',' ',$this->sopenfiles['folders'][$i]); ?></a>
</td>
<td align="center" valign="middle" style="padding-top:12px; padding-bottom:12px;">

<a href="index.php?option=com_camassistant&controller=documents&Itemid=82&controller=documents&task=sopenfiles&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->sopenfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->sopenfiles['folders'][$i];?>&type=<?php echo $type; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&taxid=<?php echo $taxid; ?>&user=<?php echo $camuser;?>">OPEN</a>

</td>
<td align="center" valign="middle">
<script type="text/javascript">
function folderdelete(folder){
var result = confirm('Are you sure you want to delete this folder '+folder+' and the internal files?');
	if(result == true)
	{
		var frm = document.docform;
		frm.option.value='com_camassistant';
		frm.controller.value='documents';
		frm.task.value='delete';
		frm.backurl.value = '<?php echo $_SERVER['REQUEST_URI']; ?>'
		<?php if($_REQUEST['spid']){ ?>
		frm.spid.value=<?php echo $_REQUEST['spid']; ?>;
		<?php } else{ ?>
		frm.spid.value='';
		<?php } ?>
		frm.smid.value=<?php echo $_REQUEST['smid']; ?>;
		frm.spath.value='<?php echo $_REQUEST['spath']."/"; ?>'+folder;
		frm.doc_title.value=folder;
		frm.submit();
	}
	if(result == false) 
	{
		window.location.href;
	}
}
</script>

<a href="javascript:folderdelete('<?php echo $this->sopenfiles['folders'][$i]; ?>');">DELETE</a>


<!--<a href="index.php?option=com_camassistant&controller=documents&Itemid=82?controller=documents&task=delete&spid=<?php //echo $_REQUEST['spid']; ?>&smid=<?php //echo $_REQUEST['smid']; ?>&spath=<?php //echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&title=<?php //echo $this->sopenfiles['folders'][$i]; ?>&Itemid=<?php //echo $_REQUEST['Itemid']; ?>">DELETE</a>-->
</td>
</tr>
<?php } ?>
<?php
for ($i=0; $i<count($this->sopenfiles['files']); $i++){
?>
<?php $filename = $this->sopenfiles['files'][$i];
$ext = substr(strrchr($filename, "."), 1);
 ?>
  <tr class="table_blue_rowdots2">
<td align="center" valign="bottom" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=open&doc_title=<?php echo $this->sopenfiles['files'][$i]; ?>&path=<?php echo $_REQUEST['spath']; ?>&Itemid=76 "><img src="templates/camassistant_inner/images/images_<?php echo $ext; ?>.png" /></a></td>
<td align="left" valign="middle" style="padding-top:12px; padding-bottom:12px;"><a href="index.php?option=com_camassistant&controller=documents&task=open&doc_title=<?php echo $this->sopenfiles['files'][$i]; ?>&path=<?php echo $_REQUEST['spath']; ?>&Itemid=76 "><?php echo str_replace('_',' ',$this->sopenfiles['files'][$i]); ?></a></td>
<td align="center" valign="middle" style="padding-top:12px; padding-bottom:12px;">
<a href="index.php?option=com_camassistant&controller=documents&task=open&doc_title=<?php echo $this->sopenfiles['files'][$i]; ?>&path=<?php echo $_REQUEST['spath']; ?>&Itemid=76 ">OPEN</a>

</td>
<td align="center" valign="middle">

<!--<a href="<?php //echo $_REQUEST['spath']."/".$this->sopenfiles['files'][$i]; ?>" style="text-decoration:none">DELETE</a>-->
<script type="text/javascript">
function filedelete(filename){
var result = confirm('Are you sure you want to delete this file '+filename+' ?');
	if(result == true)
	{
		var from = document.docform;
		from.option.value='com_camassistant';
		from.controller.value='documents';
		from.task.value='deletefile';
		from.backurl.value = '<?php echo $_SERVER['REQUEST_URI']; ?>'
		<?php if($_REQUEST['spid']){ ?>
		from.spid.value=<?php echo $_REQUEST['spid']; ?>;
		<?php } else{ ?>
		from.spid.value='';
		<?php } ?>
		from.smid.value=<?php echo $_REQUEST['smid']; ?>;
		from.spath.value='<?php echo $_REQUEST['spath']."/"; ?>'+filename;
		from.doc_title.value=filename;
		from.second.value='second';
		from.submit();
	}
	else 
	{
		return false;
	}
}
</script>
<a href="#" onclick="javascript:filedelete('<?php echo $this->sopenfiles['files'][$i]; ?>');">DELETE</a>

</td>

</tr>
<?php } ?>
<tr class="table_blue_rowdot">
<td align="center" valign="bottom">&nbsp;</td>
<td align="left" valign="top">&nbsp;</td>
<td align="left" valign="top" colspan="2">&nbsp;</td>
</tr>
</table>
</form>
<div class="table_bottomlinks2">
<ul>
<li  style=" background:none;"><img src="images/new_folder.png" alt="add a new folder" width="45" height="39" align="absmiddle" /> <a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=saddfolder&parentid=1&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']; ?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" >+Add a new Folder  </a></li>

<li><img src="images/upload_folder.png" alt="Upload a file to this folder" width="37" height="36" align="middle" /><a class="modal" id="links1"  title="Upload a file"  href="index.php?option=com_camassistant&controller=documents&task=saddfile&parentid=1&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']; ?>" rel="{handler: 'iframe', size: {x: 500, y: 250}}" >Upload a file</a></li>
</ul>
</div>

</div></div>



<div class="clear"></div>
