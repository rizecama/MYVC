<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright © 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');
JHTML::_('behavior.modal');
$pmanagers = $this->pmanagers;
$adminscount = $this->admins;
$Itemid = JRequest::getVar("Itemid",0);
/*echo "<pre>";
print_r($_REQUEST);*/
$sortby = JRequest::getVar("sortby",0);


/*echo "<pre>";
print_r($pmanagers);
print_r($properties);exit;*/
?>
<script type="text/javascript">
    window.addEvent('domready', function(){ 
       var JTooltips = new Tips($$('.hasTip'), 
       { maxTitleChars: 50, fixed: false}); 
    });
</script>

<script>
N = jQuery.noConflict();
N(document).ready(function() {	
N('.smanager').click(function(e) {
var cid = N(this).attr('id');
var title = N(this).attr('rel');

document.getElementById("dmanagerid").value = cid;
document.getElementById("dmanagername").value = title;
document.getElementById("managername3").innerHTML = title;

	     e.preventDefault();

		var maskHeight = N(document).height();
		var maskWidth = N(window).width();
		N('#mask8').css({'width':maskWidth,'height':maskHeight});
		
		//transition effect		
		N('#mask8').fadeIn(100);	
		N('#mask8').fadeTo("slow",0.8);	
	
		//Get the window height and width
		
		var winH = N(window).height();
		var winW = N(window).width();
	
		//Set the popup window to center
		N("#submit8").css('top',  winH/2-N("#submit8").height()/2);
		N("#submit8").css('position',  'fixed');
		N("#submit8").css('border',  '6px solid #609E00');
		N("#submit8").css('left', winW/2-N("#submit8").width()/2);

		//transition effect
		N("#submit8").fadeIn(2000);
		 
		 //alert( e.preventDefault);
		
	});
		
	N('.window8 #close8').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask8').hide();
		N('.window8').hide();
	});	
	N('.window8 #cancel8').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask8').hide();
		N('.window8').hide();
	});	
	//if done button is clicked
	N('.window8 #done8').click(function (e) {
		//Cancel the link behavior
		N("#rolloverimagedm").show();
		N(".buttons_uninvitedm").hide();
		e.preventDefault();
		var cid = document.getElementById('dmanagerid').value;
		var title = document.getElementById('dmanagername').value;
		
N.post("index2.php?option=com_camassistant&controller=propertymanager&task=changestatustom", {User: ""+cid+""}, function(data){

if(data){
N('#mask8').hide();
N('.window8').hide();
//alert(""+title+" has been downgraded to Standard Manager permissions successfully.");
window.location.href='index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119';
}
});
	});		
	
	
});

function getmanagerslist(managerid,companyid,mtype,name){
		el='<?php  echo Juri::base(); ?>index.php?option=com_camassistant&controller=propertymanager&task=getcompanymanagersall&pmanager_id='+managerid+'&comp_id='+companyid+'&mgrtype='+mtype+'&name='+name+'';
		var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 600, y:250}}"))
		SqueezeBox.fromElement(el,options);
}
</script>
<style>
/* Tooltips */
.tool-tip {
   float: left;
   background: #ffc;
   border: 1px solid #D4D5AA;
   padding: 5px;
   max-width: 200px;
}
 
.tool-title {
   padding: 0;
   margin: 0;
   font-size: 100%;
   font-weight: bold;
   margin-top: -15px;
   padding-top: 15px;
   padding-bottom: 5px;
   background: url(../images/selector-arrow.png) no-repeat;
}
 
.tool-text {
   font-size: 100%;
   margin: 0;
}

#mask8 {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#000;
  display:none;
}
  
#boxes8 .window8 {
  position:absolute;
  left:0;
  top:0;
  width:350px;
  height:150px;
  display:none;
  z-index:9999;
  padding:20px;
}


#boxes8 #submit8 {
   width:451px; 
  height:217px;
  padding:10px;
  background-color:#ffffff;
}
#done8 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
}
#close8 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
}
</style>
<script>
N = jQuery.noConflict();
N(document).ready(function() {	
N('.deletemanager').click(function(e) {

var cid = N(this).attr('id');
var usertype = N(this).attr('rel');
el='<?php  echo Juri::base(); ?>index2.php?option=com_camassistant&controller=propertymanager&task=deletemgr&id='+cid;
var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 600, y:365}}"))
SqueezeBox.fromElement(el,options);
/*var title = N(this).attr('title');
document.getElementById("dmanagerid").value = cid;
document.getElementById("dmanagername").value = title;
document.getElementById("managername3").innerHTML = title;
	     e.preventDefault();
		var maskHeight = N(document).height();
		var maskWidth = N(window).width();
		N('#mask9').css({'width':maskWidth,'height':maskHeight});
		//transition effect		
		N('#mask9').fadeIn(100);	
		N('#mask9').fadeTo("slow",0.8);	
	
		//Get the window height and width
		
		var winH = N(window).height();
		var winW = N(window).width();
	
		//Set the popup window to center
		N("#submit9").css('top',  winH/2-N("#submit9").height()/2);
		N("#submit9").css('position',  'fixed');
		N("#submit9").css('border',  '6px solid #609E00');		
		N("#submit9").css('left', winW/2-N("#submit9").width()/2);

		//transition effect
		N("#submit9").fadeIn(2000);*/
		 
		 //alert( e.preventDefault);
		
	});

N('.deletemanager_empty').click(function(){
		var deleteid = N(this).attr('rel');
		N('#managerid_free').val(deleteid);
		var maskHeight = N(document).height();
		var maskWidth = N(window).width();
		N('#masknan').css({'width':maskWidth,'height':maskHeight});
		N('#masknan').fadeIn(100);
		N('#masknan').fadeTo("slow",0.8);
		var winH = N(window).height();
		var winW = N(window).width();
		N("#submitnan").css('top',  winH/2-N("#submitnan").height()/2);
		N("#submitnan").css('left', winW/2-N("#submitnan").width()/2);
		N("#submitnan").fadeIn(2000);
		N('.windownan #closenan').click(function (e) {
		e.preventDefault();
		N('#masknan').hide();
		N('.windownan').hide();
		});
		N('.windownan #donenan').click(function (e) {
		N('#manager_deletion_free').submit();
		e.preventDefault();
		N('#masknan').hide();
		N('.windownan').hide();
		});
});	
	/*N('.window9 #close9').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask9').hide();
		N('.window9').hide();
	});	
	N('.window9 #cancel9').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask9').hide();
		N('.window9').hide();
	});	
	//if done button is clicked
	N('.window9 #done9').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask9').hide();
		N('.window9').hide();
		var cid = document.getElementById('dmanagerid').value;
		var title = document.getElementById('dmanagername').value;

N.post("index2.php?option=com_camassistant&controller=propertymanager&task=deletemanager", {User: ""+cid+""}, function(data){
if(data == 'success'){
alert(""+title+" has been deleted successfully.");
window.location.href='index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119';
}
});
	});*/		
	
	
});

N(document).ready(function() {	
N('.deletemanager_admin').click(function(e) {
		var usertype = N(this).attr('rel');
		if( usertype == 'cm' ){
			var maskHeight = N(document).height();
			var maskWidth = N(window).width();
			N('#maskcm').css({'width':maskWidth,'height':maskHeight});
			N('#maskcm').fadeIn(100);	
			N('#maskcm').fadeTo("slow",0.8);	
			var winH = N(window).height();
			var winW = N(window).width();
			N("#submitcm").css('top',  winH/2-N("#submitcm").height()/2);
			N("#submitcm").css('position',  'fixed');
			N("#submitcm").css('border',  '6px solid #609E00');		
			N("#submitcm").css('left', winW/2-N("#submitcm").width()/2);
			N("#submitcm").fadeIn(2000);
			N('.windowcm #donecm').click(function (e) {
				e.preventDefault();
				N('#maskcm').hide();
				N('.windowcm').hide();
			});	
			N('.windowcm #cancelcm').click(function (e) {
				e.preventDefault();
				N('#maskcm').hide();
				N('.windowcm').hide();
			});	
			
		}
	});
});

</script>
<style>
#masknan { position:absolute;  left:0;  top:0;  z-index:9000;  background-color:#000;  display:none;}
#boxesnan .windownan {  position:absolute;  left:0;  top:0;  width:350px;  height:150px;  display:none;  z-index:9999;  padding:20px;}
#boxesnan #submitnan {  width:452px;  height:127px;  padding:10px;  background-color:#ffffff;}
#boxesnan #submitnan a{ text-decoration:none; color:#000000; font-weight:bold; font-size:20px;}
#donenan {
  border: 0 none;
  color: #000000;
  cursor: pointer;
  float: left;
  font-size: 20px;
  font-weight: bold;
  margin: 0 auto;
  padding: 0;
  text-align: left;
  width: 49%;
}
#closenan {
  border: 0 none;
  cursor: pointer;
  float: left;
  height: 30px;
  padding: 0 10px 0 0;
  text-align: right;
  width: 48%;
}

/* Tooltips */
.tool-tip {
   float: left;
   background: #ffc;
   border: 1px solid #D4D5AA;
   padding: 5px;
   max-width: 200px;
}
 
.tool-title {
   padding: 0;
   margin: 0;
   font-size: 100%;
   font-weight: bold;
   margin-top: -15px;
   padding-top: 15px;
   padding-bottom: 5px;
   background: url(../images/selector-arrow.png) no-repeat;
}
 
.tool-text {
   font-size: 100%;
   margin: 0;
}

#mask9 {  position:absolute;  left:0;  top:0;  z-index:9000;  background-color:#000;  display:none;}
#boxes9 .window9 {  position:absolute;  left:0;  top:0;  width:350px;  height:150px;  display:none;  z-index:9999;  padding:20px;}
#boxes9 #submit9 {   width:420px;   height:180px;  padding:10px;  background-color:#ffffff;}
#done9 {border:0 none;cursor:pointer;height:30px;margin:0;padding:0;}
#close9 {padding-left:66px;border:0 none;cursor:pointer;height:30px;margin:0;}

#maskcm {  position:absolute;  left:0;  top:0;  z-index:9000;  background-color:#000;  display:none;}
#boxescm .windowcm {  position:absolute;  left:0;  top:0;  width:350px;  height:150px;  display:none;  z-index:9999;  padding:20px;}
#boxescm #submitcm {   width:543px;   height:180px;  padding:10px;  background-color:#ffffff;}
#donecm {border:0 none;cursor:pointer;height:52px;margin:0;padding:0;}
#closecm {padding-left:66px;border:0 none;cursor:pointer;height:30px;margin:0;}

</style>
<script>
N = jQuery.noConflict();
N(document).ready(function() {	
N('.dmanager').click(function(e) {
var cid = N(this).attr('id');
var title = N(this).attr('rel');
document.getElementById("managerid").value = cid;
document.getElementById("mname").value = title;
document.getElementById("managername2").innerHTML = title;

document.getElementById("managername").innerHTML = title;
	     e.preventDefault();

		var maskHeight = N(document).height();
		var maskWidth = N(window).width();
		N('#mask7').css({'width':maskWidth,'height':maskHeight});
		
		//transition effect		
		N('#mask7').fadeIn(100);	
		N('#mask7').fadeTo("slow",0.8);	
	
		//Get the window height and width
		
		var winH = N(window).height();
		var winW = N(window).width();
	
		//Set the popup window to center
		N("#submit-m7").css('top',  winH/2-N("#submit-m7").height()/2);
		N("#submit-m7").css('border', '6px solid #609E00');
		N("#submit-m7").css('left', winW/2-N("#submit-m7").width()/2);

		//transition effect
		N("#submit-m7").fadeIn(2000);
		 
		 //alert( e.preventDefault);
		
	});
		
	N('.window7 #close7').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask7').hide();
		N('.window7').hide();
	});	
	N('.window7 #cancel7').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		N('#mask7').hide();
		N('.window7').hide();
	});
	//if done button is clicked
	N('.window7 #done17').click(function (e) {
	N("#rolloverimage").show();
	N(".buttons_uninvite").hide();
		//Cancel the link behavior
		var cid = document.getElementById('managerid').value;
                 var managername = document.getElementById('mname').value;
               var invite = document.getElementById('invite').value;
             // window.parent.document.getElementById( 'sbox-window' ).close();
		N.post("index2.php?option=com_camassistant&controller=propertymanager&task=managers_save", {dmanager: ""+cid+"",managername: ""+managername+"",invite: ""+invite+""}, function(data){

if(data){
		e.preventDefault();
		N('#mask7').hide();
		N('.window7').hide();

//alert(""+managername+" has been upgraded to District Manager permissions successfully.");
window.location.href='index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119';
}
});
		//el='<?php  echo Juri::base(); ?>index2.php?option=com_camassistant&controller=propertymanager&task=chagetodm&id='+cid+'';
		//SqueezeBox.fromElement(el);
		//var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 600, y:190}}"))
		//SqueezeBox.fromElement(el,options);
	});		
	
	
});


</script>
<style>
/* Tooltips */
.tool-tip {
   float: left;
   background: #ffc;
   border: 1px solid #D4D5AA;
   padding: 5px;
   max-width: 200px;
}
 
.tool-title {
   padding: 0;
   margin: 0;
   font-size: 100%;
   font-weight: bold;
   margin-top: -15px;
   padding-top: 15px;
   padding-bottom: 5px;
   background: url(../images/selector-arrow.png) no-repeat;
}
 
.tool-text {
   font-size: 100%;
   margin: 0;
}

#mask7 {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#000;
  display:none;
}
  
#boxes7 .window7 {
  position:absolute;
  left:0;
  top:0;
  width:350px;
  height:150px;
  display:none;
  z-index:9999;
  padding:20px;
}


#boxes7 #submit7, #boxes7 #submit-m7 {
   width:477px; 
  height:177px;
  padding:10px;
  background-color:#ffffff;
  position:fixed;
}
#done7,#done17 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
}
#close7 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
}
</style>



<script language="javascript" type="text/javascript">
function fun_sorting()
{
	var frm=document.managersform;
	frm.option.value="com_camassistant";
	frm.controller.value="propertymanager";
	frm.task.value="manage_properties";
	frm.Itemid.value=<?php echo $Itemid;?>;
	frm.submit();
}
//
function fun_invite()
{
	alert("This Page is under construction");
}
function doPostBack(elm,userid) {
var val = elm.options[elm.selectedIndex].value;
N.post("index2.php?option=com_camassistant&controller=propertymanager&task=changemanager&manager="+userid+"", {User: ""+val+""}, function(data){

if(data == 'success'){
alert("This Manager has been successfully reassigned.");
window.location.href='index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119';
}
});

}

</script>
<!-- sof bedcrumb -->
<?php

$user = JFactory::getUser();  
if($user->user_type == 11)
{ ?>
<div align="center" style="color:#0066FF; font-size:15px"> You are not authorized to view this page.</div>
<?php } else { ?>
<div id="bedcrumb" style="display:none">
<ul>
<li class="home"><a href="index.php">Home</a> </li>
<li><a href="index.php?option=com_camassistant&controller=propertymanager&task=company_edit_form&Itemid=87">Firm Admin Home</a> </li>
<li>My Managers & Properties</li>
</ul>
</div>
<p style="height:22px;"></p>
<!-- eof bedcrumb -->
<form name="managersform" method="post" action="<?php echo $this->request_url; ?>">
<input type="hidden" name="controller" value="propertymanager" />
<input type="hidden" name="task" value="manage_properties" />
<input type="hidden" name="option" value="com_camassistant" />
<input type="hidden" name="Itemid" value="<?php echo $Itemid;?>" />

<!-- sof dotshead -->

<!-- eof dotshead -->
<div align="center">
<!--<select name="sortby" style="width:276px;" onchange="javascript:fun_sorting()">
<option value="0" >Sort By</option>	
  <option value="1" <?php if($sortby==1) echo 'selected';?>>Last Name</option>
  <option value="2" <?php if($sortby==2) echo 'selected';?>>First Name</option>
  <option value="3" <?php if($sortby==3) echo 'selected';?>>Phone</option>
  <option value="5" <?php if($sortby==5) echo 'selected';?>>Email</option>
</select>-->
</div>
<div id="i_bar">
<div id="i_bar_txt" style="text-align:center; padding-left:36px; font-size:15px;">
<span><strong>MY MANAGERS</strong>    </span>
</div>
<div id="boxes7">		
<div id="submit-m7" class="window7">		
<form name="edit" id="edit" method="post">
<div style="text-align:center; font-size:13px;">
<br>
<font color="gray">Are you sure you want to upgrade the permission level of <span id="managername" class="manager_name" style="color:gray;"></span> to a District Manager? Having District Manager permissions allows <span id="managername2" style="color:gray;"></span> to have administrative access to other manager accounts which you assign under them. NOTE: Your Firm Admin account still retains administrative access over all manager accounts.</font>
</div>
<input type="hidden" value="" name="managerid" id="managerid" />
 <input type="hidden" value="1" name="invite" id="invite" />
<input type="hidden" value="" name="mname" id="mname" />
<div class="buttons_uninvite" style="padding-top:20px; text-align:center;"><table style="padding-left:117px;"><tr><td>
<div id="close7" name="close7" value="Cancel" style="font-weight:bold;"><img src="templates/camassistant/images/No.gif" /></div></td><td style="padding-left:20px;">
<div id="done17" name="done7" value="Ok" style="font-weight:bold;"><img src="templates/camassistant/images/yes.gif" /></div><div class="clear"></div></td></tr></table></div>
<div id="rolloverimage" style="display:none;"></div>
</form>
</div>
  <div id="mask7"></div>
</div>
<div id="boxes8">		
<div id="submit8" class="window8">		
<form name="edit" id="edit" method="post">
<div style="text-align:center;">
<br>
<p style="color:gray; font-size:13px;">Are you sure you want to downgrade the permission level of <span id="managername3" style="color:gray;"></span> from a District Manager to a Standard Manager? Removing District Manager permissions revokes a manager’s administrative access to other manager accounts which have been assigned to them. Any manager accounts previously assigned to this manager will be reassigned to you, the FIRM ADMIN. NOTE: You may reassign those managers to another District Manager later.</p>
</div>
<input type="hidden" value="" name="dmanagerid" id="dmanagerid" />
<input type="hidden" value="" name="dmanagername" id="dmanagername" />
<div class="buttons_uninvitedm" style="padding-top:20px; text-align:center;"><table style="padding-left:100px;"><tr><td>
<div id="close8" name="close8" value="Cancel" style="font-weight:bold;"><img src="templates/camassistant/images/No.gif" /></div></td><td style="padding-left:20px;">
<div id="done8" name="done8" value="Ok" style="font-weight:bold;"><img src="templates/camassistant/images/yes.gif" /></div><div class="clear"></div></td></tr></table></div>
<div id="rolloverimagedm" style="display:none;"></div>
</form>
</div>
  <div id="mask8"></div>
</div>
<!--///For delete-->
<div id="boxes9">		
<div id="submit9" class="window9">		
<form name="edit" id="edit" method="post">
<div style="text-align:center">
<div id="cancel9" style="float: right;position:absolute;top:-30px;right:-20px; font-size:13px;" float="right"><img src="/media/system/images/closebox.png"></div>

<font color="#636363"><br />Once this account is deleted, any properties currently assigned to this manager will be reassigned to <strong><?php echo $user->name.' '.$user->lastname; ?><span id="managername" style="color:#0000ce;"></span></strong>.  These properties may then be assigned to other managers by clicking on the "My Properties" link.  Are you sure you want to delete this manager's account?<br /><br /></font>

</div>
<input type="hidden" value="" name="managerid" id="managerid" />
<div style="padding-top:5px; text-align:center;"><table style="padding-left:20px;"><tr><td>
<div id="close9" name="close9" value="Cancel" style="font-weight:bold;"><img src="templates/camassistant/images/No.gif" /></div></td>
<td style="padding-left:10px;">
<div id="done9" name="done9" value="Ok" style="font-weight:bold;"><img src="templates/camassistant/images/yes.gif" /></div><div class="clear"></div></td></tr></table></div>
</form>
</div>
<div id="mask9"></div>
</div>
<!--///For delete-->

<div id="i_icon"><a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=82&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" /> </a></div>
</div>
<!-- sof table pan -->
<div class="table_pannel">

<div class="table_panneldiv">
<table width="100%" cellpadding="0" cellspacing="4" class="vendortable">
<tr class="vendorfirsttr">
    <?php
	$sort = JRequest::getVar('sort','');
	if($sort == 'asc' || $sort == ''){
	$sort = 'desc';
	$id = 'compliant_desc';
	}
	else{
	$sort = 'asc';
	$id = 'compliant_asc';
	}
	?>
    <td width="190" align="left" valign="middle" nowrap="nowrap" style="padding-left:4px;">
	<a id="<?php echo $id; ?>" href="index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119&sort=<?php echo $sort ; ?>">MANAGER</a></td>
    <td width="20" align="center" valign="middle">PROPERTIES</td>
    <td width="50" valign="middle" align="center">ACCOUNT&nbsp;TYPE</td>
    <td width="80" valign="middle" align="center">REPORTS TO</td>
	<td width="40" align="center" valign="middle">DELETE</td>
  </tr>
<?php //echo "<pre>"; print_r($pmanagers); echo "</pre>"; ?>
   <?php if(count($pmanagers)>0) { 
  for($i=0;$i<count($pmanagers);$i++) { 
  	if( $pmanagers[$i]->comp_id == '' ){
			$db = JFactory::getDBO();
			$sql_comp = "SELECT comp_id FROM #__cam_customer_companyinfo WHERE cust_id=".$pmanagers[$i]->id;
			$db->setQuery( $sql_comp);
			$comp_id = $db->loadResult();
			$pmanagers[$i]->comp_id = $comp_id;
		}
	else
		$pmanagers[$i]->comp_id = $pmanagers[$i]->comp_id;	
  ?>  
  <tr class="table_blue_rowdots">
    
        <?php if($pmanagers[$i]->dmanager == ''){ ?>
    <td align="left" width="190" valign="middle">
	
	 <?php
  if($pmanagers[$i]->dmanager == 'yes'){
  	$mgrtype = 'dm';
  }
  else if($pmanagers[$i]->user_type == '13'){
  	$mgrtype = 'cm';
  }
  else{
  	$mgrtype = 'normal';
  }
  ?>
  
	<a href="index.php?option=com_camassistant&controller=propertymanager&task=customer_edit_form&pmanager_id=<?php echo $pmanagers[$i]->id;?>&comp_id=<?php echo $pmanagers[$i]->comp_id;?>&mgrtype=<?php echo $mgrtype; ?>&Itemid=<?php echo $Itemid;?>"><?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?></a>
	
	<br /><?php echo $pmanagers[$i]->phone;?>&nbsp;<?php if($pmanagers[$i]->extension) { echo "x".$pmanagers[$i]->extension; } else{ }?><br /><a class="emaillinks_manager" href="mailto:<?php echo $pmanagers[$i]->email;?>"><?php echo $pmanagers[$i]->email;?></a></td>
    <?php } else { ?>
	
	 <?php
  if($pmanagers[$i]->dmanager == 'yes'){
  	$mgrtype = 'dm';
  }
  else if($pmanagers[$i]->user_type == '13'){
  	$mgrtype = 'cm';
  }
  else{
  	$mgrtype = 'normal';
  }
  ?>
  
    <td align="left" width="190" valign="middle">
	
	<a href="index.php?option=com_camassistant&controller=propertymanager&task=customer_edit_form&pmanager_id=<?php echo $pmanagers[$i]->id;?>&comp_id=<?php echo $pmanagers[$i]->comp_id;?>&mgrtype=<?php echo $mgrtype; ?>&Itemid=<?php echo $Itemid;?>"><?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?></a>
	
	<br /><?php echo $pmanagers[$i]->phone;?>&nbsp;<?php if($pmanagers[$i]->extension) { echo "x".$pmanagers[$i]->extension; } else{ }?><br /><a class="emaillinks_manager" href="mailto:<?php echo $pmanagers[$i]->email;?>"><?php echo $pmanagers[$i]->email;?></a></font>
    </td>
        <?php } ?>
   
    <td align="center" width="40" valign="middle"><?php 
	 if($user->user_type == 13){
	$pmanagers[$i]->cust_id = $pmanagers[$i]->cust_id;
	}
	else{
	$pmanagers[$i]->cust_id = $pmanagers[$i]->id;
	}

//for counties of individual properties 
        $db = JFactory::getDBO();
		$sql_count = "SELECT count(id)FROM #__cam_property where property_manager_id=".$pmanagers[$i]->cust_id." and publish='0'";
		$db->Setquery($sql_count );
		$propertycount= $db->loadResult();
//Completd
     //echo $pmanagers[$i]->cnt;
//echo $propertycount;
?>
<a href="index.php?option=com_camassistant&controller=propertymanager&task=propertieslist&managerid=<?php echo $pmanagers[$i]->cust_id; ?>" rel="{handler: 'iframe', size: {x: 655, y: 530}}" class="modal" title="Click here" mce_style="text-decoration: none;" style="text-decoration: none;"><font color="#636363"><span class="emaillinks_manager"><?php echo $propertycount;?></span></font></a>
</td>
    <?php if($user->user_type == 13)
			{ 
	 				if ($pmanagers[$i]->id == $user->id && $user->accounttype == 'master')
					  {?> 
				  	  <td width="18" align="center" valign="middle"><?php echo "Master"; ?></td>
    			<?php } 
					else if ( $pmanagers[$i]->user_type == '13' && $pmanagers[$i]->accounttype != 'master' )
					  {?> 
				  	  <td width="18" align="center" valign="middle"><?php echo "Admin"; ?></td>
    			<?php }
					  else if($pmanagers[$i]->dmanager == '')
					  { ?>
				      <td width="120" align="center" valign="middle">
    <a id="<?php echo $pmanagers[$i]->id; ?>" rel="<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname); ?>" title="Click to change" name="dmanager" class="dmanager" href="javascript:void(0);">Standard Manager</a></td>
    			<?php } 
					  else {?>
					  <td width="120" align="center" valign="middle">
     <a id="<?php echo $pmanagers[$i]->id; ?>" name="smanager" class="smanager" href="javascript:void(0);" rel="<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname); ?>" title="Click to change"><font color="#21314D">District Manager</font></a>
        </td>
				<?php } ?>
    <?php } 
	else if($user->user_type == 12 && $user->dmanager == 'yes' && $pmanagers[$i]->dmanager == 'yes'){?>
	<td width="18" align="center" valign="middle"><?php echo "District Manager";  ?></td>
	<?php }
	else { ?> <td width="18" align="center" valign="middle"><?php echo "Standard Manager";  }?></td>
	<td align="center" width="100">
    <?php 
	
	if($user->user_type == 13){ 
			$db = JFactory::getDBO();
			$sql = "SELECT dmanager FROM #__cam_invitemanagers where managerid=".$pmanagers[$i]->id." and dmanager!=0";
			$db->Setquery($sql);
			$dimensions = $db->loadResult();
			$sql_dmanagerid = "SELECT id,name,lastname FROM #__users where id=".$dimensions."";
			$db->Setquery($sql_dmanagerid);
			$dnamnerdet = $db->loadObject();
			//Completed
			if( $dnamnerdet ){
			 ?>
			 <a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $dnamnerdet->name.'&nbsp;'.$dnamnerdet->lastname; ?></span> </a>
			 <?php 
			 }
			 else{
			$sql_sender = "SELECT sender FROM #__cam_invitemanagers where managerid=".$pmanagers[$i]->id." and sender=".$user->id." ";
			$db->Setquery($sql_sender);
			$sender = $db->loadResult();
			$sql_sendid = "SELECT id,name,lastname FROM #__users where id=".$sender."";
			$db->Setquery($sql_sendid);
			$senderid = $db->loadObject();
				if( $senderid ){ ?>
				<a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $senderid->name.'&nbsp;'.$senderid->lastname; ?></span></a>
				<?php }
			 	else{
					if($pmanagers[$i]->user_type == 13 && $user->accounttype == 'master'){ ?>
						<a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $user->name.'&nbsp;'.$user->lastname ; ?></span></a>
				<?php 	}	
					else{
						if($user->user_type == '13' && $user->accounttype != 'master'){
							$sql_master = "SELECT masterid FROM #__cam_masteraccounts where firmid=".$pmanagers[$i]->id." ";
							$db->Setquery($sql_master);
							$masterid = $db->loadResult();
							$masterdata = JFactory::getUser($masterid);  
							?>
							<a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $masterdata->name.'&nbsp;'.$masterdata->lastname ;?></span></a>
							
						<?php }
						else{
						// To get manager reorts to when master logged in
						$getadminuser = "SELECT v.cust_id FROM #__cam_camfirminfo as v, #__cam_customer_companyinfo as u where u.cust_id=".$pmanagers[$i]->id." and u.comp_id=v.id";
						$db->Setquery($getadminuser);
						$admindata = $db->loadResult();
						
						/*$sql_master = "SELECT masterid FROM #__cam_masteraccounts where firmid=".$pmanagers[$i]->id." ";
						$db->Setquery($sql_master);
						$masterid = $db->loadResult();*/
						$admin_man = JFactory::getUser($admindata);  
						?>
						<a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $admin_man->name.'&nbsp;'.$admin_man->lastname ; ?></span></a>
						<?php }
					}
				}
			 }
			 
	 } 
	 else if($user->user_type == 12 && $user->dmanager == 'yes'){
	 		if($pmanagers[$i]->user_type == 12 && $pmanagers[$i]->dmanager != 'yes'){
	 		?>
			
			<a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $user->name.'&nbsp;'.$user->lastname; ?></span></a>
			
			<?php }
			else{
			$getadminuser = "SELECT v.cust_id FROM #__cam_camfirminfo as v, #__cam_customer_companyinfo as u where u.cust_id=".$pmanagers[$i]->id." and u.comp_id=v.id";
			$db->Setquery($getadminuser);
			$admindata = $db->loadResult();
			$admin_man = JFactory::getUser($admindata);
			?>
			
			<a href="javascript:void(0);" title="Click to change" onclick="getmanagerslist(<?php echo $pmanagers[$i]->id;?>,<?php echo $pmanagers[$i]->comp_id;?>,'<?php echo $mgrtype; ?>','<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname);?>');"><span class="emaillinks_manager"><?php echo $admin_man->name.'&nbsp;'.$admin_man->lastname ;	?></span></a>
			
			<?php }
	 }
	 	else { echo "---"; } 
?>
  </td>
  <?php
  if($pmanagers[$i]->dmanager == 'yes'){
  	$mgrtype = 'dm';
	$class_mgr = 'deletemanager';
	$display = '';
  }
  else if($pmanagers[$i]->user_type == '13' && $pmanagers[$i]->accounttype != 'master'){
  	$mgrtype = 'cm';
	$class_mgr = 'deletemanager_admin';	
	$display = '';
  }
  else if($pmanagers[$i]->user_type == '13' && $pmanagers[$i]->accounttype == 'master'){
  	$mgrtype = 'cm';
	$class_mgr = 'deletemanager_admin';
	$display = 'none';	
  }
  else{
  	$mgrtype = 'normal';
	$class_mgr = 'deletemanager';	
	$display = '';
  }
  
 if( $pmanagers[$i]->user_type == '12' && $pmanagers[$i]->dmanager == 'yes' ){
 			$db = JFactory::getDBO();
			$sql = "SELECT count(dmanager) as countm FROM #__cam_invitemanagers where dmanager=".$pmanagers[$i]->id." ";
			$db->Setquery($sql);
			$count_managers_dm = $db->loadResult();
 }
  
  ?>
  <td width="40" align="center" valign="center">
  <?php if($propertycount != 0 || $pmanagers[$i]->user_type == '13'){ ?>
    <a style="display:<?php echo $display; ?>" title="Delete" id="<?php echo $pmanagers[$i]->id; ?>" rel="<?php echo $mgrtype; ?>" name="deletemanager" class="<?php echo $class_mgr; ?>" href="javascript:void(0);" title="<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname); ?>"><img style="cursor:pointer;" alt="delete" src="templates/camassistant_left/images/red.png"></a>
    <?php 
	} 
	else { 
		if( $pmanagers[$i]->user_type == '12' && $pmanagers[$i]->dmanager == 'yes' && $count_managers_dm > 0 ){ ?>
	<a style="display:<?php echo $display; ?>" title="Delete" id="<?php echo $pmanagers[$i]->id; ?>" rel="<?php echo $mgrtype; ?>" name="deletemanager" class="<?php echo $class_mgr; ?>" href="javascript:void(0);" title="<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname); ?>"><img style="cursor:pointer;" alt="delete" src="templates/camassistant_left/images/red.png"></a>		
	<?php	}	else  {		
	?>
	<a title="Delete" id="<?php echo $pmanagers[$i]->id; ?>" name="deletemanager" rel="<?php echo $pmanagers[$i]->id; ?>" class="deletemanager_empty" href="javascript:void(0);" title="<?php echo ucwords($pmanagers[$i]->name).'&nbsp;'.ucwords($pmanagers[$i]->lastname); ?>"><img style="cursor:pointer;" alt="delete" src="templates/camassistant_left/images/red.png"></a>
	<?php
	}
	 }?>
    </td>
  </tr>
  <?php } 
  
  
  } else {?>
 <tr class="table_blue_rowdots">
    <td align="center" valign="top" colspan="7">No Records Found</td>
  </tr><?php } ?>
  
 
 <tr class="table_blue_rowd">
  
   <td align="left" valign="middle">&nbsp;</td>
   <td align="left" valign="top">&nbsp;</td>
   <td align="left" valign="top">&nbsp;</td>
   <td align="center" valign="middle">&nbsp;</td>
   <td align="center" valign="middle">&nbsp;</td>
 </tr>
</table>



</div>
</div>
<!-- eof table pan -->
<div class="table_bottomlinks" style="margin-top:0px;" align="center">
<?php /*?><strong>NOTE:</strong> Managers with <span class="redtxt">RED</span> names have <strong>“District Manager” Permissions.</strong>

Williams <?php */?><a href="index.php?option=com_camassistant&controller=propertymanager&task=invitemanager&Itemid=119"><img src="templates/camassistant_left/images/InviteANewManager.gif" alt="Invite a new Manager" align="center" /></a></div>
<p style="height:100px;"></p>

 <?php //echo $this->pagination->getPagesLinks( ); ?>
	<?php //echo $this->pagination->getLimitBox( ); ?>
	<?php //echo $this->pagination->getResultsCounter(); ?>
<?php //echo $this->pagination->getPagesLinks( ); ?>
	<?php //echo $this->pagination->getLimitBox( ); ?>
	<?php //echo $this->pagination->getResultsCounter(); ?>
<!-- eof right -->
</div>
<div class="clear"></div>
</div>
</form>
<!-- eof container -->
<!--<div style="padding-top:15px;">
<div style="float:left"><a href="http://get.adobe.com/reader/" ><img src="http://www.adobe.com/images/shared/download_buttons/get_adobe_reader.gif" style="padding-left:30px; padding-top:20px;  vertical-align:middle" /></a></div>

<div class="alink0215">
<a href="http://get.adobe.com/reader/" >Download or update Adobe Reader to view your Proposal Reports</a></div>
<div class="clear"></div>
</div>-->
<?php } ?> 
<div id="boxescm" style="top:576px; left:582px;">
<div id="submitcm" class="windowcm" style="top:300px; left:582px; border:4px solid #8FD800; position:fixed; text-align:center">
<div float="right" style="float: right;position:absolute;top:-30px;right:-20px;position:absolute;top:-30px;right:-20px; cursor:pointer;" id="cancelcm"><img src="media/system/images/closebox.png"></div>
<div id="i_bar_terms">
<div id="i_bar_txt_terms" style="padding-top:8px; font-size:14px;">
<span style="font-size:14px;"> <font style="font-weight:bold; color:#FFF;">ERROR</font></span>
</div></div>
<div><p class="admindeletion">An Admin account can not be deleted unless there is another Admin account to reassign the deleted Admin's managers and properties to. Please contact MyVendorCenter support for assistance in creating another Admin account.</p>
</div>
<div style="padding-top:20px; text-align:center; display:inline-block;">
<div id="donecm" name="donecm" value="Ok" class="oknewsmall"></div>
</div>
</div>
  <div id="maskcm"></div>
</div>



<div id="boxesnan" style="top:576px; left:582px;">
<div id="submitnan" class="windownan" style="top:300px; left:582px; border:6px solid #609e00; position:fixed">
<div style="text-align:justify"><p class="namessagetext">Are you sure you want to delete this Manager's account forever?</p>
</div>
<div>
<div id="closenan"  name="closenan" value="Cancel"><img src="templates/camassistant_left/images/No.png" /></div>
<div id="donenan" name="donenan" value="Ok"><img src="templates/camassistant_left/images/Yes.png" /></div>
</div>
</div>
<form name="manager_deletion_free" id="manager_deletion_free" method="post">
<input type="hidden" name="option" value="com_camassistant">
<input type="hidden" name="controller" value="propertymanager">
<input type="hidden" name="task" value="reassignmanager_direct">
<input type="hidden" name="deletedid" id="managerid_free" value="">
</form>
  <div id="masknan"></div>
</div>