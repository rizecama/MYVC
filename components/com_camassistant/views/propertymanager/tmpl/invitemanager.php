<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');
JHTML::_('behavior.modal');
$pmanagers=$this->pmanagers;
$Itemid = JRequest::getVar("Itemid",0);
/*echo "<pre>";
print_r($_REQUEST);*/
$sortby = JRequest::getVar("sortby",0);

/*echo "<pre>";
print_r($pmanagers);
print_r($properties);exit;*/
?>
<link rel="stylesheet" media="all" type="text/css" href="/camassistant_new/components/com_camassistant/skin1/css/jquery1.css" />		
<script type="text/javascript" src="/camassistant_new/components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="/camassistant_new/components/com_camassistant/skin/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="/camassistant_new/components/com_camassistant/skin/js/jquery-ui-timepicker-addon.js"></script>

<script type="text/javascript" >
G = jQuery.noConflict();
function invitesubmit()
{
	var frm=document.invitemanager;
	 var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;

	if(frm.to.value == '')
 {
 alert('Please enter email address');
 frm.to.focus();
 return;
 } else if(reg.test(frm.to.value) == false) {
      alert('Invalid Email Address');
      return;
   } else if((reg.test(frm.cc.value) == false)&&(frm.cc.value!=''))
 {
 alert('Invalid Email Address');
 frm.cc.focus();
 return;
 } else if((reg.test(frm.bcc.value) == false)&&(frm.bcc.value!='')) {
      alert('Invalid Email Address');
	  frm.bcc.focus();
      return;
   }
  else if(frm.firmid.value == '0'){
  		G('body,html').animate({
		scrollTop: 250
		},800);
		var maskHeight = K(document).height();
		var maskWidth = K(window).width();
		G('#maskim').css({'width':maskWidth,'height':maskHeight});
		G('#maskim').fadeIn(100);
		G('#maskim').fadeTo("slow",0.8);
		var winH = G(window).height();
		var winW = G(window).width();
		G("#submitim").css('top',  winH/2-G("#submitim").height()/2);
		G("#submitim").css('left', winW/2-G("#submitim").width()/2);
		G("#submitim").fadeIn(2000);
		G('.windowim #doneim').click(function (e) {
		e.preventDefault();
		G('#maskim').hide();
		G('.windowim').hide();
		});
  }
   
   else {
frm.submit();
}
}
</script>

<script type="text/javascript">
  //Functio to verify taxid by sateesh on 03-08-11
  H = jQuery.noConflict();
var site='<?php echo JURI::root();?>';
var path='<?php echo addslashes(JPATH_SITE);?>';
var countyCount = 0;
H(document).ready(function(){
H("#managerinvite").click(function(){

		var email=H("#managerid").val();

		H.post("index2.php?option=com_camassistant&controller=propertymanager&task=verfiryemailid", {queryString: ""+email+""}, function(data){
		if(data == 'invalid' || data == 'notdefined'){
		var thirdline = 'This email already belongs to a current user on MyVendorCenter.  Please enter a different email address.';
 		alert(thirdline);
		document.invitemanager.elements['to'].value = '';
		return false;
		}
		if(data == 'notdefined'){
		 var thirdline = 'This email already belongs to a current user on MyVendorCenter.  Please enter a different email address.';
 		alert(thirdline);
		document.invitemanager.elements['to'].value = '';
		return false;
		}
		else
		{
		invitesubmit();
		}
			});
	});
H('.hidemanagers').click(function(){
	invid = H(this).attr('rel');
	H.post("index2.php?option=com_camassistant&controller=propertymanager&task=hideinvitation", {hideid: ""+invid+""}, function(data){
		if(data){		
		window.location.reload();
		}
	});
});
	});
  //Functio to verify taxid by sateesh on 03-08-11 completed
	</script>

<?php 
$db			=& JFactory::getDBO();
$mail_content_sql="SELECT introtext  FROM #__content where id='158' "; 
		$db->Setquery($mail_content_sql);
		$invite_manager = $db->loadResult();
		
$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$fname = $user->get('name');
		$lname = $user->get('lastname');
		$username = $fname. '&nbsp;'.$lname;
//echo "<pre>"; print_r($user);
		?>
<!-- sof bedcrumb -->
<div id="vender_right">

<!-- sof bedcrumb -->
<div id="bedcrumb" style="display:none">
<ul>
<li class="home"><a href="index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125">Home  </a></li><li><a href="index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119">My Managers & Properties</a> </li>
<li><a href="#"> Invite A New Manager</a> </li>
</ul>
</div>
<!-- eof bedcrumb -->
<form action="index.php?option=com_camassistant&controller=propertymanager&task=invitesubmit&Itemid=119"  method="post" name="invitemanager" enctype="multipart/form-data">

<!-- eof bedcrumb -->

<!-- sof dotshead -->
<p style="height:12px;"></p>
<!-- eof dotshead -->
<div id="i_bar">
<div id="i_bar_txt" style="font-size: 14px; padding-left: 40px; text-align: center; width: 598px;">
<span><strong>INVITE A MANAGER</strong>      </span>
</div>
<div id="i_icon"><a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=90&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" /> </a></div>
</div>

<!-- sof table pan -->


<!-- sof email pan -->
<div id="invite-popup" style="margin-top:20px; margin-left:17px; width:654px;">

<div class="invite-popup-main">
<div class="invite-popup-left">
<div class="red-arrow"><img width="10" height="20" alt="" src="templates/camassistant_left/images/red-arrow.jpg"></div>
<label>To:</label>
<input type="text" value="" name="to" id="managerid"  style="width:650px;" />
</div>
</div>


<div class="invite-popup-main">
<div class="invite-popup-left">
<div class="red-arrow"></div>
<label>CC:</label>
<input type="text" name="cc" style="width:650px;"/>
</div>
</div>


<div class="invite-popup-main">
<div class="invite-popup-left">
<div class="red-arrow"></div>
<label>BCC:</label>
<input type="text"  name="bcc" style="width:650px;"/>
</div>
</div>

<div class="invite-popup-main">
<div class="invite-popup-left">
<div class="red-arrow"></div>
<label>Subject:</label>
<input type="text" value="Please create an account with MyVendorCenter" name="subject" style="width:650px;"/>
</div>
</div>


<div class="invite-popup-main">
<label>Body:</label><br />
<?php 
$tags = array("<p>","</p>","<br>","<br />");
$rtags = array("","\n","\n","\n");
$hidden_invite_manager = str_replace($tags, $rtags, $invite_manager);
?>
<?php /*?><textarea id="notes" name="notes" readonly="readonly" style="width:643px; color:gray; height:300px; padding-left:4px; padding-right:4px;" ><?php echo $data ; ?></textarea><?php */?>
<div style="border:1px solid #F0F0F0; outline:1px solid #6D6D6D; width:645px; padding:4px;"><?php echo $invite_manager ; ?></div>
<textarea name="body" readonly="readonly"  style=" width:633px; display:none;"  ><?php echo $invite_manager; ?></textarea>
</div>

<div class="invite-popup-main">
<div class="invite-popup-left">
<div class="red-arrow"></div>
<label>Note:</label>
<textarea cols="60" rows="3" name="note" value="" style="min-height:100px; width:650px;"></textarea>
</div>
</div>


<?php 
if($user->accounttype == 'master'){
?>
<div class="invite-popup-main">
<div class="invite-popup-left" style="width:325px;">
<div class="red-arrow" style="top:21px;"><img width="10" height="20" alt="" src="templates/camassistant_left/images/red-arrow.jpg"></div>
<label>Please select the Company this manager works for:</label>
<select name="firmid" id="firmid" style="width:330px; height:27px; padding:2px;">
<option value="0">Select Company</option>
<?php
$firms = $this->cams; 
for( $f=0; $f<count($firms); $f++ ){
	echo "<option value=".$firms[$f]->firmid."> " .$firms[$f]->comp_name. " </option>";
}
?>
</select>
</div>
</div>
<?php } else { ?>
<input type="hidden" value="<?php echo $user->id; ?>" name="firmid" />
<?php } ?>
<div class="clear"></div>

<?php /*?><div class="restore_pan">
<a href="#">Restore Default Preferred Vendor Invitation Email</a>
</div><?php */?>
<!--<a href="javascript: invitesubmit()" style="float:right; margin-top:5px;"><img src="images/invirtea_newmanager.gif" alt="Invite a new manager"/></a>-->
<p style="height:5px;"></p>
<div class="clear"></div>
<br />

<div align="center">
<table align="center"><tr>
<td>
<a href="index.php?option=com_camassistant&controller=propertymanager&task=manage_properties&Itemid=119"><img src="templates/camassistant_left/images/CancelButton.gif" alt="Invite a new manager" id="" style="cursor:pointer" align=""/></a>
</td>
<td>
<a id="managerinvite"><img src="templates/camassistant_left/images/send.gif" alt="Invite a new manager" id="" style="cursor:pointer" align=""/></a>
</td>

</tr></table>
</div>

<div class="clear"></div>
</div>
<!-- eof email pan -->

<input type="hidden" name="option" value="com_camassistant" />
<input type="hidden" name="controller" value="propertymanager" />
<input type="hidden" name="task" value="invitesubmit" />
<input type="hidden" name="Itemid" value="119" />
<input type="hidden" name="user_id" value="<?php echo $user_id; ?>" />
<input type="hidden" name="username" value="<?php echo $username; ?>" />
</form>

</div>
<!-- eof container -->
<style>
#maskim {  position:absolute;  left:0;  top:0;  z-index:9000;  background-color:#000;  display:none;}
#boxesim .windowim {  position:absolute;  left:0;  top:0;  width:350px;  height:170px;  display:none;  z-index:9999;  padding:20px;}
#boxesim #submitim {  width:464px;  height:120px;  padding:10px;  background-color:#ffffff;}
#boxesim #submitim a{ text-decoration:none; color:#000000; font-weight:bold; font-size:20px;}
#doneim {border:0 none;cursor:pointer;height:30px;margin:0;padding:0;}
#closeim {border:0 none;cursor:pointer;height:30px;margin-left:57px;;padding:0; color:#000000; font-weight:bold; font-size:20px; float:left; width:134px; }
</style>
<div id="boxesim" style="top:576px; left:582px; ">
<div id="submitim" class="windowim" style="border:4px solid #8FD800; position:fixed">

<div style="padding-top:10px; text-align:center"><font color="gray">Please select the CamFirm that this Manager is associated with.  If the appropriate CamFirm is NOT listed in the dropdown menu, please <strong>contact support</strong>.</font>
</div>
<div style="padding-top:20px; text-align:center;">
<form name="edit" id="edit" method="post">
<div id="doneim" name="done1" value="Ok"><img src="templates/camassistant_left/images/ok.gif" /></div>
</form>
</div>
</div>
  <div id="maskim"></div>
</div>
<div class="clear"></div>

<BR /><BR />
<div id="i_bar_gray">
<div id="i_bar_terms_rfp">
<div id="i_bar_txt_terms_rfp">
<span> <font style="font-weight:bold; color:#FFF; font-size:14px">INVITED MANAGERS </font></span>
</div></div>
</div>

<?php
//echo "<pre>"; print_r($this->invitations); echo "</pre>";
$invitations = $this->invitations ;
?>

	<?php
	$sort = JRequest::getVar('sort','');
	if($sort == 'asc' || $sort == ''){
	$sort = 'desc';
	$id = 'compliant_desc';
	}
	else{
	$sort = 'asc';
	$id = 'compliant_asc';
	}
	?>
	
<div class="table_pannel">
<div class="table_panneldiv">
<table width="100%" cellspacing="4" cellpadding="0" class="titleheadings">
  <tbody><tr style="text-transform:none;" class="table_green_row">
<td width="222" valign="middle" align="left">
<?php
if($user->accounttype == 'master' && $user->user_type == '13'){
$itemid_s = '254';
}
else if($user->accounttype != 'master' && $user->user_type == '13'){
$itemid_s = '255';
}
?>
<a id="<?php echo $id; ?>" href="index.php?option=com_camassistant&controller=propertymanager&task=invitemanager&Itemid=<?php echo $itemid_s ; ?>&sort=<?php echo $sort ; ?>">EMAIL ADDRESS</a>
</td>
<td width="91" valign="middle" align="center">DATE</td>
<td width="110" valign="middle" align="center">STATUS</td>
<td width="57" valign="middle" align="right">HIDE</td>
  </tr>
</tbody></table>
<table width="99%" cellspacing="4" cellpadding="0" style="margin:0px 4px">
<tbody>
<?php for( $in=0; $in<count($invitations); $in++ ){ ?>
<tr style="height:45px;" class="table_blue_rowdots" id="table_blue_rowdots345406">
<td width="222" valign="middle" align="left" style="padding-top:1px;"><?php echo $invitations[$in]->reciever ; ?></td>
<td width="91" valign="middle" align="center" style="padding-top:3px;">
<?php 
$date = explode(' ',$invitations[$in]->senttime) ;
$lastdate = explode('-',$date[0]);
$finaldate = $lastdate[1].'/'.$lastdate[2].'/'.$lastdate[0] ;
echo $finaldate ;
 ?></td>
<td width="110" valign="middle" align="center" style="padding-top:3px;">
<?php if($invitations[$in]->managerid == '0') echo '<span style="margin-right:3px;">Pending</font>'; ?>
<?php if($invitations[$in]->managerid != '0') echo '<span style="color:green; margin-right:3px;">Accepted</font>'; ?>
</td>
<td width="57" valign="middle" align="right" style="padding-top:3px;">
<a title="Hide from list" class="hidemanagers" href="javascript:void(0);" rel="<?php echo $invitations[$in]->id; ?> "><img src="templates/camassistant_left/images/Hide.png" alt="delete" style="margin-right:6px;"></a>
</td>
</tr>
<?php } ?>
</tbody></table>
</div>
</div>

