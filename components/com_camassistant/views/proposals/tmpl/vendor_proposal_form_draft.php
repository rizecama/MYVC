<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright ? 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access

defined('_JEXEC') or die('Restricted access');
JHTML::_('behavior.modal');
$toolTipArray = array('className'=>'tool');
JHTML::_('behavior.tooltip', '.hasTip2', $toolTipArray);
$id = JRequest::getVar('id','');
$notinterested = JRequest::getVar('not_interested','');
$type = JRequest::getVar('type','');
$Alt_bid = JRequest::getVar('Alt_bid','');
//echo '<pre>'; print_r($this->TASKS_details);
$Form_status = $this->Form_status;
if($Form_status == 'ITB')
$Form_status = "Unsubmitted";
$Form_bidded_date = $this->Form_bidded_date;
$RFP = $this->RFP_details;

$TASKS = $this->TASKS_details;
$DOCS = $this->DOCS_details;
$TASKS_DOCS = $this->Tasks_DOCS_details;
//$SPL_REQ_DETAILS = $this->SPLRequirements_details;
$cat = $this->SPLReq_Category;
$SPL_REQ_TABS = $this->SPL_REQ_tabs;
/*$main = $SPL_REQ_DETAILS['main'];
$sub = $SPL_REQ_DETAILS['sub'];
$child = $SPL_REQ_DETAILS['child'];
*/
$Review_reqCatList = $this->SPLRequirements_details;
//$cat = $this->SPLReq_Category;
$cat = $Review_reqCatList['main'];
$main = $Review_reqCatList['main'];
$sub = $Review_reqCatList['sub'];
$child = $Review_reqCatList['child'];
$child_price=array();
//echo "<pre>"; print_r($DOCS);
$price_cnt=0;
 for($i=0; $i<count($TASKS); $i++)
 {
 if($TASKS[$i]->is_req_taskvendors == 1)  $price_cnt = $price_cnt+1;
 }
//echo '<pre>'; print_r($SPLReq_Category); echo '_______________________<br/>'; print_r($main); print_r($sub); print_r($child); exit;
//echo '<pre>'; print_r($child);
?>
<script type="text/javascript" src="components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script language="javascript" type="text/javascript">
//function to save as ITB

L = jQuery.noConflict();


function ITB_save() {

//Checkbox validation
var formname = document.vendor_proposal_form;
/*if(formname.i_agree.checked == false)
	{
		alert('Accept Terms and Conditions.');
		formname.i_agree.focus();
		L('html, body').animate({
    scrollTop: L("#i_agree").offset().top
}, 2000);

		return false;
	}*/
//Completed
L('body,html').animate({
scrollTop: 250
},800);
		//Cancel the link behavior
		//Get the A tag
		//Get the screen height and width
		var maskHeight = L(document).height();
		var maskWidth = L(window).width();

		//Set heigth and width to mask to fill up the whole screen
		L('#mask1').css({'width':maskWidth,'height':maskHeight});
		//transition effect
		L('#mask1').fadeIn(100);
		L('#mask1').fadeTo("slow",0.8);
		//Get the window height and width
		var winH = L(window).height();
		var winW = L(window).width();
		//Set the popup window to center
		//L("#submit1").css('top',  '250');
		//L("#submit1").css('left', '582');
		L("#submit1").css('top',  winH/2-L("#submit1").height()/2);
		L("#submit1").css('left', winW/2-L("#submit1").width()/2);
		
		L("#submit1").fadeIn(2000);

		L('.window1 #done1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();
		var frm = document.vendor_proposal_form;
		var con_name= document.getElementById('con_name_this_project').value;
		//alert(con_name);
		 document.getElementById('contact_name').value= con_name;
		if(con_name==''){
		alert('Please Enter Contact Name For This Project');
		} else {
		frm.submit_type.value = 'ITB';
		frm.task.value = 'Proposal_save_as_ITB';
		frm.submit();
		}
		//window.location = "index.php?option=com_camassistant&controller=rfp&task=editrfp&rfpid="+id+"&Itemid=87"
	});
}


L(document).ready(function() {


	//if close button is clicked
	L('.window1 #close1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();

		L('#mask1').hide();
		L('.window1').hide();

	});

	//if done button is clicked
	L('.window1 #done1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();

	});



});


L(document).ready(function(){
	L('#declineinvitation').click(function (){
		
		rfpid = L('#declineinvitation').attr('rel');
		el='<?php  echo Juri::base(); ?>index.php?option=com_camassistant&controller=proposals&task=reasondecline&rfpid='+rfpid;
		var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 600, y:410}}"))
		SqueezeBox.fromElement(el,options);
	});
});
</script>
<script type="text/javascript">
function getalert(){
alert("You must submit your Intent to Bid in order to begin filling out this proposal form.");
}
</script>
<style>
#mask1 {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#000;
  display:none;
}

#boxes1 .window1 {
  position:absolute;
  left:0;
  top:0;
  width:350px;
  height:150px;
  display:none;
  z-index:9999;
  padding:20px;
}


#boxes1 #submit1 {
  width:360px;
  height:235px;
  padding:10px;
  background-color:#ffffff;
}
#boxes1 #submit1 a{
 text-decoration:none;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}
#close1 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
float:left;
width:160px;
/*background:url(templates/camassistant/images/yes.gif) no-repeat;
*/
}
#done1 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}
</style>
<div id="boxes1">
<div id="submit1" class="window1" style="top:250px; left:582px;border:4px solid #8FD800; position:fixed;">
<div id="i_bar_terms">
<div id="i_bar_txt_terms">
<span> <font style="font-weight:bold; color:#FFF;">INVITATION ACCEPTANCE</font></span>
</div></div>
<div style="text-align:center"><font color="gray">Please confirm you would like to provide a proposal for this request by providing a contact name and clicking on SUBMIT</font><br/><br />
<strong><img src="templates/camassistant_left/images/RequiredArrow.png" />&nbsp;Contact Name for this Project:</strong><br /><br />
<input type="text" name="con_name_this_project" id="con_name_this_project" value="">
</div>
<br />
<div style="padding-top:10px; text-align:center;">
<form name="edit" id="edit" method="post">
<div id="close1" style="width:158px; margin-left:21px;" name="close1" value="Cancel"><img src="templates/camassistant_left/images/cancel.png" /></div></div>
<div id="done1" style="width:380px;" name="done1" value="Ok"><img src="templates/camassistant_left/images/submit.png" /></div>
</form>
</div>
  <div id="mask1"></div>
</div>
<script type="text/javascript" >
E = jQuery.noConflict();
function format_val(id,fieldname,fieldvalue){
E.post("index2.php?option=com_camassistant&controller=proposals&task=vendor_proposal_edit_format_val", {id: ""+id+"",fieldname: ""+fieldname+"",fieldvalue:""+fieldvalue+""}, function(data){
if(data.length >0) {
var x= fieldname+id;
E("#"+fieldname+id).val(data);
//E("#task_price1").val(data);
}
});
}
//Ajax function to calculate commission on vendor bidding amount
function createXMLHttpRequest()
{
	try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
	try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) {}
	try { return new XMLHttpRequest(); } catch(e) {}
	alert("XMLHttpRequest not supported");
	return null;
}
var xhReq = createXMLHttpRequest();
function getcommission()
{

	var site='<?php echo JURI::root();?>';
	var path='<?php echo addslashes(JPATH_SITE);?>';
	var is_task_price='<?php echo $price_cnt;?>';
	if(is_task_price != 0)
	{
	/*if(document.getElementById('total_lineitem_pricing').value == '')
	document.getElementById('total_lineitem_pricing').value = 0.00;
	if(document.getElementById('other_items_price').value == '')
	document.getElementById('other_items_price').value = '';*/
	var notcomma_added = document.getElementById('total_lineitem_pricing').value.replace(/,/g, '');
	var notcomma_other = document.getElementById('other_items_price').value.replace(/,/g, '');
	document.getElementById('total_price').value = parseInt(notcomma_added) + parseFloat(notcomma_other);
	var amnt = document.getElementById('total_price').value;
	var added  =document.getElementById('total_lineitem_pricing').value;
	}
	else
	{
	/*if(document.getElementById('other_items_price').value == '')
	document.getElementById('other_items_price').value = 0.00;*/
	var amnt = document.getElementById('other_items_price').value;
	}
	var other  =document.getElementById('other_items_price').value;
	xhReq.open("GET", site+"components/com_camassistant/helpers/ajax_commision.php?other="+other+"&added="+added+"&c2="+amnt+"&path="+path, true);
	xhReq.onreadystatechange = onSumcommision;
	xhReq.send(null);
}
function onSumcommision()
{
	if (xhReq.readyState != 0 && xhReq.readyState != 4)  { return; }
	var serverResponse = xhReq.responseText;
	var splitIt = serverResponse.split("AND");
	document.getElementById('commisions').value = splitIt[0];
	document.getElementById('total_price').value = splitIt[1];
	document.getElementById('total_lineitem_pricing').value = splitIt[2];
	document.getElementById('other_items_price').value = splitIt[3];
	//alert(document.getElementById('commisions').value)
}

// function to calculate line tasks prices
function update_price(val)
{
    var frm = document.vendor_Edit_proposal_form;
	var tasks_chks = document.getElementsByName('task_price[]');
	var downloads_chks = document.getElementsByName('downloads_price[]');
	//(downloads_chks.length);
	//alert(tasks_chks.length);
	var other_price = document.getElementById('other_items_price');
	var line_item_price = document.getElementById('total_lineitem_pricing');
	var total_price = document.getElementById('total_price');
	var tasks_total = 0;
         for (var i = 0; i < tasks_chks.length; i++)
         {
		 	 var comma_val = tasks_chks[i].value;
		     tasks_chks[i].value = tasks_chks[i].value.replace(/,/g, '');
		 	 if(tasks_chks[i].value != '')
		 	 tasks_total = parseFloat(tasks_total) + parseFloat(tasks_chks[i].value);
			 tasks_chks[i].value = comma_val;
         }
	//alert(tasks_total);
	var downloads_total = 0;
	if(downloads_chks.length>0)
	{
		 for (var i = 0; i < downloads_chks.length; i++)
         {
		 	 var comma_val = downloads_chks[i].value;
		     downloads_chks[i].value = downloads_chks[i].value.replace(/,/g, '');
		 	 if(downloads_chks[i].value != '')
		 	 downloads_total = parseFloat(downloads_total) + parseFloat(downloads_chks[i].value);
			 downloads_chks[i].value = comma_val;
         }
	}
	//alert(tasks_total);
	line_item_price.value = parseFloat(tasks_total) + parseFloat(downloads_total);
	//alert(line_item_price.value);
	/*if(other_price.value == '')
	other_price.value = 0.00;
	line_item_price.value = line_item_price.value.replace(',', '');
	other_price.value = other_price.value.replace(',','');
	total_price.value = parseFloat(line_item_price.value) + parseFloat(other_price.value);*/
	getcommission();
}


//function to save form as draft
function fun_saveasdraft()
{
var frm = document.vendor_proposal_form;
var tasks_chks = document.getElementsByName('task_price[]');
	/* for (var i = 0; i < tasks_chks.length; i++)
         {
		 	 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }	*/

	if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
frm.submit_type.value = 'Draft';
frm.task.value = 'Proposal_save_as';
frm.submit();
}

//function to save form as submit
function fun_saveassubmit()
{
var frm = document.vendor_proposal_form;
var tasks_chks = document.getElementsByName('task_price[]');
	 for (var i = 0; i < tasks_chks.length; i++)
         {
		 	  //if(tasks_chks[i].value == '' || tasks_chks[i].value == '0.00')	validation for empty, $0 values
			 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	// if(downloads_chks[i].value == '' || downloads_chks[i].value == '0.00')	validation for empty, $0 values
			 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }

	if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
frm.submit_type.value = 'Submit';
frm.task.value = 'Proposal_save_as';
frm.submit();
}
//function to save Alt form as draft
function Alt_saveasdraft()
{
var frm = document.vendor_proposal_form;
var tasks_chks = document.getElementsByName('task_price[]');
	/* for (var i = 0; i < tasks_chks.length; i++)
         {
		 	 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }	*/
	if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
frm.Alt_bid.value = 'yes';
frm.submit_type.value = 'Draft';
frm.task.value = 'Proposal_save_as';
frm.submit();
}

//function to save Alt form as submit
function Alt_saveassubmit(act)
{
var frm = document.vendor_proposal_form;
var tasks_chks = document.getElementsByName('task_price[]');
	 for (var i = 0; i < tasks_chks.length; i++)
         {
		 	  //if(tasks_chks[i].value == '' || tasks_chks[i].value == '0.00')	validation for empty, $0 values
			 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	 // if(downloads_chks[i].value == '' || downloads_chks[i].value == '0.00')	validation for empty, $0 values
			 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
frm.submit_type.value = act;
frm.Alt_bid.value = 'yes';
frm.task.value = 'Proposal_save_as';
frm.submit();
}
/////Automatic commas in price

</script>
<script type="text/javascript">
PO = jQuery.noConflict();
function getpopup(){
    PO('body,html').animate({
scrollTop: 250
},800);
var maskHeight = PO(document).height();
		var maskWidth = PO(window).width();
		//Set heigth and width to mask to fill up the whole screen
		PO('#maskp').css({'width':maskWidth,'height':maskHeight});
		//transition effect
		PO('#maskp').fadeIn(100);
		PO('#maskp').fadeTo("slow",0.8);
		//Get the window height and width
		var winH = PO(window).height();
		var winW = PO(window).width();
		//Set the popup window to center
		//PO("#submitp").css('top',  '300');
		//PO("#submitp").css('left', '582');
		PO("#submitp").css('top',  winH/2-PO("#submitp").height()/2);
		PO("#submitp").css('left', winW/2-PO("#submitp").width()/2);
		
		PO("#submitp").fadeIn(2000);

		PO('.windowp #donep').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		PO('#maskp').hide();
		PO('.windowp').hide();
		Alt_saveasdraft(act);

	});
}
</script>
<style>
#maskp {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#000;
  display:none;
}

#boxesp .windowp {
  position:absolute;
  left:0;
  top:0;
  width:1300px;
  height:150px;
  display:none;
  z-index:9999;
  padding:38px 10px 3px 10px;
}


#boxesp #submitp {
  width:294px;
  height:111px;
  padding:10px;
  background-color:#ffffff;
}
#boxesp #submitp a{
 text-decoration:none;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}
#donep {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
}
#closep {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding-right:107px;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}

</style>
<script type="text/javascript">     
function PrintDiv() {    
	/*document.getElementById("bedcrumb").style.display = 'none';
	document.getElementById("topborder_row").style.display = 'none';
	document.getElementById("header").style.display = 'none';
	document.getElementById("navbar_in").style.display = 'none';
	document.getElementById("vender_left").style.display = 'none';
	document.getElementById("footer").style.display = 'none';
	document.getElementById("vender_right2").style.width = '907px';
	document.getElementById("vender_right2").style.marginTop = '170px';	
	window.print();
	document.getElementById("bedcrumb").style.display = '';
	document.getElementById("topborder_row").style.display = '';
	document.getElementById("header").style.display = '';
	document.getElementById("navbar_in").style.display = '';
	document.getElementById("vender_left").style.display = '';
	document.getElementById("footer").style.display = '';
	document.getElementById("vender_right2").style.width = '673px';	
	document.getElementById("vender_right2").style.marginTop = '';*/	
	var divToPrint = document.getElementById('vender_right2');
	document.getElementById("topborder_row").style.display = 'none';
    var popupWin = window.open('', '_blank', 'width=600,height=600');
    popupWin.document.open();
    popupWin.document.write('<html><body onload="window.print()">' + divToPrint.innerHTML + '</html>');
	document.getElementById("topborder_row").style.display = '';
    popupWin.document.close();
	setTimeout(function(){popupWin.close();},1000); 
		
		}				
</script>
<div id="boxesp">
<div id="submitp" class="windowp" style="top:300px; left:582px; border:4px solid #8FD800; position:fixed;">
<br/>
<p style="color:gray">This file is available after submitting your <strong>Intent to Bid</strong></p>
<div style="padding-top:10px; text-align:center;">
<form name="edit" id="edit" method="post">
<div id="donep"  name="donep" value="Ok"><img src="templates/camassistant_left/images/ok.gif" /></div>
</div>
</form>

</div>
  <div id="maskp"></div>
</div>
<?php
		$user =& JFactory::getUser();
		$user_id = $user->get('id');

		if(!$user_id) {
		echo "<div align='center' style='color:#21314D; font-size:15px'>Please login into the site .</div>";
		}
		else{

?>
<form name="vendor_proposal_form" method="post" action="index.php?option=com_camassistant&controller=proposals&rfp_id=1"/>
<div id="vender_right2">
<!-- sof bedcrumb -->
<?php /*?><div id="bedcrumb">
<ul>
<li class="home"><a href="#">Home  </a></li><li><a href="#"> RFP Response - Proposal  <?PHP //echo $RFP->id  ?></a> </li>
</ul>
</div><?php */?>
<!-- eof bedcrumb -->

<!-- sof dotshead -->
<?PHP if($Form_status != ''){ $st = ' - STATUS: '. $Form_status.'&nbsp;'.$Form_bidded_date; } ?>
<!--<div class="green-heading" id="dotshead_green">PROPOSAL FORM - <?PHP if($Form_status == '') echo $RFP->industry_name; else echo $RFP->projectName.$st;  ?> <a style="float:right;" href="javascript:PrintDiv();">Printer Friendly Version</a></div>-->
<!-- eof dotshead -->
<div align="center" id="instructionsprint">
<table><tr>
<?php /*?><td><a href="javascript:history.go(-1)"><img src="templates/camassistant_left/images/GoBack.gif" alt="Cancel" style="vertical-align:middle; padding-right:0px;"/></a></td><?php */?>
<td><a class="createnewrequest" id="printicon_proposals" href="javascript:PrintDiv();"></a></td></tr></table></div>
<div id="i_bar_gr">
<div id="i_bar_txt_proposalform" style="padding-left:3px; width:632px; text-align:center;">
<span style="padding-left:45px;"><?PHP  echo strtoupper($RFP->projectName) ; //else echo strtoupper(str_replace('_',' ',$RFP->property_name)); ?>  </span></div>
<!--<div id="i_icon"><a href="#"><img src="templates/camassistant_left/images/info_icon2.png" alt="info" /></a></div>-->
<!--<span class="hasTip2"   title="Info :: SEMINOLE PALMS HOMEOWNERS ASSOCIATION ."> <img alt="info" style="padding-top:5px;" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/info_icon2.png"></span>-->
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=93&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" style="margin-top:4px;"> </a>
</div>
<?php
$rfp_id = JRequest::getVar('rfp_id','');
$db =& JFactory::getDBO();

$property_details="SELECT property_id FROM #__cam_rfpinfo where id='".$rfp_id."'";
$db->Setquery($property_details);
$property_id = $db->loadResult();


$property_details="SELECT property_name,tax_id,zip FROM #__cam_property where id='".$property_id."'";
$db->Setquery($property_details);
$property = $db->loadObject();

 $pr_manager = "SELECT property_manager_id FROM #__cam_property WHERE id ='".$property_id."'";
		$db->Setquery($pr_manager);
		$property_manager_id = $db->loadResult();

		$p_manager = "SELECT name,lastname,phone,extension,email FROM #__users WHERE id = '".$RFP->cust_id."'";
		$db->Setquery($p_manager);
		$property_manager_detail = $db->loadObjectList();
        ?>

<!-- sof table pan -->
<div class="table_pannel">
<div class="head_bluebg3"><!--sof rfp box-->
<?PHP if($Form_status != '') { ?>
    <div id="rpf_ifo" style="margin-top:0px;" >
    

	<div id="i_bar_gr" style="margin-bottom:6px;">
<div id="i_bar_txt_smalli" style="text-align:center;">
<span style="padding-left:0px;">CONTACT INFO</span></div>
</div>
<div id="rpf_ifo_text">
<br><font style="margin-top: 5px; color: #07183E; font-size: 12px;    font-weight: bold;">Property Manager:</font><br />
<?PHP echo $property_manager_detail[0]->name;  ?> <?PHP echo $property_manager_detail[0]->lastname;  ?><br />
<?php if ($RFP->showphone=='0') { ?>
P: <?PHP echo $property_manager_detail[0]->phone;  ?> (x<?PHP echo $property_manager_detail[0]->extension;  ?>)<br />
<?php } ?>
<?php if ($RFP->showemail=='0') {?>
<a href="mailto:<?PHP echo $property_manager_detail[0]->email;  ?>">Email Property Manager</a><br />
<?php } ?>
<h1>Property Management Company:</h1>
<?php if ($RFP->showcompany=='0') {?>
<span class="companyname_big"><?PHP echo $RFP->comp_name;  ?></span>
<?php } ?>
<?php if ($RFP->showaddress=='0') {?>
<?PHP echo $RFP->mailaddress;  ?><br />
<?PHP echo $RFP->comp_city;  ?>, <?PHP echo $RFP->comp_state;  ?> <?PHP echo $RFP->comp_zip;  ?><br />
<?php } ?>
<?php if ($RFP->showphone=='0') { ?>
P: <?PHP echo $RFP->comp_phno;  ?><br />
<?php } ?>
<?php if ($RFP->showfax=='0') {?>
Alt. Phone: <?PHP echo $RFP->comp_alt_phno;  ?><br />
<?php } ?>
<a href="http://<?PHP echo $RFP->comp_website;  ?>" target="_blank"><?PHP echo $RFP->comp_website;  ?></a>


    </div>
	</div>
	 <?PHP } ?>
<!--eof rfp box--><?PHP  //if($Form_status == '') echo ''; else {echo $RFP->projectName.' - '.$RFP->industry_name.'- RFP# '.sprintf('%06d', $RFP->id);}    ?>
 </div>
 <?php
$db=JFactory::getDBO();
$bid_text = "SELECT introtext FROM #__content WHERE id=203";
		$db->setQuery($bid_text);
		$bidtext = $db->loadResult();
		//echo $bidtext;

		$sql = 'SELECT County FROM #__cam_counties WHERE id = '.$RFP->divcounty;
		$db->Setquery($sql);
		$county = $db->loadResult();
?>

</div>


<?php
$db=JFactory::getDBO();
$pimage = "SELECT property_image FROM #__cam_property WHERE id='".$property_id."' ";
$db->Setquery($pimage);
$filename = $db->loadResult();
if( $filename ) {
		$path2 = $siteURL."components/com_camassistant/assets/images/property_pictures/";
		$path1 = $filename;
		$image = $path2.$path1;	
		$image = str_replace(' ','%20',$image);
		$apath= getimagesize($image);
		$height_orig=$apath[1];
		$width_orig=$apath[0];
		$aspect_ratio = (float) $height_orig / $width_orig;
		$thumb_width =435;
		$thumb_height = round($thumb_width * $aspect_ratio) ;
		if($thumb_height == 0){
		$thumb_height = '300';
		}		
		$image = "<img  width=".$thumb_width." height=".$thumb_height." src='components/com_camassistant/assets/images/property_pictures/".$filename."'>";
		}	
else{
$image = '<div style="margin-left: 2px;">
<div style="margin-top:-10px; display:table-cell; text-align:center; vertical-align:middle; width:432px; height:298px; box-shadow:1px 1px 2px 1px #808080; font-size:14px;">
No Image available for this Property.</div></div>';
$cleamsg = '<div class="clear"></div><p style="height:20px"></p>';
}		
echo $image ;
?>
<div class="clear"></div>
<br />
<?php echo $cleamsg; ?>
<div class="clear"></div>
<div id="i_bar_gr">
<div id="i_bar_txt_proposalform" style="text-align:center; width:666px;">
<span style="padding-left:0px; font-size:13px;">BASIC INFORMATION</span></div>
</div>

  <div class="proposal_form">
  <table cellpadding="0" cellspacing="0">
  
  <tr><td><strong>Request #:</strong>&nbsp;&nbsp;<?PHP echo $RFP->id;  ?></td></tr>
  <tr><td><strong>Property Name:</strong>&nbsp;&nbsp;<?php echo str_replace('_',' ',$property->property_name); ?></td></tr>
  <tr><td><strong>Requested Due Date:</strong>&nbsp;&nbsp;
  <?PHP
$main = explode('-',$RFP->proposalDueDate);
$date = $main[2].'-'.$main[0].'-'.$main[1];
$newdate = strtotime ( '-1 day' , strtotime ( $date ) ) ;
//$RFP->proposalDueDate = date ( 'm-d-Y' , $newdate ); ?>
<font style="font-weight:normal;"><?php echo $RFP->proposalDueDate.',&nbsp;'.$RFP->proposalDueTime;  
?></font>
  </td></tr>
  <tr><td><strong>Street Address:</strong>&nbsp;&nbsp; <?PHP echo $RFP->street;  ?></td></tr>    
<tr><td><strong>City:</strong>&nbsp;&nbsp;<font style="font-weight:normal;"><?PHP echo $RFP->city;  ?></font></td></tr>
<tr><td><strong>State:</strong>&nbsp;&nbsp;<font style="font-weight:normal;"><?PHP echo $RFP->state;  ?></font></td></tr>
<tr><td><strong>Zip:</strong>&nbsp;&nbsp;<?PHP echo $property->zip;  ?></td></tr>
<tr><td><strong>Number Of Units:</strong>&nbsp;&nbsp;<font style="font-weight:normal;"><?PHP echo $RFP->units_text;  ?></font></td></tr>
<tr><td><strong>Site Visit:</strong>&nbsp;&nbsp;<?php echo $RFP->site_visit; ?></td></tr>
<tr><td>&nbsp;</td></tr>
  </table>

<br /><br />


<div id="i_bar_gr">
<div style="text-align:center; width:666px;" id="i_bar_txt_proposalform">
<span style="padding-left:0px; font-size:13px;">SCOPE OF WORK</span></div>
</div>


<!--<span class="blue_small">STATEMENT OF WORK:</span><br />
<br />-->

<?PHP $i=1;  $price_cnt=0;

 foreach($TASKS as $linetaks){ ?>
<!--  sof line item pan -->
<?php //echo "<pre>"; print_r($linetaks->taskuploads); ?>
<div id='line_task<?php echo $linetaks->task_id; ?>'>
<div class="lineitem_pan_row"><span class="grey_12" style="font-size:15px;"><strong>Line Item #</strong><?PHP echo $i; ?>:</span>
<div class="lineitem_pan"><strong>Name: </strong><?php  if($linetaks->linetaskname){ echo $linetaks->linetaskname; } ?>
<?php /*?><div style="border-top:1px solid #CDCDCD;  padding: 4px 0;"><strong>Frequency: </strong><?php  if($linetaks->rfpreference=='Frequency'){ echo "N/A"; } else{ echo $linetaks->rfpreference; } ?></div><?php */?>
<div  style="border-top:1px solid #CDCDCD;  padding: 4px 0; text-align:left" ><strong>Description: </strong><?php echo nl2br($linetaks->task_desc); ?></div>
<?php /*?>modified by anand kumar 25-7-11<?php */?>
<?php if($linetaks->taskuploads){ ?>
<?php $path=JURI::base();
$link= $path.$linetaks->taskuploads;
$default = 'components/com_camassistant/doc/';
 $uploaded_file= str_replace(' ','',$linetaks->taskuploads);
$p_name= str_replace(' ','_',$property->property_name);
$uploads=explode('/',$uploaded_file);
$upcount=count($uploads);
$uploads[$upcount-1] = str_replace(' ','',$uploads[$upcount-1]);
//$uploads=explode('/',$uploaded_file);
if($uploads[0]=='components' && $uploads[1]=='com_camassistant' && $uploads[2]=='doc' ){
 $file_link = $uploaded_file;
 } else {
 $file_link = $default.$p_name.'_'.$property->tax_id.'//'.$uploaded_file;
 }
//$file_link = $default.$p_name.'_'.$property->tax_id.'//'.$uploaded_file;



//print_r($link);?>
<!--<a href="index.php?option=com_camassistant&controller=popupdocs&task=open&title=<?php print_r($uploads[$upcount-1]); ?>&path=<?php print_r($file_link); ?> "><img src="templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a>-->

<?php } ?>
<?php JHTML::_('behavior.modal'); ?>
<div style="border-top:1px solid #CDCDCD;   padding: 4px 0;">
<?php /*?>modified by anand kumar 25-7-11<?php */?>

<span style="text-align:left;width:300px;"><strong>Require itemized pricing for this line item:</strong> <?php  if($linetaks->is_req_taskvendors=='1'){ echo"Yes"; }else{ echo"No";  } ?></span>

<table>
    <?php $uploads= explode(',',$linetaks->taskuploads );
    if(count($uploads)>0 && count($linetaks->taskuploads)>0 ){
         for ($l=0;$l<count($uploads);$l++){  ?>
    <?php  $uploads1=explode('/',$uploads[$l]);
       if($uploads[$l] && $uploads[$l]!=' '){  ?>

<?php $uploads23=explode('/',$uploads[$l]);
 // $uploads=explode('/',$linetaks->taskuploads); $upcount=count($uploads);
	if($uploads23[0]=='components' && $uploads23[1]=='com_camassistant' && $uploads23[2]=='doc' ){
 $file_link = str_replace(' ','',$uploads[$l]);
 } else if($uploads23[0]=='components' && $uploads23[1]=='com_camassistant' && $uploads23[2]=='assets' ){
     $file_link = str_replace(' ','',$uploads[$l]);
 } else {
 $file_link = $default.$p_name.'_'.$property->tax_id.'//'.str_replace(' ','',$uploads[$l]);
 }
// $file_link = $default.$p_name.'_'.$property->tax_id.'//'.$linetaks->taskuploads;
  $file_link= str_replace('// ','//',$file_link); 
  $var = JRequest::getVar('var','');
  $new_rfpid = JRequest::getVar('rfpid','');
	if($var == 'copy'){
		$propertd="SELECT old_propertyid FROM #__cam_copyrfp where new_rfpid='".$new_rfpid."'";
		$db->Setquery($propertd);
		$newpid = $db->loadResult();
		$property_details="SELECT property_name,tax_id FROM #__cam_property where id='".$newpid."'";
		$db->Setquery($property_details);
		$property_new = $db->loadObject();
		$file_link = $default.str_replace(' ','_',$property_new->property_name).'_'.$property_new->tax_id.'//'.str_replace(' ','',$uploads[$l]);
	}
	?>
    <!-- <div class="downloadfile<?php echo $i.($l+1); ?>" id="downloadfile<?php  echo $i.($l+1); ?>" style="width:660px;"> -->
   <?php $upcount=count($uploads1);//if() ?>
       <tr class="downloadfile<?php echo $i.($l+1); ?>" id="downloadfile<?php  echo $i.($l+1); ?>"> <td></td>&nbsp;<td> <a href="index2.php?option=com_camassistant&controller=popupdocs&task=open&title=<?PHP echo str_replace(' ','',$uploads1[$upcount-1]); ?>&path=<?PHP echo $file_link; ?>"><img src="templates/camassistant_left/images/green.png" alt="download file" align="absmiddle" style="float:left;"/></a></td>&nbsp;
<td>
<span id='upload_file<?php echo $i.($l+1); ?>' style="float:left;width:auto;"><?php  if($uploads1[$upcount-1]) { ?>
<td><span style="float:left;width:auto; padding-right:5px; color:#8FD800; font-size:14px;"><a style="text-decoration:none; color:#8FD800" href="index2.php?option=com_camassistant&controller=popupdocs&task=open&title=<?PHP echo str_replace(' ','',$uploads1[$upcount-1]); ?>&path=<?PHP echo $file_link; ?>"><?php echo $uploads1[$upcount-1] ?></a></span></td><?php 
} else {?> &nbsp;&nbsp;
<a href="javascript:addEventa2(<?php echo $i; ?>);"><img alt="upload a file" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/uploadfile.gif"></a>
<?php }?>&nbsp;&nbsp;</span><input type="hidden"   value="<?php echo $uploads[$l];?>" name="linetask_uploads_2<?php  echo $i; ?>[]" id="line_uploads<?php echo $i.($l+1); ?>"  ></tr>

    <?php  } } }
    //}
?></table>

</div>
</div></div>
</div>
<br /><br />
<!-- eof line item pan -->
<?php $i++; } ?>

<?php /*?><?PHP
//RFP tasks_docs download option
for($T=0; $T<count($TASKS_DOCS); $T++)
{ if($TASKS_DOCS[$T]->taskuploads != '') {?>
<!-- sof line item pan -->
<div class="downloadfile">
<span class="grey_12">Line Items Files #<?PHP echo $T+1; ?>:</span><br />

<a href="index2.php?option=com_camassistant&controller=popupdocs&task=open&title=<?PHP echo $TASKS_DOCS[$T]->title; ?>&path=<?PHP echo $TASKS_DOCS[$T]->taskuploads; ?>"><img src="templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a> <strong><?PHP echo $TASKS_DOCS[$T]->title;?></strong></div>
<div class="clear"></div>
<!-- eof line item pan -->
<?PHP } } ?>
<div class="clear"></div><?php */?>
<div id="newdiv"></div>	 <input name="hidden" type="hidden" id="theValue" value="0">
<?PHP if($DOCS[0]->doc_path){ ?>	<div class="head_greenbg2"><strong>Additional Document/Specifications:</strong></div> <?PHP } ?>
<?PHP
//RFP doc's download option
//echo "<pre>"; print_r($DOCS);

if($DOCS[0]->doc_path){
for($j=0; $j<count($DOCS); $j++)
{
//echo "<pre>"; print_r($DOCS );
//if($DOCS[$j]->doc_path>0) {
//print_r($DOCS[$j]); ?>
<div class="downloadfile">
<span class="grey_12"><strong>Additional Document/Specification #</strong><?PHP echo $j+1; ?>:</span><br />
<?php
$uploads=explode('/',$DOCS[$j]->doc_path);
$upcount=count($uploads);
$default = 'components/com_camassistant/doc/';
$DOCS[$j]->doc_path = str_replace(' ','',$DOCS[$j]->doc_path);
if($uploads[0]=='components' && $uploads[1]=='com_camassistant' && $uploads[2]=='doc' ){
 $file_link = $DOCS[$j]->doc_path;
 } else {
 $file_link = $default.str_replace(' ','_',$property->property_name).'_'.$property->tax_id.'/'.$DOCS[$j]->doc_path;
 }
//$file_link = $default.str_replace(' ','_',$property->property_name).'_'.$property->tax_id.'/'.$DOCS[$j]->doc_path;
?>
<!--<a href="index.php?option=com_camassistant&controller=popupdocs&task=open&title=<?php print_r($uploads[$upcount-1]); ?>&path=<?php print_r($file_link); ?> "><img src="templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a>-->
<a style="cursor:pointer;" onclick="javascript:getpopup();"><img src="templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a>&nbsp; <strong><?php  echo $uploads[$upcount-1]; ?><?PHP //echo $DOCS[$j]->title;?></strong>
<div class="clear"></div>
</div>
<!--
<div style="float: left; padding-left: 10px;">
<strong>Require vendors to assign a Dollar Value to this Attachment: <?php //if($DOCS[$j]->is_req_docvendors=='1'){ echo "Yes"; } else { echo "No"; } ?></strong></div><br/>-->
<!-- eof line item pan -->
<?PHP } } ?>
<p style="padding-top: 20px;"></p>


<!--  sof line item pan -->
<div class="lineitem_pan_row">
<?PHP //if(count($cat)>0) { ?>
<div class="lineitem_pan_row">
<div id="i_bar_gr">
<div style="text-align:center; width:666px;" id="i_bar_txt_proposalform">
<span style="padding-left:0px; font-size:13px;">SPECIAL REQUIREMENTS</span></div>
</div>

<div class="lineitem_pan">
<?php
if($this->generalinfo || $this->autoinfo || $this->workersinfo || $this->umbinfo || $this->licinfo || $this->omiinfo ){
echo $this->generalinfo;
echo $this->autoinfo;
echo $this->workersinfo;
echo $this->umbinfo;
echo $this->licinfo;
echo $this->omiinfo;
}
else{
	echo "No Special Requirements.";
}
?>
 </div>
<div class="clear"></div>

</div>


<!-- //modified by sateesh on 26-07-11 completed-->

<!--<strong>Vendor must furnish documentation designating the Property Association to be listed as an "additional insured"</strong> -->


<div class="color_butons" style="display:none">
<?PHP if($Form_status == '') { ?>
<a style="cursor:pointer" onclick="javascript: alert('You must submit your Intent to Bid in order to begin filling out this proposal form.');"><img src="templates/camassistant_left/images/addnotes.gif" alt="Add Notes" width="76" height="22" /></a>
<a style="cursor:pointer" onclick="javascript: alert('You must submit your Intent to Bid in order to begin filling out this proposal form.');"><img src="templates/camassistant_left/images/uploadfile.gif" alt="Upload A File" width="87" height="22" /></a>
<a style="cursor:pointer" onclick="javascript: alert('You must submit your Intent to Bid in order to begin filling out this proposal form.');"><img src="templates/camassistant_left/images/addexception.gif" alt="Add Exception" width="97" height="22" /></a>
 <?PHP } else { ?>
<?PHP echo $SPL_REQ_TABS[0]->Addnotes; ?>
<?PHP echo $SPL_REQ_TABS[1]->Uploadfile; ?>
<?PHP echo $SPL_REQ_TABS[2]->AddException; ?>
<?PHP } ?>
</div>
<?PHP //} ?>
<div class="clear"></div>
</div>
<!-- eof line item pan -->


<!--  sof line item pan -->
<div class="lineitem_pan_row" <?PHP if(count($main)==0) { ?> style="padding-top:12px" <?PHP } ?>>
<span class="grey_12" style="display:none">PROPOSAL PRICING:
</span>
<div class="downloadfile" style="display:none">
<?PHP if($price_cnt != 0) { ?>
<div class="proposal_pric">
<label style="width: 270px;"><strong>LINE ITEM PRICING ABOVE ADDED UP</strong>:</label>
$&nbsp;<input name="total_lineitem_pricing" id="total_lineitem_pricing" type="text"  value="" readonly="readonly" />
</div>
<?PHP } ?>

<div class="proposal_pric">
<label style="width:270px"><?PHP if($price_cnt != 0) { ?><strong style="float:left;">YOUR PRICE FOR ALL OTHER ITEMS:</strong> <?PHP } else { ?><strong style="float:left;">YOUR PRICE FOR ALL OF THE ABOVE ITEMS:</strong><?PHP } ?></label>
$&nbsp;<input  name="other_items_price" id="other_items_price" style="background-color:#666666; color:#ffffff;" type="text" value=""  onclick="if(this.value == 0.00) this.value = '';" onblur="javascript: format_val('','other_items_price',this.value);" onchange="javascript: getcommission();" <?PHP if($Form_status == '') { ?> readonly="readonly" onclick="javascript: alert('You must submit your Intent to Bid in order to begin filling out this proposal form.');" <?PHP } ?> /><span class="hasTip2" title="Info ::<div style='font-size:13px; width:500px;'>All Other Items specifically includes any line items that did NOT require line-item pricing.  This MAY also include any adjustments relating to Notes or Exceptions, but should be CLEARLY noted in the respective Note or Exception.</div>"> <img align="right" style="margin-bottom:-8px; float:none; margin-right: 0px;" alt="info" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/info_icon3.png"></span>
</div>

<?PHP if($price_cnt != 0) { ?>
<div class="proposal_pric">
<label style="width: 270px;"><strong>TOTAL PROPOSAL PRICE:</strong></label>
$&nbsp;<input name="total_price" id="total_price" type="text" style="font-weight:bold;"  readonly="readonly"/>
</div>
<?PHP } ?>
<div class="proposal_pric">
<label style="width:270px" ><strong>YOUR MAXIMUM COMMISSION:</strong><br />
(Due upon the awarding of the job)</label>
$&nbsp;<input name="commisions" id="commisions" type="text" style=" font-weight:bold;" value="" readonly="readonly"/>
</div>
</div>
<div class="clear"></div>
<br />
  <?php /*?><table width="100%">
    <tr>
      <td width="4%" align="left" valign="top"><input name="i_agree" id="i_agree" type="checkbox" value="yes" /></td>
      <td width="96%">I have read and understand all of the requirements of this Request For Proposal and understand that upon viewing the job, if I wish to rescind my ITB, I may do so within 24 hours without penalty. I have also read and agree to the <a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=51&amp;Itemid=113">Terms and Conditions</a> of this website. <span class="redstar">(Required)      <br />
        <br />
        <br />
      </span></td>
    </tr>
  </table><?php */?>
  <?php if($type == 'invitation'){ ?> 
 <div id="topborder_row" align="center">
<!--<a class="createnewrequest" href="index.php?option=com_camassistant&controller=proposals&task=not_interested&type=invitation&id=<?php echo $_REQUEST['id']; ?>&rfp_id=<?php echo $_REQUEST['rfp_id']; ?>"><img src="templates/camassistant_left/images/decline.gif" vspace="15" alt="Not Interested"  /></a>
<a class="createnewrequest" href="javascript:;" onClick="history.go(-1)"><img src="templates/camassistant_left/images/GoBack.gif" vspace="15" alt="Go Back"  /></a>
<a class="createnewrequest" onclick="javascript: return ITB_save();" ><img src="templates/camassistant_left/images/accept.gif" style="cursor:pointer;" alt="submit my intent to bid" vspace="15" /></a>-->
	<?php if($notinterested != '2'){ ?>
     <a class="createnewrequest" id="declineinvitation" rel="<?php echo $_REQUEST['rfp_id']; ?>" href="javascript:void(0);"><img src="templates/camassistant_left/images/decline.gif" vspace="15" alt="Not Interested"  /></a>
	 <?php } ?>

<a class="createnewrequest" href="javascript:;" onClick="history.go(-1)"><img src="templates/camassistant_left/images/goback.gif" vspace="15" alt="Go Back"  /></a>
<a class="createnewrequest" onclick="javascript: return ITB_save();" ><img src="templates/camassistant_left/images/accept.gif" style="cursor:pointer;" alt="submit my intent to bid" vspace="15" /></a>
<?php if($interested == '2'){ ?>
<input type="hidden" value="yes" name="itb" />
<?php }
else{ ?>
<input type="hidden" value="yes" name="itb" />
<?php } ?>
</div>

 <?php } else {}
?>
<div id="topborder_row" align="center"><a class="createnewrequest" href="javascript:;" onClick="history.go(-1)"><img src="templates/camassistant_left/images/goback.gif" vspace="15" alt="Go Back"  /></a></div>

</div>
<!-- eof line item pan -->



</div>

</div>
<!-- eof table pan -->
</div>
<input type="hidden" name="rfp_id" value="<?PHP echo $_REQUEST['rfp_id']; ?>" />
<input type="hidden" name="Prp_id" value="<?PHP echo $_REQUEST['Prp_id']; ?>" />
<input type="hidden" name="Proposal_id" value="<?PHP echo $_REQUEST['Proposal_id']; ?>" />
<input type="hidden" name="Itemid" value="<?PHP echo $_REQUEST['Itemid']; ?>" />
<input type="hidden" name="id" value="<?PHP echo $id; ?>" />
<input type="hidden" name="submit_type" id="submit_type" />
<input type="hidden" name="contact_name" id="contact_name" value="" />
<input type="hidden" name="Alt_bid" id="Alt_bid" />
<input type="hidden" name="task" id="task" />
</form>
<?php } ?>