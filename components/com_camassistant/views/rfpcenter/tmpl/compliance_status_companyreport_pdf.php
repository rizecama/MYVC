<?php

/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */
// no direct access
	
	$original_mem = ini_get('memory_limit');
	ini_set('memory_limit','640M');
	ini_set('max_execution_time', 5000);
	defined('_JEXEC') or die('Restricted access');
	require_once('libraries/tcpdf/config/lang/eng.php');
	require_once('libraries/tcpdf/tcpdf.php');
	ini_set('zlib.output_compression','Off');
	$vendor_data =  $this->message;
	//echo '<pre>';print_r($vendor_data); exit;
  

	class MYPDF extends TCPDF {

	// Page footer
	public function Footer() {
		// Position at 1.5 cm from bottom
		$this->SetY(-15);
		// Page number
		$this->SetFontSize(8);
			if($this->pageno){
		//$page=(int)$this->getAliasNumPage();
		//$this->Cell(208, 0, 'Vendor Compliance Status ', 0, 2, 'C');
}$this->pageno=$this->pageno+1;
		$this->SetFontSize(7);
		$this->Cell(0, 5, 'Copyright 2014-2015 HOA Assistant, LLC', 0, 0, 'C');
	}

	public function Header() {
	
	$bMargin = $this->getBreakMargin();
        // get current auto-page-break mode
        $auto_page_break = $this->AutoPageBreak;
        // disable auto-page-break
        $this->SetAutoPageBreak(false, 0);
        // set bacground image
        if($this->page <= 1){
          $img_file = 'templates/camassistant_left/images/header-bg-border.jpg';
              $this->Image($img_file, 0, 0, 300, 60, '', '', '', false, 300, '', false, false, 0);
			
        }
        // restore auto-page-break status
        $this->SetAutoPageBreak($auto_page_break, $bMargin);
        // set the starting point for the page content
        $this->setPageMark();
	
	}
}
	$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);
	$pdf->SetCreator(PDF_CREATOR);
	// set default header data
	$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);

	// set header and footer fonts
	$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));
	$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));

	// set default monospaced font
	$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);

	//set margins
	$pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);
	$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
	$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);
	//set auto page breaks
	$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);
	//$pdf->SetDrawColor(204, 204, 204);
	//set image scale factor
	$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);
	//set some language-dependent strings
	$pdf->setLanguageArray($l);

	//$pdf->SetFont('dejavusans', '', 10);// set font
	//$pdf->AddPage(); // add a page
	// Your custom code here
	JHTML::_('behavior.modal');
	// create new PDF document
	$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);
	// set font
	//$pdf->SetFont('dejavusans', '', 12);
	//Image Quality
	$pdf->setJPEGQuality(200);
	// add a page
	//echo $this->count_enable; exit;
	
$pdf->AddPage('L');
$pdf->SetMargins(-4, 10, 0, true);
$pdf->SetXY(0, 0);
$pdf->setCellPaddings(0,0,0,0);	
$today = date('m-d-Y H:i:s');
$today_explode = explode(' ',$today);
$items = $this->items;
$totalvendors = count($items);	
$noncomp = 0;
$comp = 0;
for( $pv=0; $pv<count($items); $pv++ )
{
if( $items[$pv]->final_status == 'fail' || $items[$pv]->final_status == 'medium' )
 $noncomp++;
if($items[$pv]->final_status == 'success')
 $comp++;
}

$db = Jfactory::getDBO();
$user = Jfactory::getUser();
$manager_logo = "SELECT comp_logopath FROM #__cam_customer_companyinfo where cust_id ='".$user->id."'";
$db->Setquery($manager_logo);
$manager_logo = $db->loadResult();
$today = date('m-d-Y H:i:s');
$today_explode = explode(' ',$today);
	$htmlcontent = '<table width="1205" border="0" cellspacing="0" height="290" style="padding:0; margin:0;border:none;" >
	<tr height="20"><td ></td></tr>
  	<tr>
		<td width="20"></td>
    	<td>
    		<table>
				<tr>
					<td>
						<table>
							<tr>
								<td><img width="150" src="templates/camassistant_left/images/my-vc-logo.png"></td>
							</tr>
							<tr>
								<td><img width="200" src="templates/camassistant_left/images/profacts-logo.png"></td>
							</tr>
							<tr>
								<td style="color:#fff; font-size:22px;">Your exclusive Vendor Compliance Report</td>
							</tr>
						</table>
					</td>
					<td>
						<table>
							<tr>
								<td style="text-align:center;">';
								 $pdf->Image(''.JURI::root().'components/com_camassistant/assets/images/properymanager/'.$manager_logo.'', 180, 10, 40, 40, "", "", "", true, 550,'', false, false, 0, false, false, false);
								$htmlcontent .='</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
		</tr>
		<tr>';
		$htmlcontent .='</tr>
		</table><br/><br/><br/><br/><br/>
		<table>';
		$htmlcontent .='<tr  width="100%" style="padding:0px;">
    			<td width="100%"  bgcolor="#f5f5f5">';
					$htmlcontent .='<table width="100%" align="center">
        				<tr height="70">
            				<td colspan="2"></td>
            			</tr>
            			<tr>
							<td width="36"></td>
            				<td width="38%" align="left">
                				<p style="color:#2c384a; font-size:28px; line-height:5px;">
Please find the list of your Vendors below and their compliance status as of <strong>'.date("h:i A", strtotime($today_explode[1])).'</strong> on <strong>'.$today_explode[0].'.</strong><br />Note: this list is determined by the Vendors that you have manually added to be included on your "My Vendors" list ("Corporate Preferred Vendors" list for Master Account holder). You can view this list by logging into your MyVendorCenter account and clicking on "Vendor Lists" ("Preferred Vendors" for Master Account holder)
								</p>
                			</td>
                			<td width="58%" align="right" valign="middle">
								<table>
									<tr><td  height="20"></td></tr>
                					<tr><td>
										<table>
											<tr>
												<td>
												<img width="120" src="components/com_camassistant/assets/piechart/'.$user->id.'_piechartimg.jpg">
												</td>
												<td>
													<table style="width:100%; text-align:left; padding:10px;" height="160" >
														<tr >
															<td >
																<h3 style="font-size:38px; color: #2c384a;">Vendor Compliance Overview</h3>
															</td>
														</tr>
														<tr>
															<td>
																<table width="100%" style="padding:0;">
																<tr>
																	<td width="15">
																		<img width="15" src="templates/camassistant_left/images/green-box.png">
																	</td>
																	<td style="font-size:28px; color:#2c384a; line-height:5px;" valign="middle">
																		 Compliant: <strong >'.$comp.'</strong>
																	</td>
																</tr>
																<tr>
																	<td width="15" >
																		<img width="15" src="templates/camassistant_left/images/red-box.png">
																	</td>
																	<td style="font-size:28px;color:#2c384a; line-height:5px;" valign="middle">
																		 Non-Compliant: <strong  >'.$noncomp.'</strong>
																	</td>
																</tr>
															</table>
															</td>
														</tr>
														<tr>
															<td style="font-size:28px; color:#2c384a;" >
																&nbsp;Total Vendors: <strong>'.$totalvendors.'</strong>
															</td>
														</tr>
													</table>	
												</td>
											</tr>
										</table>
									</td></tr>
									<tr><td  height="20"></td></tr>
								</table>	
                			</td>
							<td width="15"></td>
           			 	</tr>
            			<tr height="70">
            				<td colspan="2"></td>
            			</tr>
        			</table>
   				 </td>
  			</tr>
		</table>
		<br pagebreak="true" />';
		$count_enable= $this->count_enable;
		$alt = 2;
		if( $count_enable->phone_number == '1' )
		   $display_phone = '';
		else
		   $display_phone = 'none';
		   
		foreach($vendor_data as $key=>$value){
		for($cn=0; $cn<count($value); $cn++){
			$cname = explode('MYVC',$value[$cn]);
			$vendor_companies[] = substr($cname[2],0,1);
			
		}
	}
	$vcompanynames[] = array_unique($vendor_companies);
//	echo "<pre>"; print_r($vcompanynames);exit;
	
  foreach( $vcompanynames as $vdd ) { 
	 foreach( $vdd as $vddele ) { 
	 	$newvcompanynames[] = $vddele;
	 }
  }
		//echo '<pre>';print_r($vendor_data );exit;
	foreach( $newvcompanynames as $vdds ) { 
	$htmlcontent .=' <table  width="100%"  cellpadding="0" cellspacing="0">
			<tr>
  	<td>
    	<table width="100%" >
        	<tr height="30"><td></td> </tr>
        	<tr>
            	<td valign="middle"  style="color: #2c384a; font-size: 35px; margin:0; padding:0px; font-weight:bold; vertical-align:middle; border-top:1px solid #8c8c8c; border-bottom:1px solid #8c8c8c; line-height:10px; border-left:none; border-right:none; text-align:center;">
				'.$vdds.'</td>
            </tr>
			';
			foreach($vendor_data as $key=>$value){
		  	for($last=0; $last<=0; $last++){
				$exp = explode('MYVC',$value[$last]);
				//echo '<pre>';print_r($exp);exit;
				if($value[$last]){
				if ( $vdds == 	substr($exp[2],0,1) )
		        {
				$alt++;
				if( $alt%2 == 0 )
				{
					$style = '#f5f5f5';
					$chageimage  = '0';
	            }
				else
				{
					$style = '#ffffff';
					$chageimage  = '1';
				}
	           $htmlcontent .='  
				 <tr height="20"><td></td></tr>
		       <tr height="20" bgcolor="'.$style.'"><td></td> </tr>
			   <tr width="100%"  bgcolor="'.$style.'">
            	<td width="100%"  bgcolor="'.$style.'">
                	<table width="100%" bgcolor="'.$style.'">
                    	<tr>
                        	<td>
								<table width="100%" >
									<tr>
									<td width="25"></td>
										<td width="300"><h2 style="color: #2c384a; font-size: 25px; margin:0;">'.$exp[2].'</h2></td>
									</tr>
									<tr style="display:'.$display_phone.'">	
									<td width="25"></td>
										<td width="100%">
										<p style="font-size:25px; color:#2c384a;">'.$exp[13].'<br>'.$exp[14].', '.$exp[16].', '.$exp[15].'</p>
										</td>
									</tr>
								</table>
							</td>';
								if ( $exp[11] == "Provided" )
								{
									if ( $chageimage == 1 ) 
										$w9_image = 'compliance-passed-icon.jpg';
									else
										$w9_image = 'compliance-passed-icongray.jpg';
								}	 
								else
								{
									if ( $chageimage == 1 ) 
										$w9_image = 'compliance-unknown-icon.jpg';
									else
										$w9_image = 'compliance-unknown-icongray.jpg';
								}
								if( $count_enable->how_docs == 'all' )
						$display_w9 = '';
					else if( $count_enable->include_docs == '1' && $count_enable->w9 == '1' )
						$display_w9 = '';
					else
						$display_w9 = 'none';
							$htmlcontent .='<td style="display:'.$display_w9.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr><td width="25"></td>
                                    	<td valign="middle"  width="35">
										<img style=" vertical-align: middle; width:25px; border:none;" src="templates/camassistant_left/images/'.$w9_image.'">
										</td>
								        <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
																<td style="color:#333; font-size: 25px; margin:0;">W9</td>
															</tr>
															<tr>
																<td style="color:#333; font-size: 25px; margin:0;">'.$exp[11].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
									 <tr height="20" ><td></td> </tr>
                                </table>
                            </td>';
					$exp_g = explode('/',$exp[3]);
					$exp_g = $exp_g[2].'/'.$exp_g[0].'/'.$exp_g[1];
				if( $exp[3] == 'None')
					{
						$glicolor = '#333';
						if ( $chageimage == 1 ) 
							$glitype = 'compliance-unknown-icon.jpg';
						else
							$glitype = 'compliance-unknown-icongray.jpg';
					}
				else if( $exp_g < date ('Y/m/d')) 
					{
						$glicolor = 'red';
						if ( $chageimage == 1 ) 
							$glitype = 'compliance-failed-icon.jpg';
						else
							$glitype = 'compliance-failed-icongray.jpg';
					}
			   else
					{
						$glicolor = '#333';
						if ( $chageimage == 1 ) 
							$glitype = 'compliance-passed-icon.jpg';
						else
							$glitype = 'compliance-passed-icongray.jpg';
					}
					
					if( $count_enable->how_docs == 'all' )
						$display_gli = '';
					else if( $count_enable->include_docs == '1' && $count_enable->gli == '1' )
						$display_gli = '';
					else
						$display_gli = 'none';	
						$htmlcontent .='<td style="display:'.$display_gli.'">
						      	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr><td width="25"></td>
									<td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$glitype.'"></td>
									<td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
															<td style="color:'.$glicolor.'; font-size: 25px; margin:0;">General Liability</td>
															
															</tr>
															<tr>
																<td style="font-size: 25px; margin:0;color:'.$glicolor.';">'.$exp[3].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
                                </table>
                            </td>';
		            $exp_a = explode('/',$exp[4]);
					$exp_a = $exp_a[2].'/'.$exp_a[0].'/'.$exp_a[1];
					if( $exp[4] == 'None')
					{
					$aipcolor = '#333';
					  if ( $chageimage == 1 ) 
							$aiptype = 'compliance-unknown-icon.jpg';
						  else
						 $aiptype = 'compliance-unknown-icongray.jpg';
					}
					else if( $exp_a < date ('Y/m/d')) 
					{
				    $aipcolor = 'red';
					 if ( $chageimage == 1 ) 
							$aiptype = 'compliance-failed-icon.jpg';
						  else
						 $aiptype = 'compliance-failed-icongray.jpg';
					}
					else
					{
					$aipcolor = '#333';
					if ( $chageimage == 1 ) 
							    $aiptype = 'compliance-passed-icon.jpg';
								else
								 $aiptype = 'compliance-passed-icongray.jpg';
					}
					if( $count_enable->how_docs == 'all' )
						$display_api = '';
					else if( $count_enable->include_docs == '1' && $count_enable->api == '1' )
						$display_api = '';
					else
						$display_api = 'none';
						
							
						   $htmlcontent .='<td style="display:'.$display_api.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr><td width="25"></td>
								     <td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$aiptype.'"></td>
									      <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
															<td style="color:'.$aipcolor.'; font-size: 25px; margin:0;">Auto</td>
															
															</tr>
															<tr>
																<td style="color:'.$aipcolor.'; font-size: 25px; margin:0;">'.$exp[4].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
                                </table>
                            </td>
					     </tr>
						<tr height="3"><td></td></tr>
						<tr>
						<td>
								<table width="100%" style="display:'.$display_phone.'" >
									<tr >
									<td width="25"></td>
										<td><h2 style="color: #2c384a; font-size: 25px; margin:0;">Contact:</h2></td>
									</tr>
									<tr>	
									<td width="25"></td>
										<td width="100%">
										<p style="font-size:25px; color:#2c384a;">'.$exp[17].'<br>'.$exp[12].'</p>
										</td>
									</tr>
								</table>
							</td>';
							$exp_w = explode('/',$exp[5]);
							$exp_w = $exp_w[2].'/'.$exp_w[0].'/'.$exp_w[1];
						if( $exp[5] == 'None')
							{
							   $worcolor = '#333';
								 if ( $chageimage == 1 ) 
								      $wortype = 'compliance-unknown-icon.jpg';
							     else
							         $wortype = 'compliance-unknown-icongray.jpg';
						     }
						else if( $exp[5] == 'Does Not Expire')
							{
							$worcolor = '#333';
							   if ( $chageimage == 1 ) 
							       $wortype = 'compliance-passed-icon.jpg';
						      else
						           $wortype = 'compliance-passed-icongray.jpg';
						     }
							else if( $exp_w < date ('Y/m/d')) 
							   {
							       $worcolor = 'red';
										if ( $chageimage == 1 ) 
										    $wortype = 'compliance-failed-icon.jpg';
										else
										    $wortype = 'compliance-failed-icongray.jpg';
								}
							else
							    {
							      $worcolor = '#333';
									if ( $chageimage == 1 ) 
									   $wortype = 'compliance-passed-icon.jpg';
									else
									   $wortype = 'compliance-passed-icongray.jpg';
								}
							
							if( $count_enable->how_docs == 'all' )
								$display_wc = '';
							else if( $count_enable->include_docs == '1' && $count_enable->wc == '1' )
								$display_wc = '';
							else
								$display_wc = 'none';
                            $htmlcontent .='<td style="display:'.$display_wc.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr><td width="25"></td>
                                    <td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$wortype.'"></td>
								        <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;" width="200">
															<tr>
															<td style="color:'.$worcolor.'; font-size: 25px; margin:0;">Workers Comp</td>
															</tr>
															<tr>
																<td style="color:'.$worcolor.'; font-size: 25px; margin:0;">'.$exp[5].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
									<tr height="20" ><td></td> </tr>
                                </table>
                            </td>';
							
							$exp_u = explode('/',$exp[6]);
							$exp_u = $exp_u[2].'/'.$exp_u[0].'/'.$exp_u[1];
							if( $exp[6] == 'None')
							{
								$umbcolor = '#333';
								if ( $chageimage == 1 ) 
									$umbtype = 'compliance-unknown-icon.jpg';
								else
									$umbtype = 'compliance-unknown-icongray.jpg';
							}
							else if( $exp_u < date ('Y/m/d')) 
							{
								$umbcolor = 'red';
								if ( $chageimage == 1 ) 
									$umbtype = 'compliance-failed-icon.jpg';
								else
									$umbtype = 'compliance-failed-icongray.jpg';
							}
							else
							{
								$umbcolor = '#333';
								if ( $chageimage == 1 ) 
									$umbtype = 'compliance-passed-icon.jpg';
								else
									$umbtype = 'compliance-passed-icongray.jpg';
							}
							if( $count_enable->how_docs == 'all' )
						       $display_umb = '';
							else if( $count_enable->include_docs == '1' && $count_enable->umb == '1' )
								$display_umb = '';
							else
								$display_umb = 'none';
                            $htmlcontent .='<td style="display:'.$display_umb.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr><td width="25"></td>
							     <td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$umbtype.'"></td>
									 <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
															<td style="color:'.$umbcolor.'; font-size: 25px; margin:0;">Umbrella</td>
															</tr>
															<tr>
																<td style="color:'.$umbcolor.'; font-size: 25px; margin:0;">'.$exp[6].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
									<tr height="20" ><td></td> </tr>
                                </table>
                            </td>';
							$exp_e = explode('/',$exp[7]);
							$exp_e = $exp_e[2].'/'.$exp_e[0].'/'.$exp_e[1];
							if( $exp[7] == 'None')
							{
								$eiocolor = '#333';
								if ( $chageimage == 1 ) 
									$eiotype = 'compliance-unknown-icon.jpg';
								else
									$eiotype = 'compliance-unknown-icongray.jpg';
							}
							else if( $exp_e < date ('Y/m/d')) 
							{
								$eiocolor = 'red';
								if ( $chageimage == 1 ) 
									$eiotype = 'compliance-failed-icon.jpg';
								else
									$eiotype = 'compliance-failed-icongray.jpg';
							}
							else
							{
								$eiocolor = '#333';
								if ( $chageimage == 1 ) 
									$eiotype = 'compliance-passed-icon.jpg';
								else
									$eiotype = 'compliance-passed-icongray.jpg';
							}
							if( $count_enable->how_docs == 'all' )
								$display_omi = '';
							else if( $count_enable->include_docs == '1' && $count_enable->omi == '1' )
								$display_omi = '';
							else
								$display_omi = 'none';		
                           $htmlcontent .=' <td style="display:'.$display_omi.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr><td width="25"></td>
									<td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$eiotype.'"></td>
		                                <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
															<td style="color:'.$eiocolor.'; font-size: 25px; margin:0;">E & O</td>
															 </tr>
															<tr>
															<td style="font-size: 25px; margin:0;color:'.$eiocolor.';">'.$exp[7].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
									<tr height="20" ><td></td> </tr>
                                </table>
                            </td>
				         </tr>';
						if( $exp[1] == "Verified" )
							{
								$image_text = '#8dc63f';
								if ( $chageimage == 1 ) 
									$image_status = 'compliance-verified.jpg';
								else
									$image_status = 'compliance-verifiedgray.jpg';
							}
							else
							{
								$image_text = 'red';
								if ( $chageimage == 1 ) 
									$image_status = 'compliance-smallfailed-icon.jpg';
								else
									$image_status = 'compliance-unverifiedgray1.jpg';
							}
										
						if ( $exp[0] == 'Non-Compliant')
							 {
								$image_text1 ="red";
								if ( $chageimage == 1 ) 
									$image_status1 = 'compliance-smallfailed-icon.jpg';
								else
									$image_status1 = 'compliance-unverifiedgray1.jpg';
				              }
						else
							{
								$image_text1 ="#8dc63f";
								if ( $chageimage == 1 ) 
									$image_status1 = 'compliance-verified.jpg';
								else
									$image_status1 = 'compliance-verifiedgray.jpg';
							}				
						$htmlcontent .='<tr height="3"><td></td></tr>
						<tr>
						<td width="25"></td>
                        	<td>
								<img src="templates/camassistant_left/images/'.$image_status1.'" width="13" height="13" ><span style="color:'.$image_text1.'" >&nbsp;'.$exp[0].'</span>
							<br>
								<img src="templates/camassistant_left/images/'.$image_status.'" width="13" height="13" ><span style="color:'.$image_text.'">&nbsp;'.$exp[1].'&nbsp;Documents </span>
			                 </td>';
						    $exp_p = explode('/',$exp[9]);
							$exp_p = $exp_p[2].'/'.$exp_p[0].'/'.$exp_p[1];
							if( $exp[9] == 'None')
								{
									$procolor = '#333';
									if ( $chageimage == 1 ) 
										$protype = 'compliance-unknown-icon.jpg';
									else
										$protype = 'compliance-unknown-icongray.jpg';
								}
							else if( $exp_p < date ('Y/m/d')) 
								{
									$procolor = 'red';
									if ( $chageimage == 1 ) 
										$protype = 'compliance-failed-icon.jpg';
									else
										$protype = 'compliance-failed-icongray.jpg';
								}
							else
							   {
									$procolor = '#333';
									if ( $chageimage == 1 ) 
										$protype = 'compliance-passed-icon.jpg';
									else
										$protype = 'compliance-passed-icongray.jpg';
								}
							if( $count_enable->how_docs == 'all' )
								$display_pln = '';
							else if( $count_enable->include_docs == '1' && $count_enable->pln == '1' )
								$display_pln = '';
							else
								$display_pln = 'none';		
						   $htmlcontent .='<td style="display:'.$display_pln.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr>
							        	<td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$protype.'"></td>
								     <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
															<td style="color:'.$procolor.'; font-size: 25px; margin:0;">Professional License</td>
															</tr>
															<tr>
																<td style="color:'.$procolor.'; font-size: 25px; margin:0;">'.$exp[9].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
									
                                </table>
                            </td>';
                            $exp_o = explode('/',$exp[8]);
							$exp_o = $exp_o[2].'/'.$exp_o[0].'/'.$exp_o[1];
							if( $exp[8] == 'None')
								{
									$ocpcolor = '#333';
									if ( $chageimage == 1 ) 
									  $ocptype = 'compliance-unknown-icon.jpg';
									else
									  $ocptype = 'compliance-unknown-icongray.jpg';
								}
						   else if( $exp[8] == 'Does Not Expire')
								{
								   $ocpcolor = '#333';
								   if ( $chageimage == 1 ) 
								     $ocptype = 'compliance-passed-icon.jpg';
								   else
								     $ocptype = 'compliance-passed-icongray.jpg';
								}
							else if( $exp_p < date ('Y/m/d')) 
								{
									$ocpcolor = 'red';
									if ( $chageimage == 1 ) 
										$ocptype = 'compliance-failed-icon.jpg';
									else
										$ocptype = 'compliance-failed-icongray.jpg';
								}
							else
							{
								$ocpcolor = '#333';
								if ( $chageimage == 1 )
									$ocptype = 'compliance-passed-icon.jpg';
								else
									$ocptype = 'compliance-passed-icongray.jpg';
							}
							if( $count_enable->how_docs == 'all' )
								$display_oln = '';
							else if( $count_enable->include_docs == '1' && $count_enable->oln == '1' )
								$display_oln = '';
							else
								$display_oln = 'none';		
							$htmlcontent .=' <td style="display:'.$display_oln.'">
                            	<table width="100%" cellpadding="0" cellspacing="0">
                                	<tr>
								<td valign="middle" width="35"><img style=" vertical-align: middle; width:25px;" src="templates/camassistant_left/images/'.$ocptype.'"></td>
								   <td>
											<table width="100%" cellpadding="0" cellspacing="0" align="left">
												<tr>
													<td>
														<table style="padding-top:3px;">
															<tr>
															<td style="color:'.$ocpcolor.'; font-size: 25px; margin:0;">Occ. License</td>
																</tr>
															<tr>
																<td style="color:'.$ocpcolor.'; font-size: 25px; margin:0;">'.$exp[8].'</td>
															</tr>
														</table>
													</td>
												</tr>
											</table>
										</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
						
                    </table>
                </td>
		    </tr>';
			 if( $alt%2 == 0 )
			$htmlcontent .='<br pagebreak="true" />	';
			}
			}
		 }
			 }
		  $htmlcontent .='
            <tr height="30"><td></td> </tr>
        </table>
	</td>
  </tr>
		</table>';
		
			}
?>
<?php

header($_SERVER['SERVER_PROTOCOL'] . ' 200 OK');
$style7 = array('width' => 0.1, 'color' => array(220, 220, 220));
$pdf->SetLineStyle($style7);
$pdf->writeHTML($htmlcontent, true, 0, true, 0);
$pdf->lastPage();
 //set title
$pdf->SetTitle($title);//set title
$path =   $_SERVER['DOCUMENT_ROOT'].'live/creports';
ob_end_clean();
$pdf->Output($path.'/compliancereports.pdf', 'FI');
$sendmail = JRequest::getVar('send');
if( $sendmail == 'mail' ){
		$user	= JFactory::getUser();
		$body =  $this->reportmessage;
		$body = str_replace('[USER FULL NAME]',$user->name.'&nbsp;'.$user->lastname,$body);
		$body = str_replace('[TIME]',date("h:i A", strtotime($today_explode[1])),$body);
		$body = str_replace('[DATE]',$today_explode[0],$body);
		$mailfrom = 'support@myvendorcenter.com';
		$from = 'MyVendorCenter';
		$to = $user->email;
		$to = "rize.cama@gmail.com";
		$subject = 'Compliance Report Status';
		$body = 'Please find the attachment for compliance status report.';
		$attachment = "/var/www/vhosts/vps61048.vps.ovh.ca/httpdocs/creports/compliancereports.pdf";
		JUtility::sendMail($mailfrom, $from, $to, $subject, $body, $mode=1, $cc=null, $bcc=null, $attachment, $replyto=null, $replytoname=null);
		header('Location: index.php?option=com_camassistant&controller=rfpcenter&task=compliance_status_report_webpage');
}
else
header('Location: /live/creports/compliancereports.pdf');
		/*$path = $path;
		$doc_name = $path.'/compliancereports.pdf';
		header("content-type: application/octet-stream");
		header("Content-Disposition: attachment; filename=compliancereports.pdf");
		readfile($doc_name);*/
	
//header('Location: /live/creports/compliancereports.pdf');
ini_set('memory_limit',$original_mem);
exit;
?>

