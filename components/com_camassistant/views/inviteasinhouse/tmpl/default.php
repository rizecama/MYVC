<?php  $user =& JFactory::getUser();
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here


?>
<link href="<?php JPATH_SITE ?>templates/camassistant/css/popup.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
function fun(){


var x=document.forms["mailform"]["inhouse"].value;
var re = /@/g;
/*for( var c = 0; re.exec(x); ++c );
if(c>1){
alert("Please enter only one email address");
  return false;
}
*/if (x==null || x=="")
  {
  alert("Please enter the email address");
  return false;
  }
  
frm=document.mailform;
var inhouse=frm.inhouse.value;
var subject=frm.subject.value;
var inhousetext=frm.inhousetext1.value;
var exculdetext=frm.inhousetext.value;
var tasks=frm.task.value;
var camid=frm.camid.value;

if(frm.remail){
var remail=frm.remail.value;
}
//alert(remail);
//frm.submit();
if(remail){
window.parent.location.href = 'index.php?option=com_camassistant&task=inhousevendors&camid='+camid+'&Itemid=<?php echo $_REQUEST['Itemid']; ?>&inhouse='+inhouse+'&subject='+subject+'&inhousetext='+inhousetext+'&remail='+remail+'&vendortype=<?php echo $_REQUEST['id']; ?>&userid=<?php echo $_REQUEST['userid']; ?>&email=<?php echo $user->email; ?>';

window.close();
}
else {
window.parent.location.href = 'index.php?option=com_camassistant&controller=vendorscenter&task='+tasks+'&camid='+camid+'&Itemid=120&exculdetext='+exculdetext+'&inhouse='+inhouse+'&subject='+subject+'&inhousetext='+inhousetext+'&vendortype=<?php echo $_REQUEST['id']; ?>&userid=<?php echo $_REQUEST['userid']; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&email=<?php echo $user->email; ?>';
window.close();

}
}

function exclude(){

var tax1=document.forms["mailform"]["tax1"].value;
var tax2=document.forms["mailform"]["tax2"].value;
var tax=tax1+'-'+tax2;

frm=document.mailform;
var exculdetext=frm.inhousetext.value;
var tasks=frm.task.value;
var camid=frm.camid.value;
window.parent.location.href = 'index.php?option=com_camassistant&task='+tasks+'&camid='+camid+'&tax='+tax+'&Itemid=120&exculdetext='+exculdetext+'&vendortype=<?php echo $_REQUEST['id']; ?>&userid=<?php echo $_REQUEST['userid']; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&email=<?php echo $user->email; ?>';
window.close();

}
</script>
<script type="text/javascript" src="components/com_camassistant/editor/ed.js"></script>  
<link rel="stylesheet" media="all" type="text/css" href="<?php echo Juri::base(); ?>components/com_camassistant/skin/css/jquery1.css" />		
<script type="text/javascript" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/js/jquery-ui-timepicker-addon.js"></script>

<script type="text/javascript">
  //Functio to verify taxid by sateesh on 03-08-11
H = jQuery.noConflict();
var site='<?php echo JURI::root();?>';
var path='<?php echo addslashes(JPATH_SITE);?>';
var countyCount = 0;
H(document).ready(function(){
H("#semdInvitation").click(function(){
		var email=H("#inhouse").val();
		
		var eaddress=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/;
		if(!(eaddress.test(email))){
		alert("Please enter valid email");
		return false;
		}
		
		H.post("index2.php?option=com_camassistant&controller=invitations&task=verfiryemailid", {queryString: ""+email+""}, function(data){
		if(data == 'invalid'){
		 var firstline = 'Sorry, you have already assigned a Vendor Status to this email address.';
		 var secondline = '  To assign a different status to this vendor, you must click \"Remove Vendor\" to clear the vendor\'s status, and then re-invite/exclude them.';
		 var thirdline = firstline+'\n\n'+secondline;
 		alert(thirdline);
		document.mailform.elements['inhouse'].value = '';
		return false;
		}
		else
		{
		fun();
		}
			});
	});
	<!--To check the exlude vendors-->
H("#excludevendor").click(function(){

		var tax1=H("#tax1").val();
		var tax2=H("#tax2").val();
		var tax=tax1+'-'+tax2;
		H.post("index2.php?option=com_camassistant&controller=invitations&task=verfiryexcludeid", {queryString: ""+tax+""}, function(data){
		if(data == 'invalid'){
		alert("Already, the vendor with this TAX ID excluded by you.");
		return false;
		}
		else
		{
		exclude();
		}
			});
	});
		<!--To check the exlude vendors-->
	});
  //Functio to verify taxid by sateesh on 03-08-11 completed
  function toclosecancel(){
  window.parent.document.getElementById( 'sbox-window' ).close();
  }
	</script>

<div id="l_box">
<div id="l_box_topcurve" style="height:14px; margin:15px 15px -10px 15px;">
  <div id="l_box_close"></div>
  <?php if($_REQUEST['id'] == 'preferred') {?>
  <p style="font-size:17px;"><strong>INVITE A VENDOR TO BE A PREFERRED VENDOR</strong></p>
<?php } else if($_REQUEST['id'] == 'inhouse') {?>  
  <p style="font-size:17px;"><strong>INVITE A VENDOR TO BE A IN-HOUSE VENDOR</strong></p>
<?php } else {?>
  <p style="font-size:17px;"><strong>EXCLUDE A VENDOR</strong></p>
  <?php } ?>
</div>
<div align="right" id="topborder_row" style="padding-top:4px; margin:15px;"></div>
<form style="padding:0px; margin:0px;" action="<?php echo JRoute::_( 'index.php' ); ?>" method="post" name="mailform" >
<div id="l_box_midbg" style="margin-top:17px;">
<?php if($_REQUEST['id'] != 'exclude') { ?>
<!--<p style="padding:0px; margin:0px; padding-left:165px; color:red; margin-bottom:5px;"> Insert only one email address per invitation 	</p>-->
<?php } ?>
	 <?php if($_REQUEST['id'] == 'exclude') { ?>
    <div class="form_row"><div class="form_text">Vendor Tax ID:</div><label></label>
    
    <input value="" maxlength="2" type="text" name="tax1" id="tax1" style="width:40px; text-align:center"/>&nbsp;&nbsp;
    <input value="" maxlength="7" type="text" name="tax2" id="tax2" style="width:100px; text-align:center" />
    
    <div class="clear"></div></div>
    <?php } else {?>
    <div class="form_row"><div class="form_text" style="width:89px;">To:</div><label></label><input value="<?php echo $_REQUEST['reemail']; ?>" type="text" <?php if($_REQUEST['reemail']){ ?> readonly="readonly" <?php } ?> id="inhouse" name="inhouse" style="width:390px;" onblur="verifyemailid();"/><div class="clear"></div></div>
    
    <?php } ?>
<!--<div class="form_row"><div class="form_text">BCC:</div><label></label><input value="support@camassistant.com" type="text" name="inhousevendors" style="width:390px;"/><div class="clear"></div></div>-->
<?php 
$db			=& JFactory::getDBO();
$user		=& JFactory::getUser();
if($_REQUEST['id'] == 'preferred') {
$subject = 'Preferred Vendor Invitation from&nbsp;'.$user->name;
}
else if($_REQUEST['id'] == 'inhouse') {
$subject = 'In-House Vendor Invitation from&nbsp;'.$user->name;
}
else{
$subject = '';
}
?>
<?php if($_REQUEST['id'] != 'exclude') { ?>
<div class="form_row"><div class="form_text" style="width:89px;">Subject:</div><label></label><input type="text" readonly="readonly" value="<?php echo $subject; ?>" name="subject" style="width:390px;"/><div class="clear"></div></div>
<?php } ?>
<div class="form_row_button">
<div class="form_text" style="width:87px;">&nbsp;</div>
<div id="txt_box">
<!--<div id="txt_box_topcurve"></div>-->
<?php if($_REQUEST['id'] == 'exclude') {?>  

<div id="txt_box_midbg"><!--<h1>Enter your text here:</h1>-->
<!--<script>edToolbar('mytxtarea'); </script>-->
<div class="clear"></div>
<?php //echo $this->data; ?>
<?php 
$db = JFactory::getDBO();
		$user	= JFactory::getUser();
		$id = $user->name;
		

$data = $data.'<br><br>Note that you can get the tax ID for the Vendor you wish to block from either the W-9 included with any proposal submitted through CAMassistant, or from the State`s Department of Corporations or equivalent.<br><br> ';
$tags = array("<p>","</p>","<br>","<br />");
$rtags = array("","\n","\n","\n");
$data = str_replace($tags, $rtags, $data);
echo $data;
 ?>
<textarea name="inhousetext" id="mytxtarea" class="ed" style=" width:361px; height:177px;" readonly="readonly"  ><?php echo $data; ?></textarea>
<div class="clear"></div>
<textarea name="inhousetext1" id="mytxtarea1"  type="hidden"  style=" display:none; width:361px;"  ><?php //echo $this->tdata; ?></textarea>
<div class="clear"></div>
</div>
<?php } else {?>
<div id="txt_box_midbg"><!--<h1>Enter your text here:</h1>-->
<!--<script>edToolbar('mytxtarea'); </script>-->
<div class="clear"></div>
<?php //echo '<pre>'; print_r($this); ?>
<textarea name="inhousetext" id="mytxtarea" readonly="readonly" class="ed" style=" width:390px; height:177px;"  ><?php echo $this->data; ?></textarea>
<div class="clear"></div>
<textarea name="inhousetext1" id="mytxtarea1"  type="hidden"  style=" display:none; width:388px;"  ><?php echo $this->tdata; ?></textarea>
<div class="clear"></div>
</div>
<?php } ?>
<?php if($_REQUEST['id'] != 'exclude'){ ?>
<img align="right" src="templates/camassistant_left/images/SEND.gif" alt="Submit Text" vspace="10" border="0" id="semdInvitation" style="cursor:pointer;" />
<a href="javascript:toclosecancel();"><img src="templates/camassistant_left/images/CancelButton.gif" style="margin-left: 81px; margin-top: 10px;"></a>
<?php } else {?>
<img align="right" src="templates/camassistant_left/images/exclude.jpg" alt="Submit Text" vspace="10" border="0" id="excludevendor" style="margin-right:30px; cursor:pointer;" />
<a href="javascript:toclosecancel();"><img src="templates/camassistant_left/images/CancelButton.gif" style="margin-left: 33px; margin-top: 10px;"></a>
	<?php } ?>
     <?php
	if($user->user_type == 13){
		$usercreator = $user->id;
		}
		else if($user->user_type == 12 && $user->dmanager == 'yes'){
		$fcompid = "SELECT comp_id  FROM #__cam_customer_companyinfo  where cust_id=".$user->id." "; 
		$db->Setquery($fcompid);
		$cmnyid = $db->loadResult();
		$scompid = "SELECT cust_id  FROM #__cam_camfirminfo  where id=".$cmnyid." "; 
		$db->Setquery($scompid);
		$usercreator = $db->loadResult();
		
		}
		else{
		
		}		
	
	 ?>
     
<input type="hidden" name="option" value="com_cam_assistant" />
<input type="hidden" name="camid" value="<?php echo $usercreator; ?>" />
<?php if($_REQUEST['id'] == 'exclude') {?> 
<input type="hidden" name="task" value="exclude" /> 
<?php } else {?>
<input type="hidden" name="controller" value="vendorscenter" />
<input type="hidden" name="task" value="inhousevendors" />
<?php } ?>
<input type="hidden" name="vendortype" value="inhousetype" />
<input type="hidden" name="Itemid" value="<?php echo $_REQUEST['Itemid']; ?>" />
<input type="hidden" name="fei" value="<?php echo $this->fei; ?>" />
<?php
if($_REQUEST['reemail']){ ?>
<input type="hidden" name="remail" value="<?php echo $_REQUEST['reemail']; ?>" />
<?php }
 ?>
  <?php if($_REQUEST['id'] == 'preferred') {?>
  <input type="hidden" name="invitecode" value="<?php echo $this->inc; ?>" />
  <?php } ?>
<?php echo JHTML::_( 'form.token' ); ?>


<!--<div id="txt_box_botomcurve"></div>-->
</div>
<div class="clear"></div></div>

<div class="form_row">
<div id="txt_box"></div>
<div class="clear"></div>
</div>

<div class="clear"></div>
</div>
</form>

<!--<div id="l_box_botomcurve"></div>-->

</div>
<?php exit; ?>
</div>
</body>
</html>
