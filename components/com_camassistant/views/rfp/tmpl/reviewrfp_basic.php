<?php
$globals = $this->globals ;
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');
JHTML::_('behavior.modal');
JHTML::_('behavior.calendar');
jimport( 'joomla.html.html' );
$propertyList=$this->propertyList;
$industryList=$this->industryList;
$user=& JFactory::getuser();
?>

<link rel="stylesheet" media="all" type="text/css" href="<?php echo Juri::base(); ?>components/com_camassistant/skin/css/jquery1.css" />
<script type="text/javascript" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript">
function PrintDiv() {    
	var divToPrint = document.getElementById('vender_right2');
    var popupWin = window.open('', '_blank', 'width=300,height=300');
    popupWin.document.open();
    popupWin.document.write('<html><body onload="window.print()">' + divToPrint.innerHTML + '</html>');
    popupWin.document.close(); 	
		}	
</script>
	 
<script>
G = jQuery.noConflict();
function fn_submitRFP(rfpType)
{
	frm=document.adminForm;
	frm.rfp_type.value=rfpType;
	K(document).ready(function (){
	   K("#loading-div-background").show();
    });
	frm.submit();
}

function goback()
{
window.location ='index.php?option=com_camassistant&controller=rfpcenter&task=dashboard&Itemid=125';
}
</script>
<style type="text/css">
.checkbox, .radio {
	width: 19px;
	height: 25px;
	padding: 0 5px 0 0;
	background: url(checkbox.png) no-repeat;
	display: block;
	clear: left;
	float: left;
}
.radio {
	background: url(radio.png) no-repeat;
}
.select {
	position: absolute;
	width: 158px; /* With the padding included, the width is 190 pixels: the actual width of the image. */
	height: 21px;
	padding: 0 24px 0 8px;
	color: #fff;
	font: 12px/21px arial,sans-serif;
	background: url(select.png) no-repeat;
	overflow: hidden;
}

</style>
<script type="text/javascript">
var checkboxHeight = "25";
var radioHeight = "25";
var selectWidth = "190";

document.write('<style type="text/css">input.styled { display: none; } select.styled { position: relative; width: ' + selectWidth + 'px; opacity: 0; filter: alpha(opacity=0); z-index: 5; } .disabled { opacity: 0.5; filter: alpha(opacity=50); }</style>');

var Custom = {
	init: function() {
		var inputs = document.getElementsByTagName("input"), span = Array(), textnode, option, active;
		for(a = 0; a < inputs.length; a++) {
			if((inputs[a].type == "checkbox" || inputs[a].type == "radio") && inputs[a].className.indexOf("styled") > -1) {
				span[a] = document.createElement("span");
				span[a].className = inputs[a].type;

				if(inputs[a].checked == true) {
					if(inputs[a].type == "checkbox") {
						position = "0 -" + (checkboxHeight*2) + "px";
						span[a].style.backgroundPosition = position;
					} else {
						position = "0 -" + (radioHeight*2) + "px";
						span[a].style.backgroundPosition = position;
					}
				}
				inputs[a].parentNode.insertBefore(span[a], inputs[a]);
				inputs[a].onchange = Custom.clear;
				if(!inputs[a].getAttribute("disabled")) {
					span[a].onmousedown = Custom.pushed;
					span[a].onmouseup = Custom.check;
				} else {
					span[a].className = span[a].className += " disabled";
				}
			}
		}
		inputs = document.getElementsByTagName("select");
		for(a = 0; a < inputs.length; a++) {
			if(inputs[a].className.indexOf("styled") > -1) {
				option = inputs[a].getElementsByTagName("option");
				active = option[0].childNodes[0].nodeValue;
				textnode = document.createTextNode(active);
				for(b = 0; b < option.length; b++) {
					if(option[b].selected == true) {
						textnode = document.createTextNode(option[b].childNodes[0].nodeValue);
					}
				}
				span[a] = document.createElement("span");
				span[a].className = "select";
				span[a].id = "select" + inputs[a].name;
				span[a].appendChild(textnode);
				inputs[a].parentNode.insertBefore(span[a], inputs[a]);
				if(!inputs[a].getAttribute("disabled")) {
					inputs[a].onchange = Custom.choose;
				} else {
					inputs[a].previousSibling.className = inputs[a].previousSibling.className += " disabled";
				}
			}
		}
		document.onmouseup = Custom.clear;
	},
	pushed: function() {
		element = this.nextSibling;
		if(element.checked == true && element.type == "checkbox") {
			this.style.backgroundPosition = "0 -" + checkboxHeight*3 + "px";
		} else if(element.checked == true && element.type == "radio") {
			this.style.backgroundPosition = "0 -" + radioHeight*3 + "px";
		} else if(element.checked != true && element.type == "checkbox") {
			this.style.backgroundPosition = "0 -" + checkboxHeight + "px";
		} else {
			this.style.backgroundPosition = "0 -" + radioHeight + "px";
		}
	},
	check: function() {
		element = this.nextSibling;
		if(element.checked == true && element.type == "checkbox") {
			this.style.backgroundPosition = "0 0";
			element.checked = false;
		} else {
			if(element.type == "checkbox") {
				this.style.backgroundPosition = "0 -" + checkboxHeight*2 + "px";
			} else {
				this.style.backgroundPosition = "0 -" + radioHeight*2 + "px";
				group = this.nextSibling.name;
				inputs = document.getElementsByTagName("input");
				for(a = 0; a < inputs.length; a++) {
					if(inputs[a].name == group && inputs[a] != this.nextSibling) {
						inputs[a].previousSibling.style.backgroundPosition = "0 0";
					}
				}
			}
			element.checked = true;
		}
	},
	clear: function() {
		inputs = document.getElementsByTagName("input");
		for(var b = 0; b < inputs.length; b++) {
			if(inputs[b].type == "checkbox" && inputs[b].checked == true && inputs[b].className.indexOf("styled") > -1) {
				inputs[b].previousSibling.style.backgroundPosition = "0 -" + checkboxHeight*2 + "px";
			} else if(inputs[b].type == "checkbox" && inputs[b].className.indexOf("styled") > -1) {
				inputs[b].previousSibling.style.backgroundPosition = "0 0";
			} else if(inputs[b].type == "radio" && inputs[b].checked == true && inputs[b].className.indexOf("styled") > -1) {
				inputs[b].previousSibling.style.backgroundPosition = "0 -" + radioHeight*2 + "px";
			} else if(inputs[b].type == "radio" && inputs[b].className.indexOf("styled") > -1) {
				inputs[b].previousSibling.style.backgroundPosition = "0 0";
			}
		}
	},
	choose: function() {
		option = this.getElementsByTagName("option");
		for(d = 0; d < option.length; d++) {
			if(option[d].selected == true) {
				document.getElementById("select" + this.name).childNodes[0].nodeValue = option[d].childNodes[0].nodeValue;
			}
		}
	}
}
window.onload = Custom.init;

function getpopuppics(pid){
el='<?php  echo Juri::base(); ?>index2.php?option=com_camassistant&controller=rfp&task=uploadpropertypic&pid='+pid;
var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 500, y:350}}"))
SqueezeBox.fromElement(el,options);
}
function unverified(vendorid,type){
if(type == 'unverified')
var height = '290';
else
var height = '230';
var el ='index.php?option=com_camassistant&controller=rfpcenter&task=vendortype&vendorid='+vendorid+'&type='+type;
var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 650, y:"+height+"}}"))
SqueezeBox.fromElement(el,options);
}

function preferredcompliance(vendorid,status){
el='<?php  echo Juri::base(); ?>index.php?option=com_camassistant&controller=vendorscenter&task=preferredcompliance&vendorid='+vendorid+'&status='+status+'';
	var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 650, y:700}}"))
	SqueezeBox.fromElement(el,options);
G("#sbox-window").addClass("newclasssate");	
}	

</script>
<style type="text/css">
.white_light_link {
	background-color:#FFF;
	border:1px solid #5096DB;
	display:none;
	height:250px;
	left:25%;
	overflow:auto;
	padding:5px;
	position:absolute;
	top:800px;
	bottom:0px;
	width:50%;
	z-index:1002;
}
</style>
 <?php
$rfpinfo=$this->rfpinfo;
$rfpuploadfiles=$this->rfpuploadfiles;
$rfplinetasks=$this->rfplinetasks;
$rfpreqinfo=$this->rfpreqinfo;

  ?>
  <div align="center"><img src="templates/camassistant_left/images/radius-butons_basic2.jpg"></div>
<p style="height:40px;"></p>
<div id="vender_right2">
<?php if($_REQUEST['var'] != 'view'){ ?>
<?php } ?>
<form action="<?php echo JRoute::_( 'index.php' );?>" method="post" name="adminForm" id="adminForm" class="form-validate" >
<?php $RFP=$this->userinfo;  ?>
<!-- sof dotshead -->
<?php /*?><div id="dotshead_blue">Review <span style="color:#8A976F;">RFP</span><div style=" float: right;height: 30px;padding: 4px 3px 0 0;width: 135px;"></div></div><?php */?>
<!-- eof dotshead -->

<div id="i_bar">
<div id="i_bar_txt" style="text-align:center;">
<span style="margin-left:53px; font-size:14px; text-transform: uppercase;"><strong><?php echo $rfpinfo->projectName; ?></strong></span></div>
<div id="i_icon"><?php
 $user = JFactory::getUser();
if ($user->user_type=='12') { ?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=95&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" style="padding-left:0px; padding-top:0px;"> </a>
<?php } else { ?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=60&amp;Itemid=113"><img src="templates/camassistant_left/images/info_icon2.png" style="padding-left:0px; padding-top:0px;"> </a>
<?php } ?></div>
</div>


<!-- sof table pan -->
<div class="table_pannel">


<div class="head_greenbg276" style="padding-left:20px;"><!--sof rfp box-->
<div id="rpf_ifo" style="margin-top:0px;">

<div id="i_bar">
<div id="i_bar_txt_small" style="text-align:center;">
<span style="margin-left:23px; font-size:14px;">
<strong>CONTACT INFO</strong>
<?php
 $user = JFactory::getUser();
if ($user->user_type=='12') { ?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=96&amp;Itemid=113"><img align="right" style="margin-top: -4px; margin-right: 4px;" alt="info" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/info_icon2.png"></a>
<?php } else { ?>
<a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=94&amp;Itemid=113"><img align="right" style="margin-top: -4px; margin-right: 4px;" alt="info" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/info_icon2.png"> </a>
<?php } ?>
 </span></div>
 </div>
 
 
 
<?php $db =& JFactory::getDBO();
$state="SELECT state_name FROM #__state where id='".$RFP->comp_state."'";
		$db->Setquery($state);
		$state_name = $db->loadResult();
		$property_id = JRequest::getVar('property_id','');
		$rfpid = JRequest::getVar('rfpid','');

		if($property_id == ''){
 $propertd="SELECT property_id FROM #__cam_rfpinfo where id='".$rfpid."'";
$db->Setquery($propertd);
$property_id = $db->loadResult();
		}

$property_details="SELECT property_name,tax_id,property_manager_id FROM #__cam_property where id='".$property_id."'";
$db->Setquery($property_details);
$property = $db->loadObject();
$detail="SELECT name,lastname,phone,extension,email FROM #__users where id='".$rfpinfo->cust_id."'";
$db->Setquery($detail);
$user_detail = $db->loadObjectlist();

$pdetail = "SELECT user_id FROM #__cam_propertyowner_link where propertyowner_id='".$user->id."' and property_id='".$property_id."'";
$db->Setquery($pdetail);
$p_detail = $db->loadResult();
$query = "SELECT U.*, R.* FROM #__cam_customer_companyinfo  as R LEFT JOIN  #__users as U ON R.cust_id = U.id LEFT JOIN #__cam_camfirminfo as C ON C.id=R.comp_id where R.cust_id='".$p_detail."'";
$db->setQuery($query);
$managerinfo = $db->loadObject();

$client = "SELECT cust_id FROM #__cam_rfpinfo where id='".$rfpid."'";
$db->Setquery($client);
$client = $db->loadResult();

$client_type = "SELECT user_type FROM #__users where id='".$client."'";
$db->Setquery($client_type);
$client_type = $db->loadResult();
if($user->user_type == '16')
$style = 'none';
else
$style = '';
		?>
    <div id="rpf_ifo_text">
<?php if ( $client_type !=16 && $managerinfo ) { ?>	
<h1 style="line-height:20px;">Property Management Company:</h1>

<span><?PHP echo $managerinfo->comp_name;  ?></span>
<?PHP echo $managerinfo->mailaddress;  ?><br />
<?PHP echo $managerinfo->comp_city;  ?>, <?PHP echo $state_name;  ?> <?PHP echo $managerinfo->comp_zip;  ?><br />
P: <?PHP echo $managerinfo->comp_phno;  ?><br />
<?php if($managerinfo->comp_alt_phno!='--')
{?>
Alt. Phone: <?PHP echo $managerinfo->comp_alt_phno; } ?><br />

<a href="http://<?PHP echo $managerinfo->comp_website;  ?>" target="_blank"><?PHP echo $managerinfo->comp_website;  ?></a>
<?php  } else {?>
<div style="display:<?php echo $style;?>">
<h1 style="line-height:20px;">Property Management Company:</h1>

<span><?PHP echo $RFP->comp_name;  ?></span>
<?PHP echo $RFP->mailaddress;  ?><br />
<?PHP echo $RFP->comp_city;  ?>, <?PHP echo $state_name;  ?> <?PHP echo $RFP->comp_zip;  ?><br />
P: <?PHP echo $RFP->comp_phno;  ?><br />
<?php if($RFP->comp_alt_phno!='--')
{?>
Alt. Phone: <?PHP echo $RFP->comp_alt_phno; } ?><br />

<a href="http://<?PHP echo $RFP->comp_website;  ?>" target="_blank"><?PHP echo $RFP->comp_website;  ?></a>
</div>
<?php }?>
<h1 style="line-height:20px; margin-top:10px;">Property Manager:</h1>
<?PHP echo $user_detail[0]->name;  ?> <?PHP echo $user_detail[0]->lastname;  ?><br />
P: <?PHP echo $user_detail[0]->phone;  ?> (x<?PHP echo $user_detail[0]->extension;  ?>)<br />
<a href="mailto:<?PHP echo $user_detail[0]->email;  ?>">Email Property Manager</a>
<br /><br />
<?php
if($user->user_type == 13 && $user->accounttype=='master')
$itemid = '209';
else if($user->user_type == 13 && $user->accounttype!='master')
$itemid = '209';
else
$itemid = '129';
?>

<a class="modal" id="editlinkmans" rel="{handler:'iframe', size:{x:370, y:300}}" href="index.php?option=com_camassistant&controller=rfp&task=shareinfo&tmpl=component" >EDIT</a>
  </div>
 <?php /*?><a class="modal" rel="{handler:'iframe', size:{x:370, y:300}}" href="index.php?option=com_camassistant&controller=rfp&task=shareinfo&tmpl=component" >
 <img align="right" style="margin-right:-3px;" alt="info sharing preferences" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/infosharing.gif"></a><?php */?></div>
    <!--<a href="#"><img height="22" align="right" width="141" alt="info sharing preferences" src="<?php //echo Juri::base(); ?>components/com_camassistant/skin/images/infosharing.gif"></a>-->

	

</div>
 </div>


  <div  class="proposal_form" style="padding-left:0px;">

<?php
$db=JFactory::getDBO();
$pimage = "SELECT property_image FROM #__cam_property WHERE id='".$property_id."' ";
$db->Setquery($pimage);
$filename = $db->loadResult();
if( $filename ) {
		$path2 = $siteURL."components/com_camassistant/assets/images/property_pictures/";
		$path1 = $filename;
		$image = $path2.$path1;	
		$image = str_replace(' ','%20',$image);
		$apath= getimagesize($image);
		$height_orig=$apath[1];
		$width_orig=$apath[0];
		$aspect_ratio = (float) $height_orig / $width_orig;
		$thumb_width =438;
		$thumb_height = round($thumb_width * $aspect_ratio) ;
		if($thumb_height == 0){
		$thumb_height = '307';
		}		
		$image = "<img  width=".$thumb_width." height=".$thumb_height." src='components/com_camassistant/assets/images/property_pictures/".$filename."'><div class='clear'></div><p style='height:20px'></p>";
		}	
else{
$image = '<div style="margin-left: 2px;">
		<div style="margin-top:-10px; display:table-cell; text-align:center; vertical-align:middle; width:432px; height:298px; box-shadow:1px 1px 2px 1px #808080;">
		<a class="uploadimagetext" href="javascript:void(0);" onclick="getpopuppics('. $property_id .');" >UPLOAD PROPERTY IMAGE</a></div></div>';
$cleamsg = '<div class="clear"></div><p style="height:20px"></p>';
} ?>
<div id="imagediv"><?php echo $image ; ?></div>
<?php echo $cleamsg; ?>

<div id="i_bar">
<div id="i_bar_txt" style="text-align:center; float:none; width:666px; font-size:14px;">
<span><strong>BASIC REQUEST #<?php echo $_REQUEST['rfpid']; ?></strong></span>
</div>
</div>

<div style="min-height:200px; margin-top: 6px; padding:5px; font-size:11px;border:1px solid #CDCDCD;">
<div style="font-size:13px;">
<label><strong>Property Name:</strong> </label>
<?php echo str_replace('_',' ',$this->propertyname);?>
</div>

<div class="signup">
<label><strong>Type of Bidding:</strong> </label>
<?php  
if($rfpinfo->bidding == '' || $rfpinfo->bidding == 'open'){
echo "Open Bidding";
}
else{
echo "Sealed Bidding";
}
?>
</div>

<div class="signup">
<label><strong>Reference Name: </strong></label>
<?php echo $rfpinfo->projectName; ?>
</div>

<div class="signup">
<label><strong>Proposals Due By:</strong></label>
<?php echo $rfpinfo->proposalDueDate; ?> 	<?php echo $rfpinfo->proposalDueTime; ?>
</div>
<br>
</div>
</div>
<br /><br />


<div id="i_bar_terms">
<div id="i_bar_txt_terms">
<span> <font style="font-weight:bold; color:#FFF; font-size:14PX;">SCOPE OF WORK (SOW)</font></span>
</div></div>
<div style="min-height:200px; margin-top: 6px; padding:5px; font-size:11px;border:1px solid #CDCDCD;">
<?php echo nl2br($rfpinfo->jobnotes); ?>
</div>
<?php
$bascifiles = $this->bascifiles ;
if($bascifiles) { ?>
<p style="height:5px;"></p>
<p><strong>Uploaded Files:</strong></p>
<p style="height:10px;"></p>
<table cellpadding="0" cellspacing="0">
	<?php for( $f=0; $f<count($bascifiles); $f++ ){ 
			if($bascifiles[$f]->filename != '' && $bascifiles[$f]->filename != ' ') {
	?>
		<tr class="basicfiles<?php echo $bascifiles[$f]->id; ?>"><td>
		
		<a href="index.php?option=com_camassistant&controller=documents&task=viewbasicfile&filename=<?php echo $bascifiles[$f]->filename; ?>&filepath=<?php echo $bascifiles[$f]->filepath; ?>&rfpid=<?php echo $rfpid; ?>" class="deletebasicfile"><img id="redimagebasci" alt="delete" src="templates/camassistant_left/images/green.png"></a></td><td>&nbsp;&nbsp;
		
		<a id="openbasicfile" href="index.php?option=com_camassistant&controller=documents&task=viewbasicfile&filename=<?php echo $bascifiles[$f]->filename; ?>&filepath=<?php echo $bascifiles[$f]->filepath; ?>&rfpid=<?php echo $rfpid; ?>"><?php  echo $bascifiles[$f]->filename ; ?> </a>
		
		</td></tr>
		<tr class="basicfiles<?php echo $bascifiles[$f]->id; ?>" height="0"></tr>
		<tr height="3"></tr>
	<?php } }
?>
<tr><td><p style="height:20px;"></p></td></tr>
	<?php 
}	
	?> </table>
	
<!-- eof line item pan -->
<br />
<div id="i_bar_terms">
<div id="i_bar_txt_terms">
<span> <font style="font-weight:bold; color:#FFF; font-size:14PX;">&nbsp;INVITED VENDORS (List is NOT visible to Vendors)</font></span>
</div></div>
<div class="lineitem_pan" style="border:none;">
<?php 
//echo "<pre>"; print_r($this->invitations); echo "</pre>";
$items = $this->invitations_basic ;
 ?>
<div id="heading_vendors_inv">
<div class="company_vendor_inv">COMPANY</div>
<div class="apple_vendor_inv">APPLE RATING</div>
<div class="compliant_vendor_inv">COMPLIANCE STATUS</div>
</div>
<?php 
if($items) {
foreach($items as $am ) {  
	if( $am->uninvited != 'uninvited' ) {
?>
<div id="preferredvendorsinvitations" style="width:657px;">
        <div class="search-panel-left_rfp_inv company_vendor_inv">
	
      <ul>
        <li><strong>
		<a href="index.php?option=com_camassistant&controller=vendors&task=vendordetailslayout&id=<?php echo $am->vendorid; ?>" target="_blank"><?php echo $am->company_name; ?></a></strong></li>
        <li><?php echo $am->name; ?> <?php echo $am->lastname; ?>: <?php echo $am->company_phone; ?>	<?php if($am->phone_ext){ echo "&nbsp;Ext.".$am->phone_ext; } ?></li>
		<?php
		$db = & JFactory::getDBO();
	$statecode  = "SELECT code from #__cam_vendor_states where id=".$am->state." " ; 
	$db->setQuery($statecode);
	$statea = $db->loadResult(); 
	?>
	<li><?php echo $am->city; ?>,&nbsp;<?php echo strtoupper($statea); ?></li>
        
        <li><a class="miniemails"  href="mailto:<?php echo $am->email; ?>">Email</a></li>
        </ul>
		
		
		
      </div>
	 
    <div class="search-panel-right_rfp_inv apple_vendor_inv">
	<?php
	$db = & JFactory::getDBO();
$ratecount = "SELECT V.apple FROM `#__cam_vendor_proposals` as U, `#__cam_rfpinfo` as V where U.proposedvendorid=".$am->vendorid." and V.apple!=0 and V.apple_publish=0 and U.proposaltype='Awarded' and U.rfpno = V.id ";
	$db->setQuery($ratecount);
	$count_vs=$db->loadObjectList();
	//To get the CAMA rAting
		$camratingf = "SELECT camrating FROM `#__users` where id=".$am->vendorid."  ";
		$db->setQuery($camratingf);
		$cam_ratingf = $db->loadResult();
		
		if($count_vs){
		for($c=0; $c<count($count_vs); $c++){
		$total = $total + $count_vs[$c]->apple ;
		}
		$camrating = "SELECT camrating FROM `#__users` where id=".$am->vendorid."  ";
		$db->setQuery($camrating);
		$cam_rating = $db->loadResult();
		
		if($cam_rating) {
		$total = $total + $cam_rating ;
		$count = count($count_vs) + 1;
		$avgrating = $total  / $count;	
		$rating =  round($avgrating, 1); 
		}
		else {
		$avgrating = $total  / count($count_vs);	
		$rating =  round($avgrating, 1); 
		}
	}
	else if($cam_ratingf){
	$rating = round($cam_ratingf, 1); 
	}
	else{
	$rating = 4 ;
	}
	
			if ($rating > 0 && $rating <= 0.50)
			{ $rate_image = $rateimage.'5.png';  $rating='0.5'; }
			elseif ($rating > 0.50 && $rating <= 1.00)
			{ $rate_image = $rateimage.'10.png'; $rating='1'; }
			elseif ($rating > 1.00 && $rating <= 1.50)
			{ $rate_image = $rateimage.'10.png'; $rating='1.5';}
			elseif ($rating > 1.50 && $rating <= 2.00)
			{ $rate_image = $rateimage.'20.png'; $rating='2';}
			elseif ($rating > 2.00 && $rating <= 2.50)
			{ $rate_image = $rateimage.'20.png'; $rating='2.5';}
			elseif ($rating > 2.50 && $rating <= 3.00)
			{ $rate_image = $rateimage.'30.png'; $rating='3';}
			elseif ($rating > 3.00 && $rating <= 3.50)
			{ $rate_image = $rateimage.'30.png'; $rating='3.5';}
			elseif ($rating > 3.50 && $rating <= 4.00)
			{ $rate_image = $rateimage.'40.png'; $rating='4';}
			elseif ($rating > 4.00 && $rating <= 4.50)
			{ $rate_image = $rateimage.'40.png'; $rating='4.5';}
			elseif ($rating > 4.50 && $rating <= 5.00)
			{ $rate_image = $rateimage.'50.png'; $rating='5';}
			else
			{ $rate_image = $rateimage.'40.png'; $rating='4';} 
			$total = 0; ?>
			<img width="130" src="templates/camassistant_left/images/<?php echo $rate_image ?>" />
			
	</div>
	
	<div class="search-panel-image_rfp_inv compliant_vendor_inv">
	  <?php 
			if($am->final_status == 'fail') {
			//$images_text = 'NON-COMPLIANT';
			$compliant_id = "noncompliant";
			$title = 'Non-Compliant';
			}
			else if($am->final_status == 'success') {
			//$images_text = 'COMPLIANT';
			$compliant_id = 'compliant';	
			$title = 'Compliant';		
			}
			else if($am->final_status == 'medium') {
			//$images_text = 'COMPLIANT & NON-COMPLIANT';
			$compliant_id = 'mediumcompliant';	
			$title = 'Compliant & Non-Compliant';		
			}
			
			?>
	  <p align="center" style="color:<?php echo $spe_color; ?>; display:block; margin-bottom:7px; font-weight:bold;">
	   <?php if($globals != 'fail'){ ?>

	<a href="javascript:void(0);" id="<?php echo $compliant_id; ?>" onclick="preferredcompliance('<?php echo $am->vendorid; ?>','<?php echo $title; ?>');" title="<?php echo $title ; ?>"><?php echo $images_text ; ?></a>
	
	<?php } else {
			echo "N/A";
			}?>
			 </p>

<?php
if( $am->subscribe_type == 'free' ) { ?>
<div class="unverifiedvendor"><a href="javascript:void(0);" onclick="unverified(<?php echo $am->vendorid; ?>,'unverified');" title="Click for more info">UNVERIFIED</a></div>
<?php } else {  ?>
<div class="verifiedvendor"><a href="javascript:void(0);" onclick="unverified(<?php echo $am->vendorid; ?>,'verified');" title="Click for more info">VERIFIED</a></div>
<?php } ?>
			 
	  </div>
	  
	  
    <div class="clr"></div>
  </div>
  <?php } 
  	}
  }
  ?>
<?php 
/*for($in=0; $in<count($this->invitations); $in++){
$invites = &$this->invitations[$in];
echo "<strong>Company: </strong>".$invites->company_name.'<br />' ;
}*/
?>
</div>
<br />
<div align="center" id="topborder_row" style="background:none;"><table><tr>
<?php if($_REQUEST['var'] != 'view'){ ?>
<td><a style="vertical-align:top" href="javascript:PrintDiv();"><img src="templates/camassistant_left/images/PRINT.gif" border="0" /></a></td>
<td><a style="vertical-align:top" href="index.php?option=com_camassistant&controller=rfp&task=editrfp&job=basic&rfpid=<?php echo $rfpinfo->id; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>" ><img src="templates/camassistant_left/images/GoBacknew.gif" border="0" /></a></td>
<td><a href="#" onclick="javascript:fn_submitRFP('rfp');" ><img src="templates/camassistant_left/images/submit.gif" border="0" /></a></td>

<?php } ?>
<?php if($_REQUEST['var'] == 'view'){ ?> 
<td><a style="vertical-align:top" href="javascript:PrintDiv();"><img src="templates/camassistant_left/images/PRINT.gif" border="0" /></a></td>
<td>
<?php if( $user->user_type == '16' ) { ?>
<a href="javascript:goback();">
<img src="templates/camassistant_left/images/goback.gif" alt="Cancel" style="vertical-align:middle; padding-right:0px;"/>
</a>
<?php } else { ?>
<a href="javascript:goback();">
<img src="templates/camassistant_left/images/goback.gif" alt="Cancel" style="vertical-align:middle; padding-right:0px;"/>
</a></td><?php } }?></tr>

</table>
</div>
<input type="hidden" name="option" value="com_camassistant" />
<input type="hidden" name="task" value="saverfpmsg" />
<input type="hidden" name="rfpid" value="<?php echo $rfpinfo->id; ?>" />
<input type="hidden" name="rfp_type" value="<?php echo $_REQUEST['rfp_type']; ?>" />
<input type="hidden" name="controller" value="rfp" />
<input type="hidden" name="property_id" value="<?php echo $_REQUEST['property_id'];?>" />
<input type="hidden" name="industry_id" value="<?php echo $_REQUEST['industry_id'];?>" />
<input type="hidden" name="Itemid" value="<?php echo $_REQUEST['Itemid'];?>" />
<?php echo JHTML::_( 'form.token' ); ?>

</form>
</div>
<!-- eof table pan -->

</div>
<div id="loading-div-background">
  <div id="loading-div" class="ui-corner-all">
    <img style="height:32px;width:32px;margin:30px;" src="templates/camassistant_left/images/loading_icon.gif" alt="Loading.."/><br>Please wait while your request is being submitted.
  </div>
</div>