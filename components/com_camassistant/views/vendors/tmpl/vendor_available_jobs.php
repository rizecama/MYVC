<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');
$Itemid = JRequest::getVar('Itemid','');
$Jobs 		= $this->Jobs;
JHTML::_('behavior.modal');
//echo "<pre>"; print_r($Jobs);
$vendor_GLI_compliance_alert = $this->vendor_GLI_compliance_alert;
$Itemid = JRequest::getVar('Itemid','');
$PLN_needed = $this->PLN_needed;
$Jobs 		= $this->Jobs;
$invitations 		= $this->Invitations;
$openjobs 		= $this->openjobs;
//echo '<pre>';print_r($openjobs);exit;
// Your custom code here
?>
<script type="text/javascript">
G = jQuery.noConflict();
G(document).ready( function(){
	G('.codeinfo_open').click(function(){
		rfpid = G(this).attr('data');
		propertyid = G(this).attr('rel');
		if(!G(this).hasClass("active")){
			getrfpdata(rfpid,propertyid);
			G('.codeinfo_open').removeClass('active');
			G(this).addClass('active');
		}
		else{
			G('#codedetails_'+rfpid).slideUp('slow').html('');
			G('.table_blue_rowdots_submitted').removeClass('active');
			G(this).removeClass('active');
			G('.codeinfo_drafts').removeClass('active');
		}
	});
	
	G('#declineinvitation').live('click' ,function (){
		rfpid = G('#declineinvitation').attr('rel');
		el='<?php  echo Juri::base(); ?>index.php?option=com_camassistant&controller=proposals&task=reasondecline&rfpid='+rfpid;
		var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 600, y:410}}"))
		SqueezeBox.fromElement(el,options);
	});
	
});

function getrfpdata(rfpid,propertyid){
	G.post("index2.php?option=com_camassistant&controller=vendors&task=getinvitationdetails", {rfp: ""+rfpid+"", propertyid: ""+propertyid+""}, function(data){
	if(data) {
		G('#codedetails_'+rfpid).removeClass('loader');
		G('.prop_details').slideUp();
		G('.table_blue_rowdots_submitted').removeClass('active');
		G('#table_blue_rowdots'+rfpid).addClass('active');
		G('#codedetails_'+rfpid).html(data).slideDown('slow');
		G('#codedetails_'+rfpid).show();
	}
	else{
		G('#codedetails_'+rfpid).removeClass('loader');
		G('#codedetails_'+rfpid).html("No data for this RFP");
	}
	});
}
</script>

<script language="javascript" type="text/javascript">
L = jQuery.noConflict();

function ITB_save(rfpid) {
var formname = document.vendor_proposal_form;
L('body,html').animate({
scrollTop: 250
},800);
		//Cancel the link behavior
		//Get the A tag
		//Get the screen height and width
		var maskHeight = L(document).height();
		var maskWidth = L(window).width();

		//Set heigth and width to mask to fill up the whole screen
		L('#mask1').css({'width':maskWidth,'height':maskHeight});
		//transition effect
		L('#mask1').fadeIn(100);
		L('#mask1').fadeTo("slow",0.8);
		//Get the window height and width
		var winH = L(window).height();
		var winW = L(window).width();
		//Set the popup window to center
		//L("#submit1").css('top',  '250');
		//L("#submit1").css('left', '582');
		L("#submit1").css('top',  winH/2-L("#submit1").height()/2);
		L("#submit1").css('left', winW/2-L("#submit1").width()/2);
		
		L("#submit1").fadeIn(2000);

		L('.window1 #done1').click(function (e) {
		var frm = document.vendor_proposal_form+rfpid;
		
		var con_name= document.getElementById('con_name_this_project').value;
		document.getElementById('contact_name_'+rfpid).value= con_name;
		if(con_name==''){
		alert('Please Enter Contact Name For This Project');
		} else {
		L('#mask1').hide();
		L('.window1').hide();
		e.preventDefault();
		L('#proposal_form_'+rfpid).submit();
		}
		//window.location = "index.php?option=com_camassistant&controller=rfp&task=editrfp&rfpid="+id+"&Itemid=87"
	});
		L('.window1 #close1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();
	});
}

/*L(document).ready(function() {
	//if close button is clicked
	L('.window1 #close1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();
	});
	//if done button is clicked
	L('.window1 #done1').click(function (e) {
		//Cancel the link behavior
		setTimeout("ITB_save()",10);
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();

	});
});*/
//setTimeout("ITB_save()",10);

	
</script>

<script type="text/javascript">
function getshowmessage(rfpid){
	el='<?php  echo Juri::base(); ?>index.php?option=com_camassistant&controller=vendors&task=showuninitedmsg&rfpid='+rfpid;
	var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 672, y:250}}"))
	SqueezeBox.fromElement(el,options);
}
</script>
<style>
#mask1 {  position:absolute;  left:0;  top:0;  z-index:9000;  background-color:#000;  display:none;}
#boxes1 .window1 {  position:absolute;  left:0;  top:0;  width:350px;  height:150px;  display:none;  z-index:9999;  padding:20px;}
#boxes1 #submit1 {  width:360px;  height:235px;  padding:10px;  background-color:#ffffff;}
#boxes1 #submit1 a{ text-decoration:none; color:#000000; font-weight:bold; font-size:20px;}
#close1 {border:0 none;cursor:pointer;height:30px;margin:0;padding:0;float:left;width:160px;}
#done1 {border:0 none;cursor:pointer;height:30px;margin:0;padding:0; color:#000000; font-weight:bold; font-size:20px;}
</style>
<?php
if($_REQUEST['msg']=='mail'){
echo '<p style="color:red; font-weight:bold; margin-bottom:-5px;">The RFP has been closed or max proposals for this RFP has been reached. You are not allowed to bid for this RFP</p>';
}
$user =& JFactory::getUser();
if($user->user_type != 11)
{ ?>
<div align="center" style="color:#0066FF; font-size:15px"> You must be logged in to view this page.  Please log in to check available jobs.</div>
<?php } else { ?>
<!-- sof bedcrumb -->
<div id="bedcrumb" style="display:none">
<ul>
<br/>
<li class="home"><a href="index.php?option=com_camassistant&controller=vendors&task=vendor_dashboard&Itemid=112">Home</a> </li>
<li>Available Jobs</li>
<!--<li><a href="#">Proposals Under Review</a></li> -->
</ul>
</div>
<!-- eof bedcrumb -->

<!-- sof dotshead -->
<div class="clear"></div>  <br />
<?PHP
	$deccount_pre_open = 0;
	for($oj=0; $oj<count($openjobs); $oj++) {
		if($openjobs[$oj]['not_interested'] == '2') {
			$deccount_pre_open ++ ;
		}
	}
?>
<div id="i_bar" style="background:#77b800;">
<div id="i_bar_txt">
<span><strong>NEW PROJECTS: Open Invitation</strong></span>
</div>
<div id="i_icon001"><a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=109&amp;Itemid=113"><img style="margin-top:6px;" src="templates/camassistant_left/images/info_icon2.png"> </a></div>
</div>
<div class="table_pannel">
<div class="table_panneldiv">
<table width="100%" cellpadding="0" cellspacing="4" class="vendortable">
<?PHP if(count($openjobs)>0 && count($openjobs) > $deccount_pre_open ) { ?>
    <tr class="vendorfirsttr">
	<td></td>
	<td width="30%" align="center" valign="middle">PROPERTY</td>
    <td width="33%" align="center" valign="middle">PROJECT NAME</td>
    <td width="15%" align="center" valign="middle">COUNTY</td>
    <td width="25%" align="center" valign="middle">REQUESTED DUE DATE</td>
   <!-- <td width="16%" align="center" valign="middle">TIME LEFT</td>-->
    <?php /*?><td width="19%" align="center" valign="middle">OPTIONS</td><?php */?>
  </tr>
  <?php //echo "<pre>"; print_r($invitations); echo "</pre>"; ?>
  
  <?PHP 
  	$deccount = 0;
  for($d=0; $d<count($openjobs); $d++) {
  			
  			if($openjobs[$d]['not_interested'] != '2') {
  		$subject = $Jobs[$d]['time_left'];
		$pattern = '|-|';
		preg_match($pattern, substr($subject,0), $matches, PREG_OFFSET_CAPTURE);
		$cnt = count($matches);
   if($openjobs[$d]['not_interested'] == '1') {?>
  <tr class="table_blue_rowdots_submitted" style="color:#808080;" color="#808080">
  <?php } else { ?>
   <tr class="table_blue_rowdots_submitted">
  <?php } ?>
  <td align="center" valign="middle" width="15">
	<a id="getcodeinfo_<?php echo $openjobs[$d]['rfp_id']; ?>" class="codeinfo_open" data="<?php echo $openjobs[$d]['rfp_id']; ?>" rel="<?php echo $openjobs[$d]['property_id']; ?>" href="javascript:void(0);"></a>
	</td>
	<td width="30%" align="center" valign="middle"><?PHP echo str_replace('_',' ',$openjobs[$d]['Propertyname']);  ?></td>
    <td width="33%" align="center" valign="middle"><?PHP  echo $openjobs[$d]['projectName']; //echo $Drafts[$d]->Prperty_id;  ?></td>
    <td width="15%" align="center" valign="middle">
	<?PHP if($openjobs[$d]['County']) echo $openjobs[$d]['County'];
		  else echo $openjobs[$d]['City'];
		  	
	  ?>
	</td>
	 <?php $main = $openjobs[$d]['proposalDueDate'];
  if($main != '0000-00-00'){
    $main = explode('-',$main);
	$date = $main[0].'-'.$main[1].'-'.$main[2];
	}
	else{
	$date = '00-00-0000';
	}

   ?>
    <td width="25%" align="center" valign="middle"><?PHP echo $date;  ?></td>
  </tr>
  <tr><td colspan="5"><div id="codedetails_<?php echo $openjobs[$d]['rfp_id']; ?>" class="prop_details" ></div></td></tr>
  <?PHP 
  		 }
		 else {
		 	$deccount ++;
		 }
		  } 
		  	}
  if(count($openjobs)<=0 || count($openjobs) == $deccount_pre_open )
 { ?>
 <tr>
    <td colspan="5"  align="center" valign="top"><p style="margin-bottom:10px; margin-top:10px;">You have not received any project invitations</p></td>
  </tr>
  <?PHP } ?>
 </table>
<div class="clear"></div>
</div>
</div>
<br /> <br />
<?PHP
	$deccount_pre = 0;
	for($de=0; $de<count($invitations); $de++) {
		if($invitations[$de]['not_interested'] == '2') {
			$deccount_pre ++ ;
		}
	}
?>
<div id="i_bar" style="background:#77b800;">
<div id="i_bar_txt">
<span><strong> NEW PROJECTS: Personally Invited </strong></span>
</div>
<div id="i_icon001"><a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=109&amp;Itemid=113"><img style="margin-top:6px;" src="templates/camassistant_left/images/info_icon2.png"> </a></div>
</div>

<div class="table_pannel">
<div class="table_panneldiv">
<table width="100%" cellpadding="0" cellspacing="4" class="vendortable">
<?PHP if(count($invitations)>0 && count($invitations) > $deccount_pre ) { ?>
    <tr class="vendorfirsttr">
	<td></td>
	<td width="30%" align="center" valign="middle">PROPERTY</td>
    <td width="33%" align="center" valign="middle">PROJECT NAME</td>
    <td width="15%" align="center" valign="middle">COUNTY</td>
    <td width="25%" align="center" valign="middle">REQUESTED DUE DATE</td>
   <!-- <td width="16%" align="center" valign="middle">TIME LEFT</td>-->
    <?php /*?><td width="19%" align="center" valign="middle">OPTIONS</td><?php */?>
  </tr>
  <?php //echo "<pre>"; print_r($invitations); echo "</pre>"; ?>
  
  <?PHP 
  	$deccount = 0;
  for($d=0; $d<count($invitations); $d++) {
  			
  			if($invitations[$d]['not_interested'] != '2' && $invitations[$d]['create_rfptype'] != 'open') {
  		$subject = $Jobs[$d]['time_left'];
		$pattern = '|-|';
		preg_match($pattern, substr($subject,0), $matches, PREG_OFFSET_CAPTURE);
		$cnt = count($matches);
   if($invitations[$d]['not_interested'] == '1') {?>
  <tr class="table_blue_rowdots_submitted" style="color:#808080;" color="#808080">
  <?php } else { ?>
   <tr class="table_blue_rowdots_submitted">
  <?php } ?>
  <td align="center" valign="middle" width="15">
	<a id="getcodeinfo_<?php echo $invitations[$d]['rfp_id']; ?>" class="codeinfo_open" data="<?php echo $invitations[$d]['rfp_id']; ?>" rel="<?php echo $invitations[$d]['property_id']; ?>" href="javascript:void(0);"></a>
	</td>
	<td width="30%" align="center" valign="middle"><?PHP echo str_replace('_',' ',$invitations[$d]['Propertyname']);  ?></td>
    <td width="33%" align="center" valign="middle"><?PHP  echo $invitations[$d]['projectName']; //echo $Drafts[$d]->Prperty_id;  ?></td>
    <td width="15%" align="center" valign="middle">
	<?PHP if($invitations[$d]['County']) echo $invitations[$d]['County'];
		  else echo $invitations[$d]['City'];
		  	
	  ?>
	</td>
	 <?php $main = $invitations[$d]['proposalDueDate'];
  if($main != '0000-00-00'){
    $main = explode('-',$main);
	$date = $main[0].'-'.$main[1].'-'.$main[2];
	}
	else{
	$date = '00-00-0000';
	}

   ?>
    <td width="25%" align="center" valign="middle"><?PHP echo $date;  ?></td>

    <?php /*?><td width="19%" align="center" valign="middle"><strong><?php
	if( $invitations[$d]['uninvited'] != 'uninvited' ){
	 if($invitations[$d]['not_interested'] == '2') { echo "DECLINED<br />"; ?></strong>
	<a href="index.php?option=com_camassistant&controller=proposals&task=vendor_proposal_form&view=proposals&Prp_id=<?PHP echo $invitations[$d]['prp_id'];  ?>&rfp_id=<?PHP echo $invitations[$d]['rfp_id'];  ?>&not_interested=<?PHP echo $invitations[$d]['not_interested'];  ?>&type=invitation&id=<?PHP echo $invitations[$d]['id']; ?>&type=invitation&jobtype=<?php echo $invitations[$d]['jobtype']?>&Itemid=<?PHP echo $Itemid; ?>">Respond to Invite</a>
	<?php } else {?>
	<a href="index.php?option=com_camassistant&controller=proposals&task=vendor_proposal_form&view=proposals&Prp_id=<?PHP echo $invitations[$d]['prp_id'];  ?>&rfp_id=<?PHP echo $invitations[$d]['rfp_id'];  ?>&not_interested=<?PHP echo $invitations[$d]['not_interested'];  ?>&type=invitation&id=<?PHP echo $invitations[$d]['id']; ?>&type=invitation&jobtype=<?php echo $invitations[$d]['jobtype']?>&Itemid=<?PHP echo $Itemid; ?>">Respond to Invite</a>
	<?php } } else { 
	echo '<a class="uninitetext_vendor" href="javascript:void(0);" onclick="getshowmessage('.$invitations[$d]['rfp_id'].');">UNINVITED</a>';
	
	}
	?>
	
	</td><?php */?>
  </tr>
  <tr><td colspan="5"><div id="codedetails_<?php echo $invitations[$d]['rfp_id']; ?>" class="prop_details" ></div></td></tr>
  <?PHP 
  		 }
		 else {
		 	$deccount ++;
		 }
		  } 
		  	}
  if(count($invitations)<=0 || count($invitations) == $deccount_pre )
 { ?>
 <tr>
    <td colspan="5"  align="center" valign="top"><p style="margin-bottom:10px; margin-top:10px;">You have not received any project invitations</p></td>
  </tr>
  <?PHP } ?>
 </table>
<div class="clear"></div>
</div>
</div>
<BR  />
<!-- eof table pan -->
<?php } ?>

<div id="boxes1">
<div id="submit1" class="window1" style="top:250px; left:582px;border:4px solid #8FD800; position:fixed;">
<div id="i_bar_terms">
<div id="i_bar_txt_terms">
<span> <font style="font-weight:bold; color:#FFF;">INVITATION ACCEPTANCE</font></span>
</div></div>
<div style="text-align:center"><font color="gray">Please confirm you would like to provide a proposal for this request by providing a contact name and clicking on SUBMIT</font><br/><br />
<strong><img src="templates/camassistant_left/images/RequiredArrow.png" />&nbsp;Contact Name for this Project:</strong><br /><br />
<input type="text" name="con_name_this_project" id="con_name_this_project" value="">
</div>
<br />
<div style="padding-top:10px; text-align:center;">
<form name="edit" id="edit" method="post">
<div id="close1" style="width:158px; margin-left:21px;" name="close1" value="Cancel"><img src="templates/camassistant_left/images/cancel.png" /></div></div>
<div id="done1" style="width:380px;" name="done1" value="Ok"><img src="templates/camassistant_left/images/submit.png" /></div>
</form>
</div>
  <div id="mask1"></div>
</div>