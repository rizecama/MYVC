<?php
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );
class addpropertyModelAddproperty extends Jmodel
{
	function __construct(){
		parent::__construct();

        global $mainframe, $option;

        $count='10';
		//$limit=$count;
		$limitstart = JRequest::getVar('limitstart', 0, '', 'int');
		$limitstart = ($limit != 0 ? (floor($limitstart / $limit) * $limit) : 0);

	//if ($_REQUEST['viewall']=='all'){
	$limit='0';
	$limitstart='0';
	//print_r($limit);
	//}
		//$this->setState('limit', $limit);
		//$this->setState('limitstart', $limitstart);

	}
	//To get property information
	function getpropertyinfo()
	{
	 	/*echo "<pre>";
		print_r($_REQUEST);exit;*/
		$db=&JFactory::getDBO();
		$query = "SELECT property_name,property_manager_id FROM #__cam_property WHERE id=".$_REQUEST['pid'];
		$db->setQuery($query);
		$pinfo = $db->loadObjectList();
		return $pinfo;
	}
	function _buildQuery()
	{
	$user =& JFactory::getUser();
	$user_id = $user->get('id');
	$db=&JFactory::getDBO();
	$cid = $_REQUEST['cid'];
	$state = JRequest::getVar('state','');
	$county = JRequest::getVar('county','');

	$sort = JRequest::getVar('sort','');
	if($sort == 'asc' || $sort == ''){
		
		if($user->user_type=='16')
         $sorting = 'order by property_name ASC';
		else
		
		$sorting = 'order by U.property_name ASC';
	}
	else{
		if($user->user_type=='16')
		$sorting = 'order by property_name DESC';
		else
	   $sorting = 'order by U.property_name DESC';
	}
	/*echo $cid.'<br />';
	echo $county ;*/
		if($state){
		$whereas[] = "U.`state` = '".$state."' ";
		}
		if($cid && $cid != 'undefined'){
		$whereas[] = "U.`property_manager_id` = ".$cid." ";
		}
		if($county){
		$whereas[] = "U.`divcounty` = ".$county." ";
		}
		
		
			if($user->user_type == 13 && $user->accounttype != 'master') {
			$totalmanagers = $this->gettotalmanagersofcamfirm();
			$whereas[] = "U.`property_manager_id` IN (".implode( ' , ' , $totalmanagers).") ";
			}
			else if($user->dmanager == 'yes'){
			$total_mangrs = $this->gettotalmanagersofdm() ;	
			$whereas[] = "U.`property_manager_id` IN (".implode( ' , ' , $total_mangrs).") ";
			}
			else if($user->user_type ==13 && $user->accounttype == 'master')
			{
			$total_mangrs = $this->getmastermanagers() ;
			$whereas[] = "U.`property_manager_id` IN (".implode( ' , ' , $total_mangrs).") ";
			}
			else if($user->user_type ==16 )
			{
			$mangerids = $this->getallmanageracounts();
		
		    $manager_ids = implode(',',$mangerids);
 	    
			$whereas[] = ' id IN ('.$manager_ids.')' ;
			 
			}
			
			else{
			$whereas[] = "U.`property_manager_id` IN (".$user->id.") ";
			}

			if($user->user_type==16 )
          $query = "SELECT *  FROM #__cam_property where publish!=1"; 
		   else
		    $query = "SELECT U.*, V.salutation,V.name,V.lastname FROM #__cam_property as U, #__users as V where U.`property_manager_id` = V.`id` and publish!=1 "; 
		   
			   
			if($whereas) {
				$query .= " AND ".implode( ' AND ', $whereas )."   ".$sorting." ";
			}
		 
	//echo $query ;	
	return $query;
	}

function getallmanageracounts()
	{
	$db =& JFactory::getDBO();
	$user=JFactory::getUser();
	$sql = "SELECT id FROM #__cam_property  where propertyowner_manage='".$user->id."' ";
	$db->setQuery($sql);
	$total_properties = $db->loadObjectList();
	$sql1 = "SELECT property_id as id FROM #__cam_propertyowner_link  where propertyowner_id='".$user->id."' AND link_value='1'";
	$db->setQuery($sql1);
	$total_properties1 = $db->loadObjectList();
	$total_properties = array_merge($total_properties,$total_properties1);
	
	foreach($total_properties as $id ){
		$managers[] = $id->id;
	}	
	
  return $managers ;
	}

	function gettotalmanagersofcamfirm(){
	$db = JFactory::getDBO();
	$user = JFactory::getUser();
	$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user->id;
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	$userid=array($user->id);
	$query_mans = "SELECT cust_id from #__cam_customer_companyinfo where comp_id = ".$comp_id." ";
	$db->setQuery($query_mans);
    $Managers_list = $db->loadObjectList();
	
	foreach( $Managers_list as $cf_mans)
		{
			$total_mangrs[] = $cf_mans->cust_id ;
		}
	if($total_mangrs){
		$totalcust_id1 = array_merge($userid,$total_mangrs); 
	}
	else{
		$totalcust_id1[] = $user->id; 
	}

	return $totalcust_id1; 	
	}
	
	function gettotalmanagersofdm(){
	$db = JFactory::getDBO();
	$user = JFactory::getUser();
	$dmmanagers = "SELECT DISTINCT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
	$db->setQuery($dmmanagers);
	$dm_managers = $db->loadObjectlist();
					
		for($i=0; $i<count($dm_managers);$i++){
			$query = "SELECT id from #__users where id='".$dm_managers[$i]->managerid."'" ;
			$db->setQuery($query);
			$total_mangrs[]=$db->loadResult();
			}

			/*if($Managers_list){
	foreach( $Managers_list as $cf_mans)
		{
			$total_mangrs[] = $cf_mans->id ;
		}
		}*/

	$userid=array($user->id);		
	if($total_mangrs){
		$totalcust_id1 = array_merge($userid,$total_mangrs); 
	}
	else{
		$totalcust_id1[] = $user->id; 
	}
	 return $totalcust_id1; 		
	}
	
	
	function getmastermanagers(){
			$user =& JFactory::getUser();
			$db=&JFactory::getDBO();
			$sql1 = "SELECT firmid from #__cam_masteraccounts where masterid=".$user->id." ";
			$db->Setquery($sql1);
			$subfirms = $db->loadObjectlist();
			
	if($subfirms)
		{
			for( $a=0; $a<count($subfirms); $a++ )
				{
					$firmid1[] = $subfirms[$a]->firmid;
					$sql = "SELECT id from #__cam_camfirminfo where cust_id=".$subfirms[$a]->firmid." ";
					$db->Setquery($sql);
					$companyid[] = $db->loadResult();
											
				}
				
        }
			
	if($companyid)
		{
         	for( $c=0; $c<count($companyid); $c++ )
				{
					$sql_cid = "SELECT cust_id from #__cam_customer_companyinfo where comp_id=".$companyid[$c]." ";
					$db->Setquery($sql_cid);
					$managerids = $db->loadObjectList();
						if($managerids) {
							foreach( $managerids as $last_mans){
								$total_mangrs[] = $last_mans->cust_id ;
							}
						}
               }
        }
	
	if($firmid1 && $total_mangrs )
		{
            $total_mangrs = array_merge($total_mangrs,$firmid1); 
        }
        if($firmid1){
            for( $d=0; $d<count($firmid1); $d++ ){
        $query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$firmid1[$d];
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	$userid=array($user->id);
	$query_mans = "SELECT cust_id from #__cam_customer_companyinfo where comp_id = ".$comp_id." ";
	$db->setQuery($query_mans);
        $Managers_list1 = $db->loadObjectList();
                if($Managers_list1) {
                        foreach( $Managers_list1 as $Managers_list2){
                                $Managers_list[] = $Managers_list2->cust_id ;
                        }
                }
            }
            if($Managers_list){
        $total_mangrs = array_merge($Managers_list,$firmid1);
            } else {
         $total_mangrs = $firmid1;        
            }
        }
	/*if($firmid1){
            $total_mangrs = $firmid1;
        }
         */
        $userid=array($user->id);
        if($total_mangrs){
        $total_mangrs = array_merge($userid,$total_mangrs); 
		}
		else{
		$total_mangrs[] = $user->id; 
		}
		 
		return $total_mangrs;
	}
//completed

function managemanagers(){
		$user =& JFactory::getUser();
		$db=&JFactory::getDBO();
			if($user->user_type == 13 && $user->accounttype != 'master') {
			$totalmanagers = $this->gettotalmanagersofcamfirm();
			$whereas[] = "`id` IN (".implode( ' , ' , $totalmanagers).") ";
			}
			else if($user->dmanager == 'yes'){
			$total_mangrs = $this->gettotalmanagersofdm() ;	
			$whereas[] = "`id` IN (".implode( ' , ' , $total_mangrs).") ";
			}
			else if($user->user_type ==13 && $user->accounttype == 'master')
			{
			$total_mangrs = $this->getmastermanagers() ;
			$whereas[] = "`id` IN (".implode( ' , ' , $total_mangrs).") ";
			}
			else{
			$whereas[] = "`id` IN (".$user->id.") ";
			}
		$query = "SELECT id,name,lastname FROM #__users where block='0' "; 
			if($whereas) {
				$query .= " AND ".implode( ' AND ', $whereas )."   ";
			}
			
			$db->setQuery($query);
       	 	$managers_mans=$db->loadObjectList();
			return $managers_mans;
	}
	
function getPagination()
	{
		// Lets load the content if it doesn't already exist
if (empty($this->_pagination))
{
jimport('joomla.html.pagination');
$this->_pagination = new JPagination( $this->getTotal(), $this->getState('limitstart'), $this->getState('limit') );
}

		return $this->_pagination;
	}

	function getTotal()
	{
		//DEVNOTE: Lets load the content if it doesn't already exist
		if (empty($this->_total))
		{
			$query = $this->_buildQuery();
			$this->_total = $this->_getListCount($query);
		}
		return $this->_total;
	}
function getData()
	{
		

		//DEVNOTE: Lets load the content if it doesn't already exist
		if (empty($this->_data))
		{
			$query = $this->_buildQuery();
			//$query = $this->_buildQuery1();
			$this->_data = $this->_getList($query, $this->getState('limitstart'), $this->getState('limit'));
		}
		return $this->_data;
}
//Getting states list by sateesh on 02-08-11
function getStates(){
		$db =& JFactory::getDBO();
//		$query = "SELECT code,state FROM #__cam_vendor_states ";
		$query = "SELECT * FROM #__state";
		$db->setQuery($query);
        $states=$db->loadObjectList();
		return $states;

}
//Getting states list by sateesh on 02-08-11 completed
//Getting Board members list
function getboardmembers(){
		$db =& JFactory::getDBO();
		$user =& JFactory::getUser();
        $user_id = $user->get('id');

		$query = "SELECT id,firstname,lastname,email,board_position FROM #__cam_board_mem where user_id= ".$user_id." ";
		$db->setQuery($query);
        $bmembers=$db->loadObjectList();

		return $bmembers;


}
function getProperties(){

		$db=&JFactory::getDBO();
		$user =& JFactory::getUser();
		$user_id = $user->get('id');
		//$query = "SELECT id as value,property_name as text FROM #__cam_property WHERE property_manager_id= ".$user_id." ORDER BY text ASC";
		$db->setQuery($query);
		$propertyList = $db->loadObjectList();

		return $propertyList;


}
function store_boardmember($data)
	{
	 	// give me JTable object
		$row =& $this->getTable('addboardmember');
		jimport('joomla.user.helper');

		// Bind the form fields to the  table
		if (!$row->bind($data)) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}
		// Store the  detail record into the database
		if (!$row->store()) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		return true;
	}
//Completed

////Save the property
function store($data){
        // get the table
//echo "in model";	echo "<pre>"; print_r($data); exit;
JTable::addIncludePath(JPATH_COMPONENT.DS.'tables');
$row =& $this->getTable('addproperty');

//echo '<pre>'; print_r($row); exit;
//$row = JTable::getInstance('addproperty','Table');
        if (!$row->bind($data)) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        if (!$row->check()) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        if (!$row->store()) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        return true;
}
//get customers
function getcustmers(){
		$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$db=&JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
		
		$query_man = "SELECT id FROM #__cam_customer_companyinfo WHERE cust_id=".$user_id;
		$db->setQuery($query_man);
		$comp_id_man = $db->loadResult();
		if(!$comp_id)
		$companyid = $comp_id_man ;
		else
		$companyid = $comp_id;
		
		$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where (V.comp_id = ".$companyid." or U.id=".$user_id.") and U.id=V.cust_id ORDER BY U.lastname ASC";
		if($user->user_type ==13 && $user->accounttype == 'master')
		{$sql1 = "SELECT firmid from #__cam_masteraccounts where masterid=".$user->id." ";
			$db->Setquery($sql1);
			$subfirms = $db->loadObjectlist();
			//echo "<pre>"; print_r($subfirms); echo "</pre>";
	if($subfirms)
		{
			for( $a=0; $a<count($subfirms); $a++ )
				{
					$companyid = '';
					$firmid1[] = $subfirms[$a]->firmid;
					$sql = "SELECT id from #__cam_camfirminfo where cust_id=".$subfirms[$a]->firmid." ";
					$db->Setquery($sql);
					$companyid[] = $db->loadResult(); 
				}
				//echo "<pre>"; print_r($firmid1); echo "</pre>";	
        }
			
	if($companyid)
		{
         	for( $c=0; $c<count($companyid); $c++ )
				{
					$sql_cid = "SELECT cust_id from #__cam_customer_companyinfo where comp_id=".$companyid[$c]." ";
					$db->Setquery($sql_cid);
					$managerids = $db->loadObjectList();
						if($managerids) {
							foreach( $managerids as $last_mans){
								$total_mangrs[] = $last_mans->cust_id ;
							}
						}
               }
        }
		
	if($firmid1 && $total_mangrs )
		{
            $total_mangrs = array_merge($total_mangrs,$firmid1); 
        }
	if($firmid1){
            for( $d=0; $d<count($firmid1); $d++ ){
        $query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$firmid1[$d];
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	$userid=array($user->id);
	$query_mans = "SELECT cust_id from #__cam_customer_companyinfo where comp_id = ".$comp_id." ";
	$db->setQuery($query_mans);
        $Managers_list1 = $db->loadObjectList();
                if($Managers_list1) {
                        foreach( $Managers_list1 as $Managers_list2){
                                $Managers_list[] = $Managers_list2->cust_id ;
                        }
                }
            }
       if($Managers_list){
        $total_mangrs = array_merge($Managers_list,$firmid1);
            } else {
         $total_mangrs = $firmid1;        
            }
        }		
        $userid=array($user->id);
        if($total_mangrs){
        $total_mangrs = array_merge($userid,$total_mangrs); 
		}
		else{
		$total_mangrs[] = $user->id; 
		}
		
		$totalcust_id1_arr = implode($total_mangrs,',');
		$condition = " U.id IN (".$totalcust_id1_arr.")";
		$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where ".$condition." and U.id=V.cust_id ORDER BY U.lastname ASC";
		}
		
		//echo $query; exit;
		$db->setQuery($query);
        $custmers=$db->loadObjectList();
		return $custmers;

}
//Completed
//Completed
//For getting the deials for edit property
function getpdetails(){
		$db =& JFactory::getDBO();
		//$query = "SELECT * FROM #__cam_property where id=".$_REQUEST['pid']." ";
		$query = "SELECT U.*, V.id as cid, V.County FROM #__cam_property as U, #__cam_counties as V where U.id=".$_REQUEST['pid']." and U.state = V.State ";
		$db->setQuery($query);
        $details=$db->loadObjectList();
      
		return $details;

}
//Completed
//Function to delete property
	function getproperty_delete($cid = array())
	{
		$db = & JFactory::getDBO();
		$update_rfpinfo="UPDATE #__cam_property SET publish='1' where id=".$_REQUEST['pid']."";
		$db->setQuery($update_rfpinfo);
		$res=$db->query();
		if(!$res) {
		$this->setError($this->_db->getErrorMsg());
		return false;
		}
}
//Completed
function getbmembers()
	{
	    /*****************code to send to fnd**************************/
	    JHTML::_('behavior.modal');
        $uri	=& JURI::getInstance();
		$base	= $uri->toString( array('scheme', 'host', 'port'));
		$link	= $base;
		$url	= 'index.php?option=com_camassistant&controller=addproperty&task=boardmemberslist';
		$status = 'width=450,height=500,menubar=yes,resizable=yes';
		$text = '<img src="templates/camassistant_left/images/select-my-bmembers.gif" alt="select industry"   />';
        $attribs['rel']	= "{handler: 'iframe', size: {x: 660, y: 550}}";
		$attribs['class']	= 'modal';
		$attribs['title']	= JText::_( 'Board Members' );
		//$attribs['onclick'] = "window.open(this.href,'win2','".$status."'); return false;";
		$output = JHTML::_('link', JRoute::_($url), $text, $attribs);
//		echo $output; exit;
		return $output;
		/*****************end of code to send to fnd**************************/
	}
function getstatelist()
	{
		$db =& JFactory::getDBO();
		$query_states = "SELECT * FROM #__state";
		$db->setQuery($query_states);
		$result_states = $db->loadObjectList();
		return $result_states;
	}
//Fubnction to get compnay EIN number
	function getcompanyinfo(){
		$db =& JFactory::getDBO();
		$user =& JFactory::getUser();
		$query_ein = "SELECT camfirm_license_no FROM #__cam_customer_companyinfo where cust_id=".$user->id." ";
		$db->setQuery($query_ein);
		$result_ein = $db->loadResult();
		return $result_ein;
	}
//Completed	
	function resize_pimage($files,$path,$filename){
		$resized = JPATH_COMPONENT.DS.'assets'.DS.'images'.DS.'property_pictures';
		$img = $path;
		$dimensions[0]->vendor_logo_width = 438;
		$img1=$resized;
		$apath=getimagesize($img);
		$height_orig=$apath[1]; 
		$width_orig=$apath[0]; 
		$aspect_ratio = (float) $height_orig / $width_orig;
		$width =$dimensions[0]->vendor_logo_width; 
		$height = round($width * $aspect_ratio);
		$thumb =     $this->image_resize_to_max($img,$width,$height,$img1,$filename);
		$ftmp = $filename;
        $oname = $filename;
        $fname = $path;
		$sizes = getimagesize($fname);
		$width	=	$sizes[0];
        $height	=	$sizes[1];
		$extenssion = strstr($oname, ".");
		$prod_img		= $fname;
		$prod_img_thumb =  $pdf_resized.'/'.$oname;
		move_uploaded_file($ftmp, $prod_img);
		$ret = '1';
		return $ret;
	}	
//sreenu


function get_position($pid)
{
$db = JFactory::getDBO();
$user = JFactory::getUser();
$sql = "SELECT boardmem_id From #__cam_propertyowner_link where property_id='".$pid."' AND propertyowner_id=".$user->id."";
$db->Setquery($sql);
$id = $db->loadResult();
if($id)
{
$title = "SELECT board_position From #__cam_board_mem where id='".$id."'";
$db->Setquery($title);
$title = $db->loadResult();
}
return $title;
}

function manager_propertydetails($pid)
{
       $db = JFactory::getDBO();
	   $user = JFactory::getUser();
	   $sql = "SELECT U.*, V.id as cid, V.County from #__cam_property as U, #__cam_counties as V where U.id='".$pid."' AND  U.state=V.state";
	   $db->Setquery($sql);
	   $property_info = $db->loadObject();
	   return $property_info;
	 
	  
}

function property_per($pid)
{
       $db = JFactory::getDBO();
	   $user = JFactory::getUser();
	   $sql = "SELECT vendors_p,proposals_p,invite_p,approval_p,awarding_p FROM #__cam_propertyowner_link where property_id='".$pid."' AND  propertyowner_id='".$user->id."'";
	   $db->Setquery($sql);
	   $per = $db->loadObject();
	   return $per;
	 
	  
}

function county1($pid)
{
       $db = JFactory::getDBO();
	   $user = JFactory::getUser();
	   $sql = "SELECT U.*, V.id as cid, V.County from #__cam_property as U, #__cam_counties as V where U.id='".$pid."' AND U.state=V.state";
	   $db->Setquery($sql);
	   $property_info = $db->loadObjectList();
	   return $property_info;
}
function county2($pid)
{
       $db = JFactory::getDBO();
	   $user = JFactory::getUser();
	   $sql = "SELECT U.*, V.id as cid, V.County from #__cam_property as U, #__cam_counties as V where U.id='".$pid."' AND U.state=V.state AND U.manages ='".$user->id."'";
	   $db->Setquery($sql);
	   $property_info = $db->loadObjectList();
	   return $property_info;
}

    function propertyowner_property($pid)
		{
	    $db = JFactory::getDBO();
	    $user = JFactory::getUser();
	   $sql = "SELECT U.*, V.id as cid, V.County from #__cam_property as U LEFT JOIN #__cam_counties as V ON U.state=V.state where U.id='".$pid."' AND U.manages ='".$user->id."'";
	    $db->Setquery($sql);
		$p_info = $db->loadObject();
		return $p_info;
        }
		
		function linkedpropertymanager_info($pid)
           {
			   $db = JFactory::getDBO();
			   $sql = "SELECT user_id FROM #__cam_propertyowner_link where property_id='".$pid."'";
			   $db->Setquery($sql);
			   $managerid = $db->loadResult();
			   $sql = "SELECT U.*, C.comp_name, C.camfirm_license_no from #__cam_customer_companyinfo as C , #__users as U where U.id='".$managerid."' AND U.id = C.cust_id";
			   $db->Setquery($sql);
			   $property_manager = $db->loadObject();
		        return $property_manager; 
		   }	
		
		function get_propertypermisisions($pid)
           {
				$db =& JFactory::getDBO();
				$user =& JFactory::getUser();
			   $per = "SELECT vendors_p,proposals_p,invite_p,approval_p, awarding_p from #__cam_propertyowner_link where property_id ='".$pid."' AND  propertyowner_id='".$user->id."'";
		       $db->setQuery( $per );
		       $permission = $db->loadObject();
			  return $permission;
			}
		
		
     function propertyownerinfo()
	 {
	        
        $db = JFactory::getDBO();
		$pid = JRequest::getVar('pid','');
	    $sql = "SELECT propertyowner_manage from #__cam_property where id='".$pid."'";
	    $db->Setquery($sql);
		$manages = $db->loadResult();
		if($manages)
		{
	   $sql1 = "SELECT U.phone, U.cellphone, V.altphone_ext,V.fax,U.extension from #__users as U, #__cam_propertyowner_info as V where U.id='".$manages."' AND V.user_id = '".$manages."'";
	    $db->Setquery($sql1);
		$p_info = $db->loadObject();
		return $p_info;
        }
		}

   
    function checkmangeremail($email)
	  {
	    $db = JFactory::getDBO();
		$sql = "SELECT id FROM #__users where username ='".$email."' and user_type!='13' and user_type !='11'";
		$db->Setquery($sql);
		$manger_id = $db->loadResult();
		return $manger_id;
	  }

function savenewpropertyinfo($data)
	{
	 
		$row =& $this->getTable('propertyownerproperty');
		jimport('joomla.user.helper');

		// Bind the form fields to the  table
		if (!$row->bind($data)) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}
		// Store the  detail record into the database
		if (!$row->store()) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		return true;
	}

		
	 function get_thumbnail_dimensions()
	{
		$db = JFactory::getDBO();
		$sql = "SELECT vendor_logo_height,vendor_logo_width FROM #__cam_configuration";
		$db->Setquery($sql);
		$dimensions = $db->loadObjectList();
		return $dimensions;
	}
	
			
	function image_resize_to_max($uploadfile,$max_width,$max_height,$uploadDir,$file)
	{
		/******* To Get the size and MIME type of the requested image ****/
		$size		= getimagesize($uploadfile);
		$mime		= $size['mime'];
		/********** To Create the New Image from the Restricted Image ********/
		switch($mime)
		{
			case	'image/gif'		:	$src = imagecreatefromgif($uploadfile);
										break;
			case	'image/png'		:	$src = imagecreatefrompng($uploadfile);
										break;
			default					:	$src = imagecreatefromjpeg($uploadfile);
										break;
		}
		$width		= $size[0];
		$height		= $size[1];

		//for large images
		/*********** Assiging The Maximum Width & Height of Image ****/
		if($width > $max_width || $height > $max_height)
		{
			$newwidth	= $max_width;
			$newheight	= ($height/$width)*$newwidth;
		}
		else
		{
			$newwidth	= $width;
			$newheight	= $height;
		}
		$tmp	= imagecreatetruecolor($max_width,$max_height);
         $bg = imagecolorallocate ( $tmp, 255, 255, 255 );
           imagefill ( $tmp, 0, 0, $bg );
		imagecopyresampled($tmp,$src,0,0,0,0,$max_width,$max_height,$width,$height);
		$filename = $uploadDir.DS.$file;
		switch($mime)
		{
			case	'image/gif'		:	imagegif($tmp,$filename);
										break;
			case	'image/x-png'	:
			case	'image/png'		:	imagepng($tmp,$filename);
										break;
			default					:	imagejpeg($tmp,$filename,100);
										break;
		}
		imagedestroy($src);
		imagedestroy($tmp);
	}//end of function	
}

class camassistantModelAddproperty extends Jmodel
{
function __construct(){
		parent::__construct();
}



}
?>
