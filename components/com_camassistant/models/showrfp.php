<?php
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );

class showrfpModelshowrfp extends Jmodel
{
	function __construct(){
		parent::__construct();
	}
	
	function store($data)
	{
	 	// give me JTable object	
		$row =& $this->getTable();
	
		jimport('joomla.user.helper');
		
		// Bind the form fields to the  table
		if (!$row->bind($data)) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		// Store the  detail record into the database
		if (!$row->store()) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		return true;
	}
	//
	
	
	
	function selproperty($proid)
	{
		$db =& JFactory::getDBO();
		$post = JRequest::get('get');
		$query = "SELECT * FROM `#__cam_property`  WHERE id = ".$proid." ORDER BY id"; 
		$db->setQuery($query);
		$result = $db->loadObjectList();
		return $result; 
	}
	
	function getinfo()
	{
		$db = & JFactory::getDBO();
		$post = JRequest::get('get');
		$query = "SELECT * FROM `#__cam_rfpinfo` where id = ".$post['rfpid'];
		$db->setQuery($query);
		$result1 = $db->loadObjectList();
		return $result1; 
	} 
	
	function selindustry($indsid)
	{
		$db =& JFactory::getDBO();
		$post = JRequest::get('get');
		$query1 = 'SELECT id,industry_name FROM `#__cam_industries` WHERE published = "1" AND id ="'.$indsid.'"';
		$db->setQuery($query1);
		$result1 = $db->loadObjectList();
		return $result1; 
	}
	
	
	function getlinetask()
	{	
		$db = & JFactory::getDBO();
		$post = JRequest::get('get');
		$query = "SELECT task_id,task_desc FROM #__cam_rfpsow_linetask where rfp_id = ".$post['rfpid']; 
		$db->setQuery($query);
		$result1 = $db->loadObjectList();
		return $result1;
	}
	
	function getdocs()
	{
		$db = & JFactory::getDBO();
		$post = JRequest::get('get');
		$query = "SELECT * FROM #__cam_rfpsow_docs where rfp_id = ".$post['rfpid'];
		$db->setQuery($query);
		$result1 = $db->loadObjectList();
		return $result1;
	}
	
	function getcats()
	{
		
		$db = & JFactory::getDBO();
		$post = JRequest::get('get');
		$query = "SELECT * FROM #__cam_rfpreq_categories where req_id = ".$post['rfpid'];
		$db->setQuery($query);
		$result1 = $db->loadObjectList();
		return $result1;

	}
	
	function gtesplreq()
	{
		$post = JRequest::get('get');
		$db = & JFactory::getDBO();
		$query = "SELECT * FROM #__cam_rfpreq_info AS M , #__cam_rfpreq_categories  AS N where M.rfp_id = ".$post['rfpid']." AND M.req_id = N.req_id";
		//$query = 'SELECT * FROM `#__cam_rfpreq_info` where rfp_id = 1';
		$db->setQuery($query);
		$result1 = $db->loadObjectList();
		return $result1;
	}
	
	function tasks_store($data)
	{
	 	// give me JTable object	
		$row =& $this->getTable('sowlinetasks');
		//echo "789<pre>";
		//print_r($data);
		//print_r($row);exit;
		jimport('joomla.user.helper');
		
		// Bind the form fields to the  table
		if (!$row->bind($data)) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}
		// Store the  detail record into the database
		if (!$row->store()) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		return true;
	}
	//
	function reqdocs_store($data)
	{
	 	// give me JTable object	
		$row =& $this->getTable('sowdocs');
		/*echo "789<pre>";
		print_r($data);
		print_r($row);exit;*/
        jimport('joomla.user.helper');
		
		// Bind the form fields to the  table
		if (!$row->bind($data)) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}
		// Store the  detail record into the database
		if (!$row->store()) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		return true;
	}
	//
	function rfpsplreqs_store($data)
	{
	 	// give me JTable object	
		$row =& $this->getTable('rfpreqinfo');
		jimport('joomla.user.helper');
		/*echo "789<pre>";
		print_r($data);
		print_r($row);exit;*/
		// Bind the form fields to the  table
		if (!$row->bind($data)) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}
		// Store the  detail record into the database
		if (!$row->store()) {
			$this->setError($this->_db->getErrorMsg());
			return false;
		}

		return true;
	}

	//function to display Properties list in the Dropdown
	function getProperties() 
	{
		global $mainframe;
		$db=&JFactory::getDBO();
		$query = "SELECT id as value,property_name as text FROM #__cam_property ORDER BY property_name ASC";
		$db->setQuery($query);
		$propertyList = $db->loadObjectList();
		return $propertyList;
	}
	//function to display Special Requirement Categoies
	function getSplRequiremntCats($pid) 
	{
		global $mainframe;
		$db=&JFactory::getDBO();
		$query = "SELECT req_id as id,req_title FROM #__cam_rfpreq_categories WHERE req_parentid=".$pid." ORDER BY req_id ASC";
		$db->setQuery($query);
		$reqCatList = $db->loadAssocList();
		return $reqCatList;
	}
	//Function to get Property Manager details using property id
	function getPManagers($property_id)
	{
		global $mainframe;
		$db=&JFactory::getDBO();
		$query = "SELECT property_manager_id FROM #__cam_property WHERE id=".$property_id;
		$db->setQuery($query);
		$property_manager_id = $db->loadResult();
		$query2 = "SELECT id,name,email,phone FROM #__users WHERE id=".$property_manager_id;
		$db->setQuery($query2);
		$pmdetails = $db->loadObjectList();
		return $pmdetails;
	}
	//Function to get Vendors details for particular Industry
	function getVendors($industry_id)
	{
		global $mainframe;
		$db=&JFactory::getDBO();
		$query = "SELECT vendor_id FROM #__cam_vendor_industries WHERE industry_id=".$industry_id;
		$db->setQuery($query);
		$vendorids = $db->loadObjectList();
		for($i=0;$i<count($vendorids);$i++)
		{
			$query2 = "SELECT id,name,email,phone FROM #__users WHERE id=".$vendorids[$i]->vendor_id;
			$db->setQuery($query2);
			$result = $db->loadObjectList();
			$vendorsinfo[$i]=$result;
		}
		return $vendorsinfo;
	}
	
	function getIndustry() 
	{
		global $mainframe;
	 	$db=&JFactory::getDBO();
		$query = "SELECT id as value,industry_name as text FROM #__cam_industries ORDER BY industry_name ASC";
		$db->setQuery($query);
		$industryList = $db->loadObjectList();
		return $industryList;
	}
	
	//function to display industries list in popup
	function getindustires() 
	{
		global $mainframe;
		if(isset($_SESSION['industries']))
		$chk_arry = $_SESSION['industries'];
		$db = JFactory::getDBO();
		$checked    = JHTML::_( 'grid.id', $i, $row->id );
		$sql = "SELECT * FROM #__cam_industries order by industry_name";
		$db->Setquery($sql);
		$objects = $db->loadObjectList();
		foreach( $objects as $key => $obj ) 
		{
			//$checked    = JHTML::_( 'grid.id', $key, $obj->industry_name);
			if(isset($chk_arry) && in_array($obj->industry_name,$chk_arry))
			$checked = "<input checked='checked' type='checkbox' onclick='isChecked(this.checked);' value='".$obj->industry_name."' name='cid[]' id='cb'".$key.">";
			else
			$checked = "<input type='checkbox' onclick='isChecked(this.checked);' value='".$obj->industry_name."' name='cid[]' id='cb'".$key.">";
			$industries[] = $checked.'&nbsp;'. $obj->industry_name;
		}
		//echo "<pre>"; print_r($industries);
	   return $industries;
	}

}
?>