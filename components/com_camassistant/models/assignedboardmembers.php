<?php
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );
class assignedboardmembersModelAssignedboardmembers extends Jmodel
{
	function __construct(){
		parent::__construct();

	}
	function getPropertynames(){
	$property = array(); 
	$db =& JFactory::getDBO();
	$user =& JFactory::getUser();
    $user_id = $user->get('id');
 	$query = "SELECT property_name,tax_id,id FROM #__cam_property where `property_manager_id` =".$user_id."" ;
	$db->setQuery($query);
    $propertynames=$db->loadObjectList();
	return $propertynames;
	}
	
	function getAddmember(){
	}
	function getBoardmembers(){
	$bmembers = array(); 
	$db =& JFactory::getDBO();
 	$query = "SELECT firstname,id,lastname FROM #__cam_board_mem " ;
	$db->setQuery($query);
    $bmembers=$db->loadObjectList();
	return $bmembers;
	}
	
	function getproperties(){
	echo $propertyid = $_REQUEST['property_id'];
	
	$db =& JFactory::getDBO();
 	$query = "SELECT property_id FROM #__cam_assignedboardmembers " ;
	$db->setQuery($query);
    $properties=$db->loadObjectList();
	//print_r($properties);
	for($i=0;$i<count($properties);$i++)
	{
	$arr[]=$properties[$i]->property_id;
	//$properties[]=$properties[$i]->property_id;
	}
	if (in_array($propertyid,$arr))
  {
$app =& JFactory::getApplication();  
$msg = 'This property already assigned to the board member';
$url = 'index.php?option=com_camassistant&controller=assignedboardmembers&Itemid=='.$_REQUEST['Itemid'].'';
$app->redirect( $url, $msg );

  }
else
  { 
  }


//	print_r($properties); exit;
	return $properties;

	}
	
	function store($data){

	JTable::addIncludePath(JPATH_COMPONENT.DS.'tables');
$row =& $this->getTable('assignedbmembers');
$row = JTable::getInstance('assignedbmembers','Table');
        if (!$row->bind($data)) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        if (!$row->check()) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        if (!$row->store()) {
                $this->setError( $row->getErrorMsg() );
                return false;
        }
        return true;

	
	}

	function getDetails(){
	$property = array(); 
	$db =& JFactory::getDBO();
	$user =& JFactory::getUser();
    $user_id = $user->get('id');
	$query = "SELECT property_id,member_id,property_name,tax_id,salutation,firstname,lastname,phone FROM #__cam_assignedboardmembers as I, #__cam_property as J, #__cam_board_mem  as K where I.manager_id =".$user_id." and I.property_id = J.id and I.member_id = K.id" ; 
	$db->setQuery($query);
    $details=$db->loadObjectList();
	return $details;
	}

function getRemove(){
$db =& JFactory::getDBO();
		$query = "DELETE FROM #__cam_assignedboardmembers   WHERE property_id =".$_REQUEST['propertyid']."";  
 $db->setQuery($query);
   $result = $db->query();
if($result){
$app =& JFactory::getApplication();  
$msg = 'This property removed successfully';
$url = 'index.php?option=com_camassistant&controller=assignedboardmembers&Itemid='.$_REQUEST['Itemid'].'';
$app->redirect( $url, $msg );
}
else {
echo "Not Deleted";
}
}
function geteditmembers(){

	$edit = array(); 
	$db =& JFactory::getDBO();
	$query = "SELECT property_name,id FROM #__cam_property where id =".$_REQUEST['propertyid']." " ;
	$db->setQuery($query);
    $pname=$db->loadObjectList();
	return $pname;
}
function geteditmembers1(){

	$edit1 = array(); 
	$db =& JFactory::getDBO();
	$query = "SELECT firstname,lastname,id FROM #__cam_board_mem where id =".$_REQUEST['memberid']." " ; 
	$db->setQuery($query);
    $mname=$db->loadObjectList();
	return $mname;

}

}
?>