<?php
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );
class camassistantModelinvitationcodes extends Jmodel
{
	function __construct(){
		parent::__construct();

	}
	



}
class invitationcodesModelinvitationcodes extends Jmodel
{
function __construct()
	{
		parent::__construct();
 
}

function adddtomyvendors($code)
{
$db =& JFactory::getDBO();
$user =& JFactory::getUser();

$camfirmid="SELECT id,user_type FROM #__users where manager_invitecode='".$code."' and user_type !=11";
$db->Setquery($camfirmid);
$camfdata = $db->loadObject();
$camfirmid = $camfdata->id ;
$usertypepre = $camfdata->user_type;
if($usertypepre == '13'){
$comp_query = "SELECT id FROM #__cam_camfirminfo where cust_id='".$camfirmid."'";
$db->Setquery($comp_query);
$company_id = $db->loadResult();
}
else{
$comp_query = "SELECT comp_id FROM #__cam_customer_companyinfo where cust_id='".$camfirmid."'";
$db->Setquery($comp_query);
$company_id = $db->loadResult();	
}
$checkvendor = "SELECT userid FROM #__vendor_inviteinfo where userid =".$camfirmid." and v_id=".$user->id." ";
$db->setQuery($checkvendor);
$exist = $db->loadResult();
if($exist)
{
$query = "UPDATE #__vendor_inviteinfo SET reddem = 'yes', invitedate = '".date('Y-m-d')."' WHERE userid ='".$exist."' and v_id=".$user->id.""; 
$db->setQuery($query);
$db->query();

}
else {
$insert_sql = "insert into #__vendor_inviteinfo values ('','".$camfirmid."','".$user->id."','".$company_id."','','preferred','','".$user->email."','".$user->email."','','','1','".date('Y-m-d')."','','','','','yes')"; 
$db->SetQuery($insert_sql);
$db->query();
}

}


function managerinfo()
{
$db =& JFactory::getDBO();
$user =& JFactory::getUser();
$comp_query = "SELECT userid,invitedate  FROM #__vendor_inviteinfo where v_id ='".$user->id."' and reddem ='yes'";
$db->Setquery($comp_query);
$manager = $db->loadObjectList();

for( $i=0;$i<count($manager);$i++ )
{
$camfirmid="SELECT user_type,name,lastname,manager_invitecode FROM #__users where id='".$manager[$i]->userid."'";
$db->Setquery($camfirmid);
$usertypepre = $db->loadObject();
$manager[$i]->manager_name = $usertypepre->name.'&nbsp;'.$usertypepre->lastname;
$manager[$i]->code = $usertypepre->manager_invitecode;
if( $usertypepre->user_type == '13' ){
$comp_query = "SELECT comp_name  FROM #__cam_camfirminfo where cust_id='".$manager[$i]->userid."'";
$db->Setquery($comp_query);
$manager[$i]->comapnay_name = $db->loadResult();
}
else{
$comp_query = "SELECT comp_name FROM #__cam_customer_companyinfo where cust_id='".$manager[$i]->userid."'";
$db->Setquery($comp_query);
$manager[$i]->comapnay_name = $db->loadResult();	
}
}

return $manager;
}

}
?>