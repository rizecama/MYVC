<?php
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright © 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );


class sortingModelsorting extends Jmodel
{
	//assigning variables
	var $_data;
	var $_total = null;
	var $_pagination = null;

	function __construct(){
		parent::__construct();

		global $mainframe, $context;

		//initialize class property
	    $this->_table_prefix = '#__cam_';
		 global $mainframe;
		 //echo "<pre>"; print_r($_REQUEST);
	    //DEVNOTE: Get the pagination request variables

		$limit = $mainframe->getUserStateFromRequest('global.list.limit', 'limit', $mainframe->getCfg('list_limit'), 'int');
	   $limitstart = JRequest::getVar('limitstart', 0, '', 'int');
      // $limit = $mainframe->getUserStateFromRequest('global.list.limit', 'limit', $default_limit, 'int');

		JRequest::setVar('limit', (int) $limit);
	// In case limit has been changed, adjust it
	$limitstart = ($limit != 0 ? (floor($limitstart / $limit) * $limit) : 0);
	//if ($_REQUEST['viewall']=='all'){
	$limit='0';
	$limitstart='0';
	//print_r($limit);
	//}
// echo $limit; echo $limitstart; exit;
	$this->setState('limit', $limit);
	$this->setState('limitstart', $limitstart);
	//print_r($total);
	//print_r($limit);

	}

	function get_masterManagers()
	{
		global $mainframe;
	   /* $db = JFactory::getDBO();
		$user = JFactory::getUser();
		$MGR_sql = 'SELECT P.id, P.property_manager_id, CONCAT(U.name," " ,U.lastname) "Fullname"
		FROM #__cam_camfirminfo AS C LEFT JOIN #__cam_customer_companyinfo AS CUS ON CUS.comp_id = C.id,
		 #__cam_property AS P LEFT JOIN #__users AS U ON U.id = P.property_manager_id
		WHERE C.cust_id = '.$user->id.'  GROUP BY P.property_manager_id order by U.name ';
		//echo '<pre>';
		//echo $MGR_sql; exit;
		$db->Setquery($MGR_sql);
		$Managers_list = $db->loadObjectList();*/
		$task_function = JRequest::getVar('task','');
		$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$user_type = $user->get('user_type');
		$db=&JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
		$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where V.comp_id = ".$comp_id." and U.id=V.cust_id and U.block=0";
		$db->setQuery($query);
        $Managers_list=$db->loadObjectList();
		if($user_type==13)
		{
		 $sql1 = "SELECT firmid from #__cam_masteraccounts where masterid=".$user->id." ";
			$db->Setquery($sql1);
			$subfirms = $db->loadObjectlist();
			//echo "<pre>"; print_r($subfirms); echo "</pre>";
	if($subfirms)
		{
			for( $a=0; $a<count($subfirms); $a++ )
				{
					$firmid1[] = $subfirms[$a]->firmid;
					$sql = "SELECT id from #__cam_camfirminfo where cust_id=".$subfirms[$a]->firmid." ";
					$db->Setquery($sql);
					$companyid[] = $db->loadResult();
											
				}
				//echo "<pre>"; print_r($firmid1); echo "</pre>";	
        }
			
	if($companyid)
		{
         	for( $c=0; $c<count($companyid); $c++ )
				{
					$sql_cid = "SELECT cust_id from #__cam_customer_companyinfo where comp_id=".$companyid[$c]." ";
					$db->Setquery($sql_cid);
					$managerids = $db->loadObjectList();
						if($managerids) {
							foreach( $managerids as $last_mans){
								$total_mangrs[] = $last_mans->cust_id ;
							}
						}
               }
        }
		
	if($firmid1 && $total_mangrs )
		{
            $total_mangrs = array_merge($total_mangrs,$firmid1); 
        }
	if($firmid1){
           
            
            for( $d=0; $d<count($firmid1); $d++ ){
        $query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$firmid1[$d];
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	$userid=array($user->id);
	$query_mans = "SELECT cust_id from #__cam_customer_companyinfo where comp_id = ".$comp_id." ";
	$db->setQuery($query_mans);
        $Managers_list1 = $db->loadObjectList();
                if($Managers_list1) {
                        foreach( $Managers_list1 as $Managers_list2){
                                $Managers_list3[] = $Managers_list2->cust_id ;
                        }
                }
            }
            if($Managers_list3){
        $total_mangrs = array_merge($Managers_list3,$firmid1);
            } else {
         $total_mangrs = $firmid1;        
            }
        
        
        }		
        $userid=array($user->id);
        if($total_mangrs){
        $totalcust_id1 = array_merge($userid,$total_mangrs); 
		}
		else{
		$totalcust_id1[] = $user->id; 
		}
			   
			  
               for($i=0; $i<count($totalcust_id1);$i++)
			{
               $query = "SELECT name,lastname,id from #__users where id='".$totalcust_id1[$i]."'";
               $db->setQuery($query);
              $Managers_list[] = $db->loadObject();
             // echo '<pre>'; print_r($Managers_list);
                }
//echo "<pre>"; print_r($Managers_list); echo "</pre>";
               //$custmers = & $this->get( 'custmers' );
				$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$user_name = $user->get('name');
		$lastname = $user->get('lastname');
		$db=&JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
                
		 //$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where V.comp_id = ".$comp_id." and U.id=V.cust_id and U.block=0 ";
		//$db->setQuery($query);
       // $Managers_list=$db->loadObjectList();
			$row1[0]->id = $user_id;
			$row1[0]->name = $user_name;
			$row1[0]->lastname = $lastname;
            $row1[]=$row1;
                      //  if($Managers_list){
			//$Managers_list1=array_merge($row1,$Managers_list);
                       // }

		} //echo "<pre>"; print_r($Managers_list1);  
		//echo "<pre>"; print_r($Managers_list);
		if($task_function == 'dm_rfps_by_managers'){
		$javascript		= 'onchange="document.RFPbydmmanager.submit();" ';
		$manager = 'filter_Properties';
		}
		else{
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		$manager = 'manager_id';
		}
		$Managers[] = JHTML::_('select.option', '0', 'Filter by Manager');
		$this->manager_id	= $mainframe->getUserStateFromRequest( $context.$manager, $manager, 0,	'string' );
		
                if($Managers_list){
		foreach( array_filter($Managers_list) as $obj )
		{
		//echo $obj->id;
		$obj->Fullname = $obj->name.' '.$obj->lastname;
			$Managers[] = JHTML::_('select.option',  $obj->id, $obj->Fullname);
		}
                }
				//echo "<pre>"; print_r($Managers);
                $Managers = JHTML::_('select.genericlist',$Managers, $manager, 'class="inputbox" size="1"  style="width: 400px; height:20px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->manager_id);
		//$Managers = JHTML::_('select.genericlist',$Managers, 'filter_Properties', 'class="inputbox" size="1"  style="width: 276px" ' . $javascript , 'value', 'text', $this->_filter_Properties);
		return $Managers;
	}
		//function to get Managers list in get rfps_by_managers.php -- lalitha
	function get_Managers()
	{
		global $mainframe;
	   /* $db = JFactory::getDBO();
		$user = JFactory::getUser();
		$MGR_sql = 'SELECT P.id, P.property_manager_id, CONCAT(U.name," " ,U.lastname) "Fullname"
		FROM #__cam_camfirminfo AS C LEFT JOIN #__cam_customer_companyinfo AS CUS ON CUS.comp_id = C.id,
		 #__cam_property AS P LEFT JOIN #__users AS U ON U.id = P.property_manager_id
		WHERE C.cust_id = '.$user->id.'  GROUP BY P.property_manager_id order by U.name ';
		//echo '<pre>';
		//echo $MGR_sql; exit;
		$db->Setquery($MGR_sql);
		$Managers_list = $db->loadObjectList();*/
		$task_function = JRequest::getVar('task','');
		$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$user_type = $user->get('user_type');
		$db=&JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
		$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where V.comp_id = ".$comp_id." and U.id=V.cust_id and U.block=0";
		$db->setQuery($query);
        $Managers_list=$db->loadObjectList();
		if($user_type==13)
		{
			//$custmers = & $this->get( 'custmers' );
				$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$user_name = $user->get('name');
		$lastname = $user->get('lastname');
		$db=&JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
		 $query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where V.comp_id = ".$comp_id." and U.id=V.cust_id and U.block=0 ";
		$db->setQuery($query);
        $Managers_list=$db->loadObjectList();
			$row1[0]->id = $user_id;
			$row1[0]->name = $user_name;
			$row1[0]->lastname = $lastname;
                        if($Managers_list){
			$Managers_list=array_merge($row1,$Managers_list);
                        }

		} //echo "<pre>"; print_r($custmers);  exit;
		//echo "<pre>"; print_r($Managers_list);
		if($task_function == 'dm_rfps_by_managers'){
		$javascript		= 'onchange="document.RFPbydmmanager.submit();" ';
		$manager = 'filter_Properties';
		}
		else{
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		$manager = 'manager_id';
		}
		$Managers[] = JHTML::_('select.option', '0', 'Filter by Manager');
		$this->manager_id	= $mainframe->getUserStateFromRequest( $context.$manager, $manager, 0,	'string' );
                if($Managers_list){
		foreach( $Managers_list as $obj )
		{
		//echo "<pre>"; print_r($obj);
		$obj->Fullname = $obj->name.' '.$obj->lastname;
			$Managers[] = JHTML::_('select.option',  $obj->id, $obj->Fullname);
		}
                }
                $Managers = JHTML::_('select.genericlist',$Managers, $manager, 'class="inputbox" size="1"  style="width: 400px; height:20px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->manager_id);
		//$Managers = JHTML::_('select.genericlist',$Managers, 'filter_Properties', 'class="inputbox" size="1"  style="width: 276px" ' . $javascript , 'value', 'text', $this->_filter_Properties);
		return $Managers;
	}

	function get_dmManagers()
	{

		global $mainframe;

		$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$user_name = $user->get('name');
		$lastname = $user->get('lastname');
		$db=&JFactory::getDBO();
		$task_function = JRequest::getVar('task','');
		//$user = JFactory::getUser();
		 $dmmanagers = "SELECT DISTINCT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
		$db->setQuery($dmmanagers);
		$dm_managers = $db->loadObjectlist();
		//echo "<pre>"; print_r($dm_managers);
	//	$where =" id=".$user_id;
	for($i=0; $i<count($dm_managers);$i++){
		//$where = $where." OR id='".$dm_managers[$i]->managerid."' ";
		//$where = str_replace('OR OR','OR',$where);
		$query = "SELECT name,lastname, id from #__users where id='".$dm_managers[$i]->managerid."' and block=0 ORDER BY name" ;
		$db->setQuery($query);
        $Managers_list=$db->loadObjectList();
		//echo '<pre>'; print_r( $Managers_list);
		$Managers1[$i]=$Managers_list[0];

		}
		//echo "<pre>"; print_r($Managers_list1);
		//echo "<pre>"; print_r($Managers1);
		    $row1[0]->id = $user_id;
			$row1[0]->name = $user_name;
			$row1[0]->lastname = $lastname;
			if($Managers1 && $Managers_list){

			$Managers_list1=array_merge($Managers1,$row1);
			$Managers_list2 = array_filter($Managers_list);
			}
//		echo '<pre>'; print_r( $Managers_list1); exit;
		//print_r($row1);
		//print_r($Managers_list1);
//		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		if($task_function == 'dm_rfps_by_managers'){
		$javascript		= 'onchange="document.RFPbydmmanager.submit();" ';
		$passingvar = 'filter_Properties';
		}
		else{
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		$passingvar = 'manager_id';
		}
		//$javascript		= 'onchange="document.RFPbydmmanager.submit();" ';
		$Managers[] = JHTML::_('select.option', '0', 'Filter by Manager');
		$this->_filter_Properties	= $mainframe->getUserStateFromRequest( $context.$passingvar, $passingvar, 0,	'string' );
		if($Managers_list1){
		foreach( $Managers_list1 as $obj )
		{
		//echo "<pre>"; print_r($obj);
		$obj->Fullname = $obj->name.' '.$obj->lastname;
			$Managers[] = JHTML::_('select.option',  $obj->id, $obj->Fullname);

		}
		}
		$Managers = JHTML::_('select.genericlist',$Managers, $passingvar, 'class="inputbox" size="1"  style="width: 400px; height:20px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->_filter_Properties);
		return $Managers;

	}
	//function to get Properties list in get rfps_by_property.php -- lalitha
	function get_Properties()
	{
		global $mainframe;
	  //  $db = JFactory::getDBO();
	//	$user = JFactory::getUser();
		//query to get Drfat proposals]
			$user =& JFactory::getUser();
	$user_id = $user->get('id');
	$db=&JFactory::getDBO();
	$cid = $_REQUEST['cid'];
	if($cid){
//	echo $cid; echo "In if"; exit;
	$user_id = $cid;
	}
	else {
	$user_id = $user_id;
	}
	$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	if(!$comp_id)
	{
		$query = "SELECT comp_id FROM #__cam_customer_companyinfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
	}
	$usertype = $user->get('user_type');
	$query = "SELECT U.*, V.salutation,V.name,V.lastname FROM #__cam_property as U, #__users as V where U.publish='0' and U.`property_manager_id` = V.`id` and V.block=0 AND company_id=".$comp_id;
	if($usertype != '13' || $cid)
	$query .= " AND U.`property_manager_id` =".$user_id;
	$query .= " ORDER BY U.id DESC";
	$db->Setquery($query);
		$Properties_list = $db->loadObjectList();
		//echo "<pre>"; print_r($Properties_list);
		/*$id = $user->id;

		$prp_sql = "SELECT * FROM #__cam_property as CP LEFT JOIN #__cam_camfirminfo as CC on CC.id= CP.company_id  where property_manager_id=".$id." order by CC.id";
		$db->Setquery($prp_sql);
		$Properties_list = $db->loadObjectList();*/
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		$Properties[] = JHTML::_('select.option', '0', 'Filter by Property');
		$this->_filter_Properties	= $mainframe->getUserStateFromRequest( $context.'filter_Properties', 'filter_Properties', 0,	'string' );
	if($Properties_list){	foreach( $Properties_list as $obj )
		{
                    $obj->property_name= str_replace('_', ' ', $obj->property_name);
			$Properties[] = JHTML::_('select.option',  $obj->id, $obj->property_name);
		}
        }
		//echo "<pre>"; print_r($vendorslist); exit;
		$Properties = JHTML::_('select.genericlist',$Properties, 'filter_Properties', 'class="inputbox" size="1"  style="width: 400px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->_filter_Properties);

		//If district manager
		if($user->dmanager == 'yes'){
		$query_managers = "SELECT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user_id;
	$db->setQuery($query_managers);
	$standard_managers = $db->loadObjectList();
		$where  = 'property_manager_id='.$user_id;
		for($s=0; $s<count($standard_managers);$s++){
		$where = $where." OR property_manager_id='".$standard_managers[$s]->managerid."' ";
		$where = str_replace('OR OR','OR',$where);
		}
 	$query = "SELECT U.id ,U.property_name, U.property_manager_id, U.tax_id, V.dmanager  FROM #__cam_property as U, #__users as V where U.publish='0' and U.`property_manager_id` = V.`id` and V.block=0 AND (".$where.") ";

		$db->Setquery($query);
		$Properties_list = $db->loadObjectList();

		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		$Properties1[] = JHTML::_('select.option', '0', 'Filter by Property');
		$this->_filter_Properties	= $mainframe->getUserStateFromRequest( $context.'filter_Properties', 'filter_Properties', 0,	'string' );
		foreach( $Properties_list as $obj )
		{
			$obj->property_name= str_replace('_', ' ', $obj->property_name);
			$Properties1[] = JHTML::_('select.option',  $obj->id, $obj->property_name);
		}
		//echo "<pre>"; print_r($vendorslist); exit;
		$Properties = JHTML::_('select.genericlist',$Properties1, 'filter_Properties', 'class="inputbox" size="1"  style="width: 400px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->_filter_Properties);
		}

		//COMPLETED


		return $Properties;
	}
	
	//Function to get the master firm properties
	function get_masterproperties()
	{
	global $mainframe;
	$user =& JFactory::getUser();
	$user_id = $user->get('id');
	$db=&JFactory::getDBO();
	$cid = $_REQUEST['cid'];
	if($cid){
	$user_id = $cid;
	}
	else {
	$user_id = $user_id;
	}

	 	$sql1 = "SELECT firmid from #__cam_masteraccounts where masterid=".$user_id." ";
		$db->Setquery($sql1);
		$subfirms = $db->loadObjectlist();
                   
		if($subfirms)
		{
			for( $a=0; $a<count($subfirms); $a++ )
				{
					$firmid1[] = $subfirms[$a]->firmid;
					$sql = "SELECT id from #__cam_camfirminfo where cust_id=".$subfirms[$a]->firmid." ";
					$db->Setquery($sql);
					$companyid[] = $db->loadResult();
											
				}
				//echo "<pre>"; print_r($firmid1); echo "</pre>";	
        }
		if($companyid) {
		$companyid = implode($companyid,',');
		}
		else{
		$companyid = '';
		}
                if($companyid){
              // foreach($companyid as $companyid1){
$sql_cid = "SELECT U.*, V.salutation,V.name,V.lastname FROM #__cam_property as U, #__users as V where  U.`property_manager_id` = V.`id` and V.block=0 AND company_id IN (".$companyid.") ";
		$db->Setquery($sql_cid);
                    $Properties_list = $db->loadObjectlist();
                //    }
                }
                
				
	
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		$Properties[] = JHTML::_('select.option', '0', 'Filter by Property');
		
		$this->_filter_Properties	= $mainframe->getUserStateFromRequest( $context.'filter_Properties', 'filter_Properties', 0,	'string' );
	if($Properties_list){	foreach( $Properties_list as $obj )
		{
                    $obj->property_name= str_replace('_', ' ', $obj->property_name);
			$Properties[] = JHTML::_('select.option',  $obj->id, $obj->property_name);
		}
        }
		//echo "<pre>"; print_r($vendorslist); exit;
		$Properties = JHTML::_('select.genericlist',$Properties, 'filter_Properties', 'class="inputbox" size="1"  style="width: 400px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->_filter_Properties);

		return $Properties;
	}
	//Completed
	
	function get_RFP_dmstatus()
	{
		global $mainframe;
		$javascript		= 'onchange="document.RFPbydmmanager.submit();" ';
		//$javascript		= 'onchange="submit();" ';
		$RFP_status[] = JHTML::_('select.option', '0', 'Filter by Status');
		$this->_filter_Status	= $mainframe->getUserStateFromRequest( $context.'filter_Status', 'filter_Status', 0,	'string' );
		$objects[0]->id 	= 'Draft';
		$objects[0]->status = 'Unsubmitted';
		$objects[1]->id 	= 'rfp';
		$objects[1]->status = 'Submitted';
		$objects[2]->id 	= 'Closed';
		$objects[2]->status = 'Closed';
		$objects[3]->id 	= 'Awarded';
		$objects[3]->status = 'Awarded';
		$objects[4]->id 	= 'Unawarded';
		$objects[4]->status = 'Unawarded';

		foreach( $objects as $obj )
		{
			$RFP_status[] = JHTML::_('select.option',  $obj->id, $obj->status);
		}

			$RFP_status_list = JHTML::_('select.genericlist',$RFP_status, 'filter_Status', 'class="inputbox" size="1"  style="width: 400px" ' . $javascript , 'value', 'text', $this->_filter_Status);

	$_SESSION['filter_Status']= $this->_filter_Status;
		return $RFP_status_list;

	}

	//function to get list of rfp status
	function get_RFP_status()
	{
		global $mainframe;
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		//$javascript		= 'onchange="submit();" ';
		$RFP_status[] = JHTML::_('select.option', '0', 'Filter by Status');
		$this->_filter_Status	= $mainframe->getUserStateFromRequest( $context.'filter_Status', 'filter_Status', 0,	'string' );
		$objects[0]->id 	= 'Draft';
		$objects[0]->status = 'Drafts';
		$objects[1]->id 	= 'rfp';
		$objects[1]->status = 'Submitted';
		$objects[2]->id 	= 'Closed';
		$objects[2]->status = 'Closed';
		$objects[3]->id 	= 'Awarded';
		$objects[3]->status = 'Awarded';
		$objects[4]->id 	= 'Unawarded';
		$objects[4]->status = 'Canceled';

		foreach( $objects as $obj )
		{
			$RFP_status[] = JHTML::_('select.option',  $obj->id, $obj->status);
		}

			$RFP_status_list = JHTML::_('select.genericlist',$RFP_status, 'filter_Status', 'class="inputbox" size="1"  style="width: 400px; height:20px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->_filter_Status);

	$_SESSION['filter_Status']= $this->_filter_Status;
		return $RFP_status_list;

	}

	//function to get list of rfp's by manager

	//function to get list of rfp's by property
	function get_RFP_list($type_id)
	{
		$db=&JFactory::getDBO();
		$user = JFactory::getUser();
		$sortid = JRequest::getVar('filter_Properties','');
		if($sortid)
		$filter =1;
		else
		$filter =0;
		$query_sorttype = "SELECT user_type FROM #__users WHERE id=".$sortid;
		$db->setQuery($query_sorttype);
		$sorttype = $db->loadResult();

		$filter_Properties = $this->_filter_Properties;
		$filter_Status = $this->_filter_Status;

		/*if($filter_Properties=='0'){
		$where = ' WHERE cust_id =' .$user->id ;
		}
		if(isset($filter_Properties) && $filter_Properties != '0')
		$where = '  WHERE '.$type_id.' ="'.$filter_Properties.'"';
		if(isset($filter_Status) && $filter_Status != '0')
		$where .= ' AND rfp_type = "'.$filter_Status.'"';
		$where .= ' AND rfp_type!= "review"';*/
		//echo $filter_Properties; echo $user->user_type;
		$rfptype = $filter_Status;
		$custid = $filter_Properties;

		if($rfptype) {
		$where = 'rfp_type="'.$rfptype.'" and cust_id="'.$user->id.'"';
		}

		if($custid) {
		$where = 'cust_id="'.$custid.'"';
		}

		if($custid && $rfptype) {
		$where = 'cust_id="'.$custid.'" and rfp_type="'.$rfptype.'"';
		}

		// when no sorting....
		if(!$custid && !$rfptype) {
		if($user->user_type == 12){
		$where = 'cust_id="'.$custid.'"';
		}
		else{
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user->id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();

		$query_get = "SELECT cust_id FROM #__cam_customer_companyinfo WHERE comp_id=".$comp_id;
		$db->setQuery($query_get);
		$managers = $db->loadObjectList();
		if($managers){
		$where  = 'cust_id='.$user->id.' OR';
		} else {
		$where  = 'cust_id='.$user->id;
		}
		for($i=0; $i<count($managers);$i++){
		$where = $where." OR cust_id='".$managers[$i]->cust_id."' ";
		$where = str_replace('OR OR','OR',$where);
		}
		}
		//$where[] = 'cust_id="'.$filter_Properties.'"';
		}

		//completed
		$db = JFactory::getDBO();
		//echo "<pre>"; print_r($_REQUEST);
	//if($_REQUEST['limitstart'])
		//$limit=$_REQUEST['limitstart'];
		//else
		$limit =0;

		//if ($_REQUEST['viewall']=='all'){
	//$_REQUEST['limit']='0';
	$limitstart='0';
	//print_r($limit);
	//}

		//if($_REQUEST['limit']){
		//$limit1= "LIMIT ".$limit.",".$_REQUEST['limit'];
		//}

		 $RFP_sql = "SELECT id, projectName, rfp_type, createdDate, apple FROM #__cam_rfpinfo where ".$where." ORDER BY createdDate DESC ".$limit1."";
//		echo $RFP_sql;
		$db->setQuery($RFP_sql);
		$RFP_list_by_Mgr = $db->loadObjectList();

		return $RFP_list_by_Mgr;
	}


	function get_RFP_list1($type_id)
	{
		$db=&JFactory::getDBO();
		$user = JFactory::getUser();
		$sortid = JRequest::getVar('filter_Properties','');
		if($sortid)
		$filter =1;
		else
		$filter =0;
		$query_sorttype = "SELECT user_type FROM #__users WHERE id=".$sortid;
		$db->setQuery($query_sorttype);
		$sorttype = $db->loadResult();

		$filter_Properties = $this->_filter_Properties;
		$filter_Status = $this->_filter_Status;

		/*if($filter_Properties=='0'){
		$where = ' WHERE cust_id =' .$user->id ;
		}
		if(isset($filter_Properties) && $filter_Properties != '0')
		$where = '  WHERE '.$type_id.' ="'.$filter_Properties.'"';
		if(isset($filter_Status) && $filter_Status != '0')
		$where .= ' AND rfp_type = "'.$filter_Status.'"';
		$where .= ' AND rfp_type!= "review"';*/
		//echo $filter_Properties; echo $user->user_type;
		$rfptype = $filter_Status;
		$custid = $filter_Properties;

		if($rfptype) {
		$where = 'rfp_type="'.$rfptype.'" and cust_id="'.$user->id.'"';
		}

		if($custid) {
		$where = 'cust_id="'.$custid.'"';
		}

		if($custid && $rfptype) {
		$where = 'cust_id="'.$custid.'" and rfp_type="'.$rfptype.'"';
		}

		// when no sorting....
		if(!$custid && !$rfptype) {
		if($user->user_type == 12){
		$where = 'cust_id="'.$custid.'"';
		}
		else{
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user->id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();

		$query_get = "SELECT cust_id FROM #__cam_customer_companyinfo WHERE comp_id=".$comp_id;
		$db->setQuery($query_get);
		$managers = $db->loadObjectList();
		if($managers){
		$where  = 'cust_id='.$user->id.' OR';
		} else {
		$where  = 'cust_id='.$user->id;
		}
		for($i=0; $i<count($managers);$i++){
		$where = $where." OR cust_id='".$managers[$i]->cust_id."' ";
		$where = str_replace('OR OR','OR',$where);
		}
		}
		//$where[] = 'cust_id="'.$filter_Properties.'"';
		}

		//completed
		$db = JFactory::getDBO();

		if($custid == 0){
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user->id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();

		$query_get = "SELECT cust_id FROM #__cam_customer_companyinfo WHERE comp_id=".$comp_id;
		$db->setQuery($query_get);
		$managers = $db->loadObjectList();
		if($managers){
		$where  = '(cust_id='.$user->id.' OR';
		} else {
		$where  = 'cust_id='.$user->id;
		}
		for($i=0; $i<count($managers);$i++){
		$where = $where." OR cust_id='".$managers[$i]->cust_id."' ";
		$where = str_replace('OR OR','OR',$where);
		}
		$where = $where .')' ;
		if($rfptype){
		$where = $where.' and rfp_type="'.$rfptype.'"' ;
		}

		}

		$RFP_sql = "SELECT id, projectName, rfp_type, createdDate, apple FROM #__cam_rfpinfo where ".$where." ORDER BY createdDate DESC ".$limit."";
		//echo $RFP_sql;
		$db->setQuery($RFP_sql);
		$RFP_list_by_Mgr1 = $db->loadObjectList();

		return $RFP_list_by_Mgr1;
	}


//function for dm managers list rfps
function get_dm_rfps_by_managers(){

	$db=&JFactory::getDBO();
		$user = JFactory::getUser();
		 $dmmanagers = "SELECT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
		$db->setQuery($dmmanagers);
		$dm_managers = $db->loadObjectlist();
		//echo '<pre>'; print_r($_REQUEST);
		$custid = JRequest::getVar('filter_Properties','');
		$rfptype = JRequest::getVar('filter_Status','');
//		echo "C".$custid.'<br />';
//		echo "R".$rfptype.'<br />'; exit;
		if($rfptype) {
					if($user->user_type==13)
				{
						$where234 = 'cust_id=968 '; ;
						$user =& JFactory::getUser();
						$user_id = $user->get('id');
						$db=&JFactory::getDBO();
						$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
						$db->setQuery($query);
						$comp_id = $db->loadResult();
						$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where V.comp_id = ".$comp_id." and U.id=V.cust_id and U.block=0 ";
						$db->setQuery($query);
						$Managers_list=$db->loadObjectList();
						//$where = $where.' OR ' ;
						for($i=0; $i<count($Managers_list);$i++){
						$where2 = $where2."  cust_id='".$Managers_list[$i]->id."' OR ";
						}
						$where = str_replace('OR OR','OR',$where) ;		
						$where = $where2.$where234;
						$where = "(".$where.") AND rfp_type='".$rfptype."'";
				}
				else{
						$where = " rfp_type='".$rfptype."'";
						$where  = $where.' AND (cust_id='.$user->id;
						for($i=0; $i<count($dm_managers);$i++){
						$where = $where." OR cust_id='".$dm_managers[$i]->managerid."' ";
						$where = str_replace('OR OR','OR',$where);
						}
						$where= $where.')';
					}
		}
		if($custid) {
		$where = 'cust_id="'.$custid.'" ';
		}

		if($custid && $rfptype) {
		$where = 'cust_id="'.$custid.'" and rfp_type="'.$rfptype.'"';
		}

		if(!$custid && !$rfptype) {
		$where  = 'cust_id='.$user->id;
		for($i=0; $i<count($dm_managers);$i++){
		$where = $where." OR cust_id='".$dm_managers[$i]->managerid."' ";
		$where = str_replace('OR OR','OR',$where);
		}
		}
		if(!$custid && !$rfptype) {
		if($user->user_type==13)
		{
			//$custmers = & $this->get( 'custmers' );
			$where234 = $where ;
		$user =& JFactory::getUser();
		$user_id = $user->get('id');
		$db=&JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user_id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();
		$query = "SELECT U.name,U.lastname, U.id from #__users as U, #__cam_customer_companyinfo as V where V.comp_id = ".$comp_id." and U.id=V.cust_id and U.block=0 ";
		$db->setQuery($query);
        $Managers_list=$db->loadObjectList();
		//$where = $where.' OR ' ;
		for($i=0; $i<count($Managers_list);$i++){
		$where2 = $where2."  cust_id='".$Managers_list[$i]->id."' OR ";
		}
		$where = str_replace('OR OR','OR',$where) ;		
		$where = $where2.$where234;
		}
		}
	  $RFP_sql = "SELECT id, projectName, rfp_type,cust_id,createdDate, apple FROM #__cam_rfpinfo where ".$where." ORDER BY createdDate DESC ".$limit."";
	//	echo $RFP_sql;
		$db->setQuery($RFP_sql);
		$dm_rfps_by_managers = $db->loadObjectList();

		return $dm_rfps_by_managers;
}


	//function pagination params from configuration
	function get_Configuration_Params()
	{
		$db = JFactory::getDBO();
		$rfps_by_property_limit_sql ="SELECT rfps_by_property_limit  FROM #__cam_configuration WHERE id=1";
		$db->setQuery($rfps_by_property_limit_sql);
		$rfps_by_property_limit = $db->loadResult();
		return $rfps_by_property_limit;
	}

	//function to get query in viewall_proposals
	function _buildQuery($type_id)
	{

		
		$db = JFactory::getDBO();
		$user = JFactory::getUser();
		$filter_Properties = JRequest::getVar('filter_Properties','');
		$filter_Status = JRequest::getVar('filter_Status','');
		$filter_industry = JRequest::getVar('filter_industry','');
		$filter_Properties = $this->_filter_Properties;
		$filter_Status = $this->_filter_Status;
        $manager_id = JRequest::getVar('manager_id','');
		
		if($filter_Properties){
		$whereas[] = "property_id = ".$filter_Properties." ";
		}
		if($filter_Status){
		$whereas[] = "rfp_type = '".$filter_Status."' ";
		}
		if($filter_industry){
		$whereas[] = "industry_id = ".$filter_industry." ";
		}
		
		if($manager_id){
			$whereas[] = "cust_id IN (".$manager_id.") ";
		}
		else{
			if( $user->dmanager == 'yes' ){
			$totalmanagers = $this->gettotalmanagersofdm($user->id);
			$whereas[] = "cust_id IN (".implode( ' , ' , $totalmanagers).") ";
			}
			else if( $user->user_type == '13' && $user->accounttype == 'master' ){
			$totalmanagers = $this->gettotalmanagers($user->id);
			$whereas[] = "cust_id IN (".implode( ' , ' , $totalmanagers).") ";
			}
			else if( $user->user_type == '13' && $user->accounttype != 'master' ){
			$totalmanagers = $this->gettotalmanagersofcamfirm($user->id);
			$whereas[] = "cust_id IN (".implode( ' , ' , $totalmanagers).") ";
			}
			else{
			$whereas[] = "cust_id IN (".$user->id.") ";
			}
		}
		
		$RFP_sql = "SELECT id, projectName, rfp_type, createdDate, apple, jobtype  FROM #__cam_rfpinfo" ;
		if($whereas) {
			$RFP_sql .= " WHERE ".implode( ' AND ', $whereas )."";
		}	
		//echo $RFP_sql; 
		
		return $RFP_sql; 
	}	
	
	function gettotalmanagersofdm($userid){
	$db = JFactory::getDBO();
	$user = JFactory::getUser();
	$dmmanagers = "SELECT DISTINCT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
	$db->setQuery($dmmanagers);
	$dm_managers = $db->loadObjectlist();
		for($i=0; $i<count($dm_managers);$i++){
			$query = "SELECT id from #__users where id='".$dm_managers[$i]->managerid."' and block=0 " ;
			$db->setQuery($query);
			$total_mangrs[] = $db->loadResult();
			}
			
			/*if($Managers_list){
	foreach( $Managers_list as $cf_mans)
		{
			$total_mangrs[] = $cf_mans->id ;
		}
		}*/
		
	$userid=array($user->id);		
	if($total_mangrs){
		$totalcust_id1 = array_merge($userid,$total_mangrs); 
	}
	else{
		$totalcust_id1[] = $user->id; 
	}
	 return $totalcust_id1; 		
	}
	
	function gettotalmanagersofcamfirm($userid){
	$db = JFactory::getDBO();
	$user = JFactory::getUser();
	$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user->id;
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	$userid=array($user->id);
	$query_mans = "SELECT cust_id from #__cam_customer_companyinfo where comp_id = ".$comp_id." ";
	$db->setQuery($query_mans);
    $Managers_list = $db->loadObjectList();
	
	foreach( $Managers_list as $cf_mans)
		{
			$total_mangrs[] = $cf_mans->cust_id ;
		}
	if($total_mangrs){
		$totalcust_id1 = array_merge($userid,$total_mangrs); 
	}
	else{
		$totalcust_id1[] = $user->id; 
	}

	return $totalcust_id1; 	
	}
	//Function to get all managers under the master
	function gettotalmanagers($userid){
	$db = JFactory::getDBO();
	$user = JFactory::getUser();
	$sql1 = "SELECT firmid from #__cam_masteraccounts where masterid=".$user->id." ";
	$db->Setquery($sql1);
	$subfirms = $db->loadObjectlist();
	
	//echo "<pre>"; print_r($subfirms); echo "</pre>";
	if($subfirms)
	{
			for( $a=0; $a<count($subfirms); $a++ )
		{
			$firmid1[] = $subfirms[$a]->firmid;
			$sql = "SELECT id from #__cam_camfirminfo where cust_id=".$subfirms[$a]->firmid." ";
			$db->Setquery($sql);
			$companyid[] = $db->loadResult();
		}
	}
	
	if($companyid)
	{
		for( $c=0; $c<count($companyid); $c++ )
		{
			$sql_cid = "SELECT cust_id from #__cam_customer_companyinfo where comp_id=".$companyid[$c]." ";
			$db->Setquery($sql_cid);
			$managerids = $db->loadObjectList();
				if($managerids) 
				{
					foreach( $managerids as $last_mans)
					{
						$total_mangrs[] = $last_mans->cust_id ;
					}
				}
		}
	}
	
	if($firmid1 && $total_mangrs )
	{
		$total_mangrs = array_merge($total_mangrs,$firmid1); 
	}
	if($firmid1){
            
            for( $d=0; $d<count($firmid1); $d++ ){
        $query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$firmid1[$d];
	$db->setQuery($query);
	$comp_id = $db->loadResult();
	$userid=array($user->id);
	$query_mans = "SELECT cust_id from #__cam_customer_companyinfo where comp_id = ".$comp_id." ";
	$db->setQuery($query_mans);
        $Managers_list1 = $db->loadObjectList();
                if($Managers_list1) {
                        foreach( $Managers_list1 as $Managers_list2){
                                $Managers_list[] = $Managers_list2->cust_id ;
                        }
                }
            }
            if($Managers_list){
        $total_mangrs = array_merge($Managers_list,$firmid1);
            } else {
         $total_mangrs = $firmid1;        
            }
        
        }	
	$userid=array($user->id);
	if($total_mangrs){
		$totalcust_id1 = array_merge($userid,$total_mangrs); 
	}
	else{
		$totalcust_id1[] = $user->id; 
	}
	
	return $totalcust_id1; 
	}
	//Completed
	
		/*$user = JFactory::getUser();
		//$where = ' WHERE 1=1 ';
		$filter_Properties = JRequest::getVar('filter_Properties','');
		$filter_Status = JRequest::getVar('filter_Status','');
		$filter_industry = JRequest::getVar('filter_industry','');
		
		$filter_Properties = $this->_filter_Properties;
		$filter_Status = $this->_filter_Status;
                $manager_id = JRequest::getVar('manager_id','');
        //echo '<pre>'; print_r($_REQUEST);
		$db = JFactory::getDBO();
		if(!$filter_Status && !$filter_Properties && !$manager_id) {
			$where = ' WHERE rfp_type!= "review"';
			} else if ($filter_Status != '0' && !$manager_id){
		$where .= ' WHERE rfp_type = "'.$filter_Status.'"';
		$where .= ' AND rfp_type!= "review"';
			} else if($manager_id){
                $where .= ' WHERE cust_id = "'.$manager_id.'"';
		$where .= ' AND rfp_type!= "review"';
                        }
		$db = JFactory::getDBO();
		$query = "SELECT id FROM #__cam_camfirminfo WHERE cust_id=".$user->id;
		$db->setQuery($query);
		$comp_id = $db->loadResult();

		$query_get = "SELECT cust_id FROM #__cam_customer_companyinfo WHERE comp_id=".$comp_id;
		$db->setQuery($query_get);
		$managers = $db->loadObjectList();
		//echo "<pre>"; print_r($_REQUEST);

		if(!$filter_Properties && !$manager_id){
		
			$where  = $where.' and ( cust_id='.$user->id.' OR ';
			for($i=0; $i<count($managers);$i++)
			{
				$where = $where."cust_id='".$managers[$i]->cust_id."' OR ";
				$RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where."";
			}
				$where  = $where.') ' ;
				$where = str_replace('OR )',')',$where) ;
				//$where = $where.' and rfp_type="'.$filter_Status.'"' ;
		//$where = ' WHERE cust_id ='.$user->id;
		}

		else {
		if($_REQUEST['filter_Properties']!='' && $filter_Status && !$manager_id){
		$where = ' WHERE property_id = "'.$filter_Properties.'" AND rfp_type = "'.$filter_Status.'" ';
		} else if($_REQUEST['filter_Properties'] && $filter_Status && $manager_id){
		$where = ' WHERE property_id = "'.$filter_Properties.'" AND rfp_type = "'.$filter_Status.'" AND cust_id = "'.$manager_id.'" ';
		}
		else if ($manager_id && $filter_Status){
		$where = ' WHERE cust_id = "'.$manager_id.'" AND rfp_type = "'.$filter_Status.'" ';
		} else if ($manager_id && $_REQUEST['filter_Properties']){
		$where = ' WHERE cust_id = "'.$manager_id.'" AND property_id = "'.$filter_Properties.'" ';
		} else if ($manager_id){
		$where = ' WHERE cust_id = "'.$manager_id.'" ' ;
		} else {
                    $where = ' WHERE property_id = "'.$filter_Properties.'" ' ;
                }
		}

		if($user->user_type ==13 && count($managers)!=0 && $filter_Status=='0' && !$manager_id){
		$where  = $where.' and ( cust_id='.$user->id.' OR ';
		for($i=0; $i<count($managers);$i++){
		$where = $where."cust_id='".$managers[$i]->cust_id."' OR ";
		$RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where."";
		}
		$where  = $where.') ' ;
				$where = str_replace('OR )',')',$where) ;
		}

		if ($filter_Status=='0') {
	 		$RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where."";

			} else {
			$RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo".$where."";
	 		}
                        
 if($user->user_type == 13 && $user->accounttype == 'master'){
        $sql1 = "SELECT firmid from #__cam_masteraccounts where masterid=".$user->id." ";
		$db->Setquery($sql1);
		$subfirms = $db->loadObjectlist();
                   
		if($subfirms){
		foreach($subfirms as $firmid){
                 $firmid1[] = $firmid->firmid;
                $sql = "SELECT id from #__cam_camfirminfo where cust_id=".$firmid->firmid." ";
		$db->Setquery($sql);
		$companyid = $db->loadObjectlist();
                    }
                }
                if($companyid){
               foreach($companyid as $companyid1){
                $sql_cid = "SELECT cust_id from #__cam_customer_companyinfo where comp_id=".$companyid1->id." ";
		$db->Setquery($sql_cid);
                    $managerids = $db->loadObjectlist();
                    }
                }
                if($managerids){
                 foreach($managerids as $managerids1){
		$firms[] = $managerids1->cust_id;
                }
                }
               if($firmid1 && $firms ){
               $totalcust_id=array_merge($firmid1,$firms); 
               }
               $userid=array($user->id);
               if($totalcust_id){
               $totalcust_id1=array_merge($userid,$totalcust_id); 
               }
              
			 
		if($_REQUEST['filter_Properties']!='' && $_REQUEST['filter_Properties']!='0' && $filter_Status && !$manager_id){
		$where = ' WHERE property_id = "'.$filter_Properties.'" AND rfp_type = "'.$filter_Status.'" ';
		} else if($_REQUEST['filter_Properties'] && $_REQUEST['filter_Properties'] != 0 && $filter_Status && $manager_id){
		$where = ' WHERE property_id = "'.$filter_Properties.'" AND rfp_type = "'.$filter_Status.'" AND cust_id = "'.$manager_id.'" ';
		}
		else if ($manager_id && $filter_Status){
		$where = ' WHERE cust_id = "'.$manager_id.'" AND rfp_type = "'.$filter_Status.'" ';
		} else if ($manager_id && $_REQUEST['filter_Properties'] && $_REQUEST['filter_Properties'] != 0 ){
		$where = ' WHERE cust_id = "'.$manager_id.'" AND property_id = "'.$filter_Properties.'" ';
		} else if ($manager_id){
		$where = ' WHERE cust_id = "'.$manager_id.'" ' ;
		} 
		else if($filter_Status &&  !$_REQUEST['filter_Properties'] && $_REQUEST['filter_Properties']=='0' && !$manager_id){
			
			$where  = ' where ( cust_id='.$user->id.' OR ';
				for($i=0; $i<count($totalcust_id);$i++)
				{
					$where = $where."cust_id='".$totalcust_id[$i]."' OR ";
				}
				$where  = $where.') ' ;
				$where = str_replace('OR )',')',$where) ;
				$where .= ' and rfp_type = "'.$filter_Status.'" ';
				
		}
		
			  else {
               $where  = 'where ( cust_id='.$user->id.' OR ';
				for($i=0; $i<count($totalcust_id);$i++)
				{
					$where = $where."cust_id='".$totalcust_id[$i]."' OR ";
				}
				$where  = $where.') ' ;
				$where = str_replace('OR )',')',$where) ;
               }
                   $RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where."";
                  
              } else if($user->dmanager == 'yes') {
              if($filter_Status=='0' && $manager_id=='0' ){
		 $filter_Properties = $this->_filter_Properties;
		 $filter_Status = $this->_filter_Status;
		 if(isset($filter_Status) && $filter_Status != '0')
			 $whered = ' rfp_type = "'.$filter_Status.'"';
		$query_managers = "SELECT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
		$db->setQuery($query_managers);
		$standard_managers = $db->loadObjectList();
		$where  = ' where (cust_id='.$user->id;
		for($s=0; $s<count($standard_managers);$s++){
		$where = $where." OR cust_id='".$standard_managers[$s]->managerid."'";
		$where = str_replace('OR OR','OR',$where);
		}
		
		$where =$where.')';

  	 $RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where." ";
	 }
	 else if($filter_Status != '0' && $manager_id=='0' && $filter_Properties == '0'){
	 	$whered = ' where rfp_type = "'.$filter_Status.'" AND ';
		$query_managers = "SELECT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
		$db->setQuery($query_managers);
		$standard_managers = $db->loadObjectList();
		$where  = '  (cust_id='.$user->id;
		for($s=0; $s<count($standard_managers);$s++){
		$where = $where." OR cust_id='".$standard_managers[$s]->managerid."'";
		$where = str_replace('OR OR','OR',$where);
		}
		$where = $whered.$where.')' ;
	 $RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where." ";	
	 }
	 else if($filter_Status != '0' && $manager_id=='0' && $filter_Properties != '0'){
	 	$whered = ' where rfp_type = "'.$filter_Status.'" AND ';
		$whered = ' where property_id = "'.$filter_Properties.'" AND ';
		$query_managers = "SELECT managerid FROM #__cam_invitemanagers WHERE dmanager=".$user->id;
		$db->setQuery($query_managers);
		$standard_managers = $db->loadObjectList();
		$where  = '  (cust_id='.$user->id;
		for($s=0; $s<count($standard_managers);$s++){
		$where = $where." OR cust_id='".$standard_managers[$s]->managerid."'";
		$where = str_replace('OR OR','OR',$where);
		}
		$where = $whered.$where.')' ;
	 $RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where." ";	
	 }
	 else{
	 $RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo ".$where." ";	
	 }
	 } //dmanager completed
	 
	  else {

	  $RFP_sql = "SELECT id, projectName, rfp_type, createdDate  FROM #__cam_rfpinfo".$where."";

	 }
        // echo $RFP_sql;
		if($filter_industry){
		$RFP_sql .=  " AND industry_id= ".$filter_industry ;
		}
		return $RFP_sql;*/
		

	//function to get records in viewall_proposals
	function get_limit_records($type_id)
	{
		$query = $this->_buildQuery($type_id);
		//echo "<pre>"; print_r($_REQUEST);
		//echo $this->getState("limitstart"); echo '---'; echo $this->getState("limit");
		$records = $this->_getList($query,$this->getState("limitstart"),$this->getState("limit"));
		//echo count($records);
		return $records;
	}


	function getTotal()
	{
		// Lets load the content if it doesn’t already exist
		if (empty($this->_total))
		{
		 $query = $this->_buildQuery($type_id);
		 $this->_total = $this->_getListCount($query);
		}
		return $this->_total;
	}
	function getPagination()
	{

		// Lets load the content if it doesn’t already exist
		if (empty($this->_pagination))
		{
		jimport('joomla.html.pagination');
		//echo "<pre>"; print_r($this->getState('limit'));
		$this->_pagination = new JPagination( $this->getTotal(), $this->getState('limitstart'), $this->getState('limit') );
		//echo "<pre>";  print_r($this->_pagination);
		}
		return $this->_pagination;
	}
	/*function getTotal1()
	{
		// Lets load the content if it doesn’t already exist
		if (empty($this->_total))
		{
		echo $query1 = $this->get_RFP_list($type_id);
		$this->_total1 = $this->_getListCount($query1);
		}
		return $this->_total1;
	}
	function getPagination1()
	{

		// Lets load the content if it doesn’t already exist
		if (empty($this->_pagination1))
		{
		jimport('joomla.html.pagination');
		//echo "<pre>"; print_r($this->getState('limit'));
		$this->_pagination1 = new JPagination( $this->getTotal1(), $this->getState('limitstart'), $this->getState('limit') );
		//echo "<pre>";  print_r($this->_pagination);
		}
		return $this->_pagination1;
	}*/
	//function to get pagination for all types of proposals in viewall_proposals
	function getPagination1($type_id)
	{
		// Lets load the content if it doesn’t already exist
		if (empty($this->_pagination1))
		{
		jimport('joomla.html.pagination');
		$total2 = $this->get_RFP_list1($type_id);

		 $total3 = count($total2);
		// echo $total3;
		//$limit=$total1-$this->getState('limitstart');

		$this->_pagination1 = new JPagination($total3, $this->getState('limitstart'), $this->getState('limit'));
		}
		//print_r($this->getState('limitstart'));

		//echo "<pre>"; print_r($this->_pagination1);

		return $this->_pagination1;
	}
	function getPagination5($type_id)
	{
		// Lets load the content if it doesn’t already exist
		if (empty($this->_pagination5))
		{
		jimport('joomla.html.pagination');
		$total5 = $this->get_dm_rfps_by_managers($type_id);

		 $total6 = count($total5);
		// echo $total3;
		//$limit=$total1-$this->getState('limitstart');

		$this->_pagination5 = new JPagination($total6, $this->getState('limitstart'), $this->getState('limit'));
		}
		//print_r($this->getState('limitstart'));

		//echo "<pre>"; print_r($this->_pagination1);

		return $this->_pagination5;
	}
	function getallindustries(){
		global $mainframe;
		$db=&JFactory::getDBO();
		$user =& JFactory::getUser();
		$query = "SELECT id as value, industry_name as text FROM #__cam_industries where published=1 ORDER BY industry_name ASC ";
		$db->setQuery($query);
		$industryList = $db->loadObjectList();
		$industry = 'filter_industry';
		$industries[] = JHTML::_('select.option', '0', 'Filter by Industry');
		$this->filter_industry	= $mainframe->getUserStateFromRequest( $context.$industry, $industry, 0,	'string' );
		
		foreach( $industryList as $obj )
		{
			$industries[] = JHTML::_('select.option',  $obj->value, $obj->text);
		}
		
		$javascript		= 'onchange="document.RFPbypropertyForm.submit();" ';
		//echo "<pre>"; print_r($vendorslist); exit;
//		$this->_filter_industry	= $mainframe->getUserStateFromRequest( $context.$passingvar, $passingvar, 0,	'string' );
		$industry = JHTML::_('select.genericlist',$industries, 'filter_industry', 'class="inputbox" size="1"  style="width: 400px; word-wrap:normal;" ' . $javascript , 'value', 'text', $this->filter_industry);
		return $industry;
	}

}
?>