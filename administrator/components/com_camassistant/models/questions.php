<?php
/**
 * @version		1.0.0 promocode $
 * @package		promocode
 * @copyright	Copyright © 2011 - All rights reserved.
 * @license		GNU/GPL
 * @author		anandbabu
 * @author mail	anandbabu@projectsinfo.net
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );

class QuestionsModelQuestions extends Jmodel
{
	function __construct()
	{
		parent::__construct();
		global $mainframe, $context;

		//initialize class property
	//  $this->_table_prefix = '#__cam_';		
	    $this->_table_prefix = '#__questions';	
		$array = JRequest::getVar('cid',  0, '', 'array');
		$this->setId((int)$array[0]);
	  
		//DEVNOTE: Get the pagination request variables
		$limit			= $mainframe->getUserStateFromRequest( $context.'limit', 'limit', $mainframe->getCfg('list_limit'), 0);
		$limitstart = $mainframe->getUserStateFromRequest( $context.'limitstart', 'limitstart', 0 );
		$filter_order		= $mainframe->getUserStateFromRequest( $context.'filter_order',		'filter_order',		'id',	'cmd' );
		$filter_order_Dir	= $mainframe->getUserStateFromRequest( $context.'filter_order_Dir',	'filter_order_Dir',	'asc',			'word' );

		$this->setState('limit', $limit);
		$this->setState('limitstart', $limitstart);

	}
	function setId($id)
	{
		$this->_id		= $id;
		//print_r($this->_id)
		$this->_data	= null;
	}

	function checkout($uid = null)
	{
		if ($this->_id)
		{
			// Make sure we have a user id to checkout the article with
			if (is_null($uid)) {
				$user	=& JFactory::getUser();
				$uid	= $user->get('id');
			}
			// Lets get to it and checkout the thing...
			$_detail = & $this->getTable();
			
			
			if(!$_detail->checkout($uid, $this->_id)) {
				$this->setError($this->_db->getErrorMsg());
				return false;
			}

			return true;
		}
		return false;
	}
	
	function checkin()
	{
		if ($this->_id)
		{
			$_detail = & $this->getTable();
			if(! $_detail->checkin($this->_id)) {
				$this->setError($this->_db->getErrorMsg());
				return false;
			}
		}
		return false;
	}	
	/**
	 * Tests if _detail is checked out
	 *
	 * @access	public
	 * @param	int	A user id
	 * @return	boolean	True if checked out
	 * @since	1.5
	 */
	function isCheckedOut( $uid=0 )
	{
		
		if ($this->_loadData())
		{
			if ($uid) {
				return ($this->_data->checked_out && $this->_data->checked_out != $uid);
			} else {
				return $this->_data->checked_out;
			}
		}
	}	

	/*function getListpromocode()
	{
		$db = & JFactory::getDBO();
		$query = "SELECT * FROM #__cam_promocode";
		$db->setQuery($query);
		$result = $db->loadObjectList();
		return $result;
	} 
	
	function getsave()
	{
		$promocode = JRequest::getVar('promocode','promocode');
		$amount = JRequest::getVar('amount','amount');
		$db = & JFactory::getDBO();
		$query = "INSERT INTO #__cam_promocode (`id`,`promocode`,`amount`) VALUES ('','$promocode','$amount') ";
		$db->setQuery($query);
		$result = $db->query();
		if($result) { $msg ="Sucessfully Inserted"; }
		else { $msg = "Sucessfully Inserted"; }
		$url = "index.php?option=com_promocode&view=promocode";
		$app = & JFactory::getApplication();
		$app->setRedirect($url,$msg);
	}*/

	function store($data){

JTable::addIncludePath(JPATH_COMPONENT.DS.'tables');
$row =& $this->getTable('questions');
$row = JTable::getInstance('questions','Table');
        if (!$row->bind($data)) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        if (!$row->check()) {
                $this->setError($this->_db->getErrorMsg());
                return false;
        }
        if (!$row->store()) {
                $this->setError( $row->getErrorMsg() );
                return false;
        }
        return true;         
}
function getquestion($id) 
	{
		global $mainframe;
	 	$db=&JFactory::getDBO();
	$query = "SELECT * FROM `#__questions` WHERE id='".$id."'";
		$db->setQuery($query);
		$question = $db->loadObject();	
	
		return $question;
	}
	function getData()
	{
	
		//DEVNOTE: Lets load the content if it doesn't already exist
		if (empty($this->_data))
		{
			$query = $this->_buildQuery();
			$this->_data = $this->_getList($query, $this->getState('limitstart'), $this->getState('limit'));
		}

		return $this->_data;
	}
	/**
	 * Method to get the total number of helloworld items
	 *
	 * @access public
	 * @return integer
	 */
	function getTotal()
	{
		//DEVNOTE: Lets load the content if it doesn't already exist
		if (empty($this->_total))
		{
			$query = $this->_buildQuery();
			$this->_total = $this->_getListCount($query);
		}

		return $this->_total;
	}
function deletequestion($id) 
	{
		global $mainframe;
	 	$db=&JFactory::getDBO();
		
		$query = "Delete FROM `#__questions`  WHERE id in (".$id.")"; 
		$db->setQuery($query);
		$db->Query();
		
				
	}	
	/**
	 * Method to get a pagination object for the helloworld
	 *
	 * @access public
	 * @return integer
	 */
	function getPagination()
	{
		// Lets load the content if it doesn't already exist
		if (empty($this->_pagination))
		{
			jimport('joomla.html.pagination');
			$this->_pagination = new JPagination( $this->getTotal(), $this->getState('limitstart'), $this->getState('limit') );
		}

		return $this->_pagination;
	}
	function _buildQuery()
	{
		$query = "SELECT * FROM `#__questions`";

		return $query;
	}
	function delete($cid = array())
	{
		$result = false;
		if (count( $cid ))
		{
			$cids = implode( ',', $cid );
			$query = 'DELETE FROM '.$this->_table_prefix.' WHERE id IN ( '.$cids.' )';
			$this->_db->setQuery( $query );
			if(!$this->_db->query()) {
				$this->setError($this->_db->getErrorMsg());
				return false;
			}
		}
		return true;
	}
	

}
?>