<?php
/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.model' );


class vendorsordercentreModelvendorsordercentre extends Jmodel
{
	//assigning variables
	var $_data;
	var $_total = null;
	var $_pagination = null;
	
	function __construct(){
		parent::__construct();
		
		global $mainframe, $context;

		//initialize class property
	  $this->_table_prefix = '#__cam_';	
		 global $mainframe;
		$limit			= $mainframe->getUserStateFromRequest( $context.'limit', 'limit', $mainframe->getCfg('list_limit'), 0);
		$limitstart = $mainframe->getUserStateFromRequest( $context.'limitstart', 'limitstart', 0 );
		$filter_order		= $mainframe->getUserStateFromRequest( $context.'filter_order',		'filter_order',		'affid',	'cmd' );
		$filter_order_Dir	= $mainframe->getUserStateFromRequest( $context.'filter_order_Dir',	'filter_order_Dir',	'asc',			'word' );

		$this->setState('limit', $limit);
		$this->setState('limitstart', $limitstart);
	}
	
	
	function getTotal()
	{ 
		//DEVNOTE: Lets load the content if it doesn't already exist
		if (empty($this->_total))
		{ 
			 $query = $this->_buildQuery(); 
			$this->_total = $this->_getListCount($query);
		}

		return $this->_total;
	}
	
	function _buildQuery()
	{
			$orderby	= $this->_buildContentOrderBy();
			$query = 'SELECT b.id as id ,u.username as uname,u.id as uid,cinfo.comp_name as cname,b.pay_amount as amount,b.status as status FROM `#__cam_vendor_billing` as b 
		left join #__cam_customer_companyinfo as cinfo on cinfo.cust_id=b.user_id 
		left join #__users as u on u.id=b.user_id where cinfo.status="approved" '.$where.' '.$orderby; 
		
			return $query;

	}
	
	function _buildContentOrderBy()
		{
			
			global $mainframe, $context;

		$filter_order     = $mainframe->getUserStateFromRequest( $context.'filter_order',      'filter_order', 	  'b.id' );
		$filter_order_Dir	= $mainframe->getUserStateFromRequest( 'filter_order_Dir',	'filter_order_Dir',	'asc','word' );
		if($filter_order!="")
		$orderby 	= ' ORDER BY '. $filter_order .' '. $filter_order_Dir;
		else
		$orderby="";
		return $orderby;
		}
		
	function getPagination()
	{
		// Lets load the content if it doesn't already exist
		if (empty($this->_pagination))
		{
			jimport('joomla.html.pagination');
			$this->_pagination = new JPagination( $this->getTotal(), $this->getState('limitstart'), $this->getState('limit') );
		}

		return $this->_pagination;
	}
	
	//function to get user order info
	function getVendors()
	{
		if (empty($this->_data))
		{
			 $query = $this->_buildQuery(); 
			$this->_data = $this->_getList($query, $this->getState('limitstart'), $this->getState('limit'));
		}
		
		return $this->_data;
	}

	
	//function to get order's info of perticuler vendor
	function getOrderinfo()
	{
		$id = JRequest::getVar('user_id','');
	    $db = JFactory::getDBO();
		$sql = 'SELECT u.id as id,u.username as uname,cinfo.comp_name as cname,b.pay_amount as amount,b.status as status FROM `#__cam_vendor_billing` as b 
		left join #__cam_customer_companyinfo as cinfo on cinfo.cust_id=b.user_id 
		left join #__users as u on u.id=b.user_id where b.user_id='.$id;
		$db->setQuery($sql);
		$RFP_details = $db->loadObjectList();
		//echo "<pre>"; print_r($RFP_details); exit;
		return $RFP_details;
	}
	
	
	

}
?>