<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright ï¿½ 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
/*$arr = explode('.','10,000.00');
echo str_replace(',','',$arr[0]); 	*/
defined('_JEXEC') or die('Restricted access');
$toolTipArray = array('className'=>'tool');
$document =& JFactory::getDocument();
$document->addStyleSheet(Juri::root().'templates/camassistant_left/css/style.css');
JHTML::_('behavior.tooltip', '.hasTip2', $toolTipArray);
JHTML::_('behavior.modal');
$user = JFactory::getUser();
//echo '<pre>'; print_r($this->TASKS_details);
$status = JRequest::getVar('status','');
$Itemid = JRequest::getVar('Itemid','');
$rebid = JRequest::getVar('rebid','');
$Alt_Prp = JRequest::getVar('Alt_Prp','');
$Alt_bid = JRequest::getVar('Alt_bid','');
if($Alt_bid != '')
$is_Alt =  $Alt_bid;
else
$is_Alt =  $Alt_Prp;
$act = JRequest::getVar('act','');
$Proposal_id = JRequest::getVar('Proposal_id','');
$RFP = $this->RFP_details;

$TASKS = $this->TASKS_details;
$TASKS_DOCS = $this->Tasks_DOCS_details;
$DOCS = $this->DOCS_details;
$PRICE = $this->Proposal_price_details;
$SPL_REQ_DETAILS = $this->SPLRequirements_details;
$SPL_REQ_DETAILS = $this->SPLRequirements_details;
$SPL_REQ_TABS = $this->SPL_REQ_tabs;
$Review_reqCatList = $this->SPLRequirements_details;
//$cat = $this->SPLReq_Category;
$cat = $Review_reqCatList['main'];
$main = $Review_reqCatList['main'];
$sub = $Review_reqCatList['sub'];
$child = $Review_reqCatList['child'];
$child_price=array();
$Form_status = $this->Form_status;
if($Form_status == 'ITB')
$Form_status = "Unsubmitted";
$Form_bidded_date = $this->Form_bidded_date;
$price_cnt=0;
 for($i=0; $i<count($TASKS); $i++)
 {
 if($TASKS[$i]->is_req_taskvendors == 1)  $price_cnt = $price_cnt+1;
 }
$doc_price_cnt=0;
 for($i=0; $i<count($DOCS); $i++)
 {
 if($DOCS[$i]->is_req_docvendors == 1)  $doc_price_cnt = $doc_price_cnt+1;
 }

$SPLreq_amount = $this->SPLreq_amount;
//echo  '<pre>'; print_r($PRICE);
$rfp_id = JRequest::getVar('rfp_id','');
$db =& JFactory::getDBO();

$property_details="SELECT property_id FROM #__cam_rfpinfo where id='".$rfp_id."'";
$db->Setquery($property_details);
$property_id = $db->loadResult();


$property_details="SELECT property_name,tax_id FROM #__cam_property where id='".$property_id."'";
$db->Setquery($property_details);
$property = $db->loadObject();

 $pr_manager = "SELECT property_manager_id FROM #__cam_property WHERE id ='".$property_id."'";
		$db->Setquery($pr_manager);
		$property_manager_id = $db->loadResult();

		$p_manager = "SELECT name,lastname,phone,extension,email FROM #__users WHERE id = '".$property_manager_id."'";
		$db->Setquery($p_manager);
		$property_manager_detail = $db->loadObjectList();

?>

<?PHP /************************************************popup code*************************************************/?>
<script language="JavaScript" type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/assets/wysiwyg.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script language="javascript" type="text/javascript">
L = jQuery.noConflict();

function sizeFrame() {
 for (var w = 1; w < 20; w++) {
var F = document.getElementById('wysiwygnotes'+w+'');

if(F.contentDocument) {
F.height = F.contentDocument.documentElement.scrollHeight+150; //FF 3.0.11, Opera 9.63, and Chrome
} else {
F.height = F.contentWindow.document.body.scrollHeight+100; //IE6, IE7 and Chrome
alert(F.height);
}
}
}
window.onload=sizeFrame;

function fun_POPUP_box(act) {


		//Cancel the link behavior
		//Get the A tag
		//Get the screen height and width
		var maskHeight = L(document).height();
		var maskWidth = L(window).width();
		//Set heigth and width to mask to fill up the whole screen
		L('#mask1').css({'width':maskWidth,'height':maskHeight});
		//transition effect
		L('#mask1').fadeIn(100);
		L('#mask1').fadeTo("slow",0.8);
		//Get the window height and width
		var winH = L(window).height();
		var winW = L(window).width();
		//Set the popup window to center
		L("#submit1").css('top',  '300');
		L("#submit1").css('left', '582');
		L("#submit1").fadeIn(2000);

		L('.window1 #done1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();
		fun_saveasdraft(act);

	});
}
function Alt_POPUP_box(act) {


		//Cancel the link behavior
		//Get the A tag
		//Get the screen height and width
		var maskHeight = L(document).height();
		var maskWidth = L(window).width();
		//Set heigth and width to mask to fill up the whole screen
		L('#mask1').css({'width':maskWidth,'height':maskHeight});
		//transition effect
		L('#mask1').fadeIn(100);
		L('#mask1').fadeTo("slow",0.8);
		//Get the window height and width
		var winH = L(window).height();
		var winW = L(window).width();
		//Set the popup window to center
		L("#submit1").css('top',  '300');
		L("#submit1").css('left', '582');
		L("#submit1").fadeIn(2000);

		L('.window1 #done1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();
		Alt_saveasdraft(act);

	});
}


L(document).ready(function() {


	//if close button is clicked
	L('.window1 #close1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();

		L('#mask1').hide();
		L('.window1').hide();

	});

	//if done button is clicked
	L('.window1 #done1').click(function (e) {
		//Cancel the link behavior
		e.preventDefault();
		L('#mask1').hide();
		L('.window1').hide();

	});



});

</script>
<style>
#mask1 {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#000;
  display:none;
}

#boxes1 .window1 {
  position:absolute;
  left:0;
  top:0;
  width:1300px;
  height:150px;
  display:none;
  z-index:9999;
  padding:38px 10px 3px 10px;
}


#boxes1 #submit1 {
  width:330px;
  height:233px;
  padding:10px;
  background-color:#ffffff;
}
#boxes1 #submit1 a{
 text-decoration:none;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}
#done1 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding-left:83px;
float:left;
/*background:url(templates/camassistant/images/yes.gif) no-repeat;
*/
}
#close1 {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding-right:107px;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}

</style>
<div id="boxes1" style="top:576px; left:582px;">
<div id="submit1" class="window1" style="top:1300px; left:582px;">
<div class="head_greenbg2" style="padding-left:70px">Submission Confirmation</div><br/>
<font color="#0000ce">Are you sure you want to unsubmit this proposal and move your revised version to your "Unsubmitted (Draft) Proposals"?</font>
<div style="padding-top:10px; text-align:center;">
<form name="edit" id="edit" method="post">
<div id="done1"  name="done1" value="Ok"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/yes.gif" /></div>
<div id="close1" name="close1" value="Cancel"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/no.gif" /></div></div>
</form>
<div style="padding-top:10px; text-align:center"><font color="#0000ce"><font color="#FF0000">Note:</font> moving this submitted proposal to the "Draft" status does NOT relinquish your Intent To Bid reservation or responsibility to provide a proposal before the close date of the RFP.</font>
</div>
</div>
  <div id="mask1"></div>
</div>

<?PHP /************************************************popup code*************************************************/ ?>


<script type="text/javascript" >
E = jQuery.noConflict();

function warranty_doc_remove()
{
E("#warranty_hid_text").val('');
E("#warranty_file_text").html('');
E("#warranty_file_rem").html('');
E("#warranty_path").val('');
}
F = jQuery.noConflict();
function doc_remove(id)
{
F("#hid_text"+id).val('');
F("#file_text"+id).html('');
F("#file_rem"+id).html('');
F("#path"+id).val('');
}
function sdoc_remove()
{
F("#shid_text").val('');
F("#sfile_text").html('');
F("#sfile_rem").html('');
F("#spath").val('');
}
function doc_upload(id,rfp_id,vendorid){

//el='<?php  echo Juri::base();; ?>index2.php?option=com_camassistant&controller=proposals&task=vendor_docs&warranty=file&taskid='+id;

	el='<?php  echo Juri::base();; ?>index2.php?option=com_camassistant&controller=proposals&task=upload_select&warranty=file&rfp_id='+rfp_id+'&vendorid='+vendorid+'&taskid='+id;
	var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 700, y:450}}"))
	SqueezeBox.fromElement(el,options);

}
function sdoc_upload(id,rfp_id,vendorid){

	//el='<?php  echo Juri::base();; ?>index2.php?option=com_camassistant&controller=proposals&task=vendor_docs&warranty=sfile&taskid='+id;
	//alert(el);
	el='<?php  echo Juri::base();; ?>index2.php?option=com_camassistant&controller=proposals&task=upload_select&warranty=sfile&rfp_id='+rfp_id+'&vendorid='+vendorid+'&taskid='+id;
	var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 700, y:450}}"))
	SqueezeBox.fromElement(el,options);

}
function warranty_doc_upload(rfp_id,vendorid,id){
if(E("#warranty_hid_text").val() != '')
alert('You can upload only one warranty file.');
else
{
	el='<?php  echo Juri::base();; ?>index2.php?option=com_camassistant&controller=proposals&task=upload_select&warranty=warranty_popup&rfp_id='+rfp_id+'&vendorid='+vendorid+'&taskid='+id;
        //el='<?php  echo Juri::base();; ?>index2.php?option=com_camassistant&controller=proposals&task=warranty_popup&rfp_id='+rfp_id+'&vendorid='+vendorid;
	var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: 700, y:450}}"))
	SqueezeBox.fromElement(el,options);
}
}
/*function validateNumber(id,fieldname,fieldvalue,value,e)
{
	var keyPressed = e.keyCode? e.keyCode : e.charCode;
	if(keyPressed == 13)
		format_val(id,fieldname,fieldvalue,value,e)
}*/
function format_val(id,fieldname,fieldvalue,value,e){
//alert(fieldname+id);
var i=0;
var ValidData="0123456789.,";
var Data=fieldvalue;
if(fieldvalue != "")
	for(i=0;i<Data.length;i++)
	{
		if(ValidData.indexOf(Data.charAt(i))==-1)
		{
			alert ("Please enter numerals and decimal point only.");
			 document.getElementById(fieldname+id).value=value;
			//break;
			return;

		}

	}
/*var iChars = "qwertyuioplkjhgfdsacvbnmxz!@#$%^&*()+=-[]\\\';/{}|\":<>?~_";
   for (var i = 0; i < fieldvalue.length; i++) {
  	if (iChars.indexOf(fieldvalue.charAt(i)) != -1) {
  	  alert ("Please enter numerals and decimal point only.");
	 document.getElementById(fieldname+id).value=value;
  	return false;
  	}
  }*/

E.post("index2.php?option=com_camassistant&controller=proposals&task=vendor_proposal_edit_format_val", {id: ""+id+"",fieldname: ""+fieldname+"",fieldvalue:""+fieldvalue+""}, function(data){
if(data.length >0) {
var x= fieldname+id;
E("#"+fieldname+id).val(data);
//E("#task_price1").val(data);
}
});
}

function getcommission_2()
{
var site='<?php echo JURI::root();?>';
var path='<?php echo addslashes(JPATH_SITE);?>';
var is_task_price='<?php echo $price_cnt;?>';
var is_doc_task_price='<?php echo $doc_price_cnt;?>';

	if(is_task_price != 0 || is_doc_task_price != 0)
	{
	var notcomma_added = document.getElementById('total_lineitem_pricing').value.replace(/,/g, '');
	//var notcomma_other = document.getElementById('other_items_price').value.replace(/,/g, '');
	//document.getElementById('total_price').value = parseFloat(notcomma_added) + parseFloat(notcomma_other);
        document.getElementById('total_price').value = parseFloat(notcomma_added);
	
	}
	else
	{
	//var amnt = document.getElementById('other_items_price').value;
       // var amnt = '0.00';
	}
	//var other  =document.getElementById('other_items_price').value;
        var other  = document.getElementById('total_price').value;
	var amnt = document.getElementById('total_price').value;
	var added  =document.getElementById('total_price').value;
	var amnt = document.getElementById('total_price').value;
E.post("index2.php?option=com_camassistant&controller=proposals&task=vendor_proposal_get_commission", {other: ""+other+"",added: ""+added+"",c2:""+amnt+""}, function(data){
	var splitIt = data.split('AND');
		/*alert(splitIt[3]);
		alert(splitIt[1]);
		alert(splitIt[0]);*/
	if(data.length >0) {
	if(splitIt[0] < 35)
		{splitIt[0] = '35.00';}
	E("#commisions").val(splitIt[0]);
	E("#total_price").val(splitIt[1]);
	E("#total_lineitem_pricing").val(splitIt[2]);
	//E("#other_items_price").val(splitIt[3]);
	//alert("can");
	//E('#notes1').redactor();
	setTimeout("document.adminForm.submit()",1000);
//	alert(frm);
	//frm.submit();
}
});


}


//squeeze box function edit exception.
function edit_popup(href,width,height) {
var options = $merge(options || {}, Json.evaluate("{handler: 'iframe', size: {x: "+width+", y:"+height+"}}"))
SqueezeBox.fromElement(href,options);
}

//End Of squeeze..
var id2 =  '';
	var cnt2 =  '';
	if(!id2)
	id2=1;
	else
	var id2=document.getElementById('idvals').value;
	var endid2;
	function addEvent2(taskid,tid,rfp_id,vendorid)
	{
		//document.getElementById("removeevent2").style.display = "block";
		/*if (id1<10)
		{ */
			//alert(taskid);
			id2++;

			var arrlicen2=new Array();
			var ni2 = document.getElementById('newdiv'+taskid);
			var numi2 = document.getElementById('theValues');
			var num2 = (document.getElementById("theValues").value -1)+ 2;
			//alert(num);
			var add= taskid+''+id2;
			//alert(add);
			numi2.value = num2;
			var divIdName2 = "upload"+num2;
			newitem2='<div style="padding:7px 0pt 0px 5px; height:30px;"><table><tr><td><span id="delimg'+id2+''+num2+'" style="display:none" title="Remove From RFP"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/delete.gif" alt="delete" style="cursor:pointer;" onclick="javascript:removeEvent2('+num2+','+taskid+');"/></span></td><td><span id="upload_file'+id2+''+num2+'" style="float:left;font-size:14px;width:auto;padding-right:5px;"></span></td><input type="hidden" name="hid_text'+add+'" id="hid_text'+id2+''+num2+'" value="" /><input name="fpath_'+tid+'[]" id="fpath'+id2+''+num2+'" type="hidden" value="" /></div></tr></table><div class="clear"></div>';


			var newdiv2 = document.createElement('div');
			newdiv2.setAttribute("id",divIdName2);
			newdiv2.innerHTML = newitem2;
			ni2.appendChild(newdiv2);
                        doc_upload(id2+''+num2,rfp_id,vendorid);
	//}
	/*if(id1==10)
		document.getElementById("addevent1").style.display = "none";*/
	}

	var id2 =  '';
	var cnt2 =  '';
	if(!id2)
	id2=1;
	else
	var id2=document.getElementById('idvals').value;
	var endid2;
	function saddEvent2(rfp_id,vendorid)
	{
		//document.getElementById("removeevent2").style.display = "block";
		/*if (id1<10)
		{ */
			//alert(taskid);
			id2++;

			var arrlicen2=new Array();
			var ni2 = document.getElementById('newdiv');
			var numi2 = document.getElementById('theValues');
			var num2 = (document.getElementById("theValues").value -1)+ 2;
			//alert(num);
			var add= id2;
			//alert(add);
			numi2.value = num2;
			var divIdName2 = "supload"+num2;
			 newitem2='<div style="padding:7px 0pt 0px 5px; height:30px;"><table><tr><td><span id="delimg'+id2+''+num2+'" style="display:none" title="Remove From RFP"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/delete.gif" alt="delete" style="cursor:pointer;" onclick="javascript:sremoveEvent2('+num2+');"/></span></td><td><span id="supload_file'+id2+''+num2+'" style="float:left;font-size:14px;width:auto;padding-right:5px;"></span></td><input type="hidden" name="shid_text'+add+'" id="shid_text'+id2+''+num2+'" value="" /><input name="spath[]" id="spath'+id2+''+num2+'" type="hidden" value="" /></div></tr></table><div class="clear"></div>';


			var newdiv2 = document.createElement('div');
			newdiv2.setAttribute("id",divIdName2);
			newdiv2.innerHTML = newitem2;
			ni2.appendChild(newdiv2);
                        sdoc_upload(id2+''+num2,rfp_id,vendorid);
	//}
	/*if(id1==10)
		document.getElementById("addevent1").style.display = "none";*/
	}
function removeEvent2(divNum2,taskid)
	{
			//divNum2 = document.getElementById("theValues").value;

		if(divNum2 != 0 )
		{
			var divNum3=divNum2-1;
			//var d2=taskid;
			//alert(divNum3);
			var d2 = document.getElementById('newdiv'+taskid);
			var olddiv2 = document.getElementById("upload"+divNum2);
			d2.removeChild(olddiv2);
			var numi2 = document.getElementById('theValues');
			var num2 = document.getElementById("theValues").value -1;
			numi2.value = num2;
		}
		id2--;
	/*if(id1<=cnt)
	document.getElementById("removeevent1").style.display = "none";*/

	}
function sremoveEvent2(divNum2)
	{
			//divNum2 = document.getElementById("theValues").value;

		if(divNum2 != 0 )
		{
			var divNum3=divNum2-1;
			//var d2=taskid;
			//alert(divNum3);
			var d2 = document.getElementById('newdiv');
			var olddiv2 = document.getElementById("supload"+divNum2);
			d2.removeChild(olddiv2);
			var numi2 = document.getElementById('theValues');
			var num2 = document.getElementById("theValues").value -1;
			numi2.value = num2;
		}
		id2--;
	/*if(id1<=cnt)
	document.getElementById("removeevent1").style.display = "none";*/

	}

//End Of squeeze..


//Ajax function to calculate commission on vendor bidding amount
function createXMLHttpRequest()
{
	try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
	try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) {}
	try { return new XMLHttpRequest(); } catch(e) {}
	alert("XMLHttpRequest not supported");
	return null;
}
var xhReq = createXMLHttpRequest();

function getcommission()
{

	var site='<?php echo JURI::base();?>';
	var added;
	var path='<?php echo addslashes(JPATH_SITE);?>';
	var is_task_price='<?php echo $price_cnt;?>';
	var is_doc_task_price='<?php echo $doc_price_cnt;?>';
	//alert(is_task_price);
	//alert(is_doc_task_price);
	if(is_task_price != 0 || is_doc_task_price != 0)
	{
	/*if(document.getElementById('total_lineitem_pricing').value == '')
	document.getElementById('total_lineitem_pricing').value = 0.00;
	if(document.getElementById('other_items_price').value == '')
	document.getElementById('other_items_price').value = '';*/
	var notcomma_added = document.getElementById('total_lineitem_pricing').value.replace(/,/g, '');
	//var notcomma_other = document.getElementById('other_items_price').value.replace(/,/g, '');
         var notcomma_other = '0.00';
	if(notcomma_added){
	document.getElementById('total_price').value = parseFloat(notcomma_added) + parseFloat(notcomma_other);
	} else {
	document.getElementById('total_price').value = parseFloat(notcomma_added);
	}

	var amnt = document.getElementById('total_price').value;
	var added  =document.getElementById('total_price').value;
	}
	else
	{
	/*if(document.getElementById('other_items_price').value == '')
	document.getElementById('other_items_price').value = 0.00;*/
	var added = '0';
	//var amnt = document.getElementById('other_items_price').value;
        var amnt = document.getElementById('total_price').value;

	}

        //if(is_task_price != 0 || is_doc_task_price != 0){
          //var other  =document.getElementById('other_items_price').value;
       // } else {
           var other  =document.getElementById('total_price').value;
       // }
	xhReq.open("GET", site+"components/com_camassistant/helpers/ajax_commision.php?other="+other+"&added="+added+"&c2="+amnt+"&path="+path, true);
	xhReq.onreadystatechange = onSumcommision;
	xhReq.send(null);
}
function onSumcommision()
{
	if (xhReq.readyState != 0 && xhReq.readyState != 4)  { return; }
	var serverResponse = xhReq.responseText;
	var is_task_price='<?php echo $price_cnt;?>';
	var is_doc_task_price='<?php echo $doc_price_cnt;?>';
	//alert(serverResponse);
	var splitIt = serverResponse.split("AND");
	if(splitIt[0] < 35)
	splitIt[0] = '35.00';
	document.getElementById('commisions').value = splitIt[0];
	//document.getElementById('other_items_price').value = splitIt[3];
	if(is_task_price != 0 || is_doc_task_price != 0)
	{
	document.getElementById('total_price').value = splitIt[1];
	document.getElementById('total_lineitem_pricing').value = splitIt[2];
	}
	//alert(document.getElementById('other_items_price').value)
}

function update_price(id,fieldname,val,fieldvalue,e)
{
    var res=format_val(id,fieldname,val,fieldvalue,e);
    var frm = document.adminForm;
	var tasks_chks = document.getElementsByName('task_price[]');
	var downloads_chks = document.getElementsByName('downloads_price[]');
	//(downloads_chks.length);
	//alert(tasks_chks.length);
	//var other_price = document.getElementById('other_items_price');
	var line_item_price = document.getElementById('total_lineitem_pricing');
	var total_price = document.getElementById('total_price');
	var tasks_total = 0;
         for (var i = 0; i < tasks_chks.length; i++)
         {
		 	 var comma_val = tasks_chks[i].value;
		     tasks_chks[i].value = tasks_chks[i].value.replace(/,/g, '');
		 	if(tasks_chks[i].value != '' && tasks_chks[i].value != '(Line-Item Pricing)')
		 	 tasks_total = parseFloat(tasks_total) + parseFloat(tasks_chks[i].value);
			 tasks_chks[i].value = comma_val;
         }
	var downloads_total = 0;
	if(downloads_chks.length>0)
	{
		 for (var i = 0; i < downloads_chks.length; i++)
         {
		 	 var comma_val = downloads_chks[i].value;
		     downloads_chks[i].value = downloads_chks[i].value.replace(/,/g, '');
		 	if(downloads_chks[i].value != '' && downloads_chks[i].value != '(Line-Item Pricing)')
		 	 downloads_total = parseFloat(downloads_total) + parseFloat(downloads_chks[i].value);
			 downloads_chks[i].value = comma_val;
         }
	}
	//alert(downloads_total);
	//alert(tasks_total);
	line_item_price.value = parseFloat(tasks_total) + parseFloat(downloads_total);
	//alert(line_item_price.value);
	getcommission();
}
function fun_saveasdraft(act)
{
var frm = document.adminForm;
var tasks_chks = document.getElementsByName('task_price[]');
if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
frm.submit_type.value = act;
P = jQuery.noConflict();
P('textarea[rel="editor"]').each(function(){
  var n=P(this).attr('id');
    document.getElementById(n).value = document.getElementById("wysiwyg" + n).contentWindow.document.body.innerHTML;
	notesstrings = document.getElementById(n).value ;
	notesstrings = notesstrings.replace("â", "'");
	notesstrings = notesstrings.replace(/[^\u000A\u0020-\u007E]/g, ' ');
	document.getElementById(n).value = notesstrings ;
 });
document.getElementById('submittype').value=act;
getcommission_2();
}

function fun_saveassubmit(act)
{
var frm = document.adminForm;
var tasks_chks = document.getElementsByName('task_price[]');
	 for (var i = 0; i < tasks_chks.length; i++)
         {
		 	  //if(tasks_chks[i].value == '' || tasks_chks[i].value == '0.00')	validation for empty, $0 values
			 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	// if(downloads_chks[i].value == '' || downloads_chks[i].value == '0.00')	validation for empty, $0 values
			 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }

  if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
//frm.submit_type.value = 'Submit';
frm.submit_type.value = act;
P = jQuery.noConflict();
P('textarea[rel="editor"]').each(function(){
  var n=P(this).attr('id');
    document.getElementById(n).value = document.getElementById("wysiwyg" + n).contentWindow.document.body.innerHTML;
	notesstrings = document.getElementById(n).value ;
	notesstrings = notesstrings.replace("â", "'");
	notesstrings = notesstrings.replace(/[^\u000A\u0020-\u007E]/g, ' ');
	document.getElementById(n).value = notesstrings ;
 });
getcommission_2();
document.getElementById('submittype').value=act;
//alert(document.getElementById('commisions').value);
//frm.submit();
}

function sendcommissiontofrom() {
	document.getElementById("commissionamount").innerHTML = "$" + document.vendor_Edit_proposal_form.commisions.value ;
}

function Alt_saveasdraft(act)
{
var frm = document.adminForm;
var tasks_chks = document.getElementsByName('task_price[]');
	 /*for (var i = 0; i < tasks_chks.length; i++)
         {
		 	 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }	*/

	if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
frm.submit_type.value = act;
P = jQuery.noConflict();
P('textarea[rel="editor"]').each(function(){
  var n=P(this).attr('id');
    document.getElementById(n).value = document.getElementById("wysiwyg" + n).contentWindow.document.body.innerHTML;
	notesstrings = document.getElementById(n).value ;
	notesstrings = notesstrings.replace("â", "'");
	notesstrings = notesstrings.replace(/[^\u000A\u0020-\u007E]/g, ' ');
	document.getElementById(n).value = notesstrings ;
 });
document.getElementById('submittype').value=act;
frm.Alt_Prp.value = 'yes';
getcommission_2();
}

function Alt_saveassubmit(act)
{
//var notes = document.getElementById('notes').value;
var frm = document.adminForm;
var tasks_chks = document.getElementsByName('task_price[]');
	 for (var i = 0; i < tasks_chks.length; i++)
         {
		 	 //if(tasks_chks[i].value == '' || tasks_chks[i].value == '0.00')	validation for empty, $0 values
			 if(tasks_chks[i].value == '')
			 {
		 	 alert('Please enter price for tasks');
			 tasks_chks[i].focus();
			 return ;
			 }
         }
var downloads_chks = document.getElementsByName('downloads_price[]');
	  for (var i = 0; i < downloads_chks.length; i++)
         {
		 	// if(downloads_chks[i].value == '' || downloads_chks[i].value == '0.00')	validation for empty, $0 values
			 if(downloads_chks[i].value == '')
		 	 {
		 	 alert('Please enter price for Additional documents');
			 tasks_chks[i].focus();
			 return ;
			 }
         }

   if(frm.i_agree.checked == false)
	{
		alert('Please check the required fields');
		frm.i_agree.focus();
		return;
	}
//frm.submit_type.value = 'Submit';
frm.submit_type.value = act;
document.getElementById('submittype').value=act;
frm.Alt_Prp.value = 'yes';
P = jQuery.noConflict();
P('textarea[rel="editor"]').each(function(){
  var n=P(this).attr('id');
   
 document.getElementById(n).value = document.getElementById("wysiwyg" + n).contentWindow.document.body.innerHTML;
	notesstrings = document.getElementById(n).value ;
	notesstrings = notesstrings.replace("â", "'");
	notesstrings = notesstrings.replace(/[^\u000A\u0020-\u007E]/g, ' ');
	document.getElementById(n).value = notesstrings ;
 });
 // document.getElementById(n).value = document.getElementById("wysiwyg" + n).contentWindow.document.body.innerHTML;
 //});
getcommission_2();
}
G = jQuery.noConflict();
function deletefile(spl_req,Alt_Prp,prop_id,vendor_id,rfp_id,task_id,doc_id,act,rebid){
var r = confirm("Are you sure you want to delete this file from this RFP");
if(r == true){
  		window.location.href = "index2.php?option=com_camassistant&controller=proposals&spl_req="+spl_req+"&task=Remove_downloadfile&Alt_Prp="+Alt_Prp+"&prop_id="+prop_id+"&vendor_id="+vendor_id+"&rfp_id="+rfp_id+"&task_id="+task_id+"&doc_id="+doc_id+"&act="+act+"&rebid="+rebid;
                //G.post("index2.php?option=com_camassistant&controller=proposals&spl_req="+spl_req+"&task=Remove_downloadfile&Alt_Prp="+Alt_Prp+"&prop_id="+prop_id+"&vendor_id="+vendor_id+"&rfp_id="+rfp_id+"&task_id="+task_id+"&doc_id="+doc_id+"&act="+act+"&rebid="+rebid+"", function(data){
		//if(data == 'deleted')
		//{
		//alert("File deleted from this RFP");
		//}
		//G("tr#files_"+doc_id).css("display","none");
		//})}

		//if(r == false)
		//{
		//window.location.href;
		}

}
function deletewarrentyfile(prop_id,vendor_id,rfp_id,Alt_Prp,act){
var r = confirm("Are you sure you want to delete this file from this RFP");
if(r == true){
  		G.post("index2.php?option=com_camassistant&controller=proposals&task=Remove_warranty_file&prop_id="+prop_id+"&vendor_id="+vendor_id+"&rfp_id="+rfp_id+"&Alt_Prp="+Alt_Prp+"&act="+act+"", function(data){
		if(data == 'deleted')
		{
		alert("File deleted from this RFP");
		}
		G("tr#files_"+prop_id).css("display","none");
		})}

		if(r == false)
		{
		window.location.href;
		}

}
function excption_enable(val,check_e){
var check= document.getElementById('excption_accept_'+val);
if(check_e==''){
var vis = (check.checked) ? "block" : "none";
document.getElementById('EXCEP_'+val).style.display = vis;
} else {
  var vis = (check.checked) ? "block" : "none";
document.getElementById('exe_'+val).style.display = vis;
}
}
</script>
<style>
#maskp {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#000;
  display:none;
}

#boxesp .windowp {
  position:absolute;
  left:0;
  top:0;
  width:350px;
  height:150px;
  display:none;
  z-index:9999;
  padding:20px;
}


#boxesp #submitp {
  width:300px;
  height:131px;
  padding:10px;
  background-color:#ffffff;
}
#boxesp #submitp a{
 text-decoration:none;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}
#donep {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
float:left;
width:160px;
/*background:url(templates/camassistant/images/yes.gif) no-repeat;
*/
}
#closep {
border:0 none;
cursor:pointer;
height:30px;
margin:0;
padding:0;
 color:#000000;
 font-weight:bold;
 font-size:20px;
}
</style>
<div id="boxesp" style="top:400px; left:582px;">
<div id="submitp" class="windowp" style="left:582px;">
<p style="text-align:center; color:#0000ce;">Please confirm you are aware of the referral fee, which is owed ONLY if you are awarded this project: </p>
<p style="text-align:center; color:#0000ce; margin-top:20px">REFERRAL FEE: <span id="commissionamount"></span></p><p style="height:10px"></p>
<div style="padding-top:10px; text-align:center; padding-left:60px;">
<form name="edit" id="edit" method="post">
<div id="donep" style="width:50px" name="donep" value="Ok"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/go_back.gif" /></div>
<div id="closep" style="width:250px" name="closep" value="Cancel"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/resum.gif" /></div></div>
</form>
</div>
  <div id="maskp"></div>
</div>



<?php
$db = JFactory::getDBO();
$sql = 'SELECT County FROM #__cam_counties WHERE id = '.$RFP->divcounty;
		$db->Setquery($sql);
		$county = $db->loadResult();
		?>
<form name="adminForm" method="post" action="index.php?option=com_camassistant&controller=proposals&task=Proposal_save_as&rfp_id=<?PHP echo $RFP->id  ?>"/>

<!--<div id="vender_right2">-->
<div>
<!-- sof bedcrumb -->
<!--<div id="bedcrumb">
<ul>
<li class="home"><a href="index.php">Home  </a></li><li><a href="index.php?option=com_camassistant&controller=vendors&task=vendor_proposal_centre&Itemid=106">Proposal Center Home</a> </li><li>RFP Response - Proposal # <?PHP  echo sprintf('%07d', $Proposal_id);  ?></li>
</ul>
</div>-->
<!-- eof bedcrumb -->

<!-- sof dotshead -->
<!--<div class="green-heading" id="dotshead_green"> <?PHP if($rebid == 's') { ?> <font color="#FF0000">ALTERNATE PROPOSAL FORM</font>- <?PHP echo $RFP->projectName;} else { if($Alt_Prp == 'yes') { ?><font color="#FF0000">ALTERNATE PROPOSAL FORM</font><?PHP } else {?> PROPOSAL FORM<?PHP } ?> - <?PHP echo $RFP->projectName. ' - STATUS: '. $Form_status.'&nbsp;'.$Form_bidded_date; } ?> </div>-->
<!-- eof dotshead -->
<!--<div class="green-heading" id="dotshead_green" style="margin-top:-10px; margin-bottom:-10px;"></div>-->
<!--<div id="i_bar_gr">
<div id="i_bar_txt">
<span><?PHP //echo $RFP->property_name  ?> <?PHP echo $RFP->projectName.' - '.$RFP->industry_name;  ?> - RFP# <?PHP echo sprintf('%06d', $RFP->id);   ?>  </span></div>
<div id="i_icon"><a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=119&amp;Itemid=113"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/info_icon2.png" style="margin-top:1px;"> </a></div>
</div>-->


<!-- sof table pan -->
<div class="table_pannel">

<?php //echo "<pre>"; print_r($RFP); ?>
<!--<div class="head_bluebg2">--><!--sof rfp box-->
    <div id="rpf_ifo" style="margin-left:446px;">
    <div id="rpf_ifo_head" style="margin-top:-22px;">RFP CONTACT INFO</div>
    <div id="rpf_ifo_text">
	<h1>Site Visit Requirement:</h1>
<input name="" type="text" style="width:197px; background-color:#F7F7F7; color:#7D7D7D; border:1px solid #D7D7D7; padding:3px;" value="<?PHP echo $RFP->site_visit;  ?>" readonly="readonly" />
 <?php if($RFP->site_visit != 'Not Required') { ?>
<br/><textarea readonly="readonly" cols="23" style="width:199px; height:50px; font-family:arial; font-size:12px; color:#7D7D7D; border:1px solid #D7D7D7; background:#F7F7F7; margin-top:9px; resize:vertical;"><?PHP echo $RFP->bidders_info;   ?></textarea>
<?PHP } ?>
<?php /*?><h1 style="margin-top:5px;">Property Manager:</h1><?php */?>
<br /><br><font style="margin-top: 5px; color: #07183E; font-size: 12px;    font-weight: bold;">Property Manager:</font><br />
<?PHP echo $property_manager_detail[0]->name;  ?> <?PHP echo $property_manager_detail[0]->lastname;  ?><br />
<?php if ($RFP->showphone=='0') { ?>
P: <?PHP echo $property_manager_detail[0]->phone;  ?> (x<?PHP echo $property_manager_detail[0]->extension;  ?>)<br />
<?php } ?>
<?php if ($RFP->showemail=='0') {?>
<a href="mailto:<?PHP echo $property_manager_detail[0]->email;  ?>">Email Property Manager</a>
<?php } ?>

<?php /*?>	<h1 style="margin-top:5px;">Property Management Company:</h1><?php */?>
	<br /><br><font style="margin-top: 5px; color: #07183E; font-size: 12px;    font-weight: bold;">Property Management Company:</font>
<?php if ($RFP->showcompany=='0') {?>
<?PHP echo $RFP->comp_name;  ?><br />
<?php } ?>
<?php if ($RFP->showaddress=='0') {?>
<?PHP echo $RFP->mailaddress;  ?><br />
<?PHP echo $RFP->comp_city;  ?>, <?PHP echo $RFP->comp_state;  ?>, <?PHP echo $RFP->zip;  ?><br />
<?php } ?>
<?php if ($RFP->showphone=='0') { ?>
P: <?PHP echo $RFP->comp_phno;  ?><br />
<?php } ?>
<?php if ($RFP->showfax=='0') {?>
F: <?PHP echo $RFP->comp_alt_phno;  ?><br />
<?php } ?>
<a href="http://<?PHP echo $RFP->comp_website;  ?>" target="_blank"><?PHP echo $RFP->comp_website;  ?></a>
    </div>

    </div>
<!--<?PHP echo $RFP->projectName.' - '.$RFP->industry_name;  ?> - RFP# <?PHP echo sprintf('%06d', $RFP->id);   ?>-->


 </div>

  <div class="proposal_form">

<div class="signup">
<label><strong>Proposal Deadline: </strong></label>
<?PHP
$main = explode('-',$RFP->proposalDueDate);
$date = $main[2].'-'.$main[0].'-'.$main[1];
$newdate = strtotime ( '-1 day' , strtotime ( $date ) ) ;
$RFP->proposalDueDate = date ( 'm-d-Y' , $newdate );
?>
<input readonly="readonly" name="" type="text" style="width:275px;" value="<?PHP echo $RFP->proposalDueDate.',&nbsp;'.$RFP->proposalDueTime  ?>"/>
</div>
<?PHP
list($month, $day, $year) = explode("-", $RFP->startDate);
$date =  $day."-".$month."-".$year;
 ?>
<div class="signup">

<label><strong>Projected Start Date:</strong></label>
<input readonly="readonly" name="" type="text" style="width:123px;" value="<?PHP echo date("M d, Y", strtotime($date)) ?>"/>

<?PHP
list($month, $day, $year) = explode("-", $RFP->endDate);
$date =  $day."-".$month."-".$year;
 ?>
<!--<div class="zip" style="padding-right:51px">
<label><strong>Projected End Date:</strong></label>
<input name="" readonly="readonly" type="text" style="width:127px;" value="<?PHP echo date("M d, Y", strtotime($date)) ?>"/>
</div>-->
</div>
<div class="signup">
<label><strong>Property Address:</strong>  </label>
<input name="" readonly="readonly" type="text" style="width:275px;" value="<?PHP echo $RFP->street;  ?>"/>
</div>
<div class="signup">
<label><strong>City:</strong> </label>
<input name="" readonly="readonly" type="text" style="width:275px;" value="<?PHP echo $RFP->city;  ?>"/>
</div>
<?php /*?><div class="signup">
<label>City: </label>
<input name="" readonly="readonly" type="text" style="width:275px;" value="<?PHP echo $RFP->city;  ?>"/>
</div><?php */?>
<div class="signup">
<div class="state">
<label><strong>State:</strong> 	</label>
<input name="" readonly="readonly" type="text" style="width:123px;" value="<?PHP echo $RFP->state;  ?>"/>
</div>
<div class="zip" style="padding-right:51px">
<label>      <strong>Zip:</strong> 	</label>
<input name="" readonly="readonly" type="text" style="width:127px;" value="<?PHP echo $RFP->zip;  ?>"/>
</div>
</div>

<br />
<?php
$totalrevs = $this->reviewrevisions;
if($totalrevs) { ?>
<label><strong>Manager Intensions for this RFP:</strong></label>
<div style="width:661px; margin-top: 6px; padding:5px; font-size:11px;border:1px solid #CDCDCD;">
<?php
for($m=0; $m<count($totalrevs); $m++){
$n = $m + 1;
echo "<strong>Intension ".$n. ":</strong>&nbsp;&nbsp;". $totalrevs[$m]->revision . '<br>' ;
}
?>
</div><br />
<?php } ?>
<br /><br />
<span class="blue_small"><strong>SCOPE OF WORK:</strong></span><br />
<br />
<?PHP echo nl2br( $RFP->jobnotes ) ;  ?>
<br /><br />
<?php
$bascifiles = $this->basicfiles ;
if($bascifiles) { ?>
<p style="height:5px;"></p>
<p><strong>Uploaded Files:</strong></p>
<p style="height:10px;"></p>
<table cellpadding="0" cellspacing="0">
	<?php for( $f=0; $f<count($bascifiles); $f++ ){
			if( $bascifiles[$f]->filename != '' && $bascifiles[$f]->filename != ' ' ){
	 ?>
		<tr class="basicfiles<?php echo $bascifiles[$f]->id; ?>"><td><a href="index.php?option=com_camassistant&controller=documents&task=viewbasicfile&filename=<?php echo $bascifiles[$f]->filename; ?>&filepath=<?php echo $bascifiles[$f]->filepath; ?>&rfpid=<?php echo $RFP->id; ?>" class="deletebasicfile"><img id="redimagebasci" src="<?php echo Juri::root(); ?>templates/camassistant_left/images/downloadfile.gif"></a></td><td>&nbsp;&nbsp;
		<a id="openbasicfile" href="index.php?option=com_camassistant&controller=documents&task=viewbasicfile&filename=<?php echo $bascifiles[$f]->filename; ?>&filepath=<?php echo $bascifiles[$f]->filepath; ?>&rfpid=<?php echo $RFP->id; ?>"><?php  echo str_replace('_',' ',$bascifiles[$f]->filename) ; ?> </a></td></tr>
		<tr class="basicfiles<?php echo $bascifiles[$f]->id; ?>" height="0"></tr>
		<tr height="3"></tr>
	<?php }	}
	?><tr><td><p style="height:20px;"></p></td></tr><?php 
	echo "</table>";
}	
else{ ?>
<p style="height:5px;"></p>
<p><strong>Uploaded Files: None</strong></p>
<?php } 
	?>
<br />
<?PHP $TOT = 0; $price_cnt=0; for($i=0; $i<count($TASKS); $i++)
{ //echo "<pre>"; print_r($TASKS);?>
	<!--  sof line item pan -->
<div class="lineitem_pan_row"><br />
<?PHP if($TASKS[$i]->is_modified==1) { ?>
<span class="grey_12" style="color:#FF0000" title="This is modified Line Item">Vendor Response:
</span>
<?PHP } else { ?>
<span class="blue_small"><strong>Vendor Response:
</strong></span>
<?PHP }  ?>
<div class="lineitem_pan"> <p style="height:10px;"> </p>

<?php
$len1 = strlen($TASKS[$i]->Notes);
if($len1 > 25){
$lines1 = $len1 / 120;
$height1 = $lines1 * 20;
}
else{
$height1 = 20;
}
?><table>
<!-- eof line item pan -->
<?PHP if($TASKS[$i]->taskuploads != '') {?>
<!-- sof line item pan -->
<?php
$default = 'components/com_camassistant/doc/';
//$uploaded_file= str_replace(' ','',$TASKS_DOCS[$i]->taskuploads);
$linetaks->taskuploads=$TASKS_DOCS[$i]->taskuploads;
$linetaks->taskuploads = str_replace(' ,','',$linetaks->taskuploads);
    $linetaks->taskuploads = str_replace(',,',',',$linetaks->taskuploads);
      $linetaks->taskuploads = str_replace(' ','',$linetaks->taskuploads);
 $uploads= explode(',',$linetaks->taskuploads );
    if(count($uploads)>0 && count($linetaks->taskuploads)>0 ){

         for ($l=0;$l<count($uploads);$l++){  ?>
    <?php  $uploads1=explode('/',$uploads[$l]);
       if($uploads[$l] && $uploads[$l]!=' '){

 $uploads23=explode('/',$uploads[$l]);
 //echo '<pre>'; print_r($linetaks->taskuploads);
//echo $uploads1;
 // $uploads=explode('/',$linetaks->taskuploads); $upcount=count($uploads);
// echo "Filename:".$linetaks->taskuploads;
if($uploads23[0]=='components' && $uploads23[1]=='com_camassistant' && $uploads23[2]=='doc' ){
 $file_link = str_replace(' ','',$uploads[$l]);
  } else if($uploads23[0]=='components' && $uploads23[1]=='com_camassistant' && $uploads23[2]=='assets' ){
    $file_link = str_replace(' ','',$uploads[$l]);
 } else {
 $file_link = $default.str_replace(' ','_',$property->property_name).'_'.$property->tax_id.'/'.str_replace(' ','',$uploads[$l]);
 }
// $file_link = $default.$p_name.'_'.$property->tax_id.'//'.$linetaks->taskuploads;
 $file_link= str_replace('// ','/',$file_link); ?>
    <tr><td><span class="grey_12">Attachment #<?PHP echo $l+1; ?>:&nbsp;&nbsp;&nbsp;</span></td><td><span style="float:left;font-size:10px;width:auto; padding-right:5px;"><?php   $upcount=count($uploads1); ?> <?php echo $uploads1[$upcount-1]; ?></span></td>&nbsp;&nbsp;&nbsp;<td><span style="float:left;font-size:10px;width:auto; padding-right:5px;">
<a href="index.php?option=com_camassistant&controller=popupdocs&task=open&title=<?php echo str_replace(' ','',$uploads1[$upcount-1]); ?>&path=<?php print_r($file_link); ?> "><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a></span></td></tr>
<?php } } }  ?>
<!--<a href="index2.php?option=com_camassistant&controller=popupdocs&task=open&title=<?PHP echo $TASKS_DOCS[$i]->title; ?>&path=<?PHP echo $file_link; ?>"><img src="templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a>
</div>
<div class="clear"></div>-->
<!-- eof line item pan -->
<?PHP } ?></table>
<textarea name="NOTES_<?php echo $TASKS[$i]->task_id; ?>" rel="editor" class="textarea" style=" width:649px; height:120px;" id='notes<?php echo $i+1 ; ?>'><?PHP echo $TASKS[$i]->Notes; ?></textarea>
<script language="javascript1.2">
generate_wysiwyg('notes<?php echo $i+1 ; ?>');
</script>
<br/>
<?php
$len = strlen($TASKS[$i]->Exception);
if($len > 25){
$lines = $len / 120;
$height = $lines * 20;
}
else{
$height = 20;
}
?><p style="height:5px;"> </p>
<div style="float:left;"><input type="checkbox" name="excption_accept_<?php echo $TASKS[$i]->task_id; ?>" id="excption_accept_<?php echo $TASKS[$i]->task_id; ?>" onclick="excption_enable('<?php echo $TASKS[$i]->task_id; ?>','<?php echo $TASKS[$i]->check_exception; ?>')" <?php if($TASKS[$i]->check_exception!=''){ echo checked; }?>><strong>Check this box if you're response above does NOT include everything in this Line-item's request</strong></div><br/>

<?php if($TASKS[$i]->check_exception!='') { ?>
<div id="exe_<?php echo $TASKS[$i]->task_id; ?>" <?php if($TASKS[$i]->check_exception=='') { ?> style="display:none;" <?php } ?> >
<div id="EXCEP_<?php echo $TASKS[$i]->task_id; ?>"><p style="height:10px;"> </p>
<b style="color:red; float:left;" class="blue_small">Exceptions:</b><br/><br/><textarea name="EXCEP_<?php echo $TASKS[$i]->task_id; ?>" <?PHP if($TASKS[$i]->Exception=='(list all Exceptions here)' || !$TASKS[$i]->Exception){ ?> onclick="if(this.value=='(list all Exceptions here)'){ this.value=''; } else if(this.value==''){ this.value ='(list all Exceptions here)'; }" <?php } ?> class="textarea" id='excep'  style=" width:649px; height:70px;" ><?PHP if($TASKS[$i]->Exception) echo $TASKS[$i]->Exception; else echo '(list all Exceptions here)'; ?></textarea><br/>
</div></div>
<?php } else { ?>
<div id="EXCEP_<?php echo $TASKS[$i]->task_id; ?>" style="display:none;"><p style="height:10px;"> </p>
<b style="color:red; float:left;" class="blue_small">Exceptions:</b><br/><br/><textarea name="EXCEP_<?php echo $TASKS[$i]->task_id; ?>" <?PHP if($TASKS[$i]->Exception=='(list all Exceptions here)' || !$TASKS[$i]->Exception){ ?> onclick="if(this.value=='(list all Exceptions here)'){ this.value=''; } else if(this.value==''){ this.value ='(list all Exceptions here)'; }" <?php } ?> class="textarea" id='excep'  style=" width:649px; height:70px;" ><?PHP if($TASKS[$i]->Exception) echo $TASKS[$i]->Exception; else echo '(list all Exceptions here)'; ?></textarea><br/>
</div>
<?php } ?>

<input type="hidden" name="task_ids[]" value="<?PHP echo $TASKS[$i]->task_id ?>" />

<?php //echo '<pre>'; print_r($TASKS[$i]->uploaded_file); ?>
<?php for($h=0; $h<count($TASKS[$i]->uploaded_file); $h++) {
?>

	 <input type="hidden" name="fpath_<?php echo $TASKS[$i]->task_id; ?>[]" id="hid_text<?php echo $i+1; ?>" value="<?php echo $TASKS[$i]->uploaded_file[$h]; ?>" />

     <?php } ?><br/>
      <input name="fpath_<?php echo $TASKS[$i]->task_id; ?>[]" id="fpath<?php echo $i+1; ?>" type="hidden" value="<?PHP  if($TASKS[$i]->uploaded_file != '' && $TASKS[$i]->uploaded_file == $title) echo $title; ?>" />

      <span style="float:left; padding-top:4px;"><span id="upload_file<?php echo $i+1; ?>"> </span>
        <!-- <a href="javascript: doc_upload(<?php echo $i+1; ?>);"><img onclick="javascript: doc_upload(<?php echo $i+1; ?>);" src="<?php echo Juri::root();; ?>templates/camassistant_left/images/uploadfile.gif" style="vertical-align:right;" /></a>-->
           <a href="javascript:addEvent2('<?php echo $i+1; ?>','<?php echo $TASKS[$i]->task_id; ?>','<?php echo $_REQUEST['rfp_id'];?>','<?php echo $_REQUEST['vendorid']; ?>')"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/uploadfile.gif" style="vertical-align:right;" /></a>
<!--<a href="javascript:addEvent2('<?php echo $i+1; ?>','<?php echo $TASKS[$i]->task_id; ?>');"><img alt="Upload another attachment" src="<?php echo Juri::root();; ?>components/com_camassistant/skin/images/uploadanother1.gif"></a>-->
<?php /*?><span id="file_text<?php echo $i; ?>"></span><?php */?>
<div id="newdiv<?php echo $i+1; ?>"></div>
	<input name="hidden2" type="hidden" id="theValues" value="0">
	<input name="hidden" type="hidden" id="idvals" value="0">
	</span><div class="clear"></div>

<?php /*?><span id="Alink_<?PHP echo $TASKS[$i]->task_id ?>"><?PHP echo nl2br($TASKS[$i]->Addnotes); ?></span>&nbsp;<?PHP echo $TASKS[$i]->Uploadfile; ?>&nbsp;<?php /*?><span id="Elink_<?PHP echo $TASKS[$i]->task_id ?>"><?PHP echo nl2br($TASKS[$i]->AddException); ?></span><?php */?>
<br/><table>
<?PHP $files_cnt = count($TASKS[$i]->uploaded_file); ?>
    <?php if($files_cnt > 0) { ?>
<strong>Uploaded Files:</strong><br/>
<?php } ?>
<div class="downloadfile" style="margin-bottom:-10px;">
<?PHP if($files_cnt > 0) { for($f=0; $f<$files_cnt; $f++){?>
    <span id="FILES_<?PHP echo $TASKS[$i]->task_id ?>"></span>

<?php //echo '<pre>'; print_r($TASKS[$i]->uploaded_file); ?><tr id="files_<?php echo $TASKS[$i]->uploaded_doc_ids[$f] ?>"><td>
<a href="<?php echo Juri::root(); ?>index2.php?option=com_camassistant&controller=proposals&task=downloadfile&title=<?PHP echo $TASKS[$i]->uploadfile_title[$f]; ?>&path=<?PHP echo $TASKS[$i]->uploaded_file[$f]; ?>"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a></td><td>
    <?PHP if($rebid != 's') {?> <a style="color:red;" href="javascript:deletefile('No','<?PHP echo $is_Alt; ?>','<?PHP echo $Proposal_id; ?>','<?PHP echo $_REQUEST['vendorid']; ?>','<?PHP echo $TASKS[$i]->rfp_id;  ?>','<?PHP echo $TASKS[$i]->task_id ?>','<?PHP echo $TASKS[$i]->uploaded_doc_ids[$f];  ?>','<?PHP echo $act; ?>','<?PHP echo $rebid; ?>');"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/delete.gif" alt="remove file" align="absmiddle" /></a>
   <!--<a href="index.php?option=com_camassistant&controller=proposals&spl_req=No&task=Remove_downloadfile&Alt_Prp=<?PHP echo $is_Alt; ?>&prop_id=<?PHP echo $Proposal_id; ?>&vendor_id=<?PHP echo $_REQUEST['vendorid']; ?>&rfp_id=<?PHP echo $TASKS[$i]->rfp_id;  ?>&task_id=<?PHP echo $TASKS[$i]->task_id ?>&doc_id=<?PHP echo $TASKS[$i]->uploaded_doc_ids[$f];  ?>&act=<?PHP echo $act; ?>&rebid=<?PHP echo $rebid; ?>&Itemid=<?PHP echo $_REQUEST['Itemid']; ?>"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/remove.gif" alt="remove file" align="absmiddle" /></a>-->
   <?PHP } ?></td><td>
<strong> <?PHP echo $TASKS[$i]->uploadfile_title[$f];?></strong></td></tr>

<?PHP } //end for loop ?>
<?PHP } //end if loop ?>
</div></table></div>

<?PHP if($TASKS[$i]->is_req_taskvendors == 1) {
$arr = explode('.',$TASKS[$i]->price);
$amnt_nocammas = str_replace(',','',$arr[0]);
$TOT = $TOT + $amnt_nocammas;
$price_cnt = $price_cnt+1;?>
<?php	$arr = explode('/',$TASKS[$i]->uploaded_file);
		$cnt = count($arr);
		$title = $arr[$cnt-1];
		?>
<div class="pricing_pan">
<?php /*?>onkeydown="javascript: update_price(<?PHP echo $i+1; ?>,'task_price',this.value,'<?php echo $TASKS[$i]->price; ?>',event);"<?php */?>
<div style="color:green; font-weight: bold; font-size: 16px; float: left;">$</div><!--<img align="top" src="<?php echo Juri::root();; ?>templates/camassistant_left/images/edit_line_itempricing.gif" alt="line item pricing" width="109" height="22" /> $&nbsp;</label>-->&nbsp;
<?php if($TASKS[$i]->price=='' || $TASKS[$i]->price=='0.00'){
   $TASKS[$i]->price= '(Line-Item Pricing)';
}
?>
<input type="hidden" name="price_fields[]" value="<?php echo $TASKS[$i]->task_id; ?>" />
<div style="float: left;"><input name="task_price[]" type="text" style="background-color:#fff; color:red;" id="task_price<?PHP echo $i+1; ?>" value="<?PHP  echo $TASKS[$i]->price?>" <?PHP if($TASKS[$i]->price=='(Line-Item Pricing)'){ ?> onclick="this.value='';" <?php } ?> onchange="javascript: update_price(<?PHP echo $i+1; ?>,'task_price',this.value,'<?php echo $TASKS[$i]->price; ?>',event);"  /></div>
<?php //echo '<pre>'; print_r($TASKS[$i]); ?>


</div>
<?PHP } ?></br></br>
<?PHP } ?>
<div class="clear"></div>
<!--line item files -->


<?PHP
if(count($DOCS)>0){
for($j=0; $j<count($DOCS); $j++)
{
?>
<!-- sof line item pan -->
<?Php if($DOCS[$j]->title) { ?>
<div class="downloadfile">
<span class="grey_12">Additional Document/Specification #<?PHP echo $j+1; ?>:</span>&nbsp;&nbsp;&nbsp;
<strong><?PHP echo $DOCS[$j]->title;?></strong>&nbsp;&nbsp;&nbsp;
<?php
$default = 'components/com_camassistant/doc/';
$DOCS[$j]->doc_path =str_replace(' ','',$DOCS[$j]->doc_path);
$uploads=explode('/',$DOCS[$j]->doc_path);
if($uploads[0]=='components' && $uploads[1]=='com_camassistant' && $uploads[2]=='doc' ){
 $file_link = $DOCS[$j]->doc_path;
 } else {
 $file_link = $default.$property->property_name.'_'.$property->tax_id.'/'.$DOCS[$j]->doc_path;
 }
//$file_link = $default.$property->property_name.'_'.$property->tax_id.'/'.$DOCS[$j]->doc_path;
?>

<a href="<?php echo Juri::root();; ?>index2.php?option=com_camassistant&controller=proposals&task=downloadfile&title=<?PHP echo $DOCS[$j]->title; ?>&path=<?PHP echo $file_link; ?>"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a> <strong><?PHP echo $DOCS[$j]->upload_doc;?></strong>
<div class="clear"></div><br/>
<?PHP if($DOCS[$j]->is_req_docvendors == 1) {
$arr = explode('.',$DOCS[$j]->price);
$amnt_nocammas = str_replace(',','',$arr[0]);
$TOT = $TOT + $amnt_nocammas;
?>
<!--<div class="pricing_pan2">
<label><img align="top" height="22" width="145" style="margin: 0px; padding: 0px;" alt="line item pricing" src="<?php echo Juri::root();; ?>templates/camassistant_left/images/Additional_Item_Pricing.gif"> $&nbsp;</label>
<?php /*?>onkeydown="javascript: update_price('<?PHP echo $j+1; ?>','downloads_price',this.value,'<?php echo $DOCS[$j]->price; ?>',event);"<?php */?>
<input type="hidden" name="downloads_ids[]" value="<?PHP echo $DOCS[$j]->doc_id;  ?>" />
<input name="downloads_price[]" type="text" id="downloads_price<?PHP echo $j+1; ?>" value="<?PHP echo $DOCS[$j]->price;  ?>"  onchange="javascript: update_price(<?PHP echo $j+1; ?>,'downloads_price',this.value,'<?php echo $DOCS[$j]->price; ?>',event);"/>
</div>-->
<input type="hidden" name="downloads_ids[]" value="<?PHP echo $DOCS[$j]->doc_id;  ?>" />
<?PHP } ?>
</div>
<!-- eof line item pan -->
<?PHP } } }?>
<?php //echo '<pre>'; print_r($cat);?>
<!--  sof line item pan -->
<?PHP
$cat = $Review_reqCatList['main'];
$main = $Review_reqCatList['main'];
$sub = $Review_reqCatList['sub'];
$child = $Review_reqCatList['child'];
$child_price=array();
 if(count($cat)>0) { ?>
<span class="blue_small"><strong>General Notes:</strong></span><br/>
<script language="JavaScript" type="text/javascript" src="components/com_camassistant/assets/wysiwyg.js"></script>
<textarea id="snotesmain" name="SNOTES" rel="editor" class="textarea" style=" width:656px; height:130px;" ><?PHP /*echo nl2br($SPL_REQ_TABS[6]->Notes);*/ echo $SPL_REQ_TABS[6]->Notes; ?></textarea>
<script language="javascript1.2">
generate_wysiwyg('snotesmain');
</script>
<br />
<!--<span class="blue_small"><strong><p style="color:#FF0000; padding:0px; margin:0px;">General Exceptions:</p></strong></span><textarea name="SEXCEP"  class="textarea" style=" width:649px; height:80px;" ><?PHP echo $SPL_REQ_TABS[7]->Exception; ?></textarea>-->

<span id="sfile_text"></span>
<?php	$arr = explode('/',$SPL_REQ_TABS[3]->uploaded_file[0]);
		$cnt = count($arr);
		$title = $arr[$cnt-1];
		?>
	<input type="hidden" name="shid_text" id="shid_text1" value="<?php echo $SPL_REQ_TABS[3]->uploaded_file[0]; ?>" />
	 <input name="spath[]" id="spath1" type="hidden" value="<?PHP  if($SPL_REQ_TABS[3]->uploaded_file != '' && $SPL_REQ_TABS[3]->uploaded_file == $title) echo $title; ?>" />
     <?php //javascript: sdoc_upload('1'); ?><br />
<br />
<span style="padding-top:4px;"> <span id="supload_file1"> </span>&nbsp;<a href="javascript: saddEvent2('<?php echo $_REQUEST['rfp_id'];?>','<?php echo $_REQUEST['vendorid']; ?>');"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/uploadfile.gif" style="vertical-align:right;" /></a>   <span id="sfile_rem"></span><!--<a href="javascript:saddEvent2();"><img alt="Upload another attachment" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/uploadanother1.gif"></a>--> </span>
<div id="newdiv"></div>
	<input name="hidden2" type="hidden" id="theValues" value="0">
	<input name="hidden" type="hidden" id="idvals" value="0">

<?php /*?><span id="Alink_0"><?PHP echo nl2br($SPL_REQ_TABS[0]->Addnotes); ?></span>&nbsp;<?PHP echo $SPL_REQ_TABS[1]->Uploadfile; ?>&nbsp;<?php /*?><span id="Elink_0"><?PHP echo nl2br($SPL_REQ_TABS[2]->AddException); ?></span><?php */?>


<div class="clear"></div>
<?php //echo '<pre>'; print_r($SPL_REQ_TABS[3]->uploaded_file); ?>
<?PHP $files_cnt = count($SPL_REQ_TABS[3]->uploaded_file); ?>
<?php /*?><?php if($SPL_REQ_TABS[3]->uploaded_file) { ?>
Uploaded Files:<br/> <span id="FILES_0"></span> <?php } ?> <?php */?>
<br /><table>
<?PHP if($files_cnt > 0) { ?>
<strong>Uploaded Files:</strong>
<?php } ?>
<?PHP if($files_cnt > 0) { for($f=0; $f<$files_cnt; $f++){?>
<span id="FILES_0"></span>
<div class="downloadfile" style="margin-bottom:-10px;"><tr id="files_<?php echo $SPL_REQ_TABS[4]->uploaded_doc_ids[$f]; ?>"><td>
<a href="<?php echo Juri::root();; ?>index2.php?option=com_camassistant&controller=proposals&task=downloadfile&title=<?PHP echo $title; ?>&path=<?PHP echo $SPL_REQ_TABS[3]->uploaded_file[$f]; ?>"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/downloadfile.gif" alt="download file" align="absmiddle" /></a></td><td><?PHP if($rebid != 's') {?><a style="color:red;" href="javascript:deletefile('Yes','<?PHP echo $is_Alt; ?>','<?PHP echo $Proposal_id; ?>','<?PHP echo $_REQUEST['vendorid']; ?>','<?PHP echo $RFP->id;  ?>',' ','<?PHP echo $SPL_REQ_TABS[4]->uploaded_doc_ids[$f]; ?>','<?PHP echo $act; ?>','<?PHP echo $rebid; ?>');"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/delete.gif" alt="remove file" align="absmiddle" /></a>
<!--<a href="index.php?option=com_camassistant&controller=proposals&spl_req=Yes&Alt_Prp=<?PHP echo $is_Alt; ?>&task=Remove_downloadfile&prop_id=<?PHP echo $Proposal_id; ?>&vendor_id=<?PHP echo $_REQUEST['vendorid']; ?>&rfp_id=<?PHP echo $RFP->id;  ?>&doc_id=<?PHP echo $SPL_REQ_TABS[4]->uploaded_doc_ids[$f];  ?>&act=<?PHP echo $act; ?>&rebid=<?PHP echo $rebid; ?>&Itemid=<?PHP echo $_REQUEST['Itemid']; ?>"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/remove.gif" alt="remove file" align="absmiddle" /></a> -->
<?PHP } ?></td><td>
<strong> <?PHP echo $SPL_REQ_TABS[5]->uploadfile_title[$f];?></strong></td></tr>
</div>
<?PHP } //end for loop ?>
<?PHP } //end if loop ?></table>
<?PHP } ?>
</div></br/>
<!--Warrant info change -->
<div style="width:852px;"><span class="blue_small"><strong>WARRANTY INFORMATION:</strong></span><span class="hasTip2" title="Info ::<div style='font-size:13px; width:500px;'>Type, paste, or upload your warranty policy and details.</div>"> <img align="left" style="margin-bottom:-8px; float:none; margin-right: 0px;" alt="info" src="<?php echo Juri::root();; ?>components/com_camassistant/skin/images/info_icon3.png"></span></div><br />
<div  style="float:left; width:700px;" >
	 <textarea name="warranty_file_area" rel="editor" class="textarea" id="warranty_file_area" style="float:left; width:656px; height:70px;" id="warranty_file_area" cols="50" rows="3"><?PHP  if($PRICE[0]->warranty_file_area != '') echo html_entity_decode($PRICE[0]->warranty_file_area); else echo "Not Specified"; ?></textarea>
	 <script language="javascript1.2">
generate_wysiwyg('warranty_file_area');
</script>
	  <div class="clear"></div>

	 <input type="hidden" name="warranty_hid_text" id="warranty_hid_text" value="" />

          <p style="padding-right:36px; float:left; padding-top:3px;"><a href="javascript: warranty_doc_upload('<?php echo $_REQUEST['rfp_id'];?>','<?php echo $_REQUEST['vendorid']; ?>');"><img onclick="javascript: warranty_doc_upload('<?php echo $_REQUEST['rfp_id'];?>','<?php echo $_REQUEST['vendorid']; ?>','1');" src="<?php echo Juri::root();; ?>templates/camassistant_left/images/uploadfile.gif" style="vertical-align:right;" /> </a></p>
	<!--  <p style="padding-right:36px; float:right; padding-top:3px;"><a href="javascript: warranty_doc_upload('<?php echo $_REQUEST['rfp_id'];?>','<?php echo $_REQUEST['vendorid']; ?>');"><img onclick="javascript: warranty_doc_upload('<?php echo $_REQUEST['rfp_id'];?>','<?php echo $_REQUEST['vendorid']; ?>');" src="<?php echo Juri::root();; ?>templates/camassistant_left/images/uploadfile.gif" style="vertical-align:right;" /> </a> <span id="warranty_file_rem"></span></p>-->
	  <div class="clear"></div><br/>  <table><tr><td><span id="warranty_file_rem"></span></td><td> <span id="warranty_file_text"></span></td></tr></table>

	 <?PHP

		$arr = explode('/',$PRICE[0]->warranty_filepath);
		$cnt = count($arr);
		$title = $arr[$cnt-1];

      if($PRICE[0]->warranty_filepath != '' && $PRICE[0]->warranty_file_text == $title) { ?>
<p style="padding-right:10px; float:left"><strong>Uploaded Files:</strong> </p><?php } ?>
<table><?php
	  if($PRICE[0]->warranty_filepath != '' && $PRICE[0]->warranty_file_text == $title) {?>
      <div class="clear"></div><tr id="files_<?php echo $PRICE[0]->id; ?>"><td><a href="<?php echo Juri::root();; ?>index2.php?option=com_camassistant&controller=proposals&task=downloadfile&title=<?PHP echo $title; ?>&path=<?PHP echo $PRICE[0]->warranty_filepath ?>"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/downloadfile.gif" vspace="2px"  alt="download file" align="absmiddle" /></a></p></td><td><?PHP if($rebid != 's') { ?><a style="color:red;" href="javascript:deletewarrentyfile('<?PHP echo $PRICE[0]->id; ?>','<?PHP echo $_REQUEST['vendorid']; ?>','<?PHP echo $RFP->id; ?>','<?PHP echo $PRICE[0]->Alt_bid;  ?>','<?PHP echo $act ?>');"><img src="<?php echo Juri::root();; ?>templates/camassistant_left/images/delete.gif" alt="remove file" align="absmiddle" /></a>

      <?PHP } ?> </td><td><?PHP echo $PRICE[0]->warranty_file_text ?></td><?PHP } ?></tr></table>

<input name="warranty_path" id="warranty_path" type="hidden" value="<?PHP  if($PRICE[0]->warranty_filepath != '' && $PRICE[0]->warranty_file_text == $title) echo $PRICE[0]->warranty_filepath; ?>" />
<?php //echo '<pre>'; print_r($PRICE[0]); ?>
<input type="hidden" name="warranty_hid_text1" id="warranty_hid_text" value="<?php echo $PRICE[0]->warranty_file_text; ?>" />
	 </div><div class="clear"></div>
	 <!-- Completed -->
<?PHP if(count($cat)>0) { ?>
<div class="lineitem_pan_row"><br />
<?php /*?><span class="grey_12">Special Requirements:</span><?php */?>
<span class="blue_small"><strong>Special Requirements:</strong></span>
<div class="lineitem_pan" style="background-color:#F7F7F7; width:669px;">
<?php

$cat = $Review_reqCatList['main'];
$main = $Review_reqCatList['main'];
$sub = $Review_reqCatList['sub'];
$child = $Review_reqCatList['child'];
$child_price=array();
?>
</div>
<div class="lineitem_pan" style="background-color:#F7F7F7; width:669px;">
<?PHP for($c=0; $c<count($cat); $c++)
 {
     for($m=0; $m<count($main); $m++)
	 {
	 	if($cat[$c]->main_id == $main[$m]->main_id)
		{
			echo '<span style="padding-left:0px;font-weight:bold;height:15px;">'.ucwords($main[$m]->main_title).'</span><br/>';
			for($s=0; $s<count($sub); $s++)
			{
				if($main[$m]->main_id==$sub[$s]->main_id)
				{
				echo '<span style="padding-left:25px;font-weight:normal;height:15px;">&nbsp;&nbsp;'.ucwords($sub[$s]->sub_title).'</span><br/>';
				if($sub[$s]->sub_id==12)
				echo '<span style="padding-left:25px;font-weight:normal;height:15px;"> &nbsp;&nbsp; Minimum Liability Insurance Amount Required <b>: $'.$sub[$s]->price.'</b></span> <br/>';
					for($ch=0; $ch<count($child); $ch++)
					{
						if($sub[$s]->sub_id==$child[$ch]->sub_id)
						{
							echo '<span style="padding-left:45px;font-weight:normal;height:15px;">&nbsp;&nbsp;'.ucwords($child[$ch]->child_title).'</span>';
							if($child[$ch]->child_id==14)
							{
								$child_price=explode('/',$child[$ch]->price);
								echo '<span style="padding-left:30px;font-weight:normal;height:15px;font-weight:bold"> $'.$child_price[0].'/$'.$child_price[1].'/$'.$child_price[2].'</span><br/>';
							} else {
								echo '<br/>';
							}
						}
					}
				}

			}
		}
	  }
 } ?>
 </div>

<br/>
<?PHP } ?>
</div>

	 <div class="clear"></div>
<!-- eof line item pan -->
</div></div>
<!--  Contact person editing -->
<div class="signup">
<label><strong>Contact Person:</strong> </label>
<input type="text" value="<?php echo $PRICE[0]->contact_name; ?>" style="width:275px;" name="contact_name">
</div>
<!--  Contact person completed -->
<!--  sof line item pan -->
<div class="lineitem_pan_row" <?PHP if(count($main)==0) { ?> style="padding-top:12px" <?PHP } ?> >
<br />
<span class="blue_small"><strong>PROPOSAL PRICING:</strong></span>
<div class="downloadfile">
<?PHP if($price_cnt != 0 || $doc_price_cnt != 0) { ?>
<div class="proposal_pric">
<label style="width:256px; padding-top:3px;"><strong>LINE ITEM PRICING ABOVE ADDED UP</strong>:</label>
<?PHP $PRICE[0]->tasks_total_price = number_format($PRICE[0]->tasks_total_price,2); ?>
$&nbsp;<input name="total_lineitem_pricing" id="total_lineitem_pricing" type="text"  value="<?PHP echo $PRICE[0]->tasks_total_price//echo number_format($TOT,2); //$PRICE[0]->tasks_total_price; ?>" readonly="readonly" style="color:black;" />
</div>
<?PHP } ?>

</div>
<!--
<div class="proposal_pric" style="margin-top:2px;">

<?PHP $PRICE[0]->price_other_items = number_format($PRICE[0]->price_other_items,2); ?>

<?PHP if($price_cnt != 0 || $doc_price_cnt != 0) { ?><div style="float:left; width:435px;"><label style="width:254px; padding-top:3px;">
<strong style="float:left;">YOUR PRICE FOR ALL OTHER ITEMS:</strong> <?PHP //} else { ?><!--<strong style="float:left;">YOUR PRICE FOR ALL OF THE ABOVE ITEMS:</strong>--<?PHP //} ?></label>

<?php /*?>onkeydown="javascript: validateNumber('','other_items_price',this.value,'<?php echo $PRICE[0]->price_other_items; ?>',event);"<?php */?>

$&nbsp;<input name="other_items_price" id="other_items_price" style="background-color:#fff; color:black;" type="text" value="<?PHP echo $PRICE[0]->price_other_items; ?>"  onclick="if(this.value == 0.00) this.value = '';" onblur="javascript: getcommission();" onchange="javascript: format_val('','other_items_price',this.value,'<?php echo $PRICE[0]->price_other_items; ?>',event);"    /><span  class="hasTip2" title="Info ::<div style='font-size:13px; width:500px;'>All Other Items specifically includes any line items that did NOT require line-item pricing.  This MAY also include any adjustments relating to Notes or Exceptions, but should be CLEARLY noted in the respective Note or Exception.</div>"> <img align="right" style="float:right; margin-top:-1px" alt="info" src="<?php echo Juri::base(); ?>components/com_camassistant/skin/images/info_icon3.png"></span></div>

<?php } ?>
<div style="clear:both"></div>


</div>
-->

<?PHP
$arr = explode('.',$PRICE[0]->price_other_items);
$amnt_nocammas = str_replace(',','',$arr[0]);
$proposal_total_price = $TOT + $amnt_nocammas;
 ?>
<?PHP //if($price_cnt != 0 || $doc_price_cnt != 0) {
$width = "234px;";
$margin = "";
?>
<!--
<div class="proposal_pric">
<label style="width:256px; padding-top:3px;"><strong>TOTAL PROPOSAL PRICE:</strong></label>
<?PHP //$PRICE[0]->proposal_total_price = number_format($PRICE[0]->proposal_total_price,2); ?>
$&nbsp;<input name="total_price" id="total_price" type="text" style=" font-weight:bold; color:black; " value="<?PHP echo $PRICE[0]->proposal_total_price; //echo number_format($proposal_total_price,2); ?>" readonly="readonly"/></div>-->
<?PHP //} else { $width = "244px;";  $margin = "10px"; ?>
<div class="proposal_pric">
<label style="width:256px; padding-top:0px;"><strong>TOTAL PROPOSAL PRICE:</strong></label>
<?PHP //$PRICE[0]->proposal_total_price = number_format($PRICE[0]->proposal_total_price,2); ?>
$&nbsp;<input name="total_price" id="total_price" type="text" style=" font-weight:bold; color:black; " onclick="if(this.value == 0.00) this.value = '';" onblur="javascript: getcommission();" onchange="javascript: format_val('','total_price',this.value,'<?php echo $PRICE[0]->proposal_total_price; ?>',event);"  value="<?PHP echo $PRICE[0]->proposal_total_price; //echo number_format($proposal_total_price,2); ?>" <?PHP if($price_cnt != 0 || $doc_price_cnt != 0) { ?>readonly="readonly" <?php } ?>/></div> <?php //} ?>

<?PHP
$c2 = $PRICE[0]->proposal_total_price;
$c2 = doubleval(str_replace(",","",$c2));
//echo $c2;
if($c2 != 0)
{
	if($c2 < 4400000)
	{
		$formula = (-0.00869*log($c2))+0.15;
		$percent = round($formula,5);
	}
	else if($c2 >= 4400000 && $c2 < 6500000)
	{
		$formula	=  (-0.00000000000000000000004033*pow($c2,3))+((0.0000000000000010088)*pow($c2,2))-(0.0000000083137)*$c2 + 0.037557;
		$percent = round($formula,5);
	}
	else if($c2 >= 6500000)
	{
		$percent = 0.015;
	}
	$comm_amnt = $percent*$c2;
	$comm_amnt = round($comm_amnt,2);
	//$comm_amnt = round($comm_amnt);
}
else
{
$comm_amnt = '35';
}
if($comm_amnt < 35)
$comm_amnt = '35';
//echo $comm_amnt;
$comm_amnt = doubleval(str_replace(",","",$comm_amnt));
$comm_amnt = number_format($comm_amnt,2);

?>
<div class="proposal_pric" style="margin-top:<?php echo $margin; ?>">
<div style="float:left; width:437px;"><label style="width:256px; padding-top:3px;"><strong>REFERRAL FEE</strong> (based on total above):<br /></label>

<?PHP $PRICE[0]->commission = number_format($PRICE[0]->commission,2); ?>
$&nbsp;<input readonly="readonly" name="commisions" id="commisions" type="text" style="font-weight:bold;" value="<?PHP echo $comm_amnt; //echo $PRICE[0]->commission; ?>"/>
<span class="hasTip2"><a href="/live/index2.php?option=com_content&amp;view=article&amp;id=225&amp;Itemid=113" rel="{handler: 'iframe', size: {x: 680, y: 530}}" class="modal" title="Click here" style="text-decoration: none;"> <img align="right" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/images/info_icon3.png" alt="info" style="float:right; margin-top:-2px;"> </a></span></div>
<span style="float:left; color:red; font-weight:bold; padding-top:2px;"></span>
</div>

</div>

<div class="clear"></div>
<br/>

  <table width="100%">
    <tr>
      <td width="4%" align="left" valign="top"><input name="i_agree" id="i_agree" type="checkbox" value="yes" /></td>
      <td width="96%">I have read and understand all of the requirements and/or attachments of this Request For Proposal. My pricing reflects the performance of all the duties asked, and the delivery of any products requested, and I am aware that any change orders that I submit to the aforementioned scope of work may adversely affect my Vendor Rating. I have also read and agree to the <a style="text-decoration: none;" title="Click here" class="modal" rel="{handler: 'iframe', size: {x: 680, y: 530}}" href="index2.php?option=com_content&amp;view=article&amp;id=51&amp;Itemid=113">Terms and Conditions</a> of this website. <span class="redstar">(Required)      <br />
        <br />
        <br />
      </span></td>
    </tr>
  </table>

<?PHP if($Alt_Prp == 'yes') { if($rebid == 's') $img1='saveasdraft.gif'; else $img1 = 'save_changes.gif'; if($act == 'Submit' || $status == 'resubmit') { $img='resubmit.gif'; $js_act='resubmit';} else {$img = 'review_submit.gif'; $js_act='review'; }  ?>
<div id="topborder_row" align="right"><a href="javascript: location.reload(true);"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/discardchanges.gif" alt="save as draft" width="194" height="47" /></a><?PHP if(($status != 'resubmit' && $act == 'Draft') || $act == 'review' || $rebid == 's') { ?><a href="javascript: Alt_saveasdraft('Draft');"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/saveasdraft.gif" alt="save as draft" width="154" height="46" /></a><?PHP } ?>
<?php /*?><a href="javascript: Alt_saveassubmit('<?PHP echo $js_act; ?>');"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/<?PHP echo $img; ?>" alt="review &amp; submit" /></a><?php */?>
<a href="javascript:void(0);" onclick="javascript: Alt_saveassubmit('<?PHP echo $js_act; ?>');"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/<?PHP echo $img; ?>" alt="review &amp; submit" /></a>
</div></div>
<?PHP } else {  if($rebid == 's') $img1='saveasdraft.gif'; else $img1 = 'save_changes.gif';  if($act == 'Submit' || $status == 'resubmit'){ $img='resubmit.gif'; $js_act='resubmit'; } else {$img = 'review_submit.gif'; $js_act='review'; } ?>
<div id="topborder_row" align="right"><a href="javascript: location.reload(true);"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/discardchanges.gif" alt="save as draft" width="194" height="47" /></a><?PHP if(($status != 'resubmit' && $act == 'Draft') || $act == 'review' || $rebid == 's') { ?><a href="javascript: fun_saveasdraft('Draft');"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/saveasdraft.gif" alt="save as draft" width="154" height="46" /></a><?PHP } ?>
<?php /*?><a  href="javascript: fun_saveassubmit('<?PHP echo $js_act; ?>');"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/<?PHP echo $img; ?>" alt="review &amp; submit" /></a>
<?php */?>
<a href="javascript:void(0);" onclick="javascript: fun_saveassubmit('<?PHP echo $js_act; ?>');"><img src="<?php echo Juri::root(); ?>templates/camassistant_left/images/<?PHP echo $img; ?>" alt="review &amp; submit" /></a>

</div></div>
<?PHP } ?>




<!-- eof table pan -->

<input type="hidden" name="Itemid" value="<?PHP echo $_REQUEST['Itemid']; ?>" />
<input type="hidden" name="Proposal_id" value="<?PHP echo $Proposal_id; ?>" />
<input type="hidden" name="Prp_id" value="<?PHP echo $Proposal_id; ?>" />
<input type="hidden" name="act" value="Update" />
<input type="hidden" name="vendorid" value="<?PHP echo  $_REQUEST['vendorid'];  ?>" />
<input type="hidden" name="industryid" value="<?PHP echo  $_REQUEST['industryid'];  ?>" />
<input type="hidden" name="rfpstatus" value="<?PHP echo  $_REQUEST['rfpstatus'];  ?>" />
<input type="hidden" name="rfpapproval" value="<?PHP echo  $_REQUEST['rfpapproval'];  ?>" />
<input type="hidden" name="search" value="<?PHP echo  $_REQUEST['search'];  ?>" />
<input type="hidden" name="rfp_id" value="<?PHP echo $_REQUEST['rfp_id']; ?>" />
<input type="hidden" name="submittype" id="submittype" value=""/>
<input type="hidden" name="submit_type" id="submit_type" value="<?php echo $js_act?>" />
<input type="hidden" name="Alt_Prp" id="Alt_Prp" value="<?PHP echo $is_Alt; ?>" />
<input type="hidden" name="rebid" id="rebid" value="<?PHP echo $rebid; ?>" />
</form>
<?php //echo '<pre>'; print_r($_REQUEST); ?>
