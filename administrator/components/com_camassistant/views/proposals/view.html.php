<?php
/**
 * @version		1.0.0 camassistant $
 * @package		camassistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

jimport( 'joomla.application.component.view' );

//class vendorsViewvendors extends Jview
class proposalsViewproposals extends Jview
{
	function display($tpl = null){
		JToolBarHelper::title(   JText::_( 'Vendor Proposal Form' ).': <small>' );

		// global $mainframe;
		$task = JRequest::getVar("task",'');
		//singnup process 2
		$user	= JFactory::getUser();
		//Restriction to access vendor page.
		/*if($user->user_type != 11)
		{
		$user	= JFactory::getUser();
		JRequest::setVar('task', 'not_authorized');
		JRequest::setVar('view', 'proposals');
		$this->setLayout('not_authorized');
		parent::display();
		}*/
		//to display vendor proposal form to bid
		if($task == 'vendor_docs')
		{
			$model = $this->getModel('proposals');
			$vendor_files = $model->getvendordocs();
			$this->assignRef('vendor_files', $vendor_files);
			$taxid = $model->getvendortaxid();
			$this->assignRef('taxid', $taxid);
			$this->setLayout('vendor_docs_layout');
			parent::display();
		}
		else if($task == 'openfiles')
		{
			$model = $this->getModel('proposals');
			$path = JRequest::getVar('path','');
			$openfiles = $model->getopenfiles($path);
			//echo "<pre>"; print_r($openfiles);
			$this->assignRef('openfiles', $openfiles);
			$this->setLayout('default4');
			parent::display();
		}
		else if($task == 'vendor_proposal_form')
		{
		$Alt_bid = JRequest::getVar('Alt_bid','');
		$Alt_Prp = JRequest::getVar('Alt_Prp','');
		if($Alt_bid != '')
		$Alt_Prp =  $Alt_bid;
		else
		$Alt_Prp =  $Alt_Prp;
		//$Alt_Prp = JRequest::getVar('Alt_bid','');
		$model = $this->getModel('proposals');
		//function to get vendor proposal status
		$Form_status = $model->get_Form_status();
		$this->assignRef('Form_status',$Form_status[0]->proposaltype);
		$this->assignRef('Form_bidded_date',$Form_status[0]->proposeddate);

		//function to get RFP details
		$RFP_details = $model->get_RFPinfo();
		$this->assignRef('RFP_details',$RFP_details[0]);

		//function to get RFP Task details
		$TASKS_details = $model->get_TASKSinfo('Add',$Alt_Prp);
		$this->assignRef('TASKS_details',$TASKS_details);

		//function to get RFP Docs details
		$DOCS_details = $model->get_DOCSinfo('Add',$Alt_Prp);
		$this->assignRef('DOCS_details',$DOCS_details);

		//function to get RFP Tasks_Docs details
		$Tasks_DOCS_details = $model->get_Tasks_DOCSinfo($Alt_Prp);
		$this->assignRef('Tasks_DOCS_details',$Tasks_DOCS_details);

		//function to get RFP special Requirements details
		$SPLReq_Category = $model->get_SPLReq_Category();
		$this->assignRef('SPLReq_Category',$SPLReq_Category);

		//function to get RFP special Requirements details
		$SPLRequirements_details = $model->get_SPLRequirements('Add');
		$this->assignRef('SPLRequirements_details',$SPLRequirements_details);

		//function to get RFP special Requirements tabs Addnotes, Uploadfile, Addexception links
		$SPL_REQ_tabs = $model->get_SPLRequirements_tabs('Add',$Alt_Prp);
		$this->assignRef('SPL_REQ_tabs',$SPL_REQ_tabs);

		$vendor_GLI_compliance_alert = $model->get_chk_vendor_GLI_compliance_alert();
		//echo "<pre>"; print_r($vendor_GLI_compliance_alert);
		$getindustryids = $model->getindustry_ids($user->id);
		if($getindustryids)
		if(in_array('56',$getindustryids))
		$PLN_needed = 'yes'; else $PLN_needed = 'no';
		//validation to redirect to vendor bidding form
		$Prp_bids = $model->get_RFP_Maxbids();
		$rfp_24hrs = $model->get_rfp_rebid_chk();
		$vendor_bids = $model->get_validate_vendor_bids();
		if($Prp_bids == 0)
		$this->setLayout('bidding_expired');
		else if($vendor_GLI_compliance_alert['GLI_exp'] != 0 && (($PLN_needed == 'no') ||  ($PLN_needed == 'yes' && $vendor_GLI_compliance_alert['PLN_exp'] != 0)))
		{
		$status = 'yes';
		$this->assignRef('expired',$status);
		$this->setLayout('bidding_expired');
		}
		else if($vendor_GLI_compliance_alert['W9_exist'] == 0 || $vendor_GLI_compliance_alert['GLI_exist'] == 0 ||($PLN_needed == 'yes' && $vendor_GLI_compliance_alert['PLN_exist'] == 0))
		{
		 $app =& JFactory::getApplication();
		 $app->redirect('index.php?option=com_camassistant&controller=vendors&view=vendors&task=vendor_dashboard&Itemid=112');
		}
		else if($vendor_GLI_compliance_alert['GLI_status'] != 0 ||  $vendor_GLI_compliance_alert['W9_status'] != 0 || ($PLN_needed == 'yes' && $vendor_GLI_compliance_alert['PLN_status'] != 0))
		{
		$app =& JFactory::getApplication();
		$app->redirect('index.php?option=com_camassistant&controller=vendors&view=vendors&task=vendor_dashboard&Itemid=112');
		}
		else if($vendor_GLI_compliance_alert['GLI_exp'] != 0 || ($PLN_needed == 'yes' && ($vendor_GLI_compliance_alert['PLN_status'] != 0 || $vendor_GLI_compliance_alert['PLN_exp'] != 0 )))
		{
		$app =& JFactory::getApplication();
		$app->redirect('index.php?option=com_camassistant&controller=vendors&view=vendors&task=vendor_dashboard&Itemid=112');
		}
		else if($rfp_24hrs == 'not allowed' || $vendor_bids == 'Had bid')
		{
		$this->assignRef('vendor_bids',$vendor_bids);
		$this->setLayout('bidding_expired');
		}
		else
		$this->setLayout('vendor_proposal_form');
		parent::display();
		}
		//to edit Submitted or Drafted proposed form
		else if($task == 'Proposal_edit')
		{
		JToolBarHelper::back();
		$rebid	= JRequest::getVar('rebid','');
		if($rebid != 's')
		{
			$Alt_bid = JRequest::getVar('Alt_bid','');
			$Alt_Prp = JRequest::getVar('Alt_Prp','');
			if($Alt_bid != '')
			$Alt_Prp =  $Alt_bid;
			else
			$Alt_Prp =  $Alt_Prp;
		}
		$Alt_Prp = JRequest::getVar('Alt_Prp','');
		$model = $this->getModel('proposals');


		//function to get vendor proposal status
		$Form_status = $model->get_Form_status();
		$this->assignRef('Form_status',$Form_status[0]->proposaltype);
		$this->assignRef('Form_bidded_date',$Form_status[0]->proposeddate);

		//function to get RFP details in edit proposal form
		$RFP_details = $model->get_RFPinfo();
		$this->assignRef('RFP_details',$RFP_details[0]);

		//function to get RFP Task details in edit proposal form
		$TASKS_details = $model->get_TASKSinfo('Edit',$Alt_Prp);
		$this->assignRef('TASKS_details',$TASKS_details);
		
		if( $RFP_details[0]->jobtype == 'yes' ){
		$TASKS_details = $model->get_TASKSinfo_basic('Edit',$Alt_Prp);
		$this->assignRef('TASKS_details',$TASKS_details);
		}
		//function to get RFP Tasks_Docs details
		$Tasks_DOCS_details = $model->get_Tasks_DOCSinfo($Alt_Prp);
		$this->assignRef('Tasks_DOCS_details',$Tasks_DOCS_details);

		//function to get RFP Docs details in edit proposal form
		$Edit_DOCS_details = $model->get_Edit_DOCSinfo($Alt_Prp);
		$this->assignRef('DOCS_details',$Edit_DOCS_details);

		//function to get RFP special Requirements details
		$SPLReq_Category = $model->get_SPLReq_Category();
		$this->assignRef('SPLReq_Category',$SPLReq_Category);

		//function to get RFP special Requirements details
		$SPLRequirements_details = $model->get_SPLRequirements('Edit');
		$this->assignRef('SPLRequirements_details',$SPLRequirements_details);

		//function to get RFP Docs details in edit proposal form
		$DOCS_details = $model->get_DOCSinfo('Edit',$Alt_Prp);
		$this->assignRef('DOCS_details',$DOCS_details);

		//function to get Proposal bidding price details in edit proposal form
		$Proposal_price_details = $model->get_Proposal_price_details($Alt_Prp);
		$this->assignRef('Proposal_price_details',$Proposal_price_details);

		//function to get RFP special Requirements tabs Addnotes, Uploadfile, Addexception links
		$SPL_REQ_tabs = $model->get_SPLRequirements_tabs('Edit',$Alt_Prp);
		$this->assignRef('SPL_REQ_tabs',$SPL_REQ_tabs);

		//function to get special requirement amount
		$SPLreq_amount = $model->get_SPLreq_amount();
		$this->assignRef('SPLreq_amount',$SPLreq_amount);

		//function to chk rfp proposal due date
		$rfp_24hrs = $model->get_rfp_rebid_chk();
		/*if($rfp_24hrs == 'allowed')
		$this->setLayout('vendor_proposal_edit_form');
		else
		$this->setLayout('bidding_expired');*/
		if( $RFP_details[0]->jobtype == 'yes' ){
		$basicfiles = $model->getbasicuploadfiles();
		$this->assignRef('basicfiles',$basicfiles);
		}
		
		if( $RFP_details[0]->jobtype == 'yes' ){
		$this->setLayout('vendor_proposal_edit_form_basic');
		}
		else{
		$this->setLayout('vendor_proposal_edit_form');
		}
		parent::display();
		}
		else if($task == 'Addnotes')
		{
		$act = JRequest::getVar('Action','');
		/*if(isset($act) && $act == 'Edit')
		{*/
		$Alt_bid = JRequest::getVar('Alt_bid','');
		$Alt_Prp = JRequest::getVar('Alt_Prp','');
		if($Alt_bid != '')
		$is_Alt =  $Alt_bid;
		else
		$is_Alt =  $Alt_Prp;
		$model = $this->getModel('proposals');
		$spl_req = JRequest::getVar('spl','No');
		$Notes_content = $model->get_task_Addnotes($spl_req,$is_Alt);
		$this->assignRef('Notes_content',$Notes_content);
		/*} */
		$this->setLayout('task_addnotes_form');
		parent::display();
		}
		else if($task == 'Uploadfile')
		{
		$this->setLayout('task_uploadfile_form');
		parent::display();
		}
		else if($task == 'Addexception')
		{
//		echo "can"; exit;
		$act = JRequest::getVar('Action','');
		/*if(isset($act) && $act == 'Edit')
		{*/
		$Alt_bid = JRequest::getVar('Alt_bid','');
		$Alt_Prp = JRequest::getVar('Alt_Prp','');
		if($Alt_bid != '')
		$is_Alt =  $Alt_bid;
		else
		$is_Alt =  $Alt_Prp;
		$model = $this->getModel('proposals');
		$spl_req = $act = JRequest::getVar('spl','No');
		$Exception_content = $model->get_task_Addexception($spl_req,$is_Alt);
		$this->assignRef('Eception_content',$Exception_content);
		/*}*/
		$this->setLayout('task_addexception_form');
		parent::display();
		}
		else if($task == 'vendor_proposal_preview')
		{
		$Alt_Prp = JRequest::getVar('Alt_Prp','');
		$model = $this->getModel('proposals');
		//function to get RFP details in edit proposal form
		$RFP_details = $model->get_RFPinfo();
		$this->assignRef('RFP_details',$RFP_details[0]);

		//function to get RFP Task details in edit proposal form
		$TASKS_details = $model->get_TASKSinfo_preview('Preview',$Alt_Prp);
		$this->assignRef('TASKS_details',$TASKS_details);
		if( $RFP_details[0]->jobtype == 'yes' ){
		$TASKS_details = $model->get_TASKSinfo_preview_basic('Preview',$Alt_Prp);
		$this->assignRef('TASKS_details',$TASKS_details);
		}
		//function to get RFP Tasks_Docs details
		$Tasks_DOCS_details = $model->get_Tasks_DOCSinfo($Alt_Prp);
		$this->assignRef('Tasks_DOCS_details',$Tasks_DOCS_details);

		//function to get RFP Docs details in edit proposal preview
		$Edit_DOCS_details = $model->get_Edit_DOCSinfo($Alt_Prp);
		$this->assignRef('DOCS_details',$Edit_DOCS_details);

		//function to get RFP special Requirements details
		$SPLReq_Category = $model->get_SPLReq_Category();
		$this->assignRef('SPLReq_Category',$SPLReq_Category);

		//function to get RFP special Requirements details in edit proposal form
		$SPLRequirements_details = $model->get_SPLRequirements($Alt_Prp);
		$this->assignRef('SPLRequirements_details',$SPLRequirements_details);

		//function to get RFP Docs details in edit proposal form
		$DOCS_details = $model->get_DOCSinfo('Edit',$Alt_Prp);
		$this->assignRef('DOCS_details',$DOCS_details);

		//function to get Proposal bidding price details in edit proposal form
		$Proposal_price_details = $model->get_Proposal_price_details($Alt_Prp);
		$this->assignRef('Proposal_price_details',$Proposal_price_details);

		//function to get special requirement amount
		$SPLreq_amount = $model->get_SPLreq_amount();
		$this->assignRef('SPLreq_amount',$SPLreq_amount);

		//function to get RFP special Requirements tabs Addnotes, Uploadfile, Addexception links
		$SPL_REQ_tabs = $model->get_SPLRequirements_Preview('Edit',$Alt_Prp);
		$this->assignRef('SPL_REQ_tabs',$SPL_REQ_tabs);

		$Form_status = $model->get_Form_status();
		$this->assignRef('Form_status',$Form_status[0]->proposaltype);
		$this->assignRef('Form_bidded_date',$Form_status[0]->proposeddate);
		
		if( $RFP_details[0]->jobtype == 'yes' ){
		$basicfiles = $model->getbasicuploadfiles();
		$this->assignRef('basicfiles',$basicfiles);
		}
		
		if( $RFP_details[0]->jobtype == 'yes' ){
		$this->setLayout('vendor_proposal_preview_form_basic');
		}
		else{
		$this->setLayout('vendor_proposal_preview_form');
		}
		parent::display();
		}
		else if($task == 'not_authorized')
		{
		$this->setLayout('not_authorized');
		parent::display($tpl);
		}
		else if($task == 'warranty_docs')
		{
		$model = $this->getModel('proposals');
		//functio to get vendor docs in warranty form
		$pfiles = $model->get_warranty_files();
		//echo "<pre>"; print_r($pfiles);
		$this->assignRef('pfiles', $pfiles);
		$this->setLayout('warranty_docs_form');
		parent::display();
		} else if($task == 'upload_select')
		{
			$model = $this->getModel('proposals');
			$vendor_files = $model->getvendordocs();
			$this->assignRef('vendor_files', $vendor_files);
			$taxid = $model->getvendortaxid();
			$this->assignRef('taxid', $taxid);
			$this->setLayout('uploadfile_form');
			parent::display();
		}
		else if($task == 'warranty_popup')
		{
		$model = $this->getModel('proposals');

		//functio to get vendor docs in warranty form
		$pfiles = $model->get_warranty_files();
		$this->assignRef('pfiles', $pfiles);
		$this->setLayout('warrrant_popup');
		parent::display();
		}
		else
		{
		$model = $this->getModel('proposals');
		parent::display($tpl);
		}

	}

}
?>