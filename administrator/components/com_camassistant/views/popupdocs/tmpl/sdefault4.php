<?php

/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here
JHTML::_('behavior.modal');
if(!$_SESSION['taskid'])
$_SESSION['taskid']= $_REQUEST['taskid'];
//echo "this is Shared default-4 file";
$type = JRequest::getVar( 'type','' );
$taxid = JRequest::getVar( 'taxid','' );
if($type == 'shared'){
$type = 'shared';
} else{ $type = '';}
?>
<script>
function addfile(data,taskid,filename){
window.parent.document.getElementById('lineuploads'+taskid).value =data;
window.parent.document.getElementById('delimg'+taskid).style.display ='';
window.parent.document.getElementById('uploadfile'+taskid).innerHTML =filename;
/* if(taskid>20){
window.parent.document.getElementById('requiredoprice'+taskid).style.display ='block';
} */
window.parent.document.getElementById( 'sbox-window' ).close(); 
}
</script>
<link rel="stylesheet" href="<?php echo JURI::root(); ?>templates/camassistant_inner/css/style.css" type="text/css" />
<!--//Getting states list by sateesh on 02-08-11 -->
<?php 
$fileplace = explode("-->", $_REQUEST['fileplace']);
$fpath='components/com_camassistant/doc/'.$fileplace[0];
$fpath_back='components/com_camassistant/doc/';
//print_r($_REQUEST['spid']);
if($type != 'shared'){

$cnt=count($fileplace);
if($cnt==1)
	$backlink='index2.php?option=com_camassistant&controller=popupdocs&task=sdocs&Itemid=76&pid='.$_REQUEST['pid'].'&taskid='.$_SESSION['taskid'].'';
else if($cnt==2) 
	$backlink='index2.php?option=com_camassistant&controller=popupdocs&task=sfiles&Itemid='.$_REQUEST['Itemid'].'&taskid='.$_SESSION['taskid'].'&spid='.$_REQUEST['spid'].'&smid='. $_REQUEST['smid'].'&propertyname='.$fileplace[0].'&taxid='.$taxid.'&pid='.$_REQUEST['pid'];
else {
	for($i=0;$i<count($fileplace)-2;$i++) {

	$pro_name = str_replace(' ','_',$fileplace[0]);
	$pro_name = $pro_name.'_'.$taxid;

		$fpath_back.='/'.$fileplace[$i+1];
		$fplace_back = explode("-->", $_REQUEST['fileplace']);
		for($j=0;$j<=$i+1;$j++)
		$fplace1_back[$j]=$fplace_back[$j];
		$fplace2_back=implode('-->',$fplace1_back);
	}
	$k=count($fileplace)-2;
$fpath_back = str_replace('doc','doc/'.$pro_name,$fpath_back);

	$backlink='index2.php?option=com_camassistant&controller=popupdocs&task=sopenfiles&Itemid='.$_REQUEST['Itemid'].'&taskid='.$_SESSION['taskid'].'&spid='.$_REQUEST['spid'].'&smid='. $_REQUEST['smid'].'&spath='.$fpath_back.'&folder_name='.$fileplace[$k].'&fileplace='.$fplace2_back.'&taxid='.$taxid;
}

} 

///For shared properties
else{
$cnt=count($fileplace);
if($cnt==1)
	$backlink='index2.php?option=com_camassistant&controller=popupdocs&task=sdocs&Itemid=76&pid='.$_REQUEST['pid'].'&taskid='.$_SESSION['taskid'].'';
/*else if($cnt==2) 
	$backlink='index.php?option=com_camassistant&controller=documents&task=sfiles&Itemid='.$_REQUEST['Itemid'].'&spid='.$_REQUEST['spid'].'&smid='. $_REQUEST['smid'].'&propertyname='.$fileplace[0];*/
else {

$db =& JFactory::getDBO();
$user = JFactory::getUser();
if($user->user_type == 13){
if($_REQUEST['smid'] != $user->id){
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no.'/'.$_REQUEST['smid'];
$propertyname = str_replace(' ','_',$propertyname);
$fpath_back = $fpath_back.$propertyname;
$fpath_back = str_replace('//','/',$fpath_back);
}
else{
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no;
$propertyname = str_replace(' ','_',$propertyname);
$fpath_back = $fpath_back.$propertyname;
$fpath_back = str_replace('//','/',$fpath_back);
}
}
if($user->user_type == 12){
$propertyname = $this->camfirm[0]->comp_name.'_'.$this->camfirm[0]->camfirm_license_no.'/'.$_REQUEST['smid'];
$propertyname = str_replace(' ','_',$propertyname);
$fpath_back = $fpath_back.$propertyname;
$fpath_back = str_replace('//','/',$fpath_back);

}
	for($i=0;$i<count($fileplace)-1;$i++) {
	
		$fpath_back.='/'.$fileplace[$i];
		$fplace_back = explode("-->", $_REQUEST['fileplace']);
		for($j=0;$j<=$i;$j++)
		$fplace1_back[$j]=$fplace_back[$j];
		$fplace2_back=implode('-->',$fplace1_back);

	}
	$k=count($fileplace)-1;


//echo $fpath_back;
	$backlink='index2.php?option=com_camassistant&controller=popupdocs&task=sopenfiles&type=shared&Itemid='.$_REQUEST['Itemid'].'&spid='.$_REQUEST['spid'].'&smid='. $_REQUEST['smid'].'&spath='.$fpath_back.'&propertyname='.$fileplace[$k].'&fileplace='.$fplace2_back.'&pid='.$_REQUEST['pid'];
}}
///For shared properties completed
//$path = explode($_REQUEST['folder_name'], $_REQUEST['path']);
//$fileplace = explode("-->".$_REQUEST['folder_name'], $_REQUEST['fileplace']);
?>
<div style="float:right" ><br/>
<?php if($_REQUEST['type'] != 'shared' ){ ?>
<a href="<?php echo $backlink.'&tmpl=component';?>"><img src="images/back_admin.png" alt="info" /></a>
<?php } else {?>
<a href="<?php echo $backlink.'&tmpl=component';?>"><img src="images/back_admin.png" alt="info" /></a>
<?php } ?>
</div>
<div class="clear"></div>
<!-- eof dotshead -->
<div id="i_bar">
<div id="i_bar_txt">
<span>Directory Path: <?PHP //if(isset($folder_name) && $folder_name != '') echo $folder_name; else { ?>
<?php 	for($i=0;$i<count($fileplace);$i++) { 
			echo ucfirst(trim(str_replace('_',' ',$fileplace[$i])));
			if($i<count($fileplace)-1)
			echo '/';
		} ?>
<?PHP //} ?> </span>
</div>
	
</div>

<div class="table_pannel">
<div class="table_panneldiv">
<form name="docform" action="index2.php">
<input type="hidden" name="option" value="" />
<input type="hidden" name="controller" value="" />
<input type="hidden" name="task" value="" />
<input type="hidden" name="spid" value="" />
<input type="hidden" name="smid" value="" />
<input type="hidden" name="spath" value="" />
<input type="hidden" name="doc_title" value="" />
<input type="hidden" name="second" value="" />
<table width="100%" cellpadding="0" cellspacing="4">
    <tr class="table_green_row">
    <td width="62" align="center" valign="top">SELECT</td>
    <td width="456" align="left" valign="top">Name</td>
    <td width="141" align="center" valign="top" colspan="2">options</td>
    </tr>

  <?php for ($i=0; $i<count($this->sopenfiles['folders']); $i++){ ?>
  <tr class="table_blue_rowdots2">
  <td align="center" valign="bottom">
<a href="index2.php?option=com_camassistant&controller=popupdocs&Itemid=82&controller=popupdocs&task=sopenfiles&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->sopenfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->sopenfiles['folders'][$i];?>&type=<?php echo $type; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&taxid=<?php echo $taxid; ?>&pid=<?php echo $_REQUEST['pid']; ?>&taskid=<?php echo $_SESSION['taskid'];?>&tmpl=component"><img src="images/folder_icon.png"  alt="folder" /></a></td>

<td align="left" valign="middle">
<a href="index2.php?option=com_camassistant&controller=popupdocs&Itemid=82&controller=popupdocs&task=sopenfiles&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->sopenfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->sopenfiles['folders'][$i];?>&type=<?php echo $type; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&taxid=<?php echo $taxid; ?>&pid=<?php echo $_REQUEST['pid']; ?>&taskid=<?php echo $_SESSION['taskid'];?>&tmpl=component"><?php echo str_replace('_',' ',$this->sopenfiles['folders'][$i]); ?></a>
</td>
<td align="center" valign="middle">

<a href="index2.php?option=com_camassistant&controller=popupdocs&Itemid=82&controller=popupdocs&task=sopenfiles&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']."/".$this->sopenfiles['folders'][$i]; ?>&folder_name=<?php print_r($this->sopenfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->sopenfiles['folders'][$i];?>&type=<?php echo $type; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&taxid=<?php echo $taxid; ?>&pid=<?php echo $_REQUEST['pid']; ?>&taskid=<?php echo $_SESSION['taskid'];?>&tmpl=component">OPEN</a>

</td>

</tr>
<?php } ?>
<?php
//print_r($this->sopenfiles);
for ($i=0; $i<count($this->sopenfiles['files']); $i++){
?>
<?php $filename = $this->sopenfiles['files'][$i];
$ext = substr(strrchr($filename, "."), 1);
 ?>
  <tr class="table_blue_rowdots2">
<td align="center" valign="bottom"><a href="index2.php?option=com_camassistant&controller=popupdocs&task=open&doc_title=<?php echo $this->sopenfiles['files'][$i]; ?>&path=<?php echo $_REQUEST['spath']; ?>&taskid=<?php echo $_SESSION['taskid'];?>&Itemid=76&tmpl=component"><img src="images/images_<?php echo $ext; ?>.png" /></a></td>
<td align="left" valign="middle"><a href="index2.php?option=com_camassistant&controller=popupdocs&task=open&doc_title=<?php echo $this->sopenfiles['files'][$i]; ?>&path=<?php echo $_REQUEST['spath']; ?>&taskid=<?php echo $_SESSION['taskid'];?>&Itemid=76&tmpl=component"><?php echo str_replace('_',' ',$this->sopenfiles['files'][$i]); ?></a></td>
<td align="center" valign="middle" nowrap="nowrap">
<?php /*?><a href="index2.php?option=com_camassistant&controller=popupdocs&task=open&doc_title=<?php echo $this->sopenfiles['files'][$i]; ?>&path=<?php echo $_REQUEST['spath']; ?>&Itemid=76 ">OPEN</a><?php */?>
<?php $docpath=$_REQUEST['spath'].'/'.$this->sopenfiles['files'][$i]; ?>
<a href="javascript:void(0);" onclick="addfile('<?php echo $docpath; ?>','<?php print_r($_SESSION['taskid']); ?>','<?php print_r($this->sopenfiles['files'][$i]); ?>');">ADD TO RFP</a>
</td>
</tr>
<?php } ?>
<tr class="table_blue_rowdots2">
<td align="center" valign="bottom">&nbsp;</td>
<td align="left" valign="top">&nbsp;</td>
<td align="left" valign="top" colspan="2">&nbsp;</td>
</tr>
</table>
</form>
<div class="table_bottomlinks2">
<ul>
<li  style=" background:none;"><img src="images/new_folder.png" alt="add a new folder" width="45" height="39" align="absmiddle" /> <a class="modal" id="links1"  title="Add Folder"  href="index2.php?option=com_camassistant&controller=popupdocs&task=saddfolder&parentid=1&type=<?php echo $type; ?>&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']; ?>&tmpl=component" rel="{handler: 'iframe', size: {x: 500, y: 250}}" >+Add a new Folder  </a></li>

<li><img src="images/upload_folder.png" alt="Upload a file to this folder" width="37" height="36" align="middle" /><a class="modal" id="links1"  title="Upload a file"  href="index2.php?option=com_camassistant&controller=popupdocs&task=saddfile&parentid=1&type=<?php echo $type; ?>&spid=<?php echo $_REQUEST['spid']; ?>&smid=<?php echo $_REQUEST['smid']; ?>&spath=<?php echo $_REQUEST['spath']; ?>&tmpl=component" rel="{handler: 'iframe', size: {x: 500, y: 250}}" >Upload a file</a></li>
</ul>
</div>

</div></div>



<div class="clear"></div>
