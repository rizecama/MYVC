<?php

/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here
JHTML::_('behavior.modal');
//echo "this is default-4 file"; 
$taxid = JRequest::getVar( 'taxid','' );
$fileplace = JRequest::getVar( 'fileplace','' );
JToolBarHelper::title( JText::_( 'Property name' ));
$arr = explode("-->", $fileplace, 2);
echo "<h1><font color='red'>Property Name:</font>&nbsp;&nbsp;".$arr[0]."</h1>";
?>
<link rel="stylesheet" media="all" type="text/css" href="<?php echo Juri::root(); ?>components/com_camassistant/skin/css/jquery1.css" />
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery.elastic.js"></script>


<script type="text/javascript">
function submitform(pressbutton){
var form = document.adminForm;
if(pressbutton == 'lists')
{
window.location='index.php?option=com_camassistant';}

form.submit();
}
G = jQuery.noConflict();
function deletefiles(filename,mid,type,redirect,path){

if(type == 'folder'){
var con = confirm("Are you sure you want to delete this folder "+filename+" completely? ");
}
else{
var con = confirm("Are you sure you want to delete this file "+filename+" ");
}
if(con==true){
//window.location = "index.php?option=com_camassistant&controller=documents&task=deletefiles&id="+id+"&name="+filename+"&propertyid="+pid+" ";
G.post("index.php?option=com_camassistant&controller=documents&task=deletesecond&mid="+mid+"&name="+filename+"&path="+path+"", function(data){

		if(data == 'success')
		{
		alert("File deleted successfully");
		window.location = redirect;
		}
		else{
		alert("Please try again");
		}
		})
}
if(con == false)
		{
		window.location.href;
		}
}

</script>
<?php
$fileplace = explode("-->", $_REQUEST['fileplace']);
$fpath='components/com_camassistant/doc/'.$fileplace[0].'/';
$fpath_back='components/com_camassistant/doc';
$cnt=count($fileplace);
$user = JFactory::getUser(); 
//Functio to  by sateesh on 03-08-11--> 
if($cnt==1)
	$backlink='index.php?option=com_camassistant&controller=documents&task=pdocs&Itemid=82';
else if($cnt==2) 
	$backlink='index.php?option=com_camassistant&controller=documents&task=pfiles&Itemid='.$_REQUEST['Itemid'].'&pid='.$_REQUEST['pid'].'&mid='. $_REQUEST['mid'].'&propertyname='.$fileplace[0].'&taxid='.$taxid;
else {
	for($i=0;$i<count($fileplace)-2;$i++) {
		$pro_name = str_replace(' ','_',$fileplace[0]);
		$pro_name = $pro_name.'_'.$taxid;
	
		$fpath_back.='/'.$fileplace[$i+1];
		$fplace_back = explode("-->", $_REQUEST['fileplace']);
		for($j=0;$j<=$i+1;$j++)
		$fplace1_back[$j]=$fplace_back[$j];
		$fplace2_back=implode('-->',$fplace1_back);
	}
	$k=count($fileplace)-2;
	$fpath_back = str_replace('doc','doc/'.$pro_name,$fpath_back);
	$backlink='index.php?option=com_camassistant&controller=documents&task=openfiles&Itemid='.$_REQUEST['Itemid'].'&pid='.$_REQUEST['pid'].'&mid='. $_REQUEST['mid'].'&path='.$fpath_back.'&folder_name='.$fileplace[$k].'&fileplace='.$fplace2_back.'&taxid='.$taxid;
}

?>
<div align="right"><a href="<?php echo $backlink;?>"><img src="images/back_admin.png" alt="info" /></a></div><br /><br />
<table cellpadding="0" cellspacing="0" class="adminlist">
  <tr>
  	<th class="title" align="center">Icons</th>
     <th class="title" align="center">Name</th>
    <th class="title" align="center">options</th>
    </tr>

  <?php for ($i=0; $i<count($this->openfiles['folders']); $i++){ ?>
<tr>
<td align="center"><img src="images/folder_icon.png" /></td>
    <td align="center" valign="middle"><a href="index.php?option=com_camassistant&controller=documents&controller=documents&task=openfiles&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&folder_name=<?php print_r($this->openfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->openfiles['folders'][$i];?>&taxid=<?php echo $taxid; ?>"><?php echo $this->openfiles['folders'][$i]; ?></a>
</td>
<td align="center" valign="middle">
<a href="index.php?option=com_camassistant&controller=documents&controller=documents&task=openfiles&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']."/".$this->openfiles['folders'][$i]; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>&folder_name=<?php print_r($this->openfiles['folders'][$i]); ?>&fileplace=<?php echo $_REQUEST['fileplace']."-->".$this->openfiles['folders'][$i];?>&taxid=<?php echo $taxid; ?>">OPEN</a>  <?php /*?><a href="javascript:deletefiles('<?php print_r($this->openfiles['folders'][$i]); ?>','<?php echo $_REQUEST['mid']; ?>','folder','<?php echo "http://".$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']; ?>')">DELETE</a><?php */?>

</td>
</tr>
<?php } ?>
<?php

for ($i=0; $i<count($this->openfiles['files']); $i++){
$img_icon = substr(strrchr($this->openfiles['files'][$i], "."), 1);
?>
<tr>
  <td align="center"><img src="images/images_<?php echo $img_icon; ?>.png"  alt="file" /></td>
<td align="center" valign="middle"><a href="index.php?option=com_camassistant&controller=documents&task=open&title=<?php print_r($this->openfiles['files'][$i]); ?>&path=<?php echo $_REQUEST['path']; ?> "><?php echo str_replace('_',' ',$this->openfiles['files'][$i]); ?></a>
</td>
<td align="center" valign="middle">
<a href="index.php?option=com_camassistant&controller=documents&task=open&title=<?php print_r($this->openfiles['files'][$i]); ?>&path=<?php echo $_REQUEST['path']; ?> ">OPEN</a> | <a href="javascript:deletefiles('<?php echo $this->openfiles['files'][$i]; ?>','<?php echo $_REQUEST['mid']; ?>','file','<?php echo "http://".$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']; ?>','<?php echo $_REQUEST['path']; ?>')">DELETE</a></td>

</tr>
<?php } ?>
<tr>

<div class="table_bottomlinks2" align="right" style="display:none">
<ul>
<li  style=" background:none;"><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfolder&parentid=1&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']; ?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" ><img src="images/new_folder.png" alt="add a new folder" width="45" height="39" align="absmiddle" /> </a><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfolder&parentid=1&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']; ?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" >+Add a new Folder  </a></li>

<li><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfile&parentid=1&pid=<?php echo $_REQUEST['pid']; ?>&mid=<?php echo $_REQUEST['mid']; ?>&path=<?php echo $_REQUEST['path']; ?>" rel="{handler: 'iframe', size: {x: 500, y: 250}}" > +Upload a file to this folder <img src="images/upload_folder.png" alt="Upload a file to this folder" width="37" height="36" align="middle" /></a></li> 
</ul>
</div>
</tr></table>