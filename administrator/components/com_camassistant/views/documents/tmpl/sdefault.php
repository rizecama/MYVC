<?php

/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here
JHTML::_('behavior.modal');
JToolBarHelper::title( JText::_( 'Shared Documents' ));
?>
<script type="text/javascript">
function submitform(pressbutton){
var form = document.adminForm;
if(pressbutton == 'lists')
{
window.location='index.php?option=com_camassistant';}

form.submit();
}
</script>
<?php

//TO get the company name and lisence number
		$userid = JRequest::getVar( 'managersid','');
		$db =& JFactory::getDBO();
		$query = "SELECT camfirm_license_no,comp_name FROM #__cam_customer_companyinfo WHERE cust_id=".$userid;
		$db->setQuery($query);
		$camfirmid = $db->loadObjectList();

		//TO get the user type
		$query_type = "SELECT user_type FROM #__users WHERE id=".$userid;
		$db->setQuery($query_type);
		$usertype = $db->loadResult();
		//Completed
		
	
//Completed		
?>
<div align="right"><a href="index.php?option=com_camassistant&controller=documents"><img src="images/back_admin.png" alt="info" /></a></div>
<table cellpadding="0" cellspacing="0" class="adminlist">
<tr>
<th class="title" align="center">cons</th>
<th class="title" align="center">Name</th>
<th class="title" align="center">options</th>
</tr>
<?php 

for ($i=0; $i<count($this->sdocs); $i++){
$sdocs = $this->sdocs[$i]; 
if($sdocs->sdocTitle){
$type = 'shared';
}
?>
<!--To get the file extension Modified by sateesh on 27-07-11-->
<?php 
$filename = $sdocs->sdocTitle;
$ext = end(explode('.', $filename));
$ext = substr(strrchr($filename, '.'), 1);
$ext = substr($filename, strrpos($filename, '.') + 1);
$ext = preg_replace('/^.*\.([^.]+)$/D', '$1', $filename);
$exts = split("[/\\.]", $filename);
$n = count($exts)-1;
$exts = $exts[$n];

if($exts=='gif' || $exts=='jpg' || $exts=='png' || $exts=='doc' || $exts=='psd' || $exts=='bmp' || $exts=='GIF' || $exts=='doc' || $exts=='docx' || $exts=='pdf' || $exts=='jpeg' || $exts=='rtf' || $exts=='xls' || $exts=='ppt' || $exts=='xlsx' || $exts=='docx' || $exts=='pptx'){
$exts = $exts;
$task = 'open';
$delete = 'filedelete';
if ($usertype=='13') { 
$path = 'components/com_camassistant/doc/'.str_replace(' ','_',$camfirmid[0]->comp_name).'_'.str_replace(' ','_',$camfirmid[0]->camfirm_license_no).'/'.$sdocs->sdocTitle; 
} else {
$path = 'components/com_camassistant/doc/'.str_replace(' ','_',$camfirmid[0]->comp_name).'_'.str_replace(' ','_',$camfirmid[0]->camfirm_license_no).'/'.$userid.'/'.$sdocs->sdocTitle;  
}
$type='shared';

} else{
$task = 'sopenfiles';
$exts = 'folder';
$delete = 'folderdelete';
if ($usertype=='13') {
$path = 'components/com_camassistant/doc/'.str_replace(' ','_',$camfirmid[0]->comp_name).'_'.str_replace(' ','_',$camfirmid[0]->camfirm_license_no).'/'.$sdocs->sdocTitle; 
} 
else{
$path = 'components/com_camassistant/doc/'.str_replace(' ','_',$camfirmid[0]->comp_name).'_'.str_replace(' ','_',$camfirmid[0]->camfirm_license_no).'/'.$userid.'/'.$sdocs->sdocTitle; 
}

$fileplace = $sdocs->sdocTitle;
$type='shared';
}

if($sdocs->parent_manager==0){
$path = str_replace($userid,'',$path);
$path = str_replace('//','/',$path);
$user = 'cam';
//echo $path;
}
else{
$companyname = $camfirmid[0]->comp_name.'_'.$camfirmid[0]->camfirm_license_no; 
$companyname = str_replace(' ','_',$companyname);
if ($usertype=='13') {
$paths = str_replace($companyname,$companyname.'/'.$sdocs->property_manager_id,$path);

} else{
$paths = $path;
}
$path = $paths;
$user = 'cust';
}
?>
<!--To get the file extension Modified by sateesh on 27-07-11 completed-->
<?php //echo "<pre>"; print_r($sdocs); ?>
<?php if($sdocs->sdocTitle){ ?>
<tr class="table_blue_rowdots2">
<!--<td><img src="images/doc.png" /></td>-->
<td align="center" valign="bottom"><a href="index.php?option=com_camassistant&controller=documents&Itemid=<?php echo $_REQUEST['Itemid']; ?>&propertyname=<?php print_r($sdocs->sdocTitle);  ?>&task=<?php echo $task; ?>&fileplace=<?php echo $fileplace; ?>&type=<?php echo $type; ?>&spath=<?php echo $path;?>&spid=<?php echo $sdocs->id; ?>&smid=<?php echo $userid; ?>&user=<?php echo $user; ?>"><img src="images/images_<?php echo $exts; ?>.png" /></a></td>

<td align="center" valign="middle"><a href="index.php?option=com_camassistant&controller=documents&Itemid=<?php echo $_REQUEST['Itemid']; ?>&propertyname=<?php print_r($sdocs->sdocTitle);  ?>&task=<?php echo $task; ?>&fileplace=<?php echo $fileplace; ?>&type=<?php echo $type; ?>&spath=<?php echo $path;?>&spid=<?php echo $sdocs->id; ?>&smid=<?php echo $userid; ?>&user=<?php echo $user; ?>"><?php echo str_replace('_',' ',$sdocs->sdocTitle);  ?></a>
</td>
<td align="center" valign="middle">
<a href="index.php?option=com_camassistant&controller=documents&Itemid=<?php echo $_REQUEST['Itemid']; ?>&propertyname=<?php print_r($sdocs->sdocTitle);  ?>&task=<?php echo $task; ?>&fileplace=<?php echo $fileplace; ?>&type=<?php echo $type; ?>&spath=<?php echo $path;?>&spid=<?php echo $sdocs->id; ?>&smid=<?php echo $userid; ?>&user=<?php echo $user; ?>">OPEN</a>
</td>
</tr>
<?php }  } ?>

<tr>

<div class="clear"></div>
<?php  
if ($usertype=='13') { 
$path = 'components/com_camassistant/doc/'.str_replace(' ','_',$camfirmid[0]->comp_name).'_'.$camfirmid[0]->camfirm_license_no; 
} else{
$path = 'components/com_camassistant/doc/'.str_replace(' ','_',$camfirmid[0]->comp_name).'_'.$camfirmid[0]->camfirm_license_no.'/'.$userid; 
}
?>
<div class="clear"></div><br />
<div class="table_bottomlinks2" style="float:right;">
<ul>
<li  style=" background:none;"><img src="images/new_folder.png" alt="add a new folder" width="45" height="39" align="absmiddle" /><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=saddfolder&type=shared&parentid=0&smid=<?php echo $userid; ?>&spath=<?php echo $path; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?> " rel="{handler: 'iframe', size: {x: 400, y: 200}}" >Add a folder</a></li>

<li><img src="images/upload_folder.png" alt="Upload a file to this folder" width="37" height="36" align="middle" /><a class="modal" id="links1"  title="Upload File"  href="index.php?option=com_camassistant&controller=documents&task=saddfile&type=shared&parentid=0&smid=<?php echo $userid; ?>&spath=<?php echo $path; ?>&Itemid=<?php echo $_REQUEST['Itemid']; ?>" rel="{handler: 'iframe', size: {x: 500, y: 250}}" >Upload a file</a></li> 
</ul>
</div>
</tr>
</table>