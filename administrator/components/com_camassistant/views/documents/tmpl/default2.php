<?php

/**
 * @version		1.0.0 cam assistant $
 * @package		cam_assistant
 * @copyright	Copyright Â© 2010 - All rights reserved.
 * @license		GNU/GPL
 * @author		
 * @author mail	nobody@nobody.com
 *
 *
 * @MVC architecture generated by MVC generator tool at http://www.alphaplug.com
 */

// no direct access
defined('_JEXEC') or die('Restricted access');

// Your custom code here
JHTML::_('behavior.modal');

//echo "this is default-2 file";
JToolBarHelper::title( JText::_( 'Property name' ));
echo "<h1><font color='red'>Property Name:</font>&nbsp;&nbsp;".$_REQUEST['propertyname']."</h1>";
$taxid = JRequest::getVar( 'taxid','' );
$userid = JRequest::getVar( 'mid','' );
?>
<link rel="stylesheet" media="all" type="text/css" href="<?php echo Juri::root(); ?>components/com_camassistant/skin/css/jquery1.css" />
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="<?php echo Juri::root(); ?>components/com_camassistant/skin/js/jquery.elastic.js"></script>

<script type="text/javascript">
function submitform(pressbutton){
var form = document.adminForm;
if(pressbutton == 'lists')
{
window.location='index.php?option=com_camassistant';}

form.submit();
}
G = jQuery.noConflict();
function deletefiles(filename,id,pid,type,redirect,path){
if(type == 'folder'){
var con = confirm("Are you sure you want to delete this folder "+filename+" completely? ");
}
else{
var con = confirm("Are you sure you want to delete this file "+filename+" ");
}
if(con==true){
//window.location = "index.php?option=com_camassistant&controller=documents&task=deletefiles&id="+id+"&name="+filename+"&propertyid="+pid+" ";
G.post("index.php?option=com_camassistant&controller=documents&task=deletefiles&id="+id+"&name="+filename+"&propertyid="+pid+"&path="+path+"", function(data){

		if(data == 'success')
		{
		alert("File deleted successfully");
		window.location = redirect;
		}
		else{
		alert("Please try again");
		}
		})
}
if(con == false)
		{
		window.location.href;
		}
}
</script>
<?php if($_REQUEST['task'] == 'pfiles'){ $link = 'index.php?option=com_camassistant&controller=documents&task=pdocs&managerid='.$userid.'&Itemid=82'; }  ?>
<div align="right"><a href="<?php echo $link; ?>"><img alt="BACK" src="images/back_admin.png"></a></div>
<br /><br />
<table cellpadding="0" cellspacing="0" class="adminlist">
  <tr>
  	<th class="title" align="center">Icons</th>
    <th class="title" align="center">Name</th>
    <th class="title" align="center">options</th>
    </tr>
  
  <?php 

  if(count($this->pfiles)){
//  print_r($this->pfiles);
for ($i=0; $i<count($this->pfiles); $i++){
$pfiles = $this->pfiles[$i]; 

$file = substr($pfiles->docTitle,-4,-3);
if($file!='.') {

?>
<tr>
<td align="center"><img src="images/folder_icon.png" /></td>
    <td align="center" valign="middle"><a href="index.php?option=com_camassistant&controller=documents&task=openfiles&pid=<?php echo $pfiles->property_id; ?>&mid=<?php echo $pfiles->property_manager_id; ?>&path=<?php echo $pfiles->docPath; ?>&fileplace=<?php echo $_REQUEST['propertyname']."-->".$pfiles->docTitle;?>&taxid=<?php echo $taxid; ?>"><?php echo $pfiles->docTitle; ?></a>
</td>
<td align="center" valign="middle">

<a href="index.php?option=com_camassistant&controller=documents&task=openfiles&pid=<?php echo $pfiles->property_id; ?>&mid=<?php echo $pfiles->property_manager_id; ?>&path=<?php echo $pfiles->docPath; ?>&fileplace=<?php echo $_REQUEST['propertyname']."-->".$pfiles->docTitle;?>&taxid=<?php echo $taxid; ?>">OPEN </a> 

<?php /*?><a href="javascript:deletefiles('<?php echo $pfiles->docTitle; ?>','<?php echo $pfiles->id; ?>','<?php echo $pfiles->property_id; ?>','folder','<?php echo "http://".$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']; ?>')">DELETE</a><?php */?>

</td>
</tr>
<?php } } 


for ($i=0; $i<count($this->pfiles); $i++){
$pfiles = $this->pfiles[$i]; 

$file = substr($pfiles->docTitle,-4,-3);
if($file=='.') {

$path = $pfiles->docPath;
$file = $pfiles->docTitle;
$path=str_replace($file,"",$path);
$path=str_replace("//","",$path);
$ext = end(explode('.', $pfiles->docTitle));

?>
<tr>
<td align="center"><img src="images/images_<?php echo $ext; ?>.png"  alt="file" /></td>
<td align="center" valign="middle"><a href="index.php?option=com_camassistant&controller=documents&task=open&title=<?php echo $pfiles->docTitle; ?>&path=<?php echo $path; ?> "><?php echo str_replace('_',' ',$pfiles->docTitle); ?></a>
</td>
<td align="center" valign="middle"><a href="index.php?option=com_camassistant&controller=documents&task=open&title=<?php echo $pfiles->docTitle; ?>&path=<?php echo $path; ?> ">OPEN</a> | 
<a href="javascript:deletefiles('<?php echo $pfiles->docTitle; ?>','<?php echo $pfiles->id; ?>','<?php echo $pfiles->property_id; ?>','file','<?php echo "http://".$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']; ?>','<?php echo $path; ?>')">DELETE</a>

</td>
</tr>
<?php } } 
}
 else { ?>
<tr class="table_blue_rowdots2">
    <td align="center" valign="middle"><?php echo "No files in this folder"; ?></td>
</tr>
<?php } ?>

<?php $val = 'components/com_camassistant/doc/'; 
if($pfiles->property_id ==''){
$pfiles->property_id = $_REQUEST['pid'];
}
if($pfiles->property_manager_id ==''){
$pfiles->property_manager_id = $_REQUEST['mid'];
} 
$_REQUEST['propertyname'] = ereg_replace(' ','_',$_REQUEST['propertyname']);
?>
<?php 
$taxid = JRequest::getVar( 'taxid','' );
?>

<tr>
<div class="table_bottomlinks2" align="right" style="display:none">
<ul>

<li  style=" background:none;"><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfolder&parentid=0&pid=<?php echo $pfiles->property_id; ?>&mid=<?php echo $pfiles->property_manager_id; ?>&path=<?php echo $val.$_REQUEST['propertyname'].'_'.$taxid; ?>&propertyname=<?php echo $_REQUEST['propertyname'];?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" ><img src="images/new_folder.png" alt="add a new folder" width="45" height="39" align="absmiddle" /> </a><a class="modal" id="links1"  title="Add Folder"  href="index.php?option=com_camassistant&controller=documents&task=addfolder&parentid=0&pid=<?php echo $pfiles->property_id; ?>&mid=<?php echo $pfiles->property_manager_id; ?>&path=<?php echo $val.$_REQUEST['propertyname'].'_'.$taxid;; ?>&propertyname=<?php echo $_REQUEST['propertyname'];?>" rel="{handler: 'iframe', size: {x: 400, y: 200}}" >+Add a new Folder  </a></li>

<li><a class="modal" id="links1"  title="Upload File"  href="index.php?option=com_camassistant&controller=documents&task=addfile&parentid=0&pid=<?php echo $pfiles->property_id; ?>&mid=<?php echo $pfiles->property_manager_id; ?>&path=<?php echo $val.$_REQUEST['propertyname'].'_'.$taxid; ?>" rel="{handler: 'iframe', size: {x: 500, y: 250}}" > +Upload a file to this folder </a><a class="modal" id="links1"  title="Upload File"  href="index.php?option=com_camassistant&controller=documents&task=addfile&parentid=0&pid=<?php echo $pfiles->property_id; ?>&mid=<?php echo $pfiles->property_manager_id; ?>&path=<?php echo $val.$_REQUEST['propertyname'].'_'.$taxid; ?>" rel="{handler: 'iframe', size: {x: 500, y: 250}}" ><img src="images/upload_folder.png" alt="Upload a file to this folder" width="37" height="36" align="middle" /></a></li> 
</ul>
</div>
</tr>
</table>
